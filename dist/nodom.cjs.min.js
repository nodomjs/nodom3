"use strict";function e(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var i=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}Object.defineProperty(exports,"__esModule",{value:!0});class t{static add(e,t){if(Array.isArray(e))for(let t of e)this.elements.set(t.name.toUpperCase(),t);else this.elements.set((t||e.name).toUpperCase(),e)}static get(e){return this.elements.get(e.toUpperCase())}static has(e){return this.elements.has(e.toUpperCase())}}t.elements=new Map;class s{constructor(e,t,s){this.name=e,this.prio=s>=0?s:10,this.handle=t}}class i{static addType(e,t,i){this.directiveTypes.set(e,new s(e,t,i))}static removeType(e){this.directiveTypes.delete(e)}static getType(e){return this.directiveTypes.get(e)}static hasType(e){return this.directiveTypes.has(e)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function r(e,t,s,i){return new(s||(s=Promise))((function(r,o){function n(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,a)}l((i=i.apply(e,t||[])).next())}))}i.directiveTypes=new Map;const o={TipWords:{application:"Application",system:"System",module:"Module",moduleClass:"ModuleClass",model:"Model",directive:"Directive",directiveType:"Directive-type",expression:"Expression",event:"Event",method:"Method",filter:"Filter",filterType:"Filter-type",data:"Data",dataItem:"Data-item",route:"Route",routeView:"Route-container",plugin:"Plugin",resource:"Resource",root:"Root",element:"VirtualDom"},ErrorMsgs:{unknown:"unknown error",paramException:"{0} '{1}' parameter error，see api",invoke:"method {0} parameter {1} must be {2}",invoke1:"method {0} parameter {1} must be {2} or {3}",invoke2:"method {0} parameter {1} or {2} must be {3}",invoke3:"method {0} parameter {1} not allowed empty",exist:"{0} is already exist",exist1:"{0} '{1}' is already exist",notexist:"{0} is not exist",notexist1:"{0} '{1}' is not exist",notupd:"{0} not allow to change",notremove:"{0} not allow to delete",notremove1:"{0} {1} not allow to delete",namedinvalid:"{0} {1} name error，see name rules",initial:"{0} init parameter error",jsonparse:"JSON parse error",timeout:"request overtime",config:"{0} config parameter error",config1:"{0} config parameter '{1}' error",itemnotempty:"{0} '{1}' config item '{2}' not allow empty",itemincorrect:"{0} '{1}' config item '{2}' error",wrongTemplate:"wrong template"},FormMsgs:{type:"please input valid {0}",unknown:"input error",required:"is required",min:"min value is {0}",max:"max value is {0}"},WeekDays:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}};class n{static add(e){0===this.modules.size&&(this.mainModule=e),this.modules.set(e.id,e),this.addClass(e.constructor)}static get(e){return"number"==typeof e?this.modules.get(e):this.getInstance(e)}static hasClass(e){return this.classes.has(e.toLowerCase())}static addClass(e,t){let s=e.name.toLowerCase();this.classes.has(s)||(this.classes.set(s,e),t&&this.classes.set(t,e))}static getInstance(e){let t,s="string"==typeof e?e:e.name.toLowerCase();if(t=this.classes.has(s)||"function"!=typeof e?this.classes.get(s):e,!t)return;let i=Reflect.construct(t,[]);return i.init(),i}static remove(e){this.modules.delete(e)}static setMain(e){this.mainModule=e}static getMain(){return this.mainModule}}n.modules=new Map,n.classes=new Map;class a{constructor(e,t){if(this.id=v.genId(),this.allModelField=!0,!e||!t)return;const s=this.compile(t);this.execFunc=new Function("$model","return "+s)}compile(e){const t=/('[\s\S]*?')|("[\s\S]*?")|(`[\s\S]*?`)|([a-zA-Z$_][\w$]*\s*?:)|((\.{3}|\.)?[a-zA-Z$_][\w$]*(\.[a-zA-Z$_][\w$]*)*(\s*[\[\(](\s*\))?)?)/g;let s,i="",r=0;for(;null!==(s=t.exec(e));){let n=s[0];if(r<s.index&&(i+=e.substring(r,s.index)),"'"===n[0]||'"'===n[0]||"`"===n[0])i+=n;else{let e=n[n.length-1];if(":"===e)i+=n;else if("("===e||")"===e)i+=o(n);else if(n.startsWith("this.")||"$model"===n||n.startsWith("$model.")||v.isKeyWord(n)||"."===n[0]&&"."!==n[1])i+=n;else{let e="";n.startsWith("...")&&(e="...",n=n.substr(3)),i+=e+"$model."+n,-1!==n.indexOf(".")&&(this.allModelField=!1)}}r=t.lastIndex}return r<e.length&&(i+=e.substr(r)),i;function o(e){let t=e.indexOf(".");if(-1===t){let t=e.lastIndexOf("("),s=e.substr(0,t);if(!v.isKeyWord(s)){return")"!==e[e.length-1]?'this.invokeMethod("'+s+'",':'this.invokeMethod("'+s+'")'}}else if("."!==e[0]){let s=e.substr(0,t);if(!v.isKeyWord(s))return"$model."+e}return e}}val(e,t){let s;try{s=this.execFunc.apply(e,[t])}catch(e){}return this.value=s,s}clone(){return this}}class l{static handleStyleDom(e,t,s,i){return"style"===t.tagName.toLowerCase()&&(i?s.addClass(this.cssPreName+e.id):s.removeClass(this.cssPreName+e.id),!0)}static handleStyleTextDom(e,t){return"style"===t.parent.tagName.toLowerCase()&&(l.addRules(e,t.textContent,"this"===t.parent.props.scope?"."+this.cssPreName+e.id:void 0),!0)}static addRules(e,t,s){if(!this.sheet){let e=document.createElement("style");document.head.appendChild(e),this.sheet=document.styleSheets[0]}s&&this.clearModuleRules(e);const i=/(@[a-zA-Z]+\s+url\(.+?\))|([.#@a-zA-Z]\S*(\s*\S*\s*?)?{)|\}/g,r=/@[a-zA-Z]+\s+url/;let o,n=-1,a=0;for(;null!==(o=i.exec(t));)if(r.test(o[0]))h(o[0]);else if("}"===o[0]){if(n>=0&&--a<=0){let i=t.substring(n,o.index+1);"@"===i[0]?this.sheet.insertRule(i,l.sheet.cssRules?l.sheet.cssRules.length:0):d(e,i,s),n=-1,a=0}}else-1===n?(n=o.index,a++):a++;function d(e,t,s){let i=/.+(?=\{)/.exec(t);if(i){if(s){let r=e.objectManager.get("$cssRules");r||(r=[],e.objectManager.set("$cssRules",r)),r.push(s+" "+i[0]),t=s+" "+t}l.sheet.insertRule(t,l.sheet.cssRules?l.sheet.cssRules.length:0)}}function h(e){let t;if(null!==(t=/(?<=\()\S+(?=\))/.exec(e))){if(l.importMap.has(t[0]))return;l.sheet.insertRule(e,l.importIndex++),l.importMap.set(t[0],!0)}}}static clearModuleRules(e){let t=e.objectManager.get("$cssRules");if(t&&0!==t.length){for(let e=0;e<this.sheet.cssRules.length;e++){let s=this.sheet.cssRules[e];s.selectorText&&-1!==t.indexOf(s.selectorText)&&this.sheet.deleteRule(e--)}e.objectManager.set("$cssRules",[])}}}l.importMap=new Map,l.importIndex=0,l.cssPreName="___nodommodule___";class d{constructor(e,t,s,i){if(this.id=v.genId(),this.module=e,this.name=t,s){let e=typeof s;if("string"===e){s.trim().split(":").forEach(((e,t)=>{if(e=e.trim(),0===t)this.handler=e;else switch(e){case"delg":this.delg=!0;break;case"nopopo":this.nopopo=!0;break;case"once":this.once=!0;break;case"capture":this.capture=!0}}))}else"function"===e&&(i=s)}if(i&&(this.handler=i),document.ontouchend)switch(this.name){case"click":this.name="tap";break;case"mousedown":this.name="touchstart";break;case"mouseup":this.name="touchend";break;case"mousemove":this.name="touchmove"}else switch(this.name){case"tap":this.name="click";break;case"touchstart":this.name="mousedown";break;case"touchend":this.name="mouseup";break;case"touchmove":this.name="mousemove"}}setParam(e,t,s,i){e.objectManager.setEventParam(this.id,t.key,s,i)}getParam(e,t,s){return e.objectManager.getEventParam(this.id,t.key,s)}removeParam(e,t,s){return e.objectManager.removeEventParam(this.id,t.key,s)}clearParam(e,t){e.objectManager.clearEventParam(this.id,t.key)}}class h{static bind(e,t){const s=e.eventFactory.getEvent(t.key);if(!s)return;const i=t.parent;for(let o of s)if("bindMap"!==o[0]){if(o[1].toDelg)for(let s=0;s<o[1].toDelg.length;s++){let n=o[1].toDelg[s];e.eventFactory.addEvent(i.key,n,t.key),e.eventFactory.bind(i.key,o[0],r,n.capture)}o[1].own&&e.eventFactory.bind(t.key,o[0],r,o[1].capture)}function r(t){let s=t.currentTarget;const i=e.getVirtualDom(s.vdom),r=e.eventFactory.getEvent(i.key);if(!i||!r||!r.has(t.type))return;const o=r.get(t.type);function n(s){if(!s)return;let r=!1;for(let o=0;o<s.length;o++){const n=s[o];if("string"==typeof n.handler&&(n.handler=n.module.getMethod(n.handler)),!n.handler)return;n.handler.apply(n.module||e,[i.model,i,n,t]),n.once&&s.splice(o--,1),r=n.nopopo}r&&t.stopPropagation()}function a(i){if(!i)return!1;let r=!1;for(let o=0;o<i.length;o++){const n=i[o],a=n.event;if("string"==typeof a.handler&&(a.handler=a.module.getMethod(a.handler)),!a.handler)return;for(let l=0;l<t.path.length&&t.path[l]!==s;l++)if(t.path[l].vdom===n.key){let s=e.getVirtualDom(n.key);a.handler.apply(a.module||e,[s.model,s,a,t]),r=a.nopopo,a.once&&(i.splice(o--,1),e.eventFactory.removeEvent(s.key,a,null,!0));break}}return r}o.capture?(n(o.own),a(o.delg)):a(o.delg)||n(o.own),o.own&&0===o.own.length&&delete o.own,o.delg&&0===o.delg.length&&delete o.delg}}static handleExtendEvent(e,t,s){let i=this.get(s.name);if(!i)return!1;for(let r of Object.keys(i)){let o=new d(e,r,i[r]);o.capture=s.capture,o.nopopo=s.nopopo,o.delg=s.delg,o.once=s.once,o.dependEvent=s,e.eventFactory.addEvent(t.key,o)}return!0}static regist(e,t){this.extendEventMap.set(e,t)}static unregist(e){return this.extendEventMap.delete(e)}static get(e){return this.extendEventMap.get(e)}}h.extendEventMap=new Map;class c{static add(e){e.dontAddToRender||this.waitList.includes(e.id)||this.waitList.push(e.id)}static render(){for(;this.waitList.length>0;)n.get(this.waitList.shift()).render()}static renderDom(e,t,s,i,r){let o={key:r?t.key+"_"+r:t.key,vdom:t};if(e.saveVirtualDom(o),t.tagName?(o.tagName=t.tagName,o.props={}):o.textContent=t.textContent,s=t.model||s,i?(s||(s=i.model),o.parent=i):this.currentModuleRoot=t,s||(s=e.model),o.model=s,t.staticNum>0&&t.staticNum--,t.directives&&t.directives.length>0&&"model"===t.directives[0].type.name&&t.directives[0].exec(e,o,t),o.tagName){if(!o.notChange){if(function(){if(!t.props||0===t.props.size)return;for(let s of t.props)s[1]instanceof a?(o.props[s[0]]=s[1].val(e,o.model),o.staticNum=-1):o.props[s[0]]=s[1]}(),!l.handleStyleDom(e,t,c.currentModuleRoot,"this"===t.getProp("scope"))&&t.assets&&t.assets.size>0)for(let e of t.assets)o[e[0]]=e[1];if(!function(){if(!t.directives||0===t.directives.length)return!0;o.staticNum=-1;for(let s of t.directives)if("model"!==s.type.name&&!s.exec(e,o,t))return!1;return!0}())return o}if(t.events&&!e.eventFactory.getEvent(o.key))for(let s of t.events)e.eventFactory.addEvent(o.key,s);if(t.children&&t.children.length>0){o.children=[];for(let s of t.children)c.renderDom(e,s,o.model,o,r||null)}}else if(!o.notChange)if(t.expressions){let s="";t.expressions.forEach((t=>{if(t instanceof a){let i=t.val(e,o.model);s+=void 0!==i?i:""}else s+=t})),o.textContent=s,o.staticNum=-1}else o.textContent=t.textContent;return i&&!o.dontAddToTree&&i.children.push(o),o}static renderToHtml(e,t,s,i){let r=e.getNode(t.key);if(r)if(t.tagName){let e=r.attributes,s=[];for(let t=0;t<e.length;t++)s.push(e[t].name);for(let e of Object.keys(t.props)){let i;r.setAttribute(e,void 0===t.props[e]?"":t.props[e]),-1!==(i=s.indexOf(e))&&s.splice(i,1)}if(s.length>0)for(let e of s)r.removeAttribute(e);!function(e,t){if(e.assets)for(let s of Object.keys(e.assets))t[s]=e.assets[s]}(t,r)}else r.textContent=t.textContent;else r=t.tagName?o(t):n(t),r&&t.tagName&&i&&function e(t,s){s.children&&s.children.length>0&&s.children.forEach((s=>{let i;s.tagName?(i=o(s),e(i,s)):i=n(s),i&&t.appendChild(i)}))}(r,t),r&&s&&s.appendChild(r);return r;function o(t){if("style"===t.tagName.toLowerCase())return;let s=document.createElement(t.tagName);if(s.vdom=t.key,e.saveNode(t.key,s),t.props.key&&e.saveElement(t.key,s),!t.subModuleId){for(let e of Object.keys(t.props))s.setAttribute(e,void 0===t.props[e]?"":t.props[e]);if(t.assets)for(let e of Object.keys(t.assets))s[e]=t.assets[e];h.bind(e,t)}return s}function n(t){if(l.handleStyleTextDom(e,t))return;let s=document.createTextNode(t.textContent||"");return e.saveNode(t.key,s),s}}static handleChangedDoms(e,t){for(let s of t){let[t,i,r]=[s[1]?e.getNode(s[1].key):null,s[2]&&"object"==typeof s[2]?e.getNode(s[2].key):null,s[3]?e.getNode(s[3].key):null];switch(s[0]){case 1:c.renderToHtml(e,s[1],r,!0),t=e.getNode(s[1].key),i?r.insertBefore(t,i):"number"==typeof s[2]&&r.childNodes.length-1>s[2]?r.insertBefore(t,r.childNodes[s[2]]):r.appendChild(t);break;case 2:c.renderToHtml(e,s[1],null,!1);break;case 3:r&&t&&r.removeChild(t),e.removeNode(s[1],!0);break;case 4:s[4]?i&&i.nextSibling?r.insertBefore(t,i.nextSibling):r.appendChild(t):r.insertBefore(t,i);break;default:c.renderToHtml(e,s[1],r,!0),t=e.getNode(s[1].key),r.replaceChild(t,i)}}}}var p;c.waitList=[],exports.EModuleState=void 0,(p=exports.EModuleState||(exports.EModuleState={}))[p.INITED=1]="INITED",p[p.UNACTIVE=2]="UNACTIVE",p[p.RENDERED=4]="RENDERED";class u{static go(e){e!==this.currentPath&&(-1===this.waitList.indexOf(e)&&this.waitList.push(e),setTimeout((()=>{this.load()}),0))}static load(){if(0===this.waitList.length)return;let e=this.waitList.shift();this.start(e).then((()=>{this.load()}))}static start(e){return r(this,void 0,void 0,(function*(){let t,s=this.compare(this.currentPath,e);t=null===s[0]?n.getMain():yield this.getModule(s[0]);for(let e=s[1].length-1;e>=0;e--){const t=s[1][e];if(!t.module)continue;let i=yield this.getModule(t);v.isFunction(this.onDefaultLeave)&&this.onDefaultLeave(i.model),v.isFunction(t.onLeave)&&t.onLeave(i.model),this.activeFieldMap.delete(i.id),i.unactive(!0)}if(0===s[2].length){let e=s[0];if(null!==e){let t=yield this.getModule(e);this.dependHandle(t,e,s[3]?s[3].module:null)}}else for(let e=0;e<s[2].length;e++){let i=s[2][e];if(!i||!i.module)continue;let r=yield this.getModule(i);this.dependHandle(r,i,t),v.isFunction(this.onDefaultEnter)&&this.onDefaultEnter(r.model),v.isFunction(i.onEnter)&&i.onEnter(r.model),t=r}0===this.startStyle&&(e.startsWith(this.currentPath)?history.replaceState(e,"",e):history.pushState(e,"",e)),this.currentPath=e,this.startStyle=0}))}static redirect(e){this.go(e)}static getModule(t){return r(this,void 0,void 0,(function*(){let s=t.module;return"object"==typeof s||("string"==typeof s&&t.modulePath&&(s=yield(i=t.modulePath,Promise.resolve().then((function(){return e(require(i))}))),s=s[t.module]),"function"==typeof s&&(s=n.get(s)),t.module=s),s;var i}))}static compare(e,t){let s=null,i=null;e&&(s=this.getRouteList(e,!0)),t&&(i=this.getRouteList(t));let r=0;null!==s&&(r=s.length),null!==i?i.length<r&&(r=i.length):r=0;let o=[],n=[],a=0;for(a=0;a<r&&s[a].id===i[a].id;a++)if(JSON.stringify(s[a].data)!==JSON.stringify(i[a].data)){a++;break}null!==s&&(o=s.slice(a)),null!==i&&(n=i.slice(a));let l=null,d=null;if(i&&a>0)for(let e=a-1;e>=0;e--)if(l){if(!d&&i[e].module){d=i[e];break}}else if(i[e].module){l=i[e];continue}return[l,o,n,d]}static addActiveField(e,t,s,i){if(!s||!i)return;let r=u.activeFieldMap.get(e.id);r?void 0===r.find((e=>e.model===s&&e.field===i))&&r.push({path:t,model:s,field:i}):u.activeFieldMap.set(e.id,[{path:t,model:s,field:i}])}static dependHandle(e,t,s){const i=this;e.active(!0);let r={path:t.path};v.isEmpty(t.data)||(r.data=t.data),e.model.$route=r,s&&(s.state===exports.EModuleState.RENDERED?(e.setContainer(s.getNode(u.routerKeyMap.get(s.id))),this.setDomActive(s,t.fullPath)):s.addRenderOps((function(t,s){e.setContainer(t.getNode(u.routerKeyMap.get(t.id))),i.setDomActive(t,s)}),1,[s,t.fullPath],!0))}static setDomActive(e,t){let s=u.activeFieldMap.get(e.id);if(s)for(let e of s)e.model[e.field]=e.path===t}static addRoute(e,t){this.root||(this.root=new m);let s=e.path.split("/"),i=t||this.root,r=[],o=-1,n="";for(let t=0;t<s.length;t++){let a=s[t].trim();if(""!==a){if(a.startsWith(":"))0===r.length&&(o=t),r.push(a.substr(1));else{o=-1,r=[],e.path=a;let t=0;for(;t<i.children.length;t++){let e=i.children[t];if(e.path===a){i=e;break}}t===i.children.length&&(""!==n&&(new m({path:n,parent:i}),i=i.children[i.children.length-1]),n=a)}e.params=-1===o?[]:r}else s.splice(t--,1)}void 0!==i&&i!==e&&(e.path=n,i.addChild(e)),this.routeMap.set(e.id,e)}static getRouteList(e,t){if(!this.root)return[];let s=e.split("/"),i=this.root,r=0,o=[],n="",a=this.root;for(let e=0;e<s.length;e++){let l=s[e].trim();if(""===l)continue;let d=!1;for(let e=0;e<i.children.length;e++)if(i.children[e].path===l){a!==this.root&&(a.fullPath=n,a.data=i.data,o.push(a)),i=t?i.children[e].clone():i.children[e],i.data={},a=i,d=!0,r=0;break}n+="/"+l,d||r<i.params.length&&(i.data[i.params[r++]]=l)}return i!==this.root&&(i.fullPath=n,o.push(i)),o}}u.routeMap=new Map,u.waitList=[],u.startStyle=0,u.activeFieldMap=new Map,u.routerKeyMap=new Map,window.addEventListener("popstate",(function(e){const t=history.state;t&&(u.startStyle=1,u.go(t))}));class m{constructor(e){if(this.params=[],this.data={},this.children=[],e&&!v.isEmpty(e.path)){for(let t in e)this[t]=e[t];this.id=v.genId(),u.addRoute(this,e.parent),e.routes&&Array.isArray(e.routes)&&e.routes.forEach((e=>{e.parent=this,new m(e)}))}}addChild(e){this.children.push(e),e.parent=this}clone(){let e=new m;return Object.getOwnPropertyNames(this).forEach((t=>{"data"!==t&&(e[t]=this[t])})),this.data&&(e.data=v.clone(this.data)),e}}class f{static dispatch(){f.tasks.forEach((e=>{v.isFunction(e.func)&&(e.thiser?e.func.call(e.thiser):e.func())}))}static start(e){f.dispatch(),window.requestAnimationFrame?window.requestAnimationFrame(f.start):window.setTimeout(f.start,e||50)}static addTask(e,t){if(!v.isFunction(e))throw new y("invoke","Scheduler.addTask","0","function");f.tasks.push({func:e,thiser:t})}static removeTask(e){if(!v.isFunction(e))throw new y("invoke","Scheduler.removeTask","0","function");let t=-1;-1!==(t=f.tasks.indexOf(e))&&f.tasks.splice(t,1)}}function g(e,t,s){return i.addType(e,t,s)}f.tasks=[],exports.NodomMessage=void 0;class y extends Error{constructor(e,t,s,i,r){super(e);let o=exports.NodomMessage.ErrorMsgs[e];if(void 0===o)return void(this.message="未知错误");let n=[o];for(let e=1;e<arguments.length;e++)n.push(arguments[e]);this.message=v.compileStr.apply(null,n)}}class v{static genId(){return this.generatedId++}static initKeyMap(){this.keyWordMap.set("arguments",!0),this.keyWordMap.set("boolean",!0),this.keyWordMap.set("break",!0),this.keyWordMap.set("byte",!0),this.keyWordMap.set("catch",!0),this.keyWordMap.set("char",!0),this.keyWordMap.set("const",!0),this.keyWordMap.set("default",!0),this.keyWordMap.set("delete",!0),this.keyWordMap.set("do",!0),this.keyWordMap.set("double",!0),this.keyWordMap.set("else",!0),this.keyWordMap.set("enum",!0),this.keyWordMap.set("eval",!0),this.keyWordMap.set("false",!0),this.keyWordMap.set("float",!0),this.keyWordMap.set("for",!0),this.keyWordMap.set("function",!0),this.keyWordMap.set("goto",!0),this.keyWordMap.set("if",!0),this.keyWordMap.set("in",!0),this.keyWordMap.set("instanceof",!0),this.keyWordMap.set("int",!0),this.keyWordMap.set("let",!0),this.keyWordMap.set("long",!0),this.keyWordMap.set("new",!0),this.keyWordMap.set("null",!0),this.keyWordMap.set("return",!0),this.keyWordMap.set("short",!0),this.keyWordMap.set("switch",!0),this.keyWordMap.set("this",!0),this.keyWordMap.set("throw",!0),this.keyWordMap.set("true",!0),this.keyWordMap.set("try",!0),this.keyWordMap.set("this",!0),this.keyWordMap.set("throw",!0),this.keyWordMap.set("typeof",!0),this.keyWordMap.set("var",!0),this.keyWordMap.set("while",!0),this.keyWordMap.set("with",!0),this.keyWordMap.set("Array",!0),this.keyWordMap.set("Date",!0),this.keyWordMap.set("JSON",!0),this.keyWordMap.set("Set",!0),this.keyWordMap.set("Map",!0),this.keyWordMap.set("eval",!0),this.keyWordMap.set("function",!0),this.keyWordMap.set("Infinity",!0),this.keyWordMap.set("isFinite",!0),this.keyWordMap.set("isNaN",!0),this.keyWordMap.set("isPrototypeOf",!0),this.keyWordMap.set("Math",!0),this.keyWordMap.set("NaN",!0),this.keyWordMap.set("Number",!0),this.keyWordMap.set("Object",!0),this.keyWordMap.set("prototype",!0),this.keyWordMap.set("String",!0),this.keyWordMap.set("isPrototypeOf",!0),this.keyWordMap.set("undefined",!0),this.keyWordMap.set("valueOf",!0)}static isKeyWord(e){return this.keyWordMap.has(e)}static clone(e,t,s){let i=this,r=new WeakMap;return o(e,t,s);function o(e,t,s){if(!e||"object"!=typeof e||v.isFunction(e))return e;let o;return e.clone&&v.isFunction(e.clone)?e.clone(s):(i.isObject(e)?(o=new Object,r.set(e,o),Object.getOwnPropertyNames(e).forEach((i=>{t&&(t.constructor===RegExp&&t.test(i)||v.isArray(t)&&t.includes(i))||(o[i]=n(e[i],t,s))}))):i.isMap(e)?(o=new Map,e.forEach(((e,i)=>{t&&(t.constructor===RegExp&&t.test(i)||t.includes(i))||o.set(i,n(e,t,s))}))):i.isArray(e)&&(o=new Array,e.forEach((function(e,i){o[i]=n(e,t,s)}))),o)}function n(e,t,s){if("object"==typeof e&&!v.isFunction(e)){let i=null;return i=r.has(e)?r.get(e):o(e,t,s),i}return e}}static merge(e,t,s,i,r,o){let n=this;for(let e=0;e<arguments.length;e++)if(!this.isObject(arguments[e]))throw new y("invoke","Util.merge",e+"","object");let a=Object.assign.apply(null,arguments);return function(e){for(let t in e)(n.isObject(e[t])||n.isArray(e[t]))&&(a[t]=n.clone(a[t]))}(a),a}static assign(e,t){return Object.assign?Object.assign(e,t):this.getOwnProps(t).forEach((function(s){e[s]=t[s]})),e}static compare(e,t,s){if(!e&&!t)return!0;if("object"!=typeof e||"object"!=typeof t)return!1;const i=Object.getOwnPropertyNames(e);if(i.length!==Object.getOwnPropertyNames(t).length)return!1;for(let s of i)if(e[s]!==t[s])return!1;if(s)for(let s of i){if(!this.compare(e[s],t[s]))return!1}return!0}static getOwnProps(e){return e?Object.getOwnPropertyNames(e):[]}static isFunction(e){return null!=e&&e.constructor===Function}static isArray(e){return Array.isArray(e)}static isMap(e){return null!=e&&e.constructor===Map}static isObject(e){return null!=e&&e.constructor===Object}static isInt(e){return Number.isInteger(e)}static isNumber(e){return"number"==typeof e}static isBoolean(e){return"boolean"==typeof e}static isString(e){return"string"==typeof e}static isNumberString(e){return/^\d+\.?\d*$/.test(e)}static isEmpty(e){if(null==e)return!0;let t=typeof e;if(this.isObject(e)){let t=Object.keys(e);if(void 0!==t)return 0===t.length}else if("string"===t)return""===e;return!1}static replaceNode(e,t){let s=e.parentNode,i=e.nextSibling;if(null===s)return;s.removeChild(e);(this.isArray(t)?t:[t]).forEach((function(e){null==i?s.appendChild(e):s.insertBefore(e,i)}))}static empty(e){let t=e.childNodes;for(let s=t.length-1;s>=0;s--)e.removeChild(t[s])}static formatDate(e,t){let s;if(this.isString(e)){!0===/^\d+$/.test(e)&&(s=parseInt(e))}else{if(!this.isNumber(e))throw new y("invoke","this.formatDate","0","date string","date");s=e}let i=new Date(s);if(isNaN(i.getDay()))return"";let r={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours()%12==0?12:i.getHours()%12,"H+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};return/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length))),this.getOwnProps(r).forEach((function(e){new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?r[e]:("00"+r[e]).substr((""+r[e]).length)))})),/(E+)/.test(t)&&(t=t.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+exports.NodomMessage.WeekDays[i.getDay()+""])),t}static compileStr(e,t,s,i,r,o){let n,a=arguments,l=0;for(;-1!==e.indexOf("{"+l+"}");)n=new RegExp("\\{"+l+"\\}","g"),e=e.replace(n,a[l+1]),l++;return e}static apply(e,t,s){if(e)return Reflect.apply(e,t||null,s)}static mergePath(e){return e.join("/").replace(/(\/{2,})|\\\//g,"/")}static eval(e){return new Function(`return(${e})`)()}static setNodeKey(e,t,s){if(e.key+="_"+(t||v.genId()),s&&e.children)for(let i of e.children)v.setNodeKey(i,t,s)}static setDomAsset(e,t,s){e.assets||(e.assets={}),e.assets[t]=s}static delDomAsset(e,t){e.assets&&delete e.assets[t]}}v.generatedId=1,v.keyWordMap=new Map,v.initKeyMap();class M{constructor(e,t){if(this.id=v.genId(),e&&(this.type=i.getType(e),!this.type))throw new y("notexist1",exports.NodomMessage.TipWords.directive,e);v.isString(t)?this.value=t.trim():t instanceof a?this.expression=t:this.value=t}exec(e,t,s){return!!this.disabled||(this.expression&&(this.value=this.expression.val(e,t.model)),this.type.handle.apply(this,[e,t,s]))}clone(){let e=new M;return e.type=this.type,e.expression=this.expression,e.value=this.value,e}}class k{constructor(e,t,s){this.staticNum=0,this.allModelField=!0,this.key=t||(s?s.getDomKeyId():v.genId())+"",e&&(this.tagName=e)}removeDirectives(e){this.directives&&e.forEach((e=>{this.removeDirective(e)}))}removeDirective(e){if(!this.directives)return;let t;-1!==(t=this.directives.findIndex((t=>t.type.name===e)))&&this.directives.splice(t,1),0===this.directives.length&&delete this.directives}addDirective(e,t){if(this.directives){if(this.directives.find((t=>t.type.name===e.type.name)))return}else this.directives=[];this.directives.push(e),t&&this.sortDirective()}sortDirective(){this.directives&&this.directives.length>1&&this.directives.sort(((e,t)=>i.getType(e.type.name).prio<i.getType(t.type.name).prio?-1:1))}hasDirective(e){return this.directives&&-1!==this.directives.findIndex((t=>t.type.name===e))}getDirective(e){if(this.directives)return this.directives.find((t=>t.type.name===e))}add(e){this.children||(this.children=[]),this.children.push(e)}hasClass(e,t){let s=this.getParam(e,"$classes");return!!s&&s.includes(t)}initClassArr(){if(this.classArr)return;this.classArr=[];let e=this.getProp("class");e&&(this.classArr=e.trim().split(/\s+/),this.setProp("class",this.classArr.join(" ")))}addClass(e){this.initClassArr();let t=this.classArr,s=e.trim().split(/\s+/),i=!1;for(let e of s)t.includes(e)||(i=!0,t.push(e));i&&(this.setProp("class",t.join(" ")),this.setStaticOnce())}removeClass(e){let t=this.classArr;if(!t)return;let s=e.trim().split(/\s+/),i=!1;for(let e of s){let s;-1!==(s=t.indexOf(e))&&(i=!0,t.splice(s,1))}i&&(0===t.length?this.delProp("class"):this.setProp("class",t.join(" ")),this.setStaticOnce())}initStyleMap(){if(this.styleMap)return;this.styleMap=new Map;let e=this.styleMap,t=this.getProp("style");if(t){let s=t.trim().split(/\s*;\s*/);for(let t of s){let i=t.split(/\s*:\s*/);e.set(i[0],s[1])}}}addStyle(e){this.initStyleMap();let t=!1,s=e.trim().split(/\s*;\s*/),i=this.styleMap;for(let e of s){if(""===e)continue;let s=e.split(/\s*:\s*/);i.has(s[0])&&i.get(s[0])===s[1]||(t=!0,i.set(s[0],s[1]))}t&&(this.setProp("style",[...i].map((e=>e.join(":"))).join(";")),this.setStaticOnce())}removeStyle(e){let t=this.styleMap;if(!t)return;let s=!1,i=e.trim().split(/\s*;\s*/);for(let e of i){let i=e.split(/\s*:\s*/);(!i[1]&&t.has(i[0])||t.get(i[0])===i[1])&&(s=!0,t.delete(i[0]))}s&&(0===t.size?this.delProp("style"):this.setProp("style",[...t].map((e=>e.join(":"))).join(";")),this.setStaticOnce())}hasProp(e){if(this.props)return this.props.has(e)}getProp(e,t){if(this.props)return this.props.get(e)}setProp(e,t){this.props||(this.props=new Map),this.props.set(e,t)}delProp(e){if(this.props){if(v.isArray(e))for(let t of e)this.props.delete(t);else this.props.delete(e);this.setStaticOnce()}}setAsset(e,t){this.assets||(this.assets=new Map),this.assets.set(e,t)}delAsset(e){this.assets&&this.assets.delete(e)}getEl(e){return e.getNode(this.key)}query(e){if(this.key===e)return this;if(this.children)for(let t=0;t<this.children.length;t++){let s=this.children[t].query(e);if(s)return s}}setParam(e,t,s){e.objectManager.setDomParam(this.key,t,s)}getParam(e,t){return e.objectManager.getDomParam(this.key,t)}removeParam(e,t){e.objectManager.removeDomParam(this.key,t)}setStaticOnce(){-1!==this.staticNum&&(this.staticNum=1)}clone(){let e=new k(this.tagName,this.key);if(this.tagName){if(this.props&&this.props.size>0)for(let t of this.props)e.setProp(t[0],t[1]);if(this.assets&&this.assets.size>0)for(let t of this.assets)e.setAsset(t[0],t[1]);if(this.directives&&this.directives.length>0){e.directives=[];for(let t of this.directives)e.directives.push(t.clone())}if(e.events=this.events,this.children)for(let t of this.children)e.add(t.clone())}else e.expressions=this.expressions,e.textContent=this.textContent;return e.staticNum=this.staticNum,e}addEvent(e){this.events||(this.events=[]),this.events.push(e)}}class w{constructor(e){this.module=e}compile(e){return this.compileTemplate(e)}compileTemplate(e){const t=this;e=e.replace(/\<\!\-\-[\s\S]*?\-\-\>/g,"");const s=/((?<!\\)'[\s\S]*?(?<!\\)')|((?<!\\)"[\s\S]*?(?<!\\)")|((?<!\\)`[\s\S]*?(?<!\\)`)|({{{*)|(}*}})|([\w$-]+(\s*=)?)|(<\s*[a-zA-Z][a-zA-Z0-9-_]*)|(\/?>)|(<\/\s*[a-zA-Z][a-zA-Z0-9-_]*>)/g,i=/^[a-zA-Z_$][$-\w]*?\s*?=?$/,r=/^[\s\n\r\t\v]+$/;let o,n,l,h,c=[],p=[],u=0,m=!1,f=0,g=0,v=0,w=0;for(;null!==(h=s.exec(e));){let t=h[0];0===f&&(t.startsWith("{{")?(0===w&&(v=h.index),w+=t.length/2|0):t.endsWith("}}")&&(w-=t.length/2|0,0===w&&D())),0===w&&(0===f?"<"===t[0]?(N(e.substring(u,h.index)),"/"===t[1]?b(t):(n=t.substr(1).trim().toLowerCase(),u=void 0,m="pre"===n,l=new k(n,this.genKey()),c.push(l),p.push(!1))):">"===t?x():"/>"===t?b():l&&l.tagName&&(i.test(t)?(o&&E(),t.endsWith("=")?o=t.substring(0,t.length-1).trim():(o=t,E())):o&&E(t)):"<"===t[0]&&("/"===t[1]?"template"===t.substring(2,t.length-1).trim().toLowerCase()&&0==--f&&c[c.length-1].setProp("template",e.substring(g,h.index).trim()):"template"===t.substr(1).trim().toLowerCase()&&f++))}if(c.length>1||0!==w||0!==f)throw new y("wrongTemplate");return c[0];function b(e){if(e){let t=!1;const s=e.substring(2,e.length-1).trim().toLowerCase();for(let e=c.length-1;e>=0;e--)if(!p[e]&&c[e].tagName===s){c[e].children=c.slice(e+1),c.splice(e+1),p.splice(e+1),t=!0;break}if(!t)throw new y("wrongTemplate")}let i=c[c.length-1];p[p.length-1]=!0,t.postHandleNode(i),i.sortDirective(),t.handleSlot(i),l=void 0,o=void 0,u=s.lastIndex,w=0,v=0}function x(){"template"===n&&(0===f&&(g=s.lastIndex),f++),l&&(u=s.lastIndex),l=void 0,o=void 0,w=0,v=0}function E(e){if(l&&o){if(e){let t;null!==(t=/((?<=^')(.*?)(?='$))|((?<=^")(.*?)(?="$)|((?<=^`)(.*?)(?=`$)))/.exec(e))&&(e=t[0].trim())}o.startsWith("x-")?l.addDirective(new M(o.substr(2),e)):o.startsWith("e-")?l.addEvent(new d(t.module,o.substr(2),e)):l.setProp(o,e),o=void 0}}function D(){u>0&&v>u&&N(e.substring(u,v));const i=e.substring(v+2,s.lastIndex-2);w=0,v=0;let r=new a(t.module,i);l&&l.tagName?E(r):(P(r),u=s.lastIndex),l.allModelField=r.allModelField}function N(e){""===e||!m&&r.test(e)||P(e=t.preHandleText(e))}function P(e){l||(l=new k(null,t.genKey()),c.push(l),p.push(!1)),l.expressions?l.expressions.push(e):"string"==typeof e?l.textContent=e:l.textContent?(l.expressions=[l.textContent,e],delete l.textContent):l.expressions=[e]}}handleSlot(e){if(!e.children||0===e.children.length||!e.hasDirective("module"))return;let t;for(let s=0;s<e.children.length;s++){let i=e.children[s];"template"===i.tagName&&(e.setProp("template",i.getProp("template")),e.children.splice(s--,1)),i.hasDirective("slot")||(t?e.children.splice(s--,1):(t=new k("div",this.genKey()),t.addDirective(new M("slot",null)),e.children.splice(s,1,t)),t.add(i))}}postHandleNode(e){if(t.has(e.tagName)){let s=t.get(e.tagName);Reflect.construct(s,[e,this.module])}n.hasClass(e.tagName)&&(e.addDirective(new M("module",e.tagName)),e.tagName="div")}preHandleText(e){if(/&[a-z]+;/.test(e)){let t=document.createElement("div");return t.innerHTML=e,t.textContent}return e}genKey(){return this.module.getDomKeyId()+""}}class b{static compare(e,t,s){if(e.tagName){if(e.subModuleId&&e.subModuleId===t.subModuleId)return;if(e.tagName!==t.tagName)r(5,e,null,t.parent);else if(e.staticNum||t.staticNum){let s=!1;for(let i of["props","assets"])if(!e[i]&&t[i]||e[i]&&!t[i])s=!0;else if(e[i]&&t[i]){let r=Object.keys(e[i]),o=Object.keys(t[i]);if(r.length!==o.length)s=!0;else for(let o of r)if(e[i][o]!==t[i][o]){s=!0;break}}s&&r(2,e,null,t.parent)}}else t.tagName?r(5,e,null,t.parent):(e.staticNum||t.staticNum)&&e.textContent!==t.textContent&&r(2,e,null,t.parent);if(e.staticNum>0&&e.staticNum--,e.children&&0!==e.children.length)if(t.children&&0!==t.children.length){let o={},[n,a,l,d]=[0,t.children[0],t.children.length-1,t.children[t.children.length-1]],[h,c,p,u]=[0,e.children[0],e.children.length-1,e.children[e.children.length-1]];for(;n<=l&&h<=p;)if(i(a,c))b.compare(c,a,s),c=e.children[++h],a=t.children[++n];else if(i(d,u))b.compare(u,d,s),u=e.children[--p],d=t.children[--l];else if(i(c,d)){for(b.compare(c,d,s);o.hasOwnProperty(a.key);)s[o[a.key]][0]=4,delete o[a.key],a=t.children[++n];r(4,d,a,t),c=e.children[++h],d=t.children[--l]}else if(i(u,a)){for(b.compare(u,a,s);o.hasOwnProperty(d.key);)s[o[d.key]][0]=4,delete o[d.key],d=t.children[--l];r(4,a,d,t,1),u=e.children[--p],a=t.children[++n]}else{if(o.hasOwnProperty(a.key)){for(;o.hasOwnProperty(a.key);)s[o[a.key]][0]=4,delete o[a.key],a=t.children[++n];continue}o[c.key]=r(1,c,a,t)-1,c=e.children[++h]}if(n<=l||h<=p)if(n>l)for(let s=h;s<=p;s++)r(1,e.children[s],s,t);else for(let e=n;e<=l;e++){let i=t.children[e];o.hasOwnProperty(i.key)?s[o[i.key]][0]=4:r(3,i,null,t)}}else e.children.forEach((e=>r(1,e,null,t)));else t.children&&t.children.length>0&&t.children.forEach((e=>r(3,e,null,t)));function i(e,t){return e.key===t.key}function r(e,t,i,r,o){return s.push([e,t,i,r,o])}}}class x{constructor(e,t){e.hasProp("tag")?(e.tagName=e.getProp("tag"),e.delProp("tag")):e.tagName="div"}}class E{constructor(e){this.module=e,this.eventMap=new Map}addEvent(e,t,s){let i;this.eventMap.has(e)||this.eventMap.set(e,new Map),i=this.eventMap.get(e),i.has(t.name)||i.set(t.name,{}),console.log(e,t);let r=i.get(t.name);if(s)if(r.delg){let e=r.delg;e.find((e=>e.key===s&&e.event===t))||e.push({key:s,event:t})}else r.delg=[{key:s,event:t}];else{if(t.delg)if(r.toDelg){let e=r.toDelg;-1===e.findIndex((e=>e===t))&&e.push(t)}else r.toDelg=[t];else if(r.own){let e=r.own;-1===e.findIndex((e=>e===t))&&e.push(t)}else r.own=[t];r.capture=t.capture}}getEvent(e){return this.eventMap.get(e)}removeEvent(e,t,s,i){if(!this.eventMap.has(e))return;let r=this.eventMap.get(e);if(!r.has(t.name))return;let o=r.get(t.name);if(s){if(!o.delg)return;{let e=o.delg.findIndex((e=>e.key===s&&e.event===t));-1!==e&&(o.delg.splice(e,1),0===o.delg.length&&delete o.delg)}}else if(i&&o.toDelg){let e=o.toDelg.findIndex((e=>e===t));console.log(e),-1!==e&&(o.toDelg.splice(e,1),0===o.toDelg.length&&delete o.toDelg)}else if(o.own){let e=o.own.findIndex((e=>e===t));-1!==e&&(o.own.splice(e,1),0===o.own.length&&delete o.own)}}bind(e,t,s,i){if(!this.eventMap.has(e))return!1;const r=this.eventMap.get(e);if(!r.has(t))return!1;if(r.bindMap){if(r.bindMap.has(t))return!1}else r.bindMap=new Map;const o=this.module.getNode(e);return o&&o.addEventListener(t,s,i),r.bindMap.set(t,{handler:s,capture:i}),!0}unbind(e,t){if(!this.eventMap.has(e))return;const s=this.eventMap.get(e);if(!s.bindMap||!s.has(t))return;const i=this.module.getNode(e),r=s.bindMap.get(t);i&&r&&i.removeEventListener(t,r.handler,r.capture),s.bindMap.delete(t)}unbindAll(e){if(!this.eventMap.has(e))return;const t=this.eventMap.get(e);if(!t.bindMap)return;const s=this.module.getNode(e);if(s)for(let e of t.bindMap)s.removeEventListener(e[0],e[1].handler,e[1].capture);t.bindMap.clear()}hasEvent(e){return this.eventMap.has(e)}cloneEvent(e,t){if(e===t)return;let s=this.eventMap.get(e);if(!s)return;let i=new Map;for(let e of s){if("bindMap"===e[0])continue;let t={capture:e[1].capture};e[1].own&&(t.own=e[1].own.slice(0)),e[1].delg&&(t.delg=e[1].delg.slice(0)),e[1].toDelg&&(t.toDelg=e[1].toDelg.slice(0)),i.set(e[0],t)}this.eventMap.set(t,i)}}class D{constructor(){this.subscribeMap=new Map,this.cacheData={}}get(e){let t=this.cacheData;if(-1!==e.indexOf(".")){let s=e.split(".");if(s.length>1){for(let e=0;e<s.length-1&&t;e++)t=t[s[e]];t&&(e=s[s.length-1])}}if(t)return t[e]}set(e,t){let s=this.cacheData,i=e;if(-1!==e.indexOf(".")){let t=e.split(".");if(t.length>1){for(let e=0;e<t.length-1;e++)s[t[e]]&&"object"==typeof s[t[e]]||(s[t[e]]={}),s=s[t[e]];e=t[t.length-1]}}if(s&&(s[e]=t),this.subscribeMap.has(i)){let e=this.subscribeMap.get(i);for(let s of e)this.invokeSubscribe(s.module,s.handler,t)}}remove(e){let t=this.cacheData;if(-1!==e.indexOf(".")){let s=e.split(".");if(s.length>1){for(let e=0;e<s.length-1&&t;e++)t=t[s[e]];t&&(e=s[s.length-1])}}t&&delete t[e]}subscribe(e,t,s){if(this.subscribeMap.has(t)){let i=this.subscribeMap.get(t);i.find((t=>t.module===e&&t.handler===s))||i.push({module:e,handler:s})}else this.subscribeMap.set(t,[{module:e,handler:s}]);let i=this.get(t);i&&this.invokeSubscribe(e,s,i)}invokeSubscribe(e,t,s){"string"==typeof t?e.invokeMethod(t,s):t.call(e,s)}}class N{static set(e,t){this.cache.set(e,t)}static get(e){return this.cache.get(e)}static subscribe(e,t,s){this.cache.subscribe(e,t,s)}static remove(e){this.cache.remove(e)}}N.cache=new D;class P{static addToDataMap(e,t){this.dataMap.set(e,t)}static delFromDataMap(e){this.dataMap.delete(e)}static getFromDataMap(e){return this.dataMap.get(e)}static hasDataModel(e){return this.dataMap.has(e)}static addModel(e,t){this.modelMap.has(e)?this.modelMap.get(e).model=t:this.modelMap.set(e,{model:t})}static delModel(e){this.modelMap.delete(e)}static getData(e){if(this.modelMap.has(e))return this.modelMap.get(e).data}static addWatcher(e,t,s){this.modelMap.has(e)||this.modelMap.set(e,{});let i=this.modelMap.get(e).watchers;if(i||(i={},this.modelMap.get(e).watchers=i),i[t])if("string"==typeof s)i[t].find((e=>e===s))||i[t].push(s);else{let e=s.toString();i[t].find((t=>t.toString()===e))||i[t].push(s)}else i[t]=[s]}static removeWatcher(e,t,s){if(!this.modelMap.has(e)||!this.modelMap.get(e).watchers)return;let i=this.modelMap.get(e).watchers;if(!i[t])return;let r=i[t].findIndex(s);-1!==r&&i.splice(r,1)}static getWatcher(e,t){if(!this.modelMap.has(e))return;let s=this.modelMap.get(e).watchers;return s?s[t]:void 0}static bindToModule(e,t){let s=this.modelMap.get(e);if(!s)return;let i="number"==typeof t?t:t.id;if(s.modules){let e=s.modules;-1===e.indexOf(i)&&e.push(i)}else s.modules=[i];Object.getOwnPropertyNames(e).forEach((s=>{e[s]&&"object"==typeof e[s]&&e[s].$key&&P.bindToModule(e[s],t)}))}static bindToModules(e,t){let s=this.modelMap.get(e);if(s){if(s.modules){let e=s.modules;for(let s of t)-1===e.indexOf(s)&&e.push(s)}else s.modules=t;Object.getOwnPropertyNames(e).forEach((s=>{"object"==typeof e[s]&&e[s].$key&&P.bindToModules(e[s],t)}))}}static unbindFromModule(e,t){let s=this.modelMap.get(e);if(!s||!s.modules)return;let i,r="number"==typeof t?t:t.id,o=s.modules;-1===(i=o.indexOf(r))&&o.splice(i),Object.getOwnPropertyNames(e).forEach((s=>{"object"==typeof e[s]&&e[s].$key&&P.unbindFromModule(e[s],t)}))}static getModuleIds(e){let t=this.modelMap.get(e);if(t)return t.modules}static update(e,t,s,i,r){let o=this.modelMap.get(e);if(!o)return;let a=o.modules,l=[];if(a)for(let t of a){let s=n.get(t);l.push(s),s.changedModelMap.set(e.$key,!0)}let d=this.getWatcher(e,t);if(d)for(let r of d)if(l)for(let t of l)"string"==typeof r?(r=t.getMethod(r),r&&r.call(t,e,s,i)):r.call(t,e,s,i);else r.call(e,t,i,s);if(s!==i||r)for(let e of l)c.add(e)}}P.dataMap=new WeakMap,P.modelMap=new WeakMap;class T{constructor(e,t){let s=new Proxy(e,{set:(e,t,i,r)=>{if(e[t]===i)return!0;if(["__proto__","constructor"].includes(t))return!0;let o=e[t],n=Reflect.set(e,t,i,r);return"function"!=typeof i&&-1===["$key"].indexOf(t)&&P.update(s,t,o,i),n},get:(e,i,r)=>{let o=Reflect.get(e,i,r);Array.isArray(e)&&-1!==["sort","fill"].indexOf(i)&&P.update(s,null,null,null,!0);let n=P.getFromDataMap(e[i]);if(n)return n;if(null!==o&&"object"==typeof o&&!e[i].$key){return new T(o,t)}return o},deleteProperty:function(e,t){return null!==e[t]&&"object"==typeof e[t]&&(P.delFromDataMap(e[t]),P.delModel(e[t])),delete e[t],P.update(s,t,null,null,!0),!0}});return s.$watch=this.$watch,s.$get=this.$get,s.$set=this.$set,s.$key=v.genId(),P.addToDataMap(e,s),P.addModel(s,e),t&&P.bindToModule(s,t),s}$watch(e,t,s){let i=this,r=-1;-1!==(r=e.lastIndexOf("."))&&(i=this.$get(e.substr(0,r)),e=e.substr(r+1)),i&&(s?P.removeWatcher(i,e,t):P.addWatcher(i,e,t))}$get(e){let t=this;if(-1!==e.indexOf(".")){let s=e.split(".");for(let e=0;e<s.length-1&&(t=t[s[e]],t);e++);if(!t)return;e=s[s.length-1]}return t[e]}$set(e,t,s){let i=this,r=P.getModuleIds(this);if(-1!==e.indexOf(".")){let t=e.split(".");for(let e=0;e<t.length-1;e++)if(!i[t[e]]){let s=new T({});P.bindToModules(s,r),i[t[e]]=s}e=t[t.length-1]}"object"==typeof t&&s&&P.bindToModule(t,s),i[e]=t}}class O{constructor(e){this.module=e,this.cache=new D}set(e,t){this.cache.set(e,t)}get(e){return this.cache.get(e)}remove(e){this.cache.remove(e)}setEventParam(e,t,s,i){this.cache.set("$events."+e+".$params."+t+"."+s,i)}getEventParam(e,t,s){return this.get("$events."+e+".$params."+t+"."+s)}removeEventParam(e,t,s){this.remove("$events."+e+".$params."+t+"."+s)}clearEventParam(e,t){t?this.remove("$events."+e+".$params."+t):this.remove("$events."+e+".$params")}setDomParam(e,t,s){this.set("$domparam."+e+"."+t,s)}getDomParam(e,t){return this.get("$domparam."+e+"."+t)}removeDomParam(e,t){this.remove("$domparam."+e+"."+t)}clearDomParams(e){this.remove("$domparam."+e)}clearAllDomParams(){this.remove("$domparam")}}t.add([class extends x{constructor(e,t){super(e,t);let s=e.getProp("name");if(!s)throw new y("itemnotempty",exports.NodomMessage.TipWords.element,"MODULE","className");e.delProp("name"),e.addDirective(new M("module",s))}},class extends x{constructor(e,t){super(e,t);let s=e.getProp("cond");if(!s)throw new y("itemnotempty",exports.NodomMessage.TipWords.element,"FOR","cond");e.delProp("cond"),e.addDirective(new M("repeat",s))}},class extends x{constructor(e,t){super(e,t);let s=e.getProp("cond");if(!s)throw new y("itemnotempty",exports.NodomMessage.TipWords.element,"IF","cond");e.delProp("cond"),e.addDirective(new M("if",s))}},class extends x{constructor(e,t){super(e,t);let s=e.getProp("cond");e.delProp("cond"),e.addDirective(new M("recur",s))}},class extends x{constructor(e,t){super(e,t),e.addDirective(new M("else",null))}},class extends x{constructor(e,t){super(e,t);let s=e.getProp("cond");if(!s)throw new y("itemnotempty",exports.NodomMessage.TipWords.element,"ELSEIF","cond");e.delProp("cond"),e.addDirective(new M("elseif",s))}},class extends x{constructor(e,t){super(e,t),e.addDirective(new M("endif",null))}},class extends x{constructor(e,t){super(e,t);let s=e.getProp("name")||"default";e.delProp("name"),e.addDirective(new M("slot",s))}}]),g("module",(function(e,t,s){let i,r=e.objectManager.getDomParam(t.key,"moduleId"),o=!0;if(r)i=n.get(r),o=!t.props.renderOnce;else{if(i=n.get(this.value),!i)return!0;r=i.id,e.objectManager.setDomParam(t.key,"moduleId",r),e.addChild(i),t.props.hasOwnProperty("useDomModel")&&(i.model=t.model,P.bindToModule(i.model,i),delete t.props.useDomModel)}if(t.subModuleId=r,t.tagName="",o){let e={};if(t.props)for(let s of Object.keys(t.props)){let i=t.props[s];"$"===s[0]?(e.$data||(e.$data={}),e.$data[s.substr(1)]=i,delete t.props[s]):e[s]=i}i.setProps(e,t)}return!0}),8),g("model",(function(e,t,s){let i=t.model.$get(this.value);return i&&(t.model=i),!0}),1),g("repeat",(function(e,t,s){let i=this.value;if(!v.isArray(i)||0===i.length)return!1;const r=s.getProp("$index"),o=t.parent;this.disabled=!0,delete s.model;for(let t=0;t<i.length;t++){r&&(i[t][r]=t),s.staticNum++;let n=c.renderDom(e,s,i[t],o,i[t].$key);r&&delete n.props.$index}return this.disabled=!1,!1}),2),g("recur",(function(e,t,s){if(t.props.hasOwnProperty("ref")){s.children=[];const i="$recurs."+(t.props.ref||"default");let r=e.objectManager.get(i);if(!r)return!0;let o=t.model[r.getDirective("recur").value];if(!o)return!0;let n,a=r.clone();Array.isArray(o)?n=t.model.$key:(a.model=o,n=o.$key,v.setNodeKey(a,n,!0)),s.children=[a]}else{if(!t.model[this.value])return!0;const i="$recurs."+(t.props.name||"default");e.objectManager.get(i)||e.objectManager.set(i,s)}return!0}),2),g("if",(function(e,t,s){return e.objectManager.setDomParam(t.parent.key,"$if",this.value),this.value}),5),g("else",(function(e,t,s){return!1===e.objectManager.getDomParam(t.parent.key,"$if")}),5),g("elseif",(function(e,t,s){return!0!==e.objectManager.getDomParam(t.parent.key,"$if")&&!!this.value&&(e.objectManager.setDomParam(t.parent.key,"$if",!0),!0)}),5),g("endif",(function(e,t,s){return e.objectManager.removeDomParam(t.parent.key,"$if"),!0}),5),g("show",(function(e,t,s){return!!this.value}),5),g("field",(function(e,t,s){const i=t.props.type||"text",r=t.tagName.toLowerCase(),o=t.model;if(!o)return!0;let n=o.$get(this.value);if("radio"===i)n==t.props.value?(t.props.checked="checked",v.setDomAsset(t,"checked",!0)):(delete t.props.checked,v.setDomAsset(t,"checked",!1));else if("checkbox"===i){let e=t.props["yes-value"];n==e?(t.props.value=e,v.setDomAsset(t,"checked",!0)):(t.props.value=t.props["no-value"],v.setDomAsset(t,"checked",!1))}else if("select"===r)t.props.value=n,v.setDomAsset(t,"value",n);else{let e=null!=n?n:"";t.props.value=e,v.setDomAsset(t,"value",e)}let a=N.get("$fieldChangeEvent");return a||(a=new d(null,"change",(function(e,t){let s=this.getNode(t.key);if(!s)return;let i=this.originTree.query(t.key).getDirective("field"),r=t.props.type,o=i.value,n=s.value;"checkbox"===r?n=t.props["yes-value"]==n?t.props["no-value"]:t.props["yes-value"]:"radio"===r&&(s.checked||(n=void 0));let a=o.split(".");if(1===a.length)e[o]=n;else{let t=e;o=a.pop();for(let e=0;e<a.length&&t;e++)t=t[a[e]];t&&(t[o]=n)}"radio"!==r&&(t.props.value=n,s.value=n)})),N.set("$fieldChangeEvent",a)),s.addEvent(a),!0}),10),g("route",(function(e,t,s){if("a"===t.tagName.toLowerCase()&&(t.props.href="javascript:void(0)"),t.props.path=this.value,t.props.active){let s=t.props.active;delete t.props.active,u.addActiveField(e,this.value,t.model,s),this.value.startsWith(u.currentPath)&&t.model[s]&&u.go(this.value)}let i=N.get("$routeClickEvent");return i||(i=new d(null,"click",(function(e,t,s,i){let r=t.props.path;v.isEmpty(r)||u.go(r)})),N.set("$routeClickEvent",i)),s.addEvent(i),!0})),g("router",(function(e,t,s){return u.routerKeyMap.set(e.id,t.key),!0})),g("slot",(function(e,t,s){this.value=this.value||"default";let i=t.parent.subModuleId;if(i){let e=n.get(i);return e&&e.objectManager.set("$slots."+this.value,{dom:s,model:t.model}),!1}{let i=e.objectManager.get("$slots."+this.value);if(i){let e=[],r=i.dom;for(let s of r.children){let i=s.clone();v.setNodeKey(i,t.key,!0),e.push(i)}if(s.children=e,!s.getProp("innerRender"))for(let e of s.children)e.model=i.model}}return!0}),5),g("animation",(function(e,t,s){var i,r,o,n,a,l,d,h,c,p,u,m,f,g,y,M,k,w,b,x;const E=this.value;if(!v.isObject(E))return new Error("未找到animation配置对象");const D=0!=E.tigger,N=E.type||"transition",P=0!=E.isAppear,T=(null===(i=E.name)||void 0===i?void 0:i.enter)||E.name,O=(null===(r=E.name)||void 0===r?void 0:r.leave)||E.name,W=(null===(o=E.duration)||void 0===o?void 0:o.enter)||E.duration||"",$=(null===(n=E.duration)||void 0===n?void 0:n.leavr)||E.duration||"",C=(null===(a=E.delay)||void 0===a?void 0:a.enter)||E.delay||"0s",j=(null===(l=E.delay)||void 0===l?void 0:l.leave)||E.delay||"0s",A=(null===(d=E.timingFunction)||void 0===d?void 0:d.enter)||E.timingFunction||"ease",S=(null===(h=E.timingFunction)||void 0===h?void 0:h.leave)||E.timingFunction||"ease",F=(null===(p=null===(c=E.hooks)||void 0===c?void 0:c.enter)||void 0===p?void 0:p.before)?E.hooks.enter.before:(null===(u=E.hooks)||void 0===u?void 0:u.before)||void 0,R=(null===(f=null===(m=E.hooks)||void 0===m?void 0:m.enter)||void 0===f?void 0:f.after)?E.hooks.enter.after:(null===(g=E.hooks)||void 0===g?void 0:g.after)||void 0,I=(null===(M=null===(y=E.hooks)||void 0===y?void 0:y.leave)||void 0===M?void 0:M.before)?E.hooks.leave.before:(null===(k=E.hooks)||void 0===k?void 0:k.before)||void 0,L=(null===(b=null===(w=E.hooks)||void 0===w?void 0:w.leave)||void 0===b?void 0:b.after)?E.hooks.leave.after:(null===(x=E.hooks)||void 0===x?void 0:x.after)||void 0;let V=()=>{const s=e.getNode(t.key);D?(R&&R.apply(e.model,[e]),s.classList.remove(T+"-enter-active"),"animation"==N&&s.classList.add(T+"-enter-to")):(P&&(s.style.display="none"),L&&L.apply(e.model,[e]),[s.style.width,s.style.height]=function(e){const t=e.vdom.getProp("style");let s,i;if(t){let e=t.trim().split(/;\s*/);for(const t of e)t.startsWith("width")&&(s=t.split(":")[1]),t.startsWith("height")&&(i=t.split(":")[1])}return s=s||"",i=i||"",[s,i]}(t),s.classList.remove(O+"-leave-active"),"animation"==N&&s.classList.add(O+"-leave-to")),s.removeEventListener("animationend",V),s.removeEventListener("transitionend",V)},q=e.getNode(t.key);if(D){if(q){if(-1!=q.getAttribute("class").indexOf(`${T}-enter-to`))return!0;K(q)}else P&&t.vdom.addStyle("display:none"),setTimeout((()=>{let s=e.getNode(t.key);P&&(t.vdom.removeStyle("display:none"),t.vdom.addStyle(`${T}-enter-to`),t.props.class+=` ${T}-enter-to`,s.style.display="none"),K(s)}),0);return!0}return q?(-1!=q.getAttribute("class").indexOf(`${O}-leave-to`)||_(q),!0):(P&&t.vdom.addStyle("display:none"),setTimeout((()=>{let s=e.getNode(t.key);P?(t.vdom.removeStyle("display:none"),s.classList.add(`${O}-leave-to`),t.vdom.addClass(`${O}-leave-to`),t.props.class+=` ${O}-leave-to`,s.style.display="none"):_(s)}),0),!0);function _(t){if("transition"==N){let[s,i]=H(t);requestAnimationFrame((()=>{t.classList.remove(T+"-enter-to"),t.classList.add(O+"-leave-active"),t.classList.add(O+"-leave-from"),"fold-height"==O?t.style.height=i:"fold-width"==O&&(t.style.width=s),t.style.transitionDelay=C,""!=W&&(t.style.transitionDuration=W),"ease"!=A&&(t.style.transitionTimingFunction=A),I&&I.apply(e.model,[e]),requestAnimationFrame((()=>{t.classList.add(O+"-leave-to"),t.classList.remove(O+"-leave-from"),"fold-height"==O?t.style.height="0px":"fold-width"==O&&(t.style.width="0px"),t.addEventListener("transitionend",V)}))}))}else requestAnimationFrame((()=>{t.classList.remove(T+"-enter-to"),t.classList.add(O+"-leave-active"),t.style.animationDelay=j,""!=$&&(t.style.animationDuration=$),"ease"!=S&&(t.style.animationTimingFunction=S),requestAnimationFrame((()=>{I&&I.apply(e.model,[e]),t.offsetWidth,t.addEventListener("animationend",V)}))}))}function K(t){if("transition"==N){t.style.transitionDelay="0s";let s=1e3*parseFloat(C);setTimeout((()=>{let[s,i]=H(t);t.classList.remove(O+"-leave-to"),t.classList.add(T+"-enter-active"),t.classList.add(T+"-enter-from"),"fold-height"==T?t.style.height="0px":"fold-width"==T&&(t.style.width="0px"),""!=W&&(t.style.transitionDuration=W),"ease"!=A&&(t.style.transitionTimingFunction=A),requestAnimationFrame((()=>{P&&(t.style.display=""),requestAnimationFrame((()=>{F&&F.apply(e.model,[e]),t.classList.add(T+"-enter-to"),t.classList.remove(T+"-enter-from"),"fold-height"==T?t.style.height=i:"fold-width"==T&&(t.style.width=s),t.addEventListener("transitionend",V)}))}))}),s)}else{t.style.animationDelay="0s";let s=1e3*parseFloat(C);setTimeout((()=>{requestAnimationFrame((()=>{t.classList.remove(O+"-leave-to"),t.classList.add(T+"-enter-active"),""!=W&&(t.style.animationDuration=W),"ease"!=A&&(t.style.animationTimingFunction=W),P&&(t.style.display=""),requestAnimationFrame((()=>{F&&F.apply(e.model,[e]),t.offsetWidth,t.addEventListener("animationend",V)}))}))}),s)}}function H(e){if("none"==e.style.display){const t=window.getComputedStyle(e).getPropertyValue("position"),s=window.getComputedStyle(e).getPropertyValue("visibility");e.style.position="absolute",e.style.visibility="hidden",e.style.display="";let i=window.getComputedStyle(e).getPropertyValue("width"),r=window.getComputedStyle(e).getPropertyValue("height");return e.style.position=t,e.style.visibility=s,e.style.display="none",[i,r]}return[window.getComputedStyle(e).getPropertyValue("width"),window.getComputedStyle(e).getPropertyValue("height")]}}),9),h.regist("tap",{touchstart(e,t,s,i){let r=i.touches[0];s.dependEvent.setParam(t,e,"pos",{sx:r.pageX,sy:r.pageY,t:Date.now()})},touchmove(e,t,s,i){let r=s.dependEvent.getParam(t,e,"pos");if(!r)return;let o=i.touches[0],n=o.pageX-r.sx,a=o.pageY-r.sy;(Math.abs(n)>5||Math.abs(a)>5)&&(r.move=!0)},touchend(e,t,s,i){let r=s.dependEvent.getParam(t,e,"pos");if(!r)return;s.dependEvent.removeParam(t,e,"pos");let o=Date.now()-r.t;if(!r.move&&o<200){let r=s.dependEvent.handler;"string"==typeof r&&(r=t.getMethod(r)),r&&r.apply(t,[e.model,e,s.dependEvent,i])}}}),h.regist("swipe",{touchstart(e,t,s,i){let r=i.touches[0],o=Date.now();s.dependEvent.setParam(t,e,"swipe",{oldTime:[o,o],speedLoc:[{x:r.pageX,y:r.pageY},{x:r.pageX,y:r.pageY}],oldLoc:{x:r.pageX,y:r.pageY}})},touchmove(e,t,s,i){let r=Date.now(),o=i.touches[0],n=s.dependEvent.getParam(t,e,"swipe");r-n.oldTime[1]>50&&(n.speedLoc[0]={x:n.speedLoc[1].x,y:n.speedLoc[1].y},n.speedLoc[1]={x:o.pageX,y:o.pageY},n.oldTime[0]=n.oldTime[1],n.oldTime[1]=r),n.oldLoc={x:o.pageX,y:o.pageY}},touchend(e,t,s,i){let r=s.dependEvent.getParam(t,e,"swipe"),o=Date.now(),n=o-r.oldTime[1]<30?0:1,a=r.oldLoc.x-r.speedLoc[n].x,l=r.oldLoc.y-r.speedLoc[n].y,d=Math.sqrt(a*a+l*l),h=o-r.oldTime[n];if(h>300||d<10)return;let c=d/h;if(c>.05){let r="";if(a<0&&Math.abs(l/a)<1&&(i.v0=c,r="swipeleft"),a>0&&Math.abs(l/a)<1&&(i.v0=c,r="swiperight"),l>0&&Math.abs(a/l)<1&&(i.v0=c,r="swipedown"),l<0&&Math.abs(a/l)<1&&(i.v0=c,r="swipeup"),s.dependEvent.name===r){let r=s.dependEvent.handler;"string"==typeof r&&(r=t.getMethod(r)),r&&r.apply(t,[e.model,e,s.dependEvent,i])}}}}),h.regist("swipeleft",h.get("swipe")),h.regist("swiperight",h.get("swipe")),h.regist("swipeup",h.get("swipe")),h.regist("swipedown",h.get("swipe")),exports.Compiler=w,exports.CssManager=l,exports.DefineElement=x,exports.DefineElementManager=t,exports.DiffTool=b,exports.Directive=M,exports.DirectiveManager=i,exports.DirectiveType=s,exports.EventFactory=E,exports.EventManager=h,exports.Expression=a,exports.GlobalCache=N,exports.Model=T,exports.ModelManager=P,exports.Module=class{constructor(){this.children=[],this.preRenderOps=[],this.postRenderOps=[],this.keyNodeMap=new Map,this.keyElementMap=new Map,this.keyVDomMap=new Map,this.id=v.genId(),this.objectManager=new O(this),this.changedModelMap=new Map,this.eventFactory=new E(this),n.add(this)}init(){if(this.state=exports.EModuleState.INITED,this.model=new T(this.data()||{},this),this.modules&&Array.isArray(this.modules)){for(let e of this.modules)n.addClass(e);delete this.modules}}template(e){return null}data(){return{}}render(){if(this.state===exports.EModuleState.UNACTIVE)return;this.dontAddToRender=!0;let e=this.template(this.props);if(e!==this.oldTemplate&&(this.oldTemplate=e,this.compile()),this.originTree)if(this.doRenderOps(0),this.doModuleEvent("onBeforeRender"))this.dontAddToRender=!1;else{if(this.renderTree){if(this.model){let e=this.renderTree;this.renderTree=c.renderDom(this,this.originTree,this.model),this.doModuleEvent("onBeforeRenderToHtml");let t=[];b.compare(this.renderTree,e,t),t.length>0&&c.handleChangedDoms(this,t)}}else this.doFirstRender();this.state=exports.EModuleState.RENDERED,this.doRenderOps(1),this.doModuleEvent("onRender"),this.changedModelMap.clear(),this.dontAddToRender=!1}}doFirstRender(){this.doModuleEvent("onBeforeFirstRender"),this.renderTree=c.renderDom(this,this.originTree,this.model),this.doModuleEvent("onBeforeFirstRenderToHTML");let e=c.renderToHtml(this,this.renderTree,null,!0);if(this.srcDom){const t=this.getParent().getNode(this.srcDom.key);this.container=t.parentElement,this.container.insertBefore(e,t)}else this.container&&this.container.appendChild(e);this.doModuleEvent("onFirstRender")}addChild(e){let t;"number"==typeof e?(t=e,e=n.get(t)):t=e.id,this.children.includes(t)||(this.children.push(t),e.parentId=this.id,e.active())}active(e){if(this.state=exports.EModuleState.INITED,c.add(this),e)for(let t of this.children){let s=n.get(t);s&&s.active(e)}}unactive(e,t){if(n.getMain()!==this){if(this.doModuleEvent("beforeUnActive"),this.state=exports.EModuleState.UNACTIVE,this.renderTree&&!t){let e=this.getNode(this.renderTree.key);e&&this.container&&this.container.removeChild(e)}if(delete this.renderTree,this.keyNodeMap.clear(),this.keyElementMap.clear(),this.keyVDomMap.clear(),this.eventFactory=new E(this),this.doModuleEvent("unActive"),e&&this.children)for(let e of this.children){let t=n.get(e);t&&t.unactive(!0,!0)}}}getParent(){if(this.parentId)return n.get(this.parentId)}doModuleEvent(e){return this.invokeMethod(e,this.model)}getMethod(e){return this[e]}setContainer(e){this.container=e}invokeMethod(e,t,s,i){let r=this[e];if(r&&"function"==typeof r){let e=[];for(let t=1;t<arguments.length;t++)e.push(arguments[t]);return r.apply(this,e)}}addRenderOps(e,t,s,i){if("function"!=typeof e)return;(0===t?this.preRenderOps:this.postRenderOps).push({foo:e,args:s,once:i})}doRenderOps(e){let t=0===e?this.preRenderOps:this.postRenderOps;if(t)for(let e=0;e<t.length;e++){let s=t[e];s.foo.apply(this,s.args),s.once&&t.splice(e--,1)}}setProps(e,t){let s=e.$data;if(delete e.$data,s)for(let e in s){let t=s[e];"object"==typeof t&&this.model[e]!==t&&P.bindToModule(t,this),this.model[e]=t}if(this.props=e,this.srcDom=t,this.state===exports.EModuleState.INITED||this.state===exports.EModuleState.UNACTIVE)this.active();else{let t=!1;if(this.props){const s=Object.getOwnPropertyNames(e);if(s.length!==(this.props?Object.getOwnPropertyNames(this.props):[]).length)t=!0;else for(let i of s)if(e[i]!==this.props[i]){t=!0;break}}else t=!0;if(t){let t=!1;this.originTree&&(t=this.mergeProps(this.originTree,e));(this.template(this.props)!==this.oldTemplate||t)&&this.active()}}}compile(){if(this.domKeyId=0,this.children=[],l.clearModuleRules(this),this.objectManager.clearAllDomParams(),!this.oldTemplate)return;this.originTree=new w(this).compile(this.oldTemplate),this.props&&this.mergeProps(this.originTree,this.props);let e=this.getParent();if(e){const t=e.eventFactory.getEvent(this.srcDom.key);if(t)for(let e of t)if(e[1].own)for(let t of e[1].own)this.originTree.addEvent(t)}}mergeProps(e,t){let s=!1;for(let i of Object.keys(t))t[i]!==e.getProp(i)&&(s=!0,"style"===i?e.addStyle(t[i]):"class"===i?e.addClass(t[i]):e.setProp(i,t[i]));return s}getNode(e){return this.keyNodeMap.get(e)}saveNode(e,t){this.keyNodeMap.set(e,t)}getElement(e){return this.keyElementMap.get(e)}saveElement(e,t){this.keyElementMap.set(e,t)}getVirtualDom(e){return this.keyVDomMap.get(e)}saveVirtualDom(e,t){this.keyVDomMap.set(t||e.key,e)}removeNode(e,t){if(e.subModuleId){let s=n.get(e.subModuleId);s&&s.unactive(t)}else if(this.keyNodeMap.delete(e.key),this.keyElementMap.delete(e.key),this.keyVDomMap.delete(e.key),this.eventFactory.unbindAll(e.key),t&&e&&e.children)for(let t of e.children)this.removeNode(t,!0)}clearDomCache(e,t){if(t&&e.children)for(let t of e.children)this.clearDomCache(t,!0);this.objectManager.clearDomParams(e.key),this.keyNodeMap.delete(e.key),this.keyVDomMap.delete(e.key)}getOrginDom(e){return this.originTree?function t(s){if(s.key===e)return s;if(s.children)for(let e of s.children){let s=t(e);if(s)return s}}(this.originTree):null}getDomKeyId(){return++this.domKeyId}},exports.ModuleFactory=n,exports.NCache=D,exports.NError=y,exports.NEvent=d,exports.NFactory=class{constructor(e){this.items=new Map,void 0!==e&&(this.moduleId=e.id)}add(e,t){this.items.set(e,t)}get(e){return this.items.get(e)}remove(e){this.items.delete(e)}has(e){return this.items.has(e)}},exports.NodomMessage_en=o,exports.NodomMessage_zh={TipWords:{application:"应用",system:"系统",module:"模块",moduleClass:"模块类",model:"模型",directive:"指令",directiveType:"指令类型",expression:"表达式",event:"事件",method:"方法",filter:"过滤器",filterType:"过滤器类型",data:"数据",dataItem:"数据项",route:"路由",routeView:"路由容器",plugin:"插件",resource:"资源",root:"根",element:"元素"},ErrorMsgs:{unknown:"未知错误",paramException:"{0}'{1}'方法参数错误，请参考api",invoke:"{0}方法调用参数{1}必须为{2}",invoke1:"{0}方法调用参数{1}必须为{2}或{3}",invoke2:"{0}方法调用参数{1}或{2}必须为{3}",invoke3:"{0}方法调用参数{1}不能为空",exist:"{0}已存在",exist1:"{0}'{1}'已存在",notexist:"{0}不存在",notexist1:"{0}'{1}'不存在",notupd:"{0}不可修改",notremove:"{0}不可删除",notremove1:"{0}{1}不可删除",namedinvalid:"{0}{1}命名错误，请参考用户手册对应命名规范",initial:"{0}初始化参数错误",jsonparse:"JSON解析错误",timeout:"请求超时",config:"{0}配置参数错误",config1:"{0}配置参数'{1}'错误",itemnotempty:"{0} '{1}' 配置项 '{2}' 不能为空",itemincorrect:"{0} '{1}' 配置项 '{2}' 错误",compile1:"{0}标签未闭合",compile2:"结束标签{0}未找到与之匹配的开始标签",compile3:"请检查模板标签闭合情况，模板需要有一个闭合的根节点",wrongTemplate:"模版格式错误"},FormMsgs:{type:"请输入有效的{0}",unknown:"输入错误",required:"不能为空",min:"最小输入值为{0}",max:"最大输入值为{0}"},WeekDays:{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"}},exports.Renderer=c,exports.Route=m,exports.Router=u,exports.Scheduler=f,exports.Util=v,exports.VirtualDom=k,exports.createDirective=g,exports.createRoute=function(e){if(!v.isArray(e))return new m(e);for(let t of e)new m(t)},exports.nodom=function(e,t){f.addTask(c.render,c),f.start(),exports.NodomMessage=o;let s=n.get(e);s.setContainer(document.querySelector(t)),s.active()},exports.registModule=function(e,t){n.addClass(e,t)},exports.request=function(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{"string"==typeof e&&(e={url:e}),e.params=e.params||{},e.rand&&(e.params.$rand=Math.random());let i=e.url;const r=!1!==e.async,o=new XMLHttpRequest;o.withCredentials=e.withCredentials;const n=(e.method||"GET").toUpperCase();o.timeout=r?e.timeout:0,o.onload=()=>{if(200===o.status){let i=o.responseText;if("json"===e.type)try{i=JSON.parse(i)}catch(e){s({type:"jsonparse"})}t(i)}else s({type:"error",url:i})},o.ontimeout=()=>s({type:"timeout"}),o.onerror=()=>s({type:"error",url:i});let a=null;switch(n){case"GET":let t;if(v.isObject(e.params)){let s=[];v.getOwnProps(e.params).forEach((function(t){s.push(t+"="+e.params[t])})),t=s.join("&")}void 0!==t&&(-1!==i.indexOf("?")?i+="&"+t:i+="?"+t);break;case"POST":if(e.params instanceof FormData)a=e.params;else{let t=new FormData;for(let s in e.params)t.append(s,e.params[s]);a=t}}o.open(n,i,r,e.user,e.pwd),e.header&&v.getOwnProps(e.header).forEach((t=>{o.setRequestHeader(t,e.header[t])})),o.send(a)})).catch((e=>{switch(e.type){case"error":throw new y("notexist1",exports.NodomMessage.TipWords.resource,e.url);case"timeout":throw new y("timeout");case"jsonparse":throw new y("jsonparse")}}))}))};
//# sourceMappingURL=nodom.cjs.min.js.map
