{"version":3,"file":"nodom.global.min.js","sources":["../core/defineelementmanager.ts","../core/directivetype.ts","../core/directivemanager.ts","../node_modules/_tslib@2.1.0@tslib/tslib.es6.js","../core/locales/msg_en.ts","../core/locales/msg_zh.ts","../core/modulefactory.ts","../core/expression.ts","../core/cssmanager.ts","../core/renderer.ts","../core/requestmanager.ts","../core/route.ts","../core/types.ts","../core/router.ts","../core/scheduler.ts","../core/nodom.ts","../core/error.ts","../core/util.ts","../core/directive.ts","../core/event.ts","../core/virtualdom.ts","../core/compiler.ts","../core/difftool.ts","../core/defineelement.ts","../core/eventmanager.ts","../core/eventfactory.ts","../core/cache.ts","../core/globalcache.ts","../core/model.ts","../core/modelmanager.ts","../core/objectmanager.ts","../core/dommanager.ts","../extend/elementinit.ts","../extend/directiveinit.ts","../extend/eventinit.ts","../core/module.ts","../core/factory.ts"],"sourcesContent":["import { DefineElement } from \"./defineelement\";\n\n/**\n * 自定义元素管理器\n */\nexport class DefineElementManager {\n    /**\n     * 自定义element\n     */\n    private static elements: Map<string, DefineElement> = new Map();\n    /**\n     * 添加自定义元素类\n     * @param clazz     自定义元素类或类数组\n     * @param alias     别名   \n     */\n    public static add(clazz:any,alias?:string) {\n        if(Array.isArray(clazz)){\n            for(let c of clazz){\n                this.elements.set(c.name.toUpperCase(), c);\n            }\n        }else{\n            this.elements.set((alias||clazz.name).toUpperCase(), clazz);\n        }\n    }\n\n    /**\n     * 获取自定义元素类\n     * @param tagName   元素名\n     * @returns         自定义元素类\n     */\n    public static get(tagName: string): any {\n        return this.elements.get(tagName.toUpperCase());\n    }\n\n    /**\n     * 是否存在自定义元素\n     * @param tagName   元素名\n     * @returns         存在或不存在\n     */\n    public static has(tagName:string):boolean{\n        return this.elements.has(tagName.toUpperCase());\n    }\n}\n","/**\n * 指令类\n */\nexport  class DirectiveType {\n    /**\n     * 指令类型名\n     */\n    public name:string;\n    \n    /**\n     * 优先级，越小优先级越高\n     */\n    public prio:number;\n\n    /**\n     * 渲染时执行方法\n     */\n    public handle:Function;\n    \n    /**\n     * 构造方法\n     * @param name      指令类型名       \n     * @param handle    渲染时执行方法\n     * @param prio      类型优先级\n     */ \n    constructor(name:string,handle:Function, prio?:number) {\n        this.name = name;\n        this.prio = prio>=0?prio:10;\n        this.handle = handle;\n    }\n}\n","import { DirectiveType } from \"./directivetype\";\n/**\n * 指令管理器\n */\nexport  class DirectiveManager {\n    /**\n     * 指令映射\n     */\n    private static directiveTypes:Map<string,DirectiveType> = new Map();\n    \n    /**\n     * 增加指令映射\n     * @param name      指令类型名\n     * @param handle    渲染处理函数\n     * @param prio      类型优先级\n     */\n    public static addType(name:string,handle:Function,prio?:number) {\n        this.directiveTypes.set(name, new DirectiveType(name,handle,prio));\n    }\n\n    /**\n     * 移除指令映射\n     * @param name  指令类型名\n     */\n    public static removeType(name:string) {\n        this.directiveTypes.delete(name);\n    }\n\n    /**\n     * 获取指令\n     * @param name  指令类型名\n     * @returns     指令类型或undefined\n     */\n    public static getType(name:string) {\n        return this.directiveTypes.get(name);\n    }\n\n    /**\n     * 是否含有某个指令\n     * @param name  指令类型名\n     * @returns     true/false\n     */\n    public static hasType(name:string) {\n        return this.directiveTypes.has(name);\n    }\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/*\n * 消息js文件 中文文件\n */\nexport const NodomMessage_en = {\n    /**\n     * tip words\n     */\n    TipWords:{\n        application:\"Application\",\n        system:\"System\",\n        module:\"Module\",\n        moduleClass:'ModuleClass',\n        model:\"Model\",\n        directive:\"Directive\",\n        directiveType:\"Directive-type\",\n        expression:\"Expression\",\n        event:\"Event\",\n        method:\"Method\",\n        filter:\"Filter\",\n        filterType:\"Filter-type\",\n        data:\"Data\",\n        dataItem:'Data-item',\n        route:'Route',\n        routeView:'Route-container',\n        plugin:'Plugin',\n        resource:'Resource',\n        root:'Root',\n        element:'VirtualDom'\n    },\n    /**\n     * error info\n     */\n    ErrorMsgs:{\n        unknown:\"unknown error\",\n        paramException:\"{0} '{1}' parameter error，see api\",\n        invoke:\"method {0} parameter {1} must be {2}\",\n        invoke1:\"method {0} parameter {1} must be {2} or {3}\",\n        invoke2:\"method {0} parameter {1} or {2} must be {3}\",\n        invoke3:\"method {0} parameter {1} not allowed empty\",\n        exist:\"{0} is already exist\",\n        exist1:\"{0} '{1}' is already exist\",\n        notexist:\"{0} is not exist\",\n        notexist1:\"{0} '{1}' is not exist\",\n        notupd:\"{0} not allow to change\",\n        notremove:\"{0} not allow to delete\",\n        notremove1:\"{0} {1} not allow to delete\",\n        namedinvalid:\"{0} {1} name error，see name rules\",\n        initial:\"{0} init parameter error\",\n        jsonparse:\"JSON parse error\",\n        timeout:\"request overtime\",\n        config:\"{0} config parameter error\",\n        config1:\"{0} config parameter '{1}' error\",\n        itemnotempty:\"{0} '{1}' config item '{2}' not allow empty\",\n\t\titemincorrect:\"{0} '{1}' config item '{2}' error\",\n        needEndTag: \"element {0} is not closed\",\n        needStartTag: \"without start tag matchs {0}\",\n        tagError:\"element {0} error\",\n        wrongTemplate:\"wrong template\",\n        wrongExpression:\"expression error: {0} \"\n    },\n\n    WeekDays:[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"]\n}\n","/*\n * 消息js文件 中文文件\n */\nexport const NodomMessage_zh = {\n    /**\n     * 提示单词\n     */\n    TipWords: {\n        application: \"应用\",\n        system: \"系统\",\n        module: \"模块\",\n        moduleClass: '模块类',\n        model: \"模型\",\n        directive: \"指令\",\n        directiveType: \"指令类型\",\n        expression: \"表达式\",\n        event: \"事件\",\n        method: \"方法\",\n        filter: \"过滤器\",\n        filterType: \"过滤器类型\",\n        data: \"数据\",\n        dataItem: '数据项',\n        route: '路由',\n        routeView: '路由容器',\n        plugin: '插件',\n        resource: '资源',\n        root: '根',\n        element: '元素'\n    },\n    /**\n     * 异常信息\n     */\n    ErrorMsgs: {\n        unknown: \"未知错误\",\n        paramException: \"{0}'{1}'方法参数错误，请参考api\",\n        invoke: \"{0} 方法参数 {1} 必须为 {2}\",\n        invoke1: \"{0} 方法参数 {1} 必须为 {2} 或 {3}\",\n        invoke2: \"{0} 方法参数 {1} 或 {2} 必须为 {3}\",\n        invoke3: \"{0} 方法参数 {1} 不能为空\",\n        exist: \"{0} 已存在\",\n        exist1: \"{0} '{1}' 已存在\",\n        notexist: \"{0} 不存在\",\n        notexist1: \"{0} '{1}' 不存在\",\n        notupd: \"{0} 不可修改\",\n        notremove: \"{0} 不可删除\",\n        notremove1: \"{0} {1} 不可删除\",\n        namedinvalid: \"{0} {1} 命名错误，请参考用户手册对应命名规范\",\n        initial: \"{0} 初始化参数错误\",\n        jsonparse: \"JSON解析错误\",\n        timeout: \"请求超时\",\n        config: \"{0} 配置参数错误\",\n        config1: \"{0} 配置参数 '{1}' 错误\",\n        itemnotempty: \"{0} '{1}' 配置项 '{2}' 不能为空\",\n        itemincorrect: \"{0} '{1}' 配置项 '{2}' 错误\",\n        needEndTag: \"{0} 标签未闭合\",\n        needStartTag: \"未找到与 {0} 匹配的开始标签\",\n        tagError:\"标签 {0} 错误\",\n        wrongTemplate:\"模版格式错误\",\n        wrongExpression:\"表达式 {0} 错误\"\n    },\n    WeekDays: [\"星期日\",\"星期一\", \"星期二\",\"星期三\",\"星期四\",\"星期五\",\"星期六\"]\n}\n","import { Module } from \"./module\";\n\n/**\n * 过滤器工厂，存储模块过滤器\n */\nexport class ModuleFactory {\n    /**\n     * 模块对象集合 {moduleId:模块对象}}\n     */\n    private static modules: Map<number, Module> = new Map();\n\n    /**\n     * 模块类集合 {className:模块类}\n     */\n    public static classes: Map<string, Module> = new Map();\n\n    /**\n     * 别名map\n     * key:     别名\n     * value:   类名\n     */\n    public static aliasMap:Map<string,string> = new Map();\n\n    /**\n     * 主模块\n     */\n    private static mainModule: Module;\n    /**\n     * 添加模块到工厂\n     * @param item  模块对象\n     */\n    public static add(item: Module) {\n        // 第一个为主模块\n        if (this.modules.size === 0) {\n            this.mainModule = item;\n        }\n        this.modules.set(item.id, item);\n        //添加模块类\n        this.addClass(item.constructor);\n    }\n\n    /**\n     * 获得模块\n     * @param name  类或实例id\n     */\n    public static get(name: any): Module {\n        let tp = typeof name;\n        if (tp === 'number') {  //数字，模块id\n            return this.modules.get(name);\n        } else{\n            let m;\n            if(tp === 'string'){ //字符串，模块类名\n                if(!this.classes.has(name)){  //为别名\n                    name = this.aliasMap.get(name);\n                }\n                if(this.classes.has(name)){\n                    return Reflect.construct(<any>this.classes.get(name),[]);\n                }\n            } else{ //模块类\n                return Reflect.construct(name,[]);\n            }\n        } \n    }\n\n    /**\n     * 是否存在模块类\n     * @param clazzName     模块类名\n     * @returns     true/false\n     */\n    public static hasClass(clazzName: string): boolean {\n        const name = clazzName.toLowerCase();\n        return this.classes.has(name) || this.aliasMap.has(name);\n    }\n\n    /**\n     * 添加模块类\n     * @param clazz     模块类\n     * @param alias     注册别名\n     */\n    public static addClass(clazz: any, alias?: string) {\n        //转换成小写\n        let name = clazz.name.toLowerCase();\n        if (this.classes.has(name)) {\n            return;\n        }\n        this.classes.set(name, clazz);\n        //添加别名\n        if (alias) {\n            this.aliasMap.set(alias.toLowerCase(),name);\n        }\n    }\n\n    /**\n     * 获取模块类\n     * @param name  类名或别名 \n     * @returns     模块类\n     */\n    public static getClass(name:string):any{\n        name = name.toLowerCase();\n        return this.classes.has(name)?this.classes.get(name):this.classes.get(this.aliasMap.get(name));\n    }\n    \n    /**\n     * 装载module\n     * @param modulePath    模块类路径\n     * @return              模块类\n     */\n    public static async load(modulePath:string):Promise<any>{\n        let m = await import(modulePath);\n        if(m){\n            //通过import的模块，查找模块类\n            for(let k of Object.keys(m)){\n                if(m[k].name){\n                    this.addClass(m[k]);\n                    return m[k];\n                }\n            }\n        }\n    }\n    /**\n     * 从工厂移除模块\n     * @param id    模块id\n     */\n    static remove(id: number) {\n        this.modules.delete(id);\n    }\n    /**\n     * 设置主模块\n     * @param m \t模块 \n     */\n    static setMain(m: Module) {\n        this.mainModule = m;\n    }\n\n    /**\n     * 获取主模块\n     * @returns \t应用的主模块\n     */\n    static getMain() {\n        return this.mainModule;\n    }\n}\n","import { NError } from \"./error\";\nimport { Model } from \"./model\";\nimport { Module } from \"./module\";\nimport { Util } from \"./util\";\n\n/**\n * 表达式类\n */\nexport class Expression {\n    /**\n      * 表达式id\n      */\n    id: number;\n\n    /**\n     * 执行函数\n     */\n    execFunc: Function;\n\n    /**\n     * 源表达式串\n     */\n    exprStr: string;\n\n    /**\n     * 只包含自有model变量\n     */\n    allModelField: boolean;\n\n    /**\n     * 值\n     */\n    value:any;\n\n    /**\n     * @param exprStr\t表达式串\n     */\n    constructor(exprStr: string) {\n        this.id = Util.genId();\n        this.allModelField = true;\n        if (!exprStr) {\n            return;\n        }\n        this.exprStr = exprStr;\n        const funStr = this.compile(exprStr);\n        this.execFunc = new Function('$model',`return ` + funStr);\n    }\n\n    /**\n     * 编译表达式串，替换字段和方法\n     * @param exprStr   表达式串\n     * @returns         编译后的表达式串\n     */\n    private compile(exprStr:string){\n        //字符串，object key，有效命名(函数或字段)\n        const reg = /('[\\s\\S]*?')|(\"[\\s\\S]*?\")|(`[\\s\\S]*?`)|([a-zA-Z$_][\\w$]*\\s*?:)|((\\.{3}|\\.)?[a-zA-Z$_][\\w$]*(\\.[a-zA-Z$_][\\w$]*)*(\\s*[\\[\\(](\\s*\\))?)?)/g;\n        let r;\n        let retS = '';\n        let index = 0;  //当前位置\n\n        while((r=reg.exec(exprStr)) !== null){\n            let s = r[0];\n            if(index < r.index){\n                retS += exprStr.substring(index,r.index);\n            }\n            if(s[0] === \"'\" || s[0] === '\"' || s[0] === '`'){ //字符串\n                retS += s;\n            }else{\n                let lch = s[s.length-1];\n                if(lch === ':'){  //object key\n                    retS += s;\n                }else if(lch === '(' || lch === ')'){ //函数，非内部函数\n                    retS += handleFunc(s);\n                }else { //字段 this $model .field等不做处理\n                    if(s.startsWith('this.') \n                        || Util.isKeyWord(s) \n                        || (s[0] === '.' && s[1]!=='.')){ //非model属性\n                        retS += s; \n                    }else{  //model属性\n                        let s1 = '';\n                        if(s.startsWith('...')){ // ...属性名\n                            s1 = '...';\n                            s = s.substring(3);\n                        }\n                        retS += s1 +'$model.' + s;\n                        //存在‘.’，则变量不全在在当前模型中\n                        if(s.indexOf('.') !== -1){\n                            this.allModelField = false;\n                        }\n                    }\n                }\n            } \n            index = reg.lastIndex;\n        }\n        if(index < exprStr.length){\n            retS += exprStr.substring(index);\n        }\n        return retS;\n\n        /**\n         * 处理函数串\n         * @param str   源串\n         * @returns     处理后的串\n         */\n        function handleFunc(str):string{\n            const ind1 = str.lastIndexOf('(');\n            const ind2 = str.indexOf('.');\n            //第一段\n            const fn1 = (ind2 !== -1?str.substring(0,ind2):str.substring(0,ind1)).trim();\n            //保留字或第一个为.\n            if(Util.isKeyWord(fn1) || str[0] === '.'){\n                return str;\n            }\n            //中间无'.'，模块方法\n            if(ind2 === -1){\n                return 'this.' + fn1 + str.substring(fn1.length);\n            }else{  //变量原型方法\n                return '$model.' + str;\n            }\n        }\n    }\n\n    /**\n     * 表达式计算\n     * @param module    模块\n     * @param model \t模型\n     * @returns \t\t计算结果\n     */\n    public val(module:Module,model: Model) {\n        let v;\n        try {\n            v = this.execFunc.call(module,model);\n        } catch (e) {\n            console.error(new NError(\"wrongExpression\",this.exprStr).message);\n            console.error(e);\n        }\n        this.value = v;\n        return v;\n    }\n}","import {Module} from \"./module\";\nimport { IRenderedDom } from \"./types\";\nimport { VirtualDom } from \"./virtualdom\";\n/**\n * css 管理器\n * 针对不同的rule，处理方式不同\n * CssStyleRule 进行保存和替换，同时 scopeInModule(模块作用域)有效\n * CssImportRule 路径不重复添加，因为必须加在stylerule前面，所以需要记录最后的import索引号\n */\nexport class CssManager{\n\n    /**\n     * style sheet\n     */\n    private static sheet:any;\n\n    /**\n     * import url map，用于存储import的url路径\n     */\n    private static importMap = new Map();\n\n    /**\n     * importrule 位置\n     */\n    private static importIndex = 0;\n\n    /**\n     * css class 前置名\n     */\n    private static cssPreName = '___nodommodule___';\n    \n    /**\n     * 处理style 元素\n     * @param module    模块\n     * @param dom       虚拟dom\n     * @param root      模块root dom\n     * @param add       是否添加根模块类名\n     * @returns         如果是styledom，则返回true，否则返回false\n     */\n    public static handleStyleDom(module:Module,dom:IRenderedDom,root:IRenderedDom,add?:boolean):boolean{\n        if(dom.tagName.toLowerCase() !== 'style'){\n            return false;\n        }\n        if(add){\n            let cls = this.cssPreName + module.id;\n            if(root.props['class']){\n                root.props['class'] = dom.props['class'] + ' ' + cls;\n            }else{\n                root.props['class'] = cls;\n            }\n        }\n        return true;\n    }\n\n    /**\n     * 处理 style 下的文本元素\n     * @param module    模块\n     * @param dom       style text element\n     * @returns         如果是styleTextdom返回true，否则返回false\n     */\n    public static handleStyleTextDom(module:Module,dom:IRenderedDom):boolean{\n        if(!dom.parent || dom.parent.tagName.toLowerCase() !== 'style'){\n            return false;\n        }\n        //scope=this，在模块根节点添加 限定 class\n        CssManager.addRules(module,dom.textContent,dom.parent.props['scope'] === 'this'?'.' + this.cssPreName + module.id:undefined);\n        return true;\n    }\n\n    /**\n     * 添加多个css rule\n     * @param cssText           rule集合 \n     * @param module            模块\n     * @param scopeName         作用域名(前置选择器)\n     */\n    public static addRules(module:Module,cssText:string,scopeName?:string){\n        //sheet 初始化\n        if(!this.sheet){\n            //safari不支持 cssstylesheet constructor，用 style代替\n            let sheet = document.createElement('style');\n            document.head.appendChild(sheet);\n            this.sheet = document.styleSheets[0];\n        }\n\n        //如果有作用域，则清除作用域下的rule\n        if(scopeName){\n            this.clearModuleRules(module);\n        }\n\n        //是否限定在模块内\n        //cssRule 获取正则式  @import\n        const reg = /(@[a-zA-Z]+\\s+url\\(.+?\\))|([.#@a-zA-Z]\\S*(\\s*\\S*\\s*?)?{)|\\}/g;\n\n        //import support url正则式\n        const regImp = /@[a-zA-Z]+\\s+url/;\n        \n        // keyframe font page support... 开始 位置\n        let startIndex:number=-1;\n        // { 个数，遇到 } -1 \n        let beginNum:number = 0;\n        let re;\n        while((re=reg.exec(cssText)) !== null){\n            if(regImp.test(re[0])){ //import namespace\n                handleImport(re[0]);\n            }else if(re[0] === '}'){ //回收括号，单个样式结束判断\n                if(startIndex>=0 && --beginNum <= 0){  //style @ end\n                    let txt = cssText.substring(startIndex,re.index+1);\n                    if(txt[0] === '@'){ //@开头\n                        this.sheet.insertRule(txt,CssManager.sheet.cssRules?CssManager.sheet.cssRules.length:0);\n                    }else{  //style\n                        handleStyle(module,txt,scopeName);\n                    }\n                    startIndex = -1;\n                    beginNum = 0;\n                }\n            }else{ //style 或 @内部\n                if(startIndex === -1){\n                    startIndex = re.index;\n                    beginNum++;\n                }else{\n                    beginNum++;\n                }\n            }\n        }\n        \n        /**\n         * 处理style rule\n         * @param module         模块\n         * @param cssText        css 文本\n         * @param scopeName      作用域名(前置选择器)\n         * @returns              如果css文本最后一个\"{\"前没有字符串，则返回void   \n         */\n        function handleStyle(module:Module,cssText:string,scopeName?:string){\n            const reg = /.+(?=\\{)/; //匹配字符\"{\"前出现的所有字符\n            let r = reg.exec(cssText);\n            if(!r){\n                return;\n            }\n            // 保存样式名，在模块 object manager 中以数组存储\n            if(scopeName){\n                let arr = module.objectManager.get('$cssRules');\n                if(!arr){\n                    arr = [];\n                    module.objectManager.set('$cssRules',arr);\n                }\n                arr.push((scopeName + ' ' + r[0]));\n                //为样式添加 scope name\n                cssText = scopeName + ' ' + cssText;\n            }\n            //加入到样式表\n            CssManager.sheet.insertRule(cssText,CssManager.sheet.cssRules?CssManager.sheet.cssRules.length:0);\n        } \n\n        /**\n         * 处理import rule\n         * @param cssText   css文本\n         * @returns         如果cssText中\"()\"内有字符串且importMap中存在键值为\"()\"内字符串的第一个字符，则返回void\n         */\n        function handleImport(cssText:string){\n            let ind = cssText.indexOf('(');\n            let ind1 = cssText.lastIndexOf(')');\n            if(ind === -1 || ind1 === -1 || ind>=ind1){\n                return;\n            }\n            let css = cssText.substring(ind,ind1);\n            if(CssManager.importMap.has(css)){\n                return;\n            }\n            //插入import rule\n            CssManager.sheet.insertRule(cssText,CssManager.importIndex++);\n            CssManager.importMap.set(css,true);\n        }\n        \n    }\n\n    /**\n     * 清除模块css rules\n     * @param module  模块\n     * @returns       如果模块不存在css rules，则返回void \n     */\n    public static clearModuleRules(module:Module){\n        let rules = module.objectManager.get('$cssRules');\n        if(!rules || rules.length === 0){\n            return;\n        }\n        //从sheet清除\n        for(let i=0;i<this.sheet.cssRules.length;i++){\n            let r = this.sheet.cssRules[i];\n            if(r.selectorText && rules.indexOf(r.selectorText) !== -1){\n                this.sheet.deleteRule(i--);\n            }\n        }\n\n        //置空cache\n        module.objectManager.set('$cssRules',[]);\n    }\n}","import { Module } from \"./module\";\nimport { ModuleFactory } from \"./modulefactory\";\nimport { VirtualDom } from \"./virtualdom\";\nimport { Model } from \"./model\";\nimport { Expression } from \"./expression\";\nimport { CssManager } from \"./cssmanager\";\nimport { IRenderedDom } from \"./types\";\nimport { Util } from \"./util\";\n\n/**\n * 渲染器\n */\nexport class Renderer {\n    /**\n     * 等待渲染列表（模块名）\n     */\n    public static waitList: Array < number > = [];\n\n    /**\n     * 当前模块根dom\n     */\n    private static currentModuleRoot:IRenderedDom;\n    /**\n     * 添加到渲染列表\n     * @param module 模块\n     */\n    public static add(module:Module) {\n        //如果已经在列表中，不再添加\n        if (!this.waitList.includes(module.id)) {\n            //计算优先级\n            this.waitList.push(module.id);\n        }\n    }\n    \n    /**\n     * 从渲染队列移除\n     * @param moduleId \n     */\n    public static remove(moduleId:number){\n        let index;\n        if((index = this.waitList.indexOf(moduleId)) !== -1){\n            //不能破坏watiList顺序，用null替换\n            this.waitList.splice(index,1,null);\n        }\n    }\n    /**\n     * 队列渲染\n     */\n    public static render() {\n        for(;this.waitList.length>0;){\n            let id = this.waitList[0];\n            if(id){ //存在id为null情况，remove方法造成\n                const m = ModuleFactory.get(id)\n                m.render();\n            }\n            //渲染后移除\n            this.waitList.shift();\n        }\n    }\n\n    /**\n     * 渲染dom\n     * @param module            模块 \n     * @param src               源dom\n     * @param model             模型，如果src已经带有model，则此参数无效，一般为指令产生的model（如slot）\n     * @param parent            父dom\n     * @param key               key 附加key，放在domkey的后面\n     * @returns \n     */\n    public static renderDom(module:Module,src:VirtualDom,model:Model,parent?:IRenderedDom,key?:any):IRenderedDom{\n        //构建key，如果带key，则需要重新构建唯一key\n        const key1 = key?Util.genUniqueKey(src.key,key):src.key;\n        //设置model\n        model = src.model || model;\n        let dst:IRenderedDom = {\n            key:key1,\n            vdom:src\n        }\n        if(src.tagName){\n            dst.tagName = src.tagName;\n            //添加key属性\n            dst.props = {};\n        }else{\n            dst.textContent = src.textContent;\n        }\n        //设置当前根root\n        if(!parent){\n            this.currentModuleRoot = dst;\n            //设置根model\n            if(!model){\n                model = module.model;\n            }\n        }else{\n            if(!model){\n                model = parent.model;\n            }\n            // 设置父对象\n            dst.parent = parent;\n        }\n        \n        dst.model = model;\n        dst.staticNum = src.staticNum;\n        //先处理model指令\n        if(src.directives && src.directives.length>0 && src.directives[0].type.name === 'model'){\n            src.directives[0].exec(module,dst);\n        }\n        if(dst.tagName){  //标签节点\n            handleProps();\n            //处理style，如果为style，则不处理assets和events\n            if(!CssManager.handleStyleDom(module,src,Renderer.currentModuleRoot,src.getProp('scope') === 'this')){\n                //assets\n                if(src.assets && src.assets.size>0){\n                    for(let p of src.assets){\n                        dst[p[0]] = p[1];\n                    }\n                }\n            }\n            //处理directive时，导致禁止后续渲染，则不再渲染，如show指令\n            if(!handleDirectives()){\n                return null;\n            }\n            //添加dst事件到事件工厂\n            if(src.events){\n                for(let evt of src.events){\n                    module.eventFactory.addEvent(dst,evt);\n                }\n            }\n            // 子节点渲染\n            if(src.children && src.children.length>0){\n                dst.children = [];\n                for(let c of src.children){\n                    Renderer.renderDom(module,c,dst.model,dst,key?key:null);\n                }\n            }\n        }else{ //文本节点\n            if(src.expressions){ //文本节点\n                let value = '';\n                for(let expr of src.expressions){\n                    if (expr instanceof Expression) { //处理表达式\n                        let v1 = expr.val(module,dst.model);\n                        value += v1 !== undefined ? v1 : '';\n                    } else {\n                        value += expr;\n                    }\n                }\n                dst.textContent = value;\n            }else{\n                dst.textContent = src.textContent;\n            }\n        }\n        if(src.staticNum===1){\n            src.staticNum=0;\n        }\n        //添加到dom tree，必须放在handleDirectives后，因为有可能directive执行后返回false\n        if(parent){\n            dst.parent.children.push(dst);\n        }\n        return dst;\n\n        /**\n         * 处理指令\n         * @returns     true继续执行，false不执行后续渲染代码\n         */\n        function handleDirectives():boolean {\n            if(!src.directives || src.directives.length===0){\n                return true;\n            }\n            // dst.staticNum = -1;\n            for(let d of src.directives){\n                //model指令不执行\n                if(d.type.name==='model'){\n                    continue;\n                }\n                if(!d.exec(module,dst)){\n                    return false;\n                }\n            }\n            return true;\n        }\n        \n        /**\n         * 处理属性（带表达式）\n         */\n        function handleProps() {\n            if(!src.props || src.props.size === 0){\n                return;\n            }\n            //因为存在大小写，所以用正则式进行匹配\n            const styleReg = /^style$/i;\n            const classReg = /^class$/i;\n            let value;\n            for(let k of src.props){\n                if(Array.isArray(k[1])){  //数组，需要合并\n                    value = [];\n                    for(let i=0;i<k[1].length;i++){\n                        let a = k[1][i];\n                        if(a instanceof Expression){\n                            value.push(a.val(module,dst.model));\n                            // dst.staticNum = -1;\n                        }else{\n                            value.push(a);\n                        }\n                    }\n                    if(styleReg.test(k[0])){\n                        value = src.getStyleString(value);\n                    }else if(classReg.test(k[0])){\n                        value = src.getClassString(value);\n                    }\n                }else if(k[1] instanceof Expression){\n                    value = k[1].val(module,dst.model);\n                    // dst.staticNum = -1;\n                }else{\n                    value = k[1];\n                }\n                dst.props[k[0]] = value;\n            }\n        }\n    }\n\n    /**\n     * 更新到html树\n     * @param module    模块\n     * @param src       渲染节点\n     * @returns         渲染后的节点    \n     */\n    public static updateToHtml(module: Module,src:IRenderedDom):Node {\n        let el = module.getElement(src.key);\n        if(!el){\n            return this.renderToHtml(module,src,null);\n        }else if(src.tagName){   //html dom节点已存在\n            //设置element key属性\n            (<any>el).key = src.key;\n            let attrs = (<HTMLElement>el).attributes;\n            let arr = [];\n            for(let i=0;i<attrs.length;i++){\n                arr.push(attrs[i].name);\n            }\n            //设置属性\n            for(let p of Object.keys(src.props)){\n                (<HTMLElement>el).setAttribute(p,src.props[p]===undefined?'':src.props[p]);\n                let ind;\n                if((ind=arr.indexOf(p)) !== -1){\n                    arr.splice(ind,1);\n                }\n            }\n            //清理多余attribute\n            if(arr.length>0){\n                for(let a of arr){\n                    (<HTMLElement>el).removeAttribute(a);\n                }\n            }\n            //处理asset\n            if (src.assets) {\n                for (let k of Object.keys(src.assets)) {\n                    el[k] = src.assets[k];\n                }    \n            }\n        }else{  //文本节点\n            (<any>el).textContent = src.textContent;\n        }\n        return el;\n    }\n\n    /**\n     * 渲染到html树\n     * @param module \t        模块\n     * @param src               渲染节点\n     * @param parentEl \t        父html\n     * @param isRenderChild     是否渲染子节点\n     */\n    public static renderToHtml(module: Module,src:IRenderedDom, parentEl:Node,isRenderChild?:boolean):Node {\n        let el;\n        if(src.tagName){\n            el = newEl(src);\n        }else{\n            el = newText(src);\n        }\n        //先创建子节点，再添加到html dom树，避免频繁添加\n        if(el && src.tagName  && isRenderChild){\n            genSub(el, src);\n        }\n        if(el && parentEl){\n            parentEl.appendChild(el);\n        }\n        return el;\n        \n        /**\n         * 新建element节点\n         * @param dom \t\t虚拟dom\n         * @returns \t\t新的html element\n         */\n        function newEl(dom:IRenderedDom,isSvg?:boolean): HTMLElement {\n            //style不处理\n            if(dom.tagName === 'style'){\n                return;\n            }\n            let el= document.createElement(dom.tagName);\n            //把el引用与key关系存放到cache中\n            module.saveElement(dom.key,el);\n            //设置element key属性\n            (<any>el).key = dom.key;\n            //设置属性\n            for(let p of Object.keys(dom.props)){\n                el.setAttribute(p,dom.props[p]===undefined?'':dom.props[p]);\n            }\n            //asset\n            if(dom.assets){\n                for (let p of Object.keys(dom.assets)) {\n                    el[p] = dom.assets[p];\n                }\n            }\n            //绑定事件\n            module.eventFactory.bind(dom);\n            return el;\n        }\n\n        /**\n         * 新建文本节点\n         */\n        function newText(dom:IRenderedDom): Node {\n            //样式表处理，如果是样式表文本，则不添加到dom树\n            if(CssManager.handleStyleTextDom(module,dom)){\n                 return;\n            }\n            let node = document.createTextNode(<string>dom.textContent || '');\n            module.saveElement(dom.key,node);\n            return node;\n        }\n\n        /**\n         * 生成子节点\n         * @param pEl \t父节点\n         * @param vdom  虚拟dom节点\t\n         */\n        function genSub(pEl: Node, vdom: IRenderedDom) {\n            if (vdom.children && vdom.children.length > 0) {\n                vdom.children.forEach(item => {\n                    let el1;\n                    if (item.tagName) {\n                        el1 = newEl(item);\n                        genSub(el1, item);\n                    } else {\n                        el1 = newText(item);\n                    }\n                    if(el1){\n                        pEl.appendChild(el1);\n                    }\n                });\n            }\n        }\n    }\n\n    /**\n     * 处理更改的dom节点\n     * @param module        待处理模块\n     * @param changeDoms    更改的dom参数数组 [type(add 1, upd 2,del 3,move 4 ,rep 5),dom(操作节点),dom1(被替换或修改节点),parent(父节点),loc(位置)]\n     */\n    public static handleChangedDoms(module:Module,changeDoms:any[]){\n        //替换数组\n        const repArr =[];\n        //添加和移动数组\n        const arr = [];\n        //保留原有html节点\n        for (let item of changeDoms) {\n            if(item[0] === 2){  //修改\n                Renderer.updateToHtml(module, item[1]);\n            }else if (item[0] === 3) {  //删除\n                const pEl = module.getElement(item[3].key);\n                const n1 = module.getElement(item[1].key);\n                if (pEl && n1 && n1.parentElement === pEl) {\n                    pEl.removeChild(n1);\n                }\n                module.domManager.freeNode(item[1]);\n            }else if (item[0] === 5) {  //替换\n                repArr.push(item);\n            }else{ //仅对添加和移动的节点进行二次操作\n                arr.push(item);\n            }\n        }\n\n        //替换\n        if(repArr.length>0){\n            for(let item of repArr){\n                const pEl = module.getElement(item[3].key);\n                let n2;\n                if(item[2].moduleId){ //子模块先free再获取，先还原为空文本，再实现新的子模块mount\n                    module.domManager.freeNode(item[2]);\n                    n2 = module.getElement(item[2].key);\n                }else{  //先获取，再free，避免getElement为null\n                    n2 = module.getElement(item[2].key);\n                    module.domManager.freeNode(item[2]);\n                }\n                //替换n2在element map中的值\n                const n1 = Renderer.renderToHtml(module, item[1], null, true);\n                if (pEl && n2) {\n                    pEl.replaceChild(n1, n2);\n                }\n            }\n        }\n\n        //按index排序\n        if(arr.length > 0){\n            arr.sort((a,b)=>a[4]>b[4]?1:-1);\n        }\n        \n        for(let item of arr){\n            const pEl = <HTMLElement>module.getElement(item[3].key);\n            if(item[0] === 1){ //添加\n                const n1 = Renderer.renderToHtml(module, item[1], null, true);\n                if (pEl.childNodes && pEl.childNodes.length - 1 > item[4]) {\n                    pEl.insertBefore(n1, pEl.childNodes[item[4]]);\n                }\n                else {\n                    pEl.appendChild(n1);\n                }\n            }else{  //移动\n                const n1 = module.getElement(item[1].key);\n                if (n1 && n1 !== pEl.childNodes[item[4]]) {\n                    if (pEl.childNodes.length-1 > item[4]) {\n                        pEl.insertBefore(n1, pEl.childNodes[item[4]]);\n                    }else if(n1 !== pEl.childNodes[pEl.childNodes.length-1]){ //最后一个与当前节点不相同，则放在最后\n                        pEl.appendChild(n1);\n                    }\n                }\n            }\n        }\n    }\n}","import { NError } from \"./error\";\nimport { NodomMessage } from \"./nodom\";\nimport { Util } from \"./util\";\n\nexport class RequestManager{\n    /**\n     * 拒绝相同请求（url，参数）时间间隔\n     */\n    static rejectReqTick:number = 500;\n    /**\n     * 请求map，用于缓存之前的请求url和参数\n     * key:     url\n     * value:   请求参数\n     */\n    static requestMap:Map<string,any> = new Map();\n    /**\n     * ajax 请求\n     * @param config    object 或 string\n     *                  如果为string，则直接以get方式获取资源\n     *                  object 项如下:\n     *                  参数名|类型|默认值|必填|可选值|描述\n     *                  -|-|-|-|-|-\n     *                  url|string|无|是|无|请求url\n     *\t\t\t\t\tmethod|string|GET|否|GET,POST,HEAD|请求类型\n     *\t\t\t\t\tparams|Object/FormData|{}|否|无|参数，json格式\n     *\t\t\t\t\tasync|bool|true|否|true,false|是否异步\n     *  \t\t\t\ttimeout|number|0|否|无|请求超时时间\n     *                  type|string|text|否|json,text|\n     *\t\t\t\t\twithCredentials|bool|false|否|true,false|同源策略，跨域时cookie保存\n     *                  header|Object|无|否|无|request header 对象\n     *                  user|string|无|否|无|需要认证的请求对应的用户名\n     *                  pwd|string|无|否|无|需要认证的请求对应的密码\n     *                  rand|bool|无|否|无|请求随机数，设置则浏览器缓存失效\n     */\n    static async request(config): Promise<any> {\n        const time = Date.now();\n        if(this.requestMap.has(config.url)){\n            const obj = this.requestMap.get(config.url);\n            if(time - obj.time < this.rejectReqTick && Util.compare(obj.params,config.params)){\n                return;\n            }\n        }\n        this.requestMap.set(config.url,{\n            time:time,\n            params:config.params\n        });\n        return new Promise((resolve, reject) => {\n            if (typeof config === 'string') {\n                config = {\n                    url: config\n                }\n            }\n            config.params = config.params || {};\n            //随机数\n            if (config.rand) { //针对数据部分，仅在app中使用\n                config.params.$rand = Math.random();\n            }\n            let url: string = config.url;\n            const async: boolean = config.async === false ? false : true;\n            const req: XMLHttpRequest = new XMLHttpRequest();\n            //设置同源策略\n            req.withCredentials = config.withCredentials;\n            //类型默认为get\n            const method: string = (config.method || 'GET').toUpperCase();\n            //超时，同步时不能设置\n            req.timeout = async ? config.timeout : 0;\n\n            req.onload = () => {\n                if (req.status === 200) {\n                    let r = req.responseText;\n                    if (config.type === 'json') {\n                        try {\n                            r = JSON.parse(r);\n                        } catch (e) {\n                            reject({ type: \"jsonparse\" });\n                        }\n                    }\n                    resolve(r);\n                } else {\n                    reject({ type: 'error', url: url });\n                }\n            }\n\n            req.ontimeout = () => reject({ type: 'timeout' });\n            req.onerror = () => reject({ type: 'error', url: url });\n            //上传数据\n            let data = null;\n            switch (method) {\n                case 'GET':\n                    //参数\n                    let pa: string;\n                    if (Util.isObject(config.params)) {\n                        let ar: string[] = [];\n                        for(let k of Object.keys(config.params)){\n                            const v = config.params[k];\n                            if(v === undefined || v === null){\n                                continue;\n                            }\n                            ar.push(k + '=' + v);\n                        }\n                        pa = ar.join('&');\n                    }\n                    if (pa !== undefined) {\n                        if (url.indexOf('?') !== -1) {\n                            url += '&' + pa;\n                        } else {\n                            url += '?' + pa;\n                        }\n                    }\n\n                    break;\n                case 'POST':\n                    if (config.params instanceof FormData) {\n                        data = config.params;\n                    } else {\n                        let fd: FormData = new FormData();\n                        for(let k of Object.keys(config.params)){\n                            const v = config.params[k];\n                            if(v === undefined || v === null){\n                                continue;\n                            }\n                            fd.append(k, v);\n                        }\n                        data = fd;                  \n                    }\n                    break;\n            }\n\n            req.open(method, url, async, config.user, config.pwd);\n            //设置request header\n            if (config.header) {\n                Util.getOwnProps(config.header).forEach((item) => {\n                    req.setRequestHeader(item, config.header[item]);\n                })\n            }\n            req.send(data);\n        }).catch((re) => {\n            switch (re.type) {\n                case \"error\":\n                    throw new NError(\"notexist1\", NodomMessage.TipWords['resource'], re.url);\n                case \"timeout\":\n                    throw new NError(\"timeout\");\n                case \"jsonparse\":\n                    throw new NError(\"jsonparse\");\n            }\n        });\n    }\n\n    /**\n     * 清除超时缓存请求信息\n     */\n    static clearCache(){\n        const time = Date.now();\n        for(let key of this.requestMap.keys()){\n            if(time - this.requestMap.get(key).time > this.rejectReqTick){\n                this.requestMap.delete(key);\n            }\n        }\n    }\n}","import { IRouteCfg } from \"./types\";\nimport { Util } from \"./util\";\n\n/**\n * 路由类\n */\n export class Route {\n    /**\n     * 路由id\n     */\n    id:number;\n    /**\n     * 路由参数名数组\n     */\n    params:Array<string> = [];\n    /**\n     * 路由参数数据\n     */\n    data:any = {};\n    /**\n     * 子路由\n     */\n    children:Array<Route> = [];\n    /**\n     * 进入路由事件方法\n     */\n    onEnter:Function;\n    /**\n     * 离开路由方法\n     */\n    onLeave:Function;\n    \n    /**\n     * 路由路径\n     */\n    path:string;\n    /**\n     * 完整路径\n     */\n    fullPath:string;\n\n    /**\n     * 路由对应模块对象或类或模块类名\n     */\n    module:any;\n    \n    /**\n     * 模块路径，当module为类名时需要，默认执行延迟加载\n     */\n    modulePath:string;\n\n    /**\n     * 父路由\n     */\n    parent:Route;\n\n    /**\n     * \n     * @param config 路由配置项\n     */\n    constructor(config?:IRouteCfg,parent?:Route) {\n        if (!config || Util.isEmpty(config.path)) {\n            return;\n        }\n        this.id = Util.genId();\n        //参数赋值\n        for(let o of Object.keys(config)){\n            this[o] = config[o];   \n        }\n        this.parent = parent;\n        //解析路径\n        if(this.path){\n            this.parse();\n        }\n        if(parent){\n            parent.addChild(this);\n        }\n        //子路由\n        if (config.routes && Array.isArray(config.routes)) {\n            config.routes.forEach((item) => {\n                new Route(item,this);\n            });\n        }\n    }\n    \n    /**\n     * 添加子路由\n     * @param child \n     */\n    public addChild(child:Route){\n        this.children.push(child);\n        child.parent = this;\n    }\n\n    /**\n     * 通过路径解析路由对象\n     */\n    private parse(){\n        let pathArr:Array<string> = this.path.split('/');\n        let node:Route = this.parent;\n        let param:Array<string> = [];\n        let paramIndex:number = -1; //最后一个参数开始\n        let prePath:string = '';    //前置路径\n        for (let i = 0; i < pathArr.length; i++) {\n            let v = pathArr[i].trim();\n            if (v === '') {\n                pathArr.splice(i--, 1);\n                continue;\n            }\n\n            if (v.startsWith(':')) { //参数\n                if (param.length === 0) {\n                    paramIndex = i;\n                }\n                param.push(v.substring(1));\n            } else {\n                paramIndex = -1;\n                param = []; //上级路由的参数清空\n                this.path = v; //暂存path\n                let j = 0;\n                for (; j < node.children.length; j++) {\n                    let r = node.children[j];\n                    if (r.path === v) {\n                        node = r;\n                        break;\n                    }\n                }\n\n                //没找到，创建新节点\n                if (j === node.children.length) {\n                    if (prePath !== '') {\n                        new Route({ path: prePath},node);\n                        node = node.children[node.children.length - 1];\n                    }\n                    prePath = v;\n                }\n            }\n\n            //不存在参数\n            this.params = paramIndex===-1?[]:param;\n        }\n    }\n\n    /**\n     * 克隆\n     * @returns 克隆对象\n     */\n    clone(){\n        let r = new Route();\n        Object.getOwnPropertyNames(this).forEach(item=>{\n            if(item === 'data'){    \n                return;\n            }\n            r[item] = this[item];\n        });\n        if(this.data){\n            r.data = Util.clone(this.data);\n        }\n        return r;\n    }\n}","import { Model } from \"./model\";\nimport { Module } from \"./module\";\nimport { Route } from \"./route\";\nimport { VirtualDom } from \"./virtualdom\";\n\n/**\n * 应用初始化配置类型\n */\n/**\n * 路由配置\n */\nexport interface IRouteCfg {\n    /**\n     * 路由路径，可以带通配符*，可以带参数 /:\n     */\n    path?: string;\n    \n    /**\n     * 路由对应模块对象或类或模块类名\n     */\n    module?:any;\n\n    /**\n     * 模块路径，当module为类名时需要，默认执行延迟加载\n     */\n    modulePath?:string;\n    /**\n     * 子路由数组\n     */\n    routes?: Array<IRouteCfg>;\n\n    /**\n     * 进入路由事件方法\n     */\n    onEnter?: Function;\n    /**\n     * 离开路由方法\n     */\n    onLeave?: Function;\n    \n    /**\n     * 父路由\n     */\n    parent?: Route;\n}\n\n/**\n * 模块状态类型\n */\nexport enum EModuleState {\n    /**\n     * 准备好，可渲染\n     */\n    READY = 1,\n    /**\n     * 未挂载到html dom\n     */\n    UNMOUNTED=3,\n    /**\n     * 已挂载到dom树\n     */\n    MOUNTED=4\n}\n\n/**\n * 渲染后的节点接口\n */\nexport interface IRenderedDom{\n    /**\n     * 元素名，如div\n     */\n    tagName?: string;\n\n    /**\n     * key:string|number,整颗渲染树唯一\n     */\n    key: any;\n \n    /**\n      * 绑定模型\n     */\n    model?: Model;\n\n    /**\n     * 直接属性 不是来自于attribute，而是直接作用于html element，如el.checked,el.value等\n     */\n    assets?: Object;\n\n    /**\n     * 静态属性(attribute)集合\n     * {prop1:value1,...}\n     */\n    props?: Object;\n \n    /**\n     * element为textnode时有效\n     */\n    textContent?: string;\n\n    /**\n     * 子节点数组[]\n     */\n    children?: Array<IRenderedDom>;\n\n    /**\n     * 父虚拟dom\n     */\n    parent?: IRenderedDom;\n\n     /**\n      * staticNum 静态标识数\n      *  0 表示静态，不进行比较\n      *  > 0 每次比较后-1\n      *  < 0 不处理\n      */\n    staticNum?: number;\n \n    /**\n     * 子模块id，模块容器时有效\n     */\n    moduleId?: number;\n\n    /**\n     * 源虚拟dom\n     */\n    vdom?: VirtualDom;\n}\n\n","import { Module } from \"./module\";\nimport { ModuleFactory } from \"./modulefactory\";\nimport { Route } from \"./route\";\nimport { EModuleState } from \"./types\";\nimport { Util } from \"./util\";\n\n/**\n * 路由管理类\n * @since \t1.0\n */\nexport class Router {\n    /**\n     * 当前路径\n     */\n    public static currentPath: string;\n\n    /**\n     * path等待链表\n     */\n    private static waitList: Array<string> = [];\n\n    /**\n     * 默认路由进入事件方法\n     */\n    private static onDefaultEnter: Function;\n    /**\n     * 默认路由离开事件\n     */\n    private static onDefaultLeave: Function;\n\n    /**\n     * 启动方式 0:直接启动 1:popstate 启动\n     */\n    public static startStyle: number = 0;\n\n    /**\n     * 激活Dom map，格式为{moduleId:[]}\n     */\n    private static activeFieldMap: Map<number, Array<any>> = new Map();\n\n    /**\n     * 绑定到module的router指令对应的key，即router容器对应的key，格式为 {moduleId:routerKey,...}\n     */\n    public static routerKeyMap: Map<number, number> = new Map();\n\n    /**\n     * 根路由\n     */\n    public static root:Route = new Route();\n\n    /**\n     * 基础路径，实际显示路径为 basePath+routePath\n     */\n    public static basePath:string;\n    \n    /**\n     * 把路径加入跳转列表(准备跳往该路由)\n     * @param path \t路径 \n     */\n    static go(path: string) {\n        //相同路径不加入\n        if (path === this.currentPath) {\n            return;\n        }\n\n        //添加路径到等待列表，已存在，不加入\n        if (this.waitList.indexOf(path) === -1) {\n            this.waitList.push(path);\n        }\n\n        //延迟加载，避免同一个路径多次加入\n        setTimeout(() => {\n            this.load();\n        }, 0);\n    }\n\n    /**\n     * 启动加载\n     */\n    private static load() {\n        //在加载，或无等待列表，则返回\n        if (this.waitList.length === 0) {\n            return;\n        }\n\n        let path: string = this.waitList.shift();\n        this.start(path).then(() => {\n            //继续加载\n            this.load();\n        });\n    }\n\n    /**\n     * 切换路由\n     * @param path \t路径\n     */\n    private static async start(path: string) {\n        let diff = this.compare(this.currentPath, path);\n        // 当前路由依赖的容器模块\n        let parentModule: Module;\n        if (diff[0] === null) {  //不存在上一级模块\n            //默认为主模块\n            parentModule = ModuleFactory.getMain();\n\n            // 当router key map不为空且主模块无router容器时，则取第一个key对应的模块为父模块\n            if(this.routerKeyMap.size>0){\n                const mid = this.routerKeyMap.keys().next().value;\n                if(mid !== parentModule.id){\n                    const m = ModuleFactory.get(mid);\n                    if(m){\n                        parentModule = m;\n                    }\n                }\n            }\n        } else {\n            parentModule = await this.getModule(diff[0]);\n        }\n        //onleave事件，从末往前执行\n        for (let i = diff[1].length - 1; i >= 0; i--) {\n            const r = diff[1][i];\n            if (!r.module) {\n                continue;\n            }\n            const module: Module = await this.getModule(r);\n            if (Util.isFunction(this.onDefaultLeave)) {\n                this.onDefaultLeave(module.model);\n            }\n            if (Util.isFunction(r.onLeave)) {\n                r.onLeave(module.model);\n            }\n            // 清理map映射\n            this.activeFieldMap.delete(module.id);\n            // 取消挂载\n            module.unmount();\n        }\n        if (diff[2].length === 0) { //路由相同，参数不同\n            let route: Route = diff[0];\n            if (route !== null) {\n                const module: Module = await this.getModule(route);\n                // 模块处理\n                this.dependHandle(module, route, diff[3] ? diff[3].module : null);\n            }\n        } else { //路由不同\n            //加载模块\n            for (let ii = 0; ii < diff[2].length; ii++) {\n                const route: Route = diff[2][ii];\n                //路由不存在或路由没有模块（空路由）\n                if (!route || !route.module) {\n                    continue;\n                }\n                const module: Module = await this.getModule(route);\n                // 模块处理\n                this.dependHandle(module, route, parentModule);\n                //默认全局路由enter事件\n                if (Util.isFunction(this.onDefaultEnter)) {\n                    this.onDefaultEnter(module.model);\n                }\n                //当前路由进入事件\n                if (Util.isFunction(route.onEnter)) {\n                    route.onEnter(module.model);\n                }\n                parentModule = module;\n            }\n        }\n\n        //如果是history popstate，则不加入history\n        if (this.startStyle === 0) {\n            let path1:string = (Router.basePath||'') + path;\n            //子路由，替换state\n            if (path.startsWith(this.currentPath)) {\n                history.replaceState(path1, '', path1);\n            } else { //路径push进history\n                history.pushState(path1, '', path1);\n            }\n        }\n        //修改currentPath\n        this.currentPath = path;\n        //设置start类型为正常start\n        this.startStyle = 0;\n    }\n\n    /*\n     * 重定向\n     * @param path \t路径\n     */\n    public static redirect(path: string) {\n        this.go(path);\n    }\n\n    /**\n     * 获取module\n     * @param route 路由对象 \n     * @returns     路由对应模块\n     */\n    private static async getModule(route: Route) {\n        let module = route.module;\n        //已经是模块实例\n        if (typeof module === 'object') {\n            return module;\n        }\n        //模块路径\n        if(typeof module === 'string'){\n            module = await ModuleFactory.load(module);\n        }\n        //模块类\n        if (typeof module === 'function') {\n            route.module = ModuleFactory.get(module);\n        }\n        return route.module;\n    }\n    /**\n     * 比较两个路径对应的路由链\n     * @param path1 \t第一个路径\n     * @param path2 \t第二个路径\n     * @returns \t\t数组 [父路由或不同参数的路由，第一个需要销毁的路由数组，第二个需要增加的路由数组，不同参数路由的父路由]\n     */\n    private static compare(path1: string, path2: string): Array<any> {\n        // 获取路由id数组\n        let arr1: Array<Route> = null;\n        let arr2: Array<Route> = null;\n\n        if (path1) {\n            //采用克隆方式复制，避免被第二个路径返回的路由覆盖参数\n            arr1 = this.getRouteList(path1, true);\n        }\n        if (path2) {\n            arr2 = this.getRouteList(path2);\n        }\n\n        let len = 0;\n        if (arr1 !== null) {\n            len = arr1.length;\n        }\n\n        if (arr2 !== null) {\n            if (arr2.length < len) {\n                len = arr2.length;\n            }\n        } else {\n            len = 0;\n        }\n        //需要销毁的旧路由数组\n        let retArr1 = [];\n        //需要加入的新路由数组\n        let retArr2 = [];\n        let i = 0;\n        for (i = 0; i < len; i++) {\n            //找到不同路由开始位置\n            if (arr1[i].id === arr2[i].id) {\n                //比较参数\n                if (JSON.stringify(arr1[i].data) !== JSON.stringify(arr2[i].data)) {\n                    i++;\n                    break;\n                }\n            } else {\n                break;\n            }\n        }\n\n        //旧路由改变数组\n        if (arr1 !== null) {\n            retArr1 = arr1.slice(i);\n        }\n\n        //新路由改变数组（相对于旧路由）\n        if (arr2 !== null) {\n            retArr2 = arr2.slice(i);\n        }\n\n        //上一级路由或参数不同的当前路由\n        let p1: Route = null;\n        //上二级路由或参数不同路由的上一级路由\n        let p2: Route = null;\n        if (arr2 && i > 0) {\n            // 可能存在空路由，需要向前遍历\n            for (let j = i - 1; j >= 0; j--) {\n                if (!p1) {\n                    if (arr2[j].module) {\n                        p1 = arr2[j];\n                        continue;\n                    }\n                } else if (!p2) {\n                    if (arr2[j].module) {\n                        p2 = arr2[j];\n                        break;\n                    }\n                }\n            }\n        }\n        return [p1, retArr1, retArr2, p2];\n    }\n\n    /**\n     * 添加激活字段\n     * @param module    模块 \n     * @param path      路由路径\n     * @param model     激活字段所在model\n     * @param field     字段名\n     */\n    public static addActiveField(module: Module, path: string, model: any, field: string) {\n        if (!model || !field) {\n            return;\n        }\n        let arr = Router.activeFieldMap.get(module.id);\n        if (!arr) {  //尚未存在，新建\n            Router.activeFieldMap.set(module.id, [{ path: path, model: model, field: field }]);\n        } else if (arr.find(item => item.model === model && item.field === field) === undefined) {  //不重复添加\n            arr.push({ path: path, model: model, field: field });\n        }\n    }\n\n    /**\n     * 依赖模块相关处理\n     * @param module \t模块\n     * @param pm        依赖模块\n     * @param path \t\tview对应的route路径\n     */\n    private static dependHandle(module: Module, route: Route, pm: Module) {\n        const me = this;\n        //设置参数\n        let o = {\n            path: route.path\n        };\n        if (!Util.isEmpty(route.data)) {\n            o['data'] = route.data;\n        }\n        module.model['$route'] = o;\n        if(pm){\n            if(pm.state === EModuleState.MOUNTED){  //被依赖已挂载在html dom树中\n                module.setContainer(<HTMLElement>pm.getElement(Router.routerKeyMap.get(pm.id)));\n                //激活\n                module.active();\n                this.setDomActive(pm, route.fullPath);\n            } else { //被依赖模块不处于被渲染后状态\n                if(pm['onMount']){\n                    const foo = pm['onMount'];\n                    pm['onMount'] = (model)=>{\n                        foo(model);\n                        module.setContainer(<HTMLElement>pm.getElement(Router.routerKeyMap.get(pm.id)));\n                        //激活\n                        module.active();\n                        me.setDomActive(pm,route.fullPath);\n                        //还原onMount方法\n                        pm['onMount'] = foo;\n                    }\n                }else{\n                    pm['onMount'] = (model)=>{\n                        module.setContainer(<HTMLElement>pm.getElement(Router.routerKeyMap.get(pm.id)));\n                        //激活\n                        module.active();\n                        me.setDomActive(pm,route.fullPath);\n                        //只执行一次\n                        delete pm['onMount'];\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * 设置路由元素激活属性\n     * @param module    模块 \n     * @param path      路径\n     * @returns \n     */\n    private static setDomActive(module: Module, path: string) {\n        let arr = Router.activeFieldMap.get(module.id);\n        if (!arr) {\n            return;\n        }\n        for (let o of arr) {\n            o.model[o.field] = o.path === path;\n        }\n    }\n    \n    /**\n     * 获取路由数组\n     * @param path \t要解析的路径\n     * @param clone 是否clone，如果为false，则返回路由树的路由对象，否则返回克隆对象\n     * @returns     路由对象数组\n     */\n    static getRouteList(path: string, clone?: boolean): Array<Route> {\n        if (!this.root) {\n            return [];\n        }\n        let pathArr: string[] = path.split('/');\n        let node: Route = this.root;\n        let paramIndex: number = 0;      //参数索引\n        let retArr: Array<Route> = [];\n        let fullPath: string = '';       //完整路径\n        let preNode: Route = this.root;  //前一个节点\n        for (let i = 0; i < pathArr.length; i++) {\n            let v: string = pathArr[i].trim();\n            if (v === '') {\n                continue;\n            }\n            let find: boolean = false;\n            for (let j = 0; j < node.children.length; j++) {\n                if (node.children[j].path === v) {\n                    //设置完整路径\n                    if (preNode !== this.root) {\n                        preNode.fullPath = fullPath;\n                        preNode.data = node.data;\n                        retArr.push(preNode);\n                    }\n\n                    //设置新的查找节点\n                    node = clone ? node.children[j].clone() : node.children[j];\n                    //参数清空\n                    node.data = {};\n                    preNode = node;\n                    find = true;\n                    //参数索引置0\n                    paramIndex = 0;\n                    break;\n                }\n            }\n            //路径叠加\n            fullPath += '/' + v;\n            //不是孩子节点,作为参数\n            if (!find) {\n                if (paramIndex < node.params.length) { //超出参数长度的废弃\n                    node.data[node.params[paramIndex++]] = v;\n                }\n            }\n        }\n        //最后一个节点\n        if (node !== this.root) {\n            node.fullPath = fullPath;\n            retArr.push(node);\n        }\n        return retArr;\n    }\n}\n\n//处理popstate事件\nwindow.addEventListener('popstate', function (e) {\n    //根据state切换module\n    const state = history.state;\n    if (!state) {\n        return;\n    }\n    Router.startStyle = 1;\n    Router.go(state);\n});\n","import { NError } from \"./error\";\nimport { Util } from \"./util\";\n\n/**\n * 调度器，用于每次空闲的待操作序列调度\n */\nexport class Scheduler{\n\tprivate static tasks:Array<any> = [];\n\tpublic static dispatch(){\n\t\tScheduler.tasks.forEach((item)=>{\n\t\t\tif(Util.isFunction(item.func)){\n\t\t\t\tif(item.thiser){\n\t\t\t\t\titem.func.call(item.thiser);\n\t\t\t\t}else{\n\t\t\t\t\titem.func();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * 启动调度器\n\t * @param scheduleTick \t渲染间隔\n\t */\n\tpublic static start(scheduleTick?:number){\n\t\tScheduler.dispatch();\n\t\tif(window.requestAnimationFrame){\n\t\t\twindow.requestAnimationFrame(Scheduler.start);\n\t\t}else{\n\t\t\twindow.setTimeout(Scheduler.start,scheduleTick||50);\n\t\t}\t\t\n\t}\n\n\t/**\n\t * 添加任务\n\t * @param foo \t\t任务和this指向\n\t * @param thiser \tthis指向\n\t */\n\tpublic static addTask(foo:Function,thiser?:any){\n\t\tif(!Util.isFunction(foo)){\n\t\t\tthrow new NError(\"invoke\",\"Scheduler.addTask\",\"0\",\"function\");\n\t\t}\n\t\t\n\t\tScheduler.tasks.push({func:foo,thiser:thiser});\n\t}\n\n\t/**\n\t * 移除任务\n\t * @param foo \t任务\n\t */\n\tpublic static removeTask(foo){\n\t\tif(!Util.isFunction(foo)){\n\t\t\tthrow new NError(\"invoke\",\"Scheduler.removeTask\",\"0\",\"function\");\n\t\t}\n\t\tlet ind = -1;\n\t\tif((ind = Scheduler.tasks.indexOf(foo)) !== -1){\n\t\t\tScheduler.tasks.splice(ind,1);\n\t\t}\t\n\t}\n}\n","import { DirectiveManager } from \"./directivemanager\";\nimport { NError } from \"./error\";\nimport { NodomMessage_en } from \"./locales/msg_en\";\nimport { NodomMessage_zh } from \"./locales/msg_zh\";\nimport { Model } from \"./model\";\nimport { ModelManager } from \"./modelmanager\";\nimport { Module } from \"./module\";\nimport { ModuleFactory } from \"./modulefactory\";\nimport { Renderer } from \"./renderer\";\nimport { RequestManager } from \"./requestmanager\";\nimport { Route } from \"./route\";\nimport { Router } from \"./router\";\nimport { Scheduler } from \"./scheduler\";\nimport { IRouteCfg } from \"./types\";\nimport { Util } from \"./util\";\n\n/**\n * nodom提示消息\n */\nexport var NodomMessage;\n/**\n * 新建一个App\n * @param clazz     模块类\n * @param el        el选择器\n * @param language  语言（zh,en），默认zh\n */\nexport async function nodom(clazz:any,el:string,language?:string){\n    //设置nodom语言\n    switch(language||'zh'){\n        case 'zh':\n            NodomMessage = NodomMessage_zh;\n            break;\n        case 'en':\n            NodomMessage = NodomMessage_en;\n    }\n    //渲染器启动渲染\n    Scheduler.addTask(Renderer.render, Renderer);\n    //启动调度器\n    Scheduler.start();\n    let mdl:any = ModuleFactory.get(clazz);\n    mdl.setContainer(document.querySelector(el));\n    mdl.active();\n}\n\n/**\n * 暴露的创建路由方法\n * @param config  数组或单个配置\n */\nexport function createRoute(config: IRouteCfg | Array<IRouteCfg>,parent?:Route): Route {\n    let route:Route;\n    parent = parent || Router.root;\n    if (Util.isArray(config)) {\n        for (let item of <Array<IRouteCfg>>config) {\n            route = new Route(item,parent);\n        }\n    } else {\n        route = new Route(<IRouteCfg>config,parent);\n    }\n    return route;\n}\n\n/**\n * 创建指令\n * @param name      指令名 \n * @param priority  优先级（1最小，1-10为框架保留优先级）\n * @param init      初始化方法\n * @param handler   渲染时方法\n */\nexport function createDirective(name: string, handler: Function,priority?: number) {\n    return DirectiveManager.addType(name,handler,priority);\n}\n\n/**\n * 注册模块\n * @param clazz     模块类\n * @param name      注册名，如果没有，则为类名\n */\nexport function registModule(clazz:any,name?:string){\n    ModuleFactory.addClass(clazz,name);\n}\n\n/**\n * ajax 请求\n * @param config    object 或 string\n *                  如果为string，则直接以get方式获取资源\n *                  object 项如下:\n *                  参数名|类型|默认值|必填|可选值|描述\n *                  -|-|-|-|-|-\n *                  url|string|无|是|无|请求url\n *\t\t\t\t\tmethod|string|GET|否|GET,POST,HEAD|请求类型\n *\t\t\t\t\tparams|Object/FormData|{}|否|无|参数，json格式\n *\t\t\t\t\tasync|bool|true|否|true,false|是否异步\n *  \t\t\t\ttimeout|number|0|否|无|请求超时时间\n *                  type|string|text|否|json,text|\n *\t\t\t\t\twithCredentials|bool|false|否|true,false|同源策略，跨域时cookie保存\n *                  header|Object|无|否|无|request header 对象\n *                  user|string|无|否|无|需要认证的请求对应的用户名\n *                  pwd|string|无|否|无|需要认证的请求对应的密码\n *                  rand|bool|无|否|无|请求随机数，设置则浏览器缓存失效\n */\nexport async function request(config): Promise<any> {\n    return await RequestManager.request(config);\n}","import { NodomMessage } from \"./nodom\";\n\n/**\n * 异常处理类\n * @since       1.0.0\n */\nexport  class NError extends Error{\n    constructor(errorName:string,p1?:string,p2?:string,p3?:string,p4?:string){\n        super(errorName);\n        let msg:string = NodomMessage.ErrorMsgs[errorName];\n        if(msg === undefined){\n            this.message = \"未知错误\";\n            return;\n        }\n        //复制请求参数\n        let params:Array<string> = [msg];\n        for(let i=1;i<arguments.length;i++){\n            params.push(arguments[i]);\n        }\n        this.message = this.compile.apply(null,params);\n    }\n\n    /**\n     * 编译字符串，把{n}替换成带入值\n     * @param src   待编译的字符串\n     * @returns     转换后的消息\n     */\n    private compile(src: string, p1?: any, p2?: any, p3?: any, p4?: any, p5?: any): string {\n        let reg: RegExp;\n        let args = arguments;\n        let index = 0;\n        for (; ;) {\n            if (src.indexOf('\\{' + index + '\\}') !== -1) {\n                reg = new RegExp('\\\\{' + index + '\\\\}', 'g');\n                src = src.replace(reg, args[index + 1]);\n                index++;\n            } else {\n                break;\n            }\n        }\n        return src;\n    }\n}   \n","import { NError } from \"./error\";\nimport { NodomMessage } from \"./nodom\";\nimport { IRenderedDom } from \"./types\";\nimport { VirtualDom } from \"./virtualdom\";\n/**\n * 基础服务库\n * @since       1.0.0\n */\nexport class Util {\n    /**\n     * 全局id\n     */\n    private static generatedId: number = 1;\n    \n    /**\n     * js 保留字 map\n     */\n    public static keyWordMap = new Map();\n    \n    /**\n     * 唯一主键\n     */\n    public static genId() {\n        return this.generatedId++;\n    }\n\n    /**\n     * 初始化保留字map\n     */\n    public static initKeyMap(){\n        [\n            'arguments','boolean','break','byte','catch',\n            'char','const','default','delete','do',\n            'double','else','enum','eval','false',\n            'float','for','function','goto','if',\n            'in','instanceof','int','let','long',\n            'null','return','short','switch','this',\n            'throw','true','try','this','throw',\n            'typeof','var','while','with','Array',\n            'Date','JSON', 'Set','Map','eval',\n            'Infinity','isFinite','isNaN','isPrototypeOf','Math',\n            'NaN','Number','Object','prototype','String',\n            'isPrototypeOf','undefined','valueOf'\n        ].forEach(item=>{\n            this.keyWordMap.set(item,true);\n        });\n    }\n    /**\n     * 是否为 js 保留关键字\n     * @param name  名字\n     * @returns     如果为保留字，则返回true，否则返回false\n     */\n    public static isKeyWord(name:string):boolean{\n        return this.keyWordMap.has(name);\n    }\n\n    /******对象相关******/\n\n    /**\n     * 对象复制\n     * @param srcObj    源对象\n     * @param expKey    不复制的键正则表达式或名\n     * @param extra     clone附加参数\n     * @returns         复制的对象\n     */\n\n    public static clone(srcObj: Object, expKey?: RegExp | string[], extra?: any): any {\n        let me = this;\n        let map: WeakMap<Object, any> = new WeakMap();\n        return clone(srcObj, expKey, extra);\n\n        /**\n         * clone对象\n         * @param src      待clone对象\n         * @param expKey   不克隆的键\n         * @param extra    clone附加参数\n         * @returns        克隆后的对象\n         */\n        function clone(src, expKey, extra?) {\n            //非对象或函数，直接返回            \n            if (!src || typeof src !== 'object' || Util.isFunction(src)) {\n                return src;\n            }\n            let dst;\n\n            //带有clone方法，则直接返回clone值\n            if (src.clone && Util.isFunction(src.clone)) {\n                return src.clone(extra);\n            } else if (me.isObject(src)) {\n                dst = new Object();\n                //把对象加入map，如果后面有新克隆对象，则用新克隆对象进行覆盖\n                map.set(src, dst);\n                Object.getOwnPropertyNames(src).forEach((prop) => {\n                    //不克隆的键\n                    if (expKey) {\n                        if (expKey.constructor === RegExp && (<RegExp>expKey).test(prop) //正则表达式匹配的键不复制\n                            || Util.isArray(expKey) && (<any[]>expKey).includes(prop)    //被排除的键不复制\n                        ) {\n                            return;\n                        }\n                    }\n                    dst[prop] = getCloneObj(src[prop], expKey, extra);\n                });\n            } else if (me.isMap(src)) {\n                dst = new Map();\n                //把对象加入map，如果后面有新克隆对象，则用新克隆对象进行覆盖\n                src.forEach((value, key) => {\n                    //不克隆的键\n                    if (expKey) {\n                        if (expKey.constructor === RegExp && (<RegExp>expKey).test(key)       //正则表达式匹配的键不复制\n                            || (<any[]>expKey).includes(key)) {     //被排除的键不复制\n                            return;\n                        }\n                    }\n                    dst.set(key, getCloneObj(value, expKey, extra));\n                });\n            } else if (me.isArray(src)) {\n                dst = new Array();\n                //把对象加入map，如果后面有新克隆对象，则用新克隆对象进行覆盖\n                src.forEach(function (item, i) {\n                    dst[i] = getCloneObj(item, expKey, extra);\n                });\n            }\n            return dst;\n        }\n\n        /**\n         * 获取clone对象\n         * @param value     待clone值\n         * @param expKey    排除键\n         * @param extra     附加参数\n         */\n        function getCloneObj(value, expKey, extra) {\n            if (typeof value === 'object' && !Util.isFunction(value)) {\n                let co = null;\n                if (!map.has(value)) {  //clone新对象\n                    co = clone(value, expKey, extra);\n                } else {                    //从map中获取对象\n                    co = map.get(value);\n                }\n                return co;\n            }\n            return value;\n        }\n    }\n    /**\n     * 合并多个对象并返回\n     * @param   参数数组\n     * @returns 返回对象\n     */\n    public static merge(o1?: Object, o2?: Object, o3?: Object, o4?: Object, o5?: Object, o6?: Object) {\n        let me = this;\n        for (let i = 0; i < arguments.length; i++) {\n            if (!this.isObject(arguments[i])) {\n                throw new NError('invoke', 'Util.merge', i + '', 'object');\n            }\n        }\n        let retObj = Object.assign.apply(null, arguments);\n        subObj(retObj);\n        return retObj;\n        //处理子对象\n        function subObj(obj) {\n            for (let o of Object.keys(obj)) {\n                if (me.isObject(obj[o]) || me.isArray(obj[o])) { //对象或数组\n                    retObj[o] = me.clone(retObj[o]);\n                }\n            }\n        }\n    }\n\n    /**\n     * 把obj2对象所有属性赋值给obj1\n     * @returns 返回对象obj1\n     */\n    public static assign(obj1, obj2) {\n        if (Object.assign) {\n            Object.assign(obj1, obj2);\n        } else {\n            this.getOwnProps(obj2).forEach(function (p) {\n                obj1[p] = obj2[p];\n            });\n        }\n        return obj1;\n    }\n\n    /**\n     * 比较两个对象值是否相同(只比较object和array)\n     * @param src   源对象\n     * @param dst   目标对象 \n     * @returns     值相同则返回true，否则返回false \n     */\n    public static compare(src:any,dst:any):boolean{\n        return cmp(src,dst);\n        function cmp(o1,o2){\n            if(o1 === o2){\n                return true;\n            }\n            let keys1 = Object.keys(o1);\n            let keys2 = Object.keys(o2);\n            if(keys1.length !== keys2.length){\n                return false;\n            }\n            for(let k of keys1){\n                if(typeof o1[k] === 'object' && typeof o2[k] === 'object'){\n                    let r = cmp(o1[k],o2[k]);\n                    if(!r){\n                        return false;\n                    }\n                }else if(o1[k] !== o2[k]){\n                    return false;\n                }\n            }\n            return true;\n        }\n    }\n    /**\n     * 获取对象自有属性\n     * @param obj   需要获取属性的对象\n     * @returns     返回属性数组\n     */\n    public static getOwnProps(obj): Array<string> {\n        if (!obj) {\n            return [];\n        }\n        return Object.getOwnPropertyNames(obj);\n    }\n    /**************对象判断相关************/\n    /**\n     * 判断是否为函数\n     * @param foo   检查的对象\n     * @returns     true/false\n     */\n    public static isFunction(foo): boolean {\n        return foo !== undefined && foo !== null && foo.constructor === Function;\n    }\n\n    /**\n     * 判断是否为数组\n     * @param obj   检查的对象\n     * @returns     true/false\n     */\n    public static isArray(obj): boolean {\n        return Array.isArray(obj);\n    }\n\n    /**\n     * 判断是否为map\n     * @param obj   检查的对象\n     */\n    public static isMap(obj): boolean {\n        return obj !== null && obj !== undefined && obj.constructor === Map;\n    }\n\n    /**\n     * 判断是否为对象\n     * @param obj   检查的对象\n     * @returns     true/false\n     */\n    public static isObject(obj): boolean {\n        return obj !== null && obj !== undefined && obj.constructor === Object;\n    }\n\n    /**\n     * 判断是否为整数\n     * @param v     检查的值\n     * @returns     true/false\n     */\n    public static isInt(v): boolean {\n        return Number.isInteger(v);\n    }\n    /**\n     * 判断是否为number\n     * @param v     检查的值\n     * @returns     true/false\n     */\n    public static isNumber(v): boolean {\n        return typeof v === 'number';\n    }\n\n    /**\n     * 判断是否为boolean\n     * @param v     检查的值\n     * @returns     true/false\n     */\n    public static isBoolean(v): boolean {\n        return typeof v === 'boolean';\n    }\n    /**\n     * 判断是否为字符串\n     * @param v     检查的值\n     * @returns     true/false\n     */\n    public static isString(v): boolean {\n        return typeof v === 'string';\n    }\n\n    /**\n     * 判断是否为数字串\n     * @param v     检查的值\n     * @returns     true/false\n     */\n    public static isNumberString(v): boolean {\n        return /^\\d+\\.?\\d*$/.test(v);\n    }\n\n    /**\n     * 判断对象/字符串是否为空\n     * @param obj   检查的对象\n     * @returns     true/false\n     */\n    public static isEmpty(obj): boolean {\n        if (obj === null || obj === undefined)\n            return true;\n        let tp = typeof obj;\n        if (this.isObject(obj)) {\n            let keys = Object.keys(obj);\n            if (keys !== undefined) {\n                return keys.length === 0;\n            }\n        } else if (tp === 'string') {\n            return obj === '';\n        }\n        return false;\n    }\n\n\n    /**\n     * 把srcNode替换为nodes\n     * @param srcNode       源dom\n     * @param nodes         替换的dom或dom数组\n     */\n    public static replaceNode(srcNode: Node, nodes: Node | Array<Node>) {\n        let pnode: Node = srcNode.parentNode;\n        let bnode: Node = srcNode.nextSibling;\n        if (pnode === null) {\n            return;\n        }\n        pnode.removeChild(srcNode);\n        const nodeArr: Array<Node> = this.isArray(nodes) ? <Node[]>nodes : [<Node>nodes];\n        nodeArr.forEach(function (node) {\n            if (bnode === undefined || bnode === null) {\n                pnode.appendChild(node);\n            } else {\n                pnode.insertBefore(node, bnode);\n            }\n        });\n    }\n    \n    /**\n     * 清空子节点\n     * @param el   需要清空的节点\n     */\n    public static empty(el: HTMLElement) {\n        const me = this;\n        let nodes: NodeList = el.childNodes;\n        for (let i = nodes.length - 1; i >= 0; i--) {\n            el.removeChild(nodes[i]);\n        }\n    }\n    \n    /******日期相关******/\n    /**\n     * 日期格式化\n     * @param timestamp  时间戳\n     * @param format     日期格式\n     * @returns          日期串\n     */\n    public static formatDate(timeStamp: string | number, format: string): string {\n        if (this.isString(timeStamp)) {\n            //排除日期格式串,只处理时间戳\n            let reg = /^\\d+$/;\n            if (reg.test(<string>timeStamp)) {\n                timeStamp = Number(<string>timeStamp);\n            } else {\n                throw new NError('invoke', 'Util.formatDate', '0', 'date string', 'date');\n            }\n        } \n        //得到日期\n        let date: Date = new Date(timeStamp);\n        // invalid date\n        if (isNaN(date.getDay())) {\n            throw new NError('invoke', 'Util.formatDate', '0', 'date string', 'date');\n        }\n\n        let o = {\n            \"M+\": date.getMonth() + 1, //月份\n            \"d+\": date.getDate(), //日\n            \"h+\": date.getHours(), //小时\n            \"H+\": date.getHours(), //小时\n            \"m+\": date.getMinutes(), //分\n            \"s+\": date.getSeconds(), //秒\n            \"S\": date.getMilliseconds() //毫秒\n        };\n\n        let re;\n        //年\n        if (re=/(y+)/.exec(format)) {\n            format = format.replace(re[0], (date.getFullYear() + \"\").substring(4 - re[0].length));\n        }\n        //月日\n        this.getOwnProps(o).forEach(function (k) {\n            if (re=new RegExp(\"(\" + k + \")\").exec(format)) {\n                format = format.replace(re[0], re[0].length===1?o[k]:(\"00\" + o[k]).substring((o[k]+'').length));\n            }\n        });\n\n        //星期\n        format = format.replace(/(E+)/, NodomMessage.WeekDays[date.getDay() + \"\"]);\n        return format;\n    }\n\n    /******字符串相关*****/\n    /**\n     * 编译字符串，把{n}替换成带入值\n     * @param src   待编译的字符串\n     * @returns     转换后的消息\n     */\n    public static compileStr(src: string, p1?: any, p2?: any, p3?: any, p4?: any, p5?: any): string {\n        let reg: RegExp;\n        let args = arguments;\n        let index = 0;\n        for (; ;) {\n            if (src.indexOf('\\{' + index + '\\}') !== -1) {\n                reg = new RegExp('\\\\{' + index + '\\\\}', 'g');\n                src = src.replace(reg, args[index + 1]);\n                index++;\n            } else {\n                break;\n            }\n        }\n        return src;\n    }\n\n    /**\n     * 函数调用\n     * @param foo   函数\n     * @param obj   this指向\n     * @param args  参数数组\n     */\n    public static apply(foo: Function, obj: any, args?: Array<any>): any {\n        if (!foo) {\n            return;\n        }\n        return Reflect.apply(foo, obj || null, args);\n    }\n\n    /**\n     * 合并并修正路径，即路径中出现'//','///','\\/'的情况，统一置换为'/'\n     * @param paths     待合并路径数组\n     * @returns         返回路径\n     */\n    public static mergePath(paths: string[]): string {\n        return paths.join('/').replace(/(\\/{2,})|\\\\\\//g, '\\/');\n    }\n\n    /**\n     * eval\n     * @param evalStr   eval串\n     * @returns         eval值\n     */\n    public static eval(evalStr: string): any {\n        return new Function(`return(${evalStr})`)();\n    }\n\n    /**\n     * 改造 dom key，避免克隆时重复，格式为：key_id\n     * @param node    节点\n     * @param id      附加id\n     * @param deep    是否深度处理\n     */\n    public static setNodeKey(node:VirtualDom, id?:number,deep?:boolean){\n        node.key = this.genUniqueKey(node.key,id);\n        if(deep && node.children){\n            for(let c of node.children) {\n                Util.setNodeKey(c,id,true);\n            }\n        }\n    }\n\n    /**\n     * 设置dom asset\n     * @param dom       渲染后的dom节点\n     * @param name      asset name    \n     * @param value     asset value\n     */\n    public static setDomAsset(dom:IRenderedDom,name:string,value:any){\n        if(!dom.assets){\n            dom.assets = {};\n        }\n        dom.assets[name] = value;\n    }\n\n    /**\n     * 通过两个整数，生成唯一key\n     * @param x     第一个整整数\n     * @param y     第二个正整数\n     * @returns 唯一key，为避免与genId的key相同，对结果取负\n     */\n    public static genUniqueKey(x:number,y:number){\n        // if(x<0){\n        //     x = -x;\n        // }\n        // if(y<0){\n        //     y = -y;\n        // }\n        // return -((x << 16) | y);\n        return x + '_' + y;\n    }\n}\n\n//初始化keymap\nUtil.initKeyMap();","import { DirectiveManager } from \"./directivemanager\";\nimport { DirectiveType } from \"./directivetype\";\nimport { Module } from \"./module\";\nimport { Util } from \"./util\";\nimport { Expression } from \"./expression\";\nimport { NError } from \"./error\";\nimport { NodomMessage } from \"./nodom\";\nimport { IRenderedDom } from \"./types\";\n\n/**\n * 指令类\n */\nexport  class Directive {\n    /**\n     * 指令id\n     */\n    public id:number;\n\n    /**\n     * 指令类型\n     */\n    public type:DirectiveType;\n    \n    /**\n     * 指令值\n     */\n    public value:any;\n    \n    /**\n     * 表达式\n     */\n    public expression:Expression;\n\n    /**\n     * 禁用指令\n     */\n    public disabled:boolean;\n\n    /**\n     * 指令参数\n     */\n    public params:any;\n    /**\n     * 构造方法\n     * @param type  \t类型名\n     * @param value \t指令值\n     */\n    constructor(type?:string,value?:string|Expression) {\n        this.id = Util.genId();\n        if(type){\n            this.type = DirectiveManager.getType(type);\n            if(!this.type){\n                throw new NError('notexist1',NodomMessage.TipWords['directive'],type);\n            }\n        }\n        \n        if (Util.isString(value)) {\n            this.value = (<string>value).trim();\n        }else if(value instanceof Expression){\n            this.expression = value;\n        }else{\n            this.value = value;\n        }\n    }\n\n    /**\n     * 执行指令\n     * @param module    模块\n     * @param dom       渲染目标节点对象\n     * @returns         true/false\n     */\n    public exec(module:Module,dom:IRenderedDom):boolean {\n        //禁用，不执行\n        if(this.disabled){\n            return true;\n        }\n        if(this.expression){\n            this.value = this.expression.val(module,dom.model);\n        }\n        return this.type.handle.apply(this,[module,dom]);\n    }\n\n    /**\n     * 克隆\n     */\n    public clone():Directive{\n        let d = new Directive();\n        d.type = this.type;\n        d.expression = this.expression;\n        d.value = this.value;\n        return d;\n    }\n}\n","import { Module } from \"./module\";\nimport { Util } from \"./util\";\nimport { IRenderedDom } from \"./types\";\n\n/**\n * 事件类\n * @remarks\n * 事件分为自有事件和代理事件\n * @author      yanglei\n * @since       1.0\n */\nexport class NEvent {\n    /**\n     * 事件id\n     */\n    public id: number;\n    /**\n     * 事件所属模块\n     */\n    public module:Module;\n    /**\n     * 事件名\n     */\n    public name: string;\n    /**\n     * 事件处理函数名(需要在模块中定义)\n     */\n    public handler: string | Function;\n    /**\n     * 代理模式，事件代理到父对象\n     */\n    public delg: boolean;\n    /**\n     * 禁止冒泡，代理模式下无效\n     */\n    public nopopo: boolean;\n    /**\n     * 只执行一次\n     */\n    public once: boolean;\n\n    /**\n     * 使用 capture，代理模式下无效\n     */\n    public capture: boolean;\n\n    /**\n     * 依赖事件，用于扩展事件存储原始事件\n     */\n    public dependEvent:NEvent;\n    \n\n    /**\n     * @param eventName     事件名\n     * @param eventStr      事件串或事件处理函数,以“:”分割,中间不能有空格,结构为: 方法名[:delg(代理到父对象):nopopo(禁止冒泡):once(只执行一次):capture(useCapture)]\n     *                      如果为函数，则替代第三个参数\n     * @param handler       事件执行函数，如果方法不在module methods中定义，则可以直接申明，eventStr第一个参数失效，即eventStr可以是\":delg:nopopo...\"\n     */\n    constructor(module:Module,eventName: string, eventStr?: string | Function, handler?: Function) {\n        this.id = Util.genId();\n        this.module = module;\n        this.name = eventName;\n        // GlobalCache.saveEvent(this);\n        //如果事件串不为空，则不需要处理\n        if (eventStr) {\n            let tp = typeof eventStr;\n            if (tp === 'string') {\n                let eStr: string = (<string>eventStr).trim();\n                eStr.split(':').forEach((item, i) => {\n                    item = item.trim();\n                    if (i === 0) { //事件方法\n                        this.handler = item;\n                    } else { //事件附加参数\n                        switch (item) {\n                            case 'delg':\n                                this.delg = true;\n                                break;\n                            case 'nopopo':\n                                this.nopopo = true;\n                                break;\n                            case 'once':\n                                this.once = true;\n                                break;\n                            case 'capture':\n                                this.capture = true;\n                                break;\n                        }\n                    }\n                });\n            } else if (tp === 'function') {\n                handler = <Function>eventStr;\n            }\n        }\n        //新增事件方法（不在methods中定义）\n        if (handler) {\n            this.handler = handler;\n        }\n        \n        if (document.ontouchend) { //触屏设备\n            switch (this.name) {\n                case 'click':\n                    this.name = 'tap';\n                    break;\n                case 'mousedown':\n                    this.name = 'touchstart';\n                    break;\n                case 'mouseup':\n                    this.name = 'touchend';\n                    break;\n                case 'mousemove':\n                    this.name = 'touchmove';\n                    break;\n            }\n        } else { //转非触屏\n            switch (this.name) {\n                case 'tap':\n                    this.name = 'click';\n                    break;\n                case 'touchstart':\n                    this.name = 'mousedown';\n                    break;\n                case 'touchend':\n                    this.name = 'mouseup';\n                    break;\n                case 'touchmove':\n                    this.name = 'mousemove';\n                    break;\n            }\n        }\n    }\n\n    /**\n     * 设置附加参数值\n     * @param module    模块\n     * @param dom       虚拟dom\n     * @param name      参数名\n     * @param value     参数值\n     */\n    public setParam(module:Module,dom:IRenderedDom,name: string, value: any) {\n        module.objectManager.setEventParam(this.id,dom.key,name,value);\n    }\n\n    /**\n     * 获取附加参数值\n     * @param module    模块\n     * @param dom       虚拟dom\n     * @param name      参数名\n     * @returns         附加参数值\n     */\n    public getParam(module:Module,dom:IRenderedDom,name: string) {\n        return module.objectManager.getEventParam(this.id,dom.key,name);\n    }\n\n    /**\n     * 移除参数\n     * @param module    模块 \n     * @param dom       虚拟dom\n     * @param name      参数名\n     */\n    public removeParam(module:Module,dom:IRenderedDom,name: string) {\n        return module.objectManager.removeEventParam(this.id,dom.key,name);\n    }\n    /**\n     * 清参数cache\n     * @param module    模块\n     * @param dom       虚拟dom\n     */\n    public clearParam(module:Module,dom:IRenderedDom){\n        module.objectManager.clearEventParam(this.id,dom.key);\n    }\n}\n","import { Directive } from './directive'\nimport { DirectiveManager } from './directivemanager'\nimport { NEvent } from './event'\nimport { Expression } from './expression'\nimport { Model } from './model'\nimport { Module } from './module'\nimport { Util } from './util'\n\n/**\n * 虚拟dom\n */\nexport class VirtualDom {\n\t/**\n\t * 元素名，如div\n\t */\n\tpublic tagName: string\n\n\t/**\n\t * key，数字或字符串，整颗虚拟dom树唯一\n\t */\n\tpublic key: any;\n\n\t/**\n\t * 绑定模型\n\t */\n\tpublic model: Model\n\n\t/**\n\t * element为textnode时有效\n\t */\n\tpublic textContent: string\n\n\t/**\n\t * 表达式+字符串数组，用于textnode\n\t */\n\tpublic expressions: Array<Expression | string>\n\n\t/**\n\t * 指令集\n\t */\n\tpublic directives: Directive[]\n\n\t/**\n\t * 直接属性 不是来自于attribute，而是直接作用于html element，如el.checked,el.value等\n\t */\n\tpublic assets: Map<string, any>\n\n\t/**\n\t * 属性(attribute)集合\n\t * {prop1:value1,...}\n\t * 属性值可能是值，也可能是表达式，还可能是数组，当为子模块时，存在从props传递过来的属性，如果模块模版存在相同属性，则会变成数组。\n\t */\n\tpublic props: Map<string, any>\n\n\t/**\n\t * 删除的class名数组\n\t */\n\tprivate removedClassMap: Map<string, boolean>\n\n\t/**\n\t * 删除的style属性名map\n\t */\n\tprivate removedStyleMap: Map<string, boolean>\n\n\t/**\n\t * 事件数组\n\t */\n\tpublic events: Array<NEvent>\n\n\t/**\n\t * 子节点数组[]\n\t */\n\tpublic children: Array<VirtualDom>\n\n\t/**\n\t * 父虚拟dom\n\t */\n\tpublic parent: VirtualDom;\n\n\t/**\n\t * staticNum 静态标识数\n\t *  0 表示静态，不进行比较\n\t *  > 0 每次比较后-1\n\t *  < 0 表达式，每次渲染后不处理\n\t * 默认为1，至少渲染1次\n\t */\n\tpublic staticNum: number\n\n\t/**\n\t * 对应的所有表达式的字段都属于dom model内\n\t */\n\tpublic allModelField: boolean = true;\n\n\t/**\n\t * 标签闭合标志\n\t */\n\tpublic isClosed: boolean\n\t\n\t/**\n\t * 标签开始位置\n\t */\n\tpublic tagStartPos: number\n\n\t/**\n\t * 标签结束为止\n\t */\n\tpublic tagEndPos: number\n\t\n\t/**\n\t * 自关闭节点是否已经自关闭\n\t */\n\tpublic selfClosed: boolean = false\n\n\t/**\n\t * @param tag       标签名\n\t * @param key       key\n\t * @param module \t模块\n\t */\n\tconstructor(tag?: string, key?: number, module?: Module) {\n\t\tthis.key = key || (module ? module.getDomKeyId() : Util.genId())\n\t\tthis.staticNum = 1;\n\t\tif (tag) {\n\t\t\tthis.tagName = tag\n\t\t}\n\t}\n\n\t/**\n\t * 移除多个指令\n\t * @param directives \t待删除的指令类型数组或指令类型\n\t * @returns             如果虚拟dom上的指令集为空，则返回void\n\t */\n\tpublic removeDirectives(directives: string[]) {\n\t\tif (!this.directives) {\n\t\t\treturn\n\t\t}\n\t\t//数组\n\t\tdirectives.forEach((d) => {\n\t\t\tthis.removeDirective(d)\n\t\t})\n\t}\n\n\t/**\n\t * 移除指令\n\t * @param directive \t待删除的指令类型名\n\t * @returns             如果虚拟dom上的指令集为空，则返回void\n\t */\n\tpublic removeDirective(directive: string) {\n\t\tif (!this.directives) {\n\t\t\treturn\n\t\t}\n\n\t\tlet ind\n\t\tif ((ind = this.directives.findIndex(\n\t\t\t\t(item) => item.type.name === directive\n\t\t\t)) !== -1\n\t\t) {\n\t\t\tthis.directives.splice(ind, 1)\n\t\t}\n\t\tif (this.directives.length === 0) {\n\t\t\tdelete this.directives\n\t\t}\n\t}\n\n\t/**\n\t * 添加指令\n\t * @param directive     指令对象\n\t * @param sort          是否排序\n\t * @returns             如果虚拟dom上的指令集不为空，且指令集中已经存在传入的指令对象，则返回void\n\t */\n\tpublic addDirective(directive: Directive, sort?: boolean) {\n\t\tif (!this.directives) {\n\t\t\tthis.directives = []\n\t\t} else if (\n\t\t\tthis.directives.find((item) => item.type.name === directive.type.name)\n\t\t) {\n\t\t\treturn\n\t\t}\n\t\tthis.directives.push(directive)\n\t\t//指令按优先级排序\n\t\tif (sort) {\n\t\t\tthis.sortDirective()\n\t\t}\n\t}\n\n\t/**\n\t * 指令排序\n\t * @returns           如果虚拟dom上指令集为空，则返回void\n\t */\n\tpublic sortDirective() {\n\t\tif (!this.directives) {\n\t\t\treturn\n\t\t}\n\t\tif (this.directives.length > 1) {\n\t\t\tthis.directives.sort((a, b) => {\n\t\t\t\treturn DirectiveManager.getType(a.type.name).prio <\n\t\t\t\t\tDirectiveManager.getType(b.type.name).prio\n\t\t\t\t\t? -1\n\t\t\t\t\t: 1\n\t\t\t})\n\t\t}\n\t}\n\n\t/**\n\t * 是否有某个类型的指令\n\t * @param typeName \t    指令类型名\n\t * @returns             如果指令集不为空，且含有传入的指令类型名则返回true，否则返回false\n\t */\n\tpublic hasDirective(typeName: string): boolean {\n\t\treturn (\n\t\t\tthis.directives &&\n\t\t\tthis.directives.findIndex((item) => item.type.name === typeName) !== -1\n\t\t)\n\t}\n\n\t/**\n\t * 获取某个类型的指令\n\t * @param module            模块\n\t * @param directiveType \t指令类型名\n\t * @returns                 如果指令集为空，则返回void；否则返回指令类型名等于传入参数的指令对象\n\t */\n\tpublic getDirective(directiveType: string): Directive {\n\t\tif (!this.directives) {\n\t\t\treturn\n\t\t}\n\t\treturn this.directives.find((item) => item.type.name === directiveType)\n\t}\n\n\t/**\n\t * 添加子节点\n\t * @param dom       子节点\n\t * @param index     指定位置，如果不传此参数，则添加到最后\n\t */\n\tpublic add(dom: VirtualDom, index?: number) {\n\t\tif (!this.children) {\n\t\t\tthis.children = []\n\t\t}\n\t\tif (index) {\n\t\t\tthis.children.splice(index, 0, dom)\n\t\t} else {\n\t\t\tthis.children.push(dom)\n\t\t}\n\t\tdom.parent = this\n\t}\n\n\t/**\n\t * 移除子节点\n\t * @param dom   子节点\n\t */\n\tpublic remove(dom: VirtualDom) {\n\t\tlet index = this.children.indexOf(dom)\n\t\tif (index !== -1) {\n\t\t\tthis.children.splice(index, 1)\n\t\t}\n\t}\n\n\t/**\n\t * 添加css class\n\t * @param cls class名或表达式,可以多个，以“空格”分割\n\t */\n\tpublic addClass(cls: string | Expression) {\n\t\tthis.addProp('class', cls)\n\t\t//需要从remove class map 移除\n\t\tif (this.removedClassMap && this.removedClassMap.size > 0) {\n\t\t\tlet arr = (<string>cls).trim().split(/\\s+/)\n\t\t\tfor (let a of arr) {\n\t\t\t\tif (a === '') {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tthis.removedClassMap.delete(a)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * 删除css class，因为涉及到表达式，此处只记录删除标识\n\t * @param cls class名,可以多个，以“空格”分割\n\t */\n\tpublic removeClass(cls: string) {\n\t\tlet pv = this.getProp('class')\n\t\tif (!pv) {\n\t\t\treturn\n\t\t}\n\t\tif (!this.removedClassMap) {\n\t\t\tthis.removedClassMap = new Map()\n\t\t}\n\t\tlet arr = cls.trim().split(/\\s+/)\n\t\tfor (let a of arr) {\n\t\t\tif (a === '') {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tthis.removedClassMap.set(a, true)\n\t\t}\n\t\tthis.setStaticOnce()\n\t}\n\n\t/**\n\t * 获取class串\n\t * @returns class 串\n\t */\n\tpublic getClassString(values): string {\n\t\tlet clsArr = []\n\t\tfor (let pv of values) {\n\t\t\tlet arr = pv.trim().split(/\\s+/)\n\t\t\tfor (let a of arr) {\n\t\t\t\tif (!this.removedClassMap || !this.removedClassMap.has(a)) {\n\t\t\t\t\tif (!clsArr.includes(a)) {\n\t\t\t\t\t\tclsArr.push(a)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (clsArr.length > 0) {\n\t\t\treturn clsArr.join(' ')\n\t\t}\n\t}\n\n\t/**\n\t * 添加style\n\t *  @param style style字符串或表达式\n\t */\n\tpublic addStyle(style: string | Expression) {\n\t\tthis.addProp('style', style)\n\t\tif (typeof style === 'string') {\n\t\t\t//需要从remove class map 移除\n\t\t\tif (this.removedStyleMap && this.removedStyleMap.size > 0) {\n\t\t\t\tlet arr = style.trim().split(/\\s*;\\s*/)\n\t\t\t\tfor (let a of arr) {\n\t\t\t\t\tif (a === '') {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\t\t\t\t\tlet sa1 = a.split(/\\s*:\\s*/)\n\t\t\t\t\tlet p = sa1[0].trim()\n\t\t\t\t\tif (p !== '') {\n\t\t\t\t\t\tthis.removedClassMap.delete(sa1[0].trim())\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.setStaticOnce();\n\t}\n\n\t/**\n\t * 删除style\n\t * @param styleStr style字符串，多个style以空格' '分割\n\t */\n\tpublic removeStyle(styleStr: string) {\n\t\tif (!this.removedClassMap) {\n\t\t\tthis.removedClassMap = new Map()\n\t\t}\n\t\tlet arr = styleStr.trim().split(/\\s+/)\n\t\tfor (let a of arr) {\n\t\t\tif (a === '') {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tthis.removedClassMap.set(a, true)\n\t\t}\n\t\tthis.setStaticOnce()\n\t}\n\n\t/**\n\t * 获取style串\n\t * @returns style 串\n\t */\n\tpublic getStyleString(values): string {\n\t\tlet map = new Map()\n\t\tfor (let pv of values) {\n\t\t\tlet sa = pv.trim().split(/\\s*;\\s*/)\n\t\t\tfor (let s of sa) {\n\t\t\t\tif (s === '') {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tlet sa1 = s.split(/\\s*:\\s*/)\n\t\t\t\t//不在移除style map才能加入\n\t\t\t\tif (!this.removedStyleMap || !this.removedStyleMap.has(sa1[0])) {\n\t\t\t\t\tmap.set(sa1[0], sa1[1])\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (map.size > 0) {\n\t\t\treturn [...map].map((item) => item.join(':')).join(';')\n\t\t}\n\t}\n\t/**\n\t * 是否拥有属性\n\t * @param propName  属性名\n\t * @param isExpr    是否只检查表达式属性\n\t * @returns         如果属性集含有传入的属性名返回true，否则返回false\n\t */\n\tpublic hasProp(propName: string) {\n\t\tif (this.props) {\n\t\t\treturn this.props.has(propName)\n\t\t}\n\t}\n\n\t/**\n\t * 获取属性值\n\t * @param propName  属性名\n\t * @param isExpr    是否只获取表达式属性\n\t * @returns         传入属性名的value\n\t */\n\tpublic getProp(propName: string, isExpr?: boolean) {\n\t\tif (this.props) {\n\t\t\treturn this.props.get(propName)\n\t\t}\n\t}\n\n\t/**\n\t * 设置属性值\n\t * @param propName  属性名\n\t * @param v         属性值\n\t */\n\tpublic setProp(propName: string, v: any) {\n\t\tif (!this.props) {\n\t\t\tthis.props = new Map()\n\t\t}\n\t\tif (propName === 'style') {\n\t\t\tif (this.removedStyleMap) {\n\t\t\t\t//清空removedStyleMap\n\t\t\t\tthis.removedStyleMap.clear()\n\t\t\t}\n\t\t} else if (propName === 'class') {\n\t\t\tif (this.removedClassMap) {\n\t\t\t\t//清空removedClassMap\n\t\t\t\tthis.removedClassMap.clear()\n\t\t\t}\n\t\t}\n\t\tthis.props.set(propName, v)\n\t\tthis.setStaticOnce();\n\t}\n\n\t/**\n\t * 添加属性，如果原来的值存在，则属性值变成数组\n\t * @param pName     属性名\n\t * @param pValue    属性值\n\t */\n\tpublic addProp(pName, pValue): boolean {\n\t\tlet pv = this.getProp(pName)\n\t\tif (!pv) {\n\t\t\tthis.setProp(pName, pValue)\n\t\t} else if (Array.isArray(pv)) {\n\t\t\tif (pv.includes(pValue)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tpv.push(pValue)\n\t\t} else if (pv !== pValue) {\n\t\t\tthis.setProp(pName, [pv, pValue])\n\t\t} else {\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t}\n\n\t/**\n\t * 删除属性\n\t * @param props     属性名或属性名数组\n\t * @returns         如果虚拟dom上的属性集为空，则返回void\n\t */\n\tpublic delProp(props: string | string[]) {\n\t\tif (!this.props) {\n\t\t\treturn\n\t\t}\n\t\tif (Util.isArray(props)) {\n\t\t\tfor (let p of <string[]>props) {\n\t\t\t\tthis.props.delete(p)\n\t\t\t}\n\t\t} else {\n\t\t\tthis.props.delete(<string>props)\n\t\t}\n\t\t//设置静态标志，至少要比较一次\n\t\tthis.setStaticOnce()\n\t}\n\n\t/**\n\t * 设置asset\n\t * @param assetName     asset name\n\t * @param value         asset value\n\t */\n\tpublic setAsset(assetName: string, value: any) {\n\t\tif (!this.assets) {\n\t\t\tthis.assets = new Map()\n\t\t}\n\t\tthis.assets.set(assetName, value)\n\t\tthis.setStaticOnce();\n\t}\n\n\t/**\n\t * 删除asset\n\t * @param assetName     asset name\n\t * @returns             如果虚拟dom上的直接属性集为空，则返回void\n\t */\n\tpublic delAsset(assetName: string) {\n\t\tif (!this.assets) {\n\t\t\treturn\n\t\t}\n\t\tthis.assets.delete(assetName)\n\t\tthis.setStaticOnce();\n\t}\n\n\t/**\n\t * 设置cache参数\n\t * @param module    模块\n\t * @param name      参数名\n\t * @param value     参数值\n\t */\n\tpublic setParam(module: Module, name: string, value: any) {\n\t\tmodule.objectManager.setDomParam(this.key, name, value)\n\t}\n\n\t/**\n\t * 获取参数值\n\t * @param module    模块\n\t * @param name      参数名\n\t * @returns         参数值\n\t */\n\tpublic getParam(module: Module, name: string) {\n\t\treturn module.objectManager.getDomParam(this.key, name)\n\t}\n\n\t/**\n\t * 移除参数\n\t * @param module    模块\n\t * @param name      参数名\n\t */\n\tpublic removeParam(module: Module, name: string) {\n\t\tmodule.objectManager.removeDomParam(this.key, name)\n\t}\n\n\t/**\n\t * 设置单次静态标志\n\t */\n\tprivate setStaticOnce() {\n\t\tif (this.staticNum !== -1) {\n\t\t\tthis.staticNum = 1;\n\t\t}\n\t}\n\n\t/**\n\t * 克隆\n\t */\n\tpublic clone(): VirtualDom {\n\t\tlet dst: VirtualDom = new VirtualDom(this.tagName, this.key)\n\t\tif (this.tagName) {\n\t\t\t//属性\n\t\t\tif (this.props && this.props.size > 0) {\n\t\t\t\tfor (let p of this.props) {\n\t\t\t\t\tdst.setProp(p[0], p[1])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.assets && this.assets.size > 0) {\n\t\t\t\tfor (let p of this.assets) {\n\t\t\t\t\tdst.setAsset(p[0], p[1])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.directives && this.directives.length > 0) {\n\t\t\t\tdst.directives = []\n\t\t\t\tfor (let d of this.directives) {\n\t\t\t\t\tdst.directives.push(d.clone())\n\t\t\t\t}\n\t\t\t}\n\t\t\t//复制事件\n\t\t\tdst.events = this.events\n\n\t\t\t//子节点clone\n\t\t\tif (this.children) {\n\t\t\t\tfor (let c of this.children) {\n\t\t\t\t\tdst.add(c.clone())\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tdst.expressions = this.expressions\n\t\t\tdst.textContent = this.textContent\n\t\t}\n\t\tdst.staticNum = this.staticNum\n\t\treturn dst\n\t}\n\n\t/**\n\t * 保存事件\n\t * @param event     事件对象\n\t */\n\tpublic addEvent(event: NEvent) {\n\t\tif (!this.events) {\n\t\t\tthis.events = [event]\n\t\t}else if(!this.events.includes(event)){\n\t\t\tthis.events.push(event)\n\t\t}\n\t}\n}\n","import { DefineElementManager } from './defineelementmanager'\r\nimport { Directive } from './directive'\r\nimport { NError } from './error'\r\nimport { NEvent } from './event'\r\nimport { Expression } from './expression'\r\nimport { Module } from './module'\r\nimport { ModuleFactory } from './modulefactory'\r\nimport { VirtualDom } from './virtualdom'\r\n\r\nconst voidTagMap = new Set(\r\n\t'area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr'.split(',')\r\n)\r\n\r\n/**\r\n * - 模板标签必须闭合\r\n */\r\n/**\r\n * - 模板标签必须闭合\r\n */\r\nexport class Compiler {\r\n\t/**\r\n\t * 模块\r\n\t */\r\n\tprivate module: Module\r\n\r\n\t/**\r\n\t * 当前节点\r\n\t */\r\n\tprivate current: VirtualDom\r\n\r\n\t/**\r\n\t * 虚拟dom树\r\n\t */\r\n\tprivate domArr: Array<VirtualDom> = []\r\n\r\n\t/**\r\n\t * 文本节点\r\n\t */\r\n\tprivate textArr: Array<any> = []\r\n\r\n\t/**\r\n\t * 是否是表达式文本节点\r\n\t */\r\n\tprivate isExprText: boolean = false\r\n\r\n\t/**\r\n\t * 当前编译的模板 主要用于报错的时候定位\r\n\t */\r\n\tprivate template: string = ''\r\n\r\n\t/**\r\n\t * 构造器\r\n\t * @param module\r\n\t */\r\n\tconstructor(module: Module) {\r\n\t\tthis.module = module\r\n\t}\r\n\r\n\t/**\r\n\t * 编译\r\n\t * @param elementStr     待编译html串\r\n\t * @returns              虚拟dom\r\n\t */\r\n\tpublic compile(elementStr: string): VirtualDom {\r\n\t\tif(!elementStr){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// 清除注释\r\n\t\tthis.template = elementStr.replace(/\\<\\!\\-\\-[\\s\\S]*?\\-\\-\\>/g, '').trim()\r\n\t\telementStr = this.template\r\n\t\t// 编译\r\n\t\tthis.compileTemplate(elementStr)\r\n\t\tif (this.domArr.length === 0) {\r\n\t\t\tthrow new NError('wrongTemplate')\r\n\t\t}\r\n\t\t// 处理<div><div><div>abc这样的模板\r\n\t\tfor (let i = this.domArr.length - 1; i >= 1; i--) {\r\n\t\t\tif (!this.domArr[i].isClosed) {\r\n\t\t\t\tif (this.domArr[i].tagName !== undefined) {\r\n\t\t\t\t\tthis.warnStartTagNotClose(this.domArr[i])\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.domArr[i - 1].isClosed) {\r\n\t\t\t\t\tthis.domArr[i].isClosed = true\r\n\t\t\t\t\tlet temp = this.domArr.pop()\r\n\t\t\t\t\tthis.domArr[i - 1].add(temp)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this.domArr[this.domArr.length - 1].isClosed) {\r\n\t\t\tthis.domArr[this.domArr.length - 1].isClosed = true\r\n\t\t\tthis.warnStartTagNotClose(this.domArr[this.domArr.length - 1])\r\n\t\t}\r\n\t\t// 后处理，主要处理没有使用一个容器包裹所有节点的情况\r\n\t\t// domArr.length > 1  新建一个div节点接收domArr里面的所有节点\r\n\t\t// domArr.length == 1 如果是文本节点或者是模块，则新建一个div节点接收，其他情况直接使用该节点\r\n\t\t// domArr.length < 1 模板错误，抛出编译模板报错\r\n\t\tlet dom: VirtualDom\r\n\t\tif (this.domArr.length > 1) {\r\n\t\t\t// 说明没有使用一个容器包裹所有的节点\r\n\t\t\tdom = new VirtualDom('div', this.genKey(), this.module)\r\n\t\t\t// dom.add([...this.domArr]);\r\n\t\t\tthis.domArr.forEach((item) => {\r\n\t\t\t\tdom.add(item)\r\n\t\t\t})\r\n\t\t\tdom.isClosed = true\r\n\t\t} else if (this.domArr.length == 1) {\r\n\t\t\tif (this.domArr[0].tagName && !this.domArr[0].hasDirective('module')) {\r\n\t\t\t\tdom = this.domArr[0]\r\n\t\t\t} else {\r\n\t\t\t\tdom = new VirtualDom('div', this.genKey(), this.module)\r\n\t\t\t\tdom.add(this.domArr[0])\r\n\t\t\t\tdom.isClosed = true\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthrow new NError('wrongTemplate')\r\n\t\t}\r\n\t\treturn dom\r\n\t}\r\n\r\n\t/**\r\n\t * 产生dom key\r\n\t * @returns   dom key\r\n\t */\r\n\tprivate genKey(): number {\r\n\t\treturn this.module.getDomKeyId()\r\n\t}\r\n\r\n\t/**\r\n\t * 编译模板\r\n\t * @param srcStr \t源串\r\n\t */\r\n\tprivate compileTemplate(srcStr: string) {\r\n\t\twhile (srcStr.length !== 0) {\r\n\t\t\tif (srcStr.startsWith('<')) {\r\n\t\t\t\t// 标签\r\n\t\t\t\tif (srcStr[1] == '/') {\r\n\t\t\t\t\t// 结束标签\r\n\t\t\t\t\tsrcStr = this.compileEndTag(srcStr)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 开始标签\r\n\t\t\t\t\tsrcStr = this.compileStartTag(srcStr)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// 文本节点\r\n\t\t\t\tsrcStr = this.compileText(srcStr)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理开始节点\r\n\t * @param srcStr 待编译字符串\r\n\t * @returns 编译处理后的字符串\r\n\t */\r\n\tprivate compileStartTag(srcStr: string): string {\r\n\t\t// 抓取<div\r\n\t\tconst match = /^<\\s*([a-z][^\\s\\/\\>]*)/i.exec(srcStr)\r\n\t\t// 抓取成功\r\n\t\tif (match) {\r\n\t\t\t// 设置当前正在编译的节点\r\n\t\t\tthis.current = new VirtualDom(\r\n\t\t\t\tmatch[1].toLowerCase(),\r\n\t\t\t\tthis.genKey(),\r\n\t\t\t\tthis.module\r\n\t\t\t)\r\n\t\t\t// 当前节点入栈\r\n\t\t\tthis.domArr.push(this.current)\r\n\t\t\t// 截断字符串 准备处理属性\r\n\t\t\tthis.current.tagStartPos = this.template.length - srcStr.length\r\n\t\t\tsrcStr = srcStr.substring(match.index + match[0].length).trimStart()\r\n\t\t} else {\r\n\t\t\t// <!-- 或者<后跟符号不是字符\r\n\t\t\t// 当作text节点\r\n\t\t\tthis.textArr.push(srcStr[0])\r\n\t\t\treturn srcStr.substring(1)\r\n\t\t}\r\n\r\n\t\t// 处理属性\r\n\t\tsrcStr = this.compileAttributes(srcStr)\r\n\r\n\t\t// 属性处理完成之后 判断是否结束\r\n\t\tif (srcStr.startsWith('>')) {\r\n\t\t\t// 开始标签结束\r\n\t\t\tthis.current.tagEndPos = this.template.length - srcStr.substring(1).length\r\n\t\t\tif (this.isVoidTag(this.current)) {\r\n\t\t\t\tif (!this.current.selfClosed) {\r\n\t\t\t\t\tthis.warnStartTagNotClose(this.current)\r\n\t\t\t\t}\r\n\t\t\t\tthis.handleSelfClosingTag()\r\n\t\t\t}\r\n\t\t\treturn srcStr.substring(1).trimStart()\r\n\t\t} else {\r\n\t\t\t// 开始标签没结束>\r\n\t\t\tthrow new NError('needEndTag', this.current.tagName)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理标签属性\r\n\t * @param srcStr 待编译字符串\r\n\t * @returns 编译后字符串\r\n\t */\r\n\tprivate compileAttributes(srcStr: string): string {\r\n\t\t// 确保处理完成之后是>开头\r\n\t\twhile (srcStr.length != 0 && !srcStr.startsWith('>')) {\r\n\t\t\t// 抓取形如：a='b' a={{b}} a=\"b\" a=`b` / a 的属性串;\r\n\t\t\tconst match =\r\n\t\t\t\t/^(\\/|\\$?[a-z_][\\w-]*)(?:\\s*=\\s*((?:'[^']*')|(?:\"[^\"]*\")|(?:`[^`]*`)|(?:{{[^}}]*}})))?/i.exec(\r\n\t\t\t\t\tsrcStr\r\n\t\t\t\t)\r\n\t\t\t// 抓取成功 处理属性\r\n\t\t\tif (match) {\r\n\t\t\t\t// HTML在解析 属性的时候会把大写属性名改成小写(数据项除外)，这里为了和html一致 统一把属性名处理成为小写\r\n\t\t\t\tlet name = match[1][0]!=='$'?match[1].toLowerCase():match[1];\r\n\t\t\t\tif (name === '/') {\r\n\t\t\t\t\t// 是自闭合标签\r\n\t\t\t\t\tthis.handleSelfClosingTag()\r\n\t\t\t\t\tthis.current.selfClosed = true\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 是普通属性\r\n\t\t\t\t\tlet value: any = !match[2]\r\n\t\t\t\t\t\t? undefined\r\n\t\t\t\t\t\t: match[2].startsWith(`\"`)\r\n\t\t\t\t\t\t? match[2].substring(1, match[2].length - 1)\r\n\t\t\t\t\t\t: match[2].startsWith(`'`)\r\n\t\t\t\t\t\t? match[2].substring(1, match[2].length - 1)\r\n\t\t\t\t\t\t: match[2]\r\n\r\n\t\t\t\t\tif (value && value.startsWith('{{')) {\r\n\t\t\t\t\t\tvalue = new Expression(value.substring(2, value.length - 2))\r\n\t\t\t\t\t\t//表达式 staticNum为-1\r\n\t\t\t\t\t\tthis.current.staticNum = -1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (name.startsWith('x-')) {\r\n\t\t\t\t\t\t// 指令\r\n\t\t\t\t\t\tthis.current.addDirective(new Directive(name.substring(2), value))\r\n\t\t\t\t\t} else if (name.startsWith('e-')) {\r\n\t\t\t\t\t\t// 事件\r\n\t\t\t\t\t\tthis.current.addEvent(\r\n\t\t\t\t\t\t\tnew NEvent(this.module, name.substring(2), value)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t//普通属性\r\n\t\t\t\t\t\tthis.current.setProp(name, value)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (match) {\r\n\t\t\t\tsrcStr = srcStr.substring(match.index + match[0].length).trimStart()\r\n\t\t\t} else {\r\n\t\t\t\tif (this.current) {\r\n\t\t\t\t\tthrow new NError('tagError', this.current.tagName)\r\n\t\t\t\t}\r\n\t\t\t\tthrow new NError('wrongTemplate')\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn srcStr\r\n\t}\r\n\r\n\t/**\r\n\t * 处理结束标签\r\n\t * @param srcStr 待编译字符串\r\n\t * @returns 编译后字符串\r\n\t */\r\n\tprivate compileEndTag(srcStr: string): string {\r\n\t\t// 抓取</div>\r\n\t\tconst match = /^<\\/\\s*([a-z][^\\>]*)/i.exec(srcStr)\r\n\t\tif (match) {\r\n\t\t\t// 抓取成功\r\n\t\t\tconst name = match[1].toLowerCase().trim()\r\n\t\t\tif (this.current && this.current.tagName === name) {\r\n\t\t\t\t// 当前节点与闭合标签名相同 尝试闭合\r\n\t\t\t\tif (this.domArr.length < 1) {\r\n\t\t\t\t\t// 当前栈空 错误闭合 按照html 测试 a</b>c 的结果丢弃该字符串\r\n\t\t\t\t\treturn srcStr.substring(match.index + match[0].length + 1)\r\n\t\t\t\t} else if (this.domArr.length == 1) {\r\n\t\t\t\t\t// 当前栈只有一个节点，处理该节点，并且将当前节点指向undefined\r\n\t\t\t\t\tthis.handleCloseTag()\r\n\t\t\t\t\tthis.current = undefined\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 当前栈内有多个节点\r\n\t\t\t\t\t// 1.处理当前节点\r\n\t\t\t\t\tlet temp = this.domArr.pop()\r\n\t\t\t\t\tthis.handleCloseTag()\r\n\t\t\t\t\tthis.current = !this.domArr[this.domArr.length - 1].isClosed\r\n\t\t\t\t\t\t? this.domArr[this.domArr.length - 1]\r\n\t\t\t\t\t\t: undefined\r\n\r\n\t\t\t\t\tthis.current ? this.current.add(temp) : this.domArr.push(temp)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//\r\n\t\t\t\t/**\r\n\t\t\t\t * 没找到闭合标签与当前标签不匹配 ，分两种情况\r\n\t\t\t\t * 1. 当前结束标签与栈中之前的元素匹配正常闭合只是中间有标签没闭合；\r\n\t\t\t\t * 2. 当前结束标签与栈中所有元素都不匹配\r\n\t\t\t\t * */\r\n\t\t\t\tif (this.domArr.length === 0) {\r\n\t\t\t\t\tthis.warnEndTagNotMatch(name, srcStr)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 尝试寻找与其匹配的开始节点\r\n\t\t\t\t\tlet pos = 0\r\n\t\t\t\t\tfor (let i = this.domArr.length - 1; i >= 1; i--) {\r\n\t\t\t\t\t\tif (!this.domArr[i].isClosed && name === this.domArr[i].tagName) {\r\n\t\t\t\t\t\t\tpos = i\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pos !== 0) {\r\n\t\t\t\t\t\t// warn 用户中间有未闭合的节点\r\n\t\t\t\t\t\tfor (let i = this.domArr.length - 1; i >= pos; i--) {\r\n\t\t\t\t\t\t\tif (this.domArr[i].tagName !== undefined && i !== pos) {\r\n\t\t\t\t\t\t\t\t// 不是文本节点\r\n\t\t\t\t\t\t\t\tthis.warnStartTagNotClose(this.domArr[i])\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// 如果是空标签那么不能将节点放进去\r\n\t\t\t\t\t\t\tif (!this.domArr[i - 1].isClosed) {\r\n\t\t\t\t\t\t\t\tthis.domArr[i].isClosed = true\r\n\t\t\t\t\t\t\t\tlet temp = this.domArr.pop()\r\n\t\t\t\t\t\t\t\tthis.domArr[i - 1].add(temp)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.current = undefined\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// pos = 0 表示当前栈没有元素与当前闭合标签匹配\r\n\t\t\t\t\t\tthis.warnEndTagNotMatch(name, srcStr)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn srcStr.substring(match.index + match[0].length + 1)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 抓取失败\r\n\t\t\tthrow new NError('needEndTag', this.current.tagName)\r\n\t\t}\r\n\t\treturn srcStr.substring(match.index + match[0].length + 1).trimStart();\r\n\t}\r\n\r\n\t/**\r\n\t * 编译text\r\n\t * @param srcStr \t源串\r\n\t * @returns \t\t\r\n\t */\r\n\tprivate compileText(srcStr: string): string {\r\n\t\t// 字符串最开始变为< 或者字符串消耗完 则退出循环\r\n\t\twhile (!srcStr.startsWith('<') && srcStr.length !== 0) {\r\n\t\t\tif (srcStr.startsWith('{')) {\r\n\t\t\t\t// 可能是表达式\r\n\t\t\t\tconst matchExp = /^{{([\\s\\S]*?)}}/i.exec(srcStr)\r\n\t\t\t\tif (matchExp) {\r\n\t\t\t\t\t// 抓取成功\r\n\t\t\t\t\tthis.textArr.push(new Expression(matchExp[1]))\r\n\t\t\t\t\tthis.isExprText = true\r\n\t\t\t\t\tsrcStr = srcStr.substring(matchExp.index + matchExp[0].length)\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 跳过单独的{\r\n\t\t\t\t\ttypeof this.textArr[this.textArr.length] === 'string'\r\n\t\t\t\t\t\t? (this.textArr[this.textArr.length] += '{')\r\n\t\t\t\t\t\t: this.textArr.push('{')\r\n\t\t\t\t\tsrcStr = srcStr.substring(1)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// 非表达式，处理成普通字符节点\r\n\t\t\t\tconst match = /([^\\<\\{]*)/.exec(srcStr)\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\tlet txt: string\r\n\t\t\t\t\tif (this.current && this.current.tagName === 'pre') {\r\n\t\t\t\t\t\t// 在pre标签里\r\n\t\t\t\t\t\ttxt = this.preHandleText(\r\n\t\t\t\t\t\t\tsrcStr.substring(0, match.index + match[0].length)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttxt = this.preHandleText(\r\n\t\t\t\t\t\t\tsrcStr.substring(0, match.index + match[0].length)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.textArr.push(txt)\r\n\t\t\t\t}\r\n\t\t\t\tsrcStr = srcStr.substring(match.index + match[0].length)\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 最开始是< 或者字符消耗完毕 退出循环\r\n\t\tlet text = new VirtualDom(undefined, this.genKey())\r\n\t\tif(this.isExprText){\r\n\t\t\ttext.expressions = [...this.textArr];\r\n\t\t\t//动态文本节点，staticNum=-1\r\n\t\t\ttext.staticNum = -1;\r\n\t\t}else{\r\n\t\t\ttext.textContent = this.textArr.join('')\r\n\t\t}\r\n\t\t\r\n\t\tif (this.current) {\r\n\t\t\t// 当前节点未闭合\r\n\t\t\tif (this.isExprText) {\r\n\t\t\t\tthis.current.add(text)\r\n\t\t\t} else {\r\n\t\t\t\tif (text.textContent.length !== 0) {\r\n\t\t\t\t\tthis.current.add(text)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// 当前不存在未闭合节点，说明text是第一个节点 或者 没有用一个容器把所有节点包裹起来。\r\n\t\t\t// 如果文本节点不是全空则直接push当前文本节点 ，等到编译完成的时候使用一个统一的div包裹所有的domArr里面的节点。\r\n\t\t\t// 如果是全空文本节点则直接丢弃\r\n\t\t\tif (this.isExprText) {\r\n\t\t\t\tthis.domArr.push(text)\r\n\t\t\t} else {\r\n\t\t\t\tif (text.textContent.trim().length !== 0) {\r\n\t\t\t\t\tthis.domArr.push(text)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 文本节点也要闭合\r\n\t\t/**\r\n\t\t *  防止下面的情况出现\r\n\t\t * <div>abc</div>\r\n\t\t *  something\r\n\t\t * <div>abc</div>\r\n\t\t */\r\n\t\ttext.isClosed = true\r\n\t\t// 重置状态\r\n\t\tthis.isExprText = false\r\n\t\tthis.textArr = []\r\n\t\t// 返回字符串\r\n\t\treturn srcStr\r\n\t}\r\n\r\n\t/**\r\n\t * 预处理html保留字符 如 &nbsp;,&lt;等\r\n\t * @param str   待处理的字符串\r\n\t * @returns     解析之后的串\r\n\t */\r\n\tprivate preHandleText(str: string): string {\r\n\t\tlet reg = /&[a-z]+;/\r\n\t\tif (reg.test(str)) {\r\n\t\t\tlet div = document.createElement('div')\r\n\t\t\tdiv.innerHTML = str\r\n\t\t\treturn div.textContent + ''\r\n\t\t}\r\n\t\treturn str\r\n\t}\r\n\r\n\t/**\r\n\t * 处理当前节点是模块或者自定义节点\r\n\t */\r\n\tprivate postHandleNode() {\r\n\t\tlet clazz = DefineElementManager.get(this.current.tagName)\r\n\t\tif (clazz) {\r\n\t\t\tReflect.construct(clazz, [this.current, this.module])\r\n\t\t}\r\n\t\tconst node = this.current\r\n\t\t// 是否是模块类\r\n\t\tif (ModuleFactory.hasClass(node.tagName)) {\r\n\t\t\tconst dir: Directive = new Directive('module', node.tagName)\r\n\t\t\tdir.params = { srcId: this.module.id }\r\n\t\t\tnode.addDirective(dir)\r\n\t\t\tnode.tagName = 'div'\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 处理插槽\r\n\t */\r\n\tprivate handleSlot() {\r\n\t\tlet dom = this.current\r\n\t\tif (\r\n\t\t\t!dom.children ||\r\n\t\t\tdom.children.length === 0 ||\r\n\t\t\t!dom.hasDirective('module')\r\n\t\t) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet slotCt: VirtualDom\r\n\t\tfor (let j = 0; j < dom.children.length; j++) {\r\n\t\t\tlet c = dom.children[j]\r\n\t\t\tif (c.hasDirective('slot')) {\r\n\t\t\t\t//带slot的不处理\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\t//@ts-ignore\r\n\t\t\tif (!slotCt) {\r\n\t\t\t\t//第一个直接被slotCt替换\r\n\t\t\t\tslotCt = new VirtualDom('div', this.genKey())\r\n\t\t\t\tslotCt.addDirective(new Directive('slot'))\r\n\t\t\t\t//当前位置，用slot替代\r\n\t\t\t\tdom.children.splice(j, 1, slotCt)\r\n\t\t\t} else {\r\n\t\t\t\t//直接删除\r\n\t\t\t\tdom.children.splice(j--, 1)\r\n\t\t\t}\r\n\t\t\tslotCt.add(c)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 处理闭合节点\r\n\t */\r\n\tprivate handleCloseTag() {\r\n\t\tthis.postHandleNode()\r\n\t\tthis.current.sortDirective()\r\n\t\tthis.handleSlot()\r\n\t\tthis.current.isClosed = true\r\n\t}\r\n\t/**\r\n\t * 处理自闭合节点\r\n\t */\r\n\tprivate handleSelfClosingTag() {\r\n\t\tthis.postHandleNode()\r\n\t\tthis.current.sortDirective()\r\n\t\tif (this.domArr.length > 1) {\r\n\t\t\tthis.domArr.pop()\r\n\t\t\tthis.domArr[this.domArr.length - 1].add(this.current)\r\n\t\t\tthis.current = this.domArr[this.domArr.length - 1]\r\n\t\t} else {\r\n\t\t\tthis.current = undefined\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 如有闭合标签没有匹配到任何开始标签 给用户警告\r\n\t * @param name 标签名\r\n\t * @param srcStr 剩余模板字符串\r\n\t */\r\n\tprivate warnEndTagNotMatch(name: string, srcStr: string) {\r\n\t\tconsole.warn(\r\n\t\t\t`[Nodom warn]: 模块 %c${\r\n\t\t\t\tthis.module.constructor.name\r\n\t\t\t}%c 中 </${name}> 未匹配到对应的开始标签。\r\n      \\n\\t ${this.template.substring(\r\n\t\t\t\t0,\r\n\t\t\t\tthis.template.length - srcStr.length\r\n\t\t\t)}%c</${name}>%c${srcStr.substring(name.length + 3)}`,\r\n\t\t\t'color:red;font-weight:bold;',\r\n\t\t\t'',\r\n\t\t\t'color:red;font-weight:bold;',\r\n\t\t\t``\r\n\t\t)\r\n\t}\r\n\t/**\r\n\t * 当前节点没有闭合给用户输出警告\r\n\t * @param dom 节点\r\n\t */\r\n\tprivate warnStartTagNotClose(dom: VirtualDom) {\r\n\t\tconsole.warn(\r\n\t\t\t`[Nodom warn]: 模块：%c${this.module.constructor.name}%c 中 ${\r\n\t\t\t\tdom.tagName\r\n\t\t\t} 标签未闭合！ \\n\\t ${this.template.substring(\r\n\t\t\t\t0,\r\n\t\t\t\tdom.tagStartPos\r\n\t\t\t)}%c${this.template.substring(\r\n\t\t\t\tdom.tagStartPos,\r\n\t\t\t\tdom.tagEndPos\r\n\t\t\t)}%c${this.template.substring(dom.tagEndPos)}`,\r\n\t\t\t'color:red;font-weight:bold;',\r\n\t\t\t'',\r\n\t\t\t'color:red;font-weight:bold;',\r\n\t\t\t''\r\n\t\t)\r\n\t}\r\n\t/**\r\n\t * 判断节点是都是空节点\r\n\t * @param dom\r\n\t * @returns\r\n\t */\r\n\tprivate isVoidTag(dom: VirtualDom) {\r\n\t\treturn voidTagMap.has(dom.tagName)\r\n\t}\r\n}\r\n","import { IRenderedDom } from \"./types\";\n/**\n * 比较器\n */\nexport class DiffTool{\n    /**\n     * 比较节点\n     * @param src           待比较节点（新树节点）\n     * @param dst \t        被比较节点 (旧树节点)\n     * @param changeArr     增删改的节点数组\n     * @returns\t            [[type(add 1, upd 2,move 3 ,rep 4,del 5),dom(操作节点),dom1(被替换或修改节点),parent(父节点),loc(位置)]]\n     */\n    public static compare(src:IRenderedDom,dst:IRenderedDom):any[] {\n        const changeArr = [];\n        compare(src,dst);\n        return changeArr;\n\n        /**\n         * 比较节点\n         * @param src           待比较节点（新树节点）\n         * @param dst \t        被比较节点 (旧树节点)\n         * @returns\t            [[type(add 1, upd 2,del 3,move 4 ,rep 5),dom(操作节点),dom1(被替换或修改节点),parent(父节点),\n         *                       loc(dom在父的children index)]]\n         */\n        function compare(src:IRenderedDom,dst:IRenderedDom) {\n            if (!src.tagName) { //文本节点\n                if (!dst.tagName) {\n                    if ((src.staticNum || dst.staticNum) && src.textContent !== dst.textContent) {\n                        addChange(2,src,null,dst.parent);\n                    }else if(src.moduleId !== dst.moduleId){\n                        addChange(5,src,dst, dst.parent);\n                    }\n                } else { //节点类型不同，替换\n                    addChange(5,src,dst, dst.parent);\n                }\n            } else {\n                //节点类型不同或对应的子模块不同，替换\n                if (src.tagName !== dst.tagName) { \n                    addChange(5,src,dst, dst.parent);\n                }else{//节点类型相同，但有一个不是静态节点，进行属性比较\n                    if((src.staticNum || dst.staticNum) && isChange(src,dst)){\n                        addChange(2,src,null,dst.parent);\n                    }\n                    if(!src.moduleId){  //子模块不比较子节点\n                        compareChildren(src,dst);\n                    }\n                }\n            }\n        }\n\n        /**\n         * 比较子节点\n         * @param src   新节点\n         * @param dst   旧节点\n         */\n        function compareChildren(src,dst){\n            //子节点处理\n            if (!src.children || src.children.length === 0) {\n                // 旧节点的子节点全部删除\n                if (dst.children && dst.children.length > 0) {\n                    dst.children.forEach(item => addChange(3,item,null,dst));\n                }\n            } else {\n                //全部新加节点\n                if (!dst.children || dst.children.length === 0) {\n                    src.children.forEach((item,index) => addChange(1, item,null, dst,index));\n                } else { //都有子节点\n                    //存储比较后需要add的key\n                    let addObj={};\n                    //子节点对比策略\n                    let [newStartIdx,newEndIdx,oldStartIdx,oldEndIdx] = [0,src.children.length-1,0,dst.children.length-1];\n                    let [newStartNode,newEndNode,oldStartNode,oldEndNode] = [\n                        src.children[newStartIdx],\n                        src.children[newEndIdx],\n                        dst.children[oldStartIdx],\n                        dst.children[oldEndIdx]\n                    ]\n                    \n                    while(newStartIdx <= newEndIdx && oldStartIdx <= oldEndIdx) {\n                        if (oldStartNode.key === newStartNode.key) {  //新前旧前\n                            compare(newStartNode,oldStartNode);\n                            if(newStartIdx !== oldStartIdx){\n                                addChange(4,newStartNode,null,dst,newStartIdx);\n                            }\n                            newStartNode = src.children[++newStartIdx];\n                            oldStartNode = dst.children[++oldStartIdx];\n                        } else if (oldEndNode.key === newEndNode.key) { //新后旧后\n                            compare(newEndNode,oldEndNode);\n                            if(oldEndIdx !== newEndIdx){\n                                addChange(4,newEndNode,null,dst,newEndIdx);\n                            }\n                            newEndNode = src.children[--newEndIdx];\n                            oldEndNode = dst.children[--oldEndIdx];\n                        } else if (newStartNode.key === oldEndNode.key) { //新前旧后\n                            //新前旧后\n                            compare(newStartNode,oldEndNode);\n                            //放在指定位置\n                            if(newStartIdx !== oldEndIdx){\n                                addChange(4,newStartNode,null,dst,newStartIdx);\n                            }\n                            newStartNode = src.children[++newStartIdx];\n                            oldEndNode = dst.children[--oldEndIdx];\n                        } else if (newEndNode.key === oldStartNode.key) {  //新后旧前\n                            compare(newEndNode,oldStartNode);\n                            if(newEndIdx !== oldStartIdx){\n                                addChange(4, newEndNode, null,dst, newEndIdx);\n                            }\n                            newEndNode = src.children[--newEndIdx];\n                            oldStartNode = dst.children[++oldStartIdx];\n                        } else {\n                            //加入到addObj\n                            addObj[newStartNode.key]= addChange(1, newStartNode, null,dst,newStartIdx);\n                            //新前指针后移\n                            newStartNode = src.children[++newStartIdx];\n                        }\n                    }\n\n                    //多余新节点，需要添加\n                    if(newStartIdx<=newEndIdx) {\n                        for (let i = newStartIdx; i <= newEndIdx; i++) {\n                            // 添加到dst.children[i]前面\n                            addChange(1,src.children[i], null ,dst,i);\n                        }\n                    }\n                    \n                    //有多余老节点，需要删除或变成移动\n                    if(oldStartIdx<=oldEndIdx){\n                        for (let i = oldStartIdx,index=i; i <= oldEndIdx; i++,index++) {\n                            let ch=dst.children[i];\n                            //如果要删除的节点在addArr中，则表示move，否则表示删除\n                            if(addObj.hasOwnProperty(ch.key)){ \n                                let o = addObj[ch.key];\n                                if(index !== o[4]){ //修改为move\n                                    o[0] = 4;\n                                    //从add转为move，需要比较新旧节点\n                                    compare(o[1],ch);\n                                }else{  //删除不需要移动的元素\n                                    let ii;\n                                    if((ii=changeArr.findIndex(item=>item[1].key === o[1].key)) !== -1){\n                                        changeArr.splice(ii,1);\n                                    }\n                                }\n                            }else{\n                                addChange(3,ch,null,dst);\n                                //删除的元素索引号-1，用于判断是否需要移动节点\n                                index--;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        /**\n         * 判断节点是否修改\n         * @parma src   新树节点\n         * @param dst   旧树节点\n         * \n         */\n        function isChange(src:IRenderedDom,dst:IRenderedDom):boolean{\n            for(let p of ['props','assets']){\n                //属性比较\n                if(!src[p] && dst[p] || src[p] && !dst[p]){\n                    return true;\n                }else if(src[p] && dst[p]){\n                    let keys = Object.keys(src[p]);\n                    let keys1 = Object.keys(dst[p]);\n                    if(keys.length !== keys1.length){\n                        return true;\n                    }else{\n                        for(let k of keys){\n                            if(src[p][k] !== dst[p][k]){\n                                return true;\n                            }\n                        }\n                    }\n                }\n            }\n            return false;\n        }\n        \n        /**\n         * 添加刪除替換\n         * @param type      类型 add 1, upd 2,del 3,move 4 ,rep 5\n         * @param dom       虚拟节点    \n         * @param dom1      相对节点\n         * @param parent    父节点\n         * @param loc       添加或移动的目标index\n         * @returns         添加的change数组\n        */\n        function addChange(type:number,dom: IRenderedDom, dom1: IRenderedDom,parent?:IRenderedDom,loc?:number){\n            const o = [type,dom,dom1,parent,loc];\n            changeArr.push(o);\n            return o;\n        }\n    }\n}\n","import { VirtualDom } from \"./virtualdom\";\nimport { Module } from \"./module\";\n/**\n * 自定义元素\n * 用于扩充定义，主要对ast obj进行前置处理\n */\nexport class DefineElement {\n    /**\n     * 构造器，在dom编译后执行\n     * @param node \n     * @param module \n     */\n    constructor(node:VirtualDom){\n        if (node.hasProp('tag')) {\n            node.tagName = node.getProp('tag');\n            node.delProp('tag');\n        } else {\n            node.tagName = 'div';\n        }\n    }\n}\n","import { NEvent } from \"./event\";\nimport { Module } from \"./module\";\nimport { IRenderedDom } from \"./types\";\n/**\n * 事件管理器\n */\nexport class EventManager {\n    /**\n     * 外部事件集\n     */\n    private static extendEventMap = new Map();\n\n    \n    \n    /**\n     * 处理外部事件\n     * @param dom       dom节点\n     * @param event     事件对象\n     * @returns         如果有是外部事件，则返回true，否则返回false\n     */\n    public static handleExtendEvent(module:Module,dom:IRenderedDom,event:NEvent):boolean{\n        let evts = this.get(event.name);\n        if (!evts) {\n            return false;\n        }\n        for(let key of Object.keys(evts)){\n            let ev = new NEvent(module,key,evts[key]);\n            ev.capture = event.capture;\n            ev.nopopo = event.nopopo;\n            ev.delg = event.delg;\n            ev.once = event.once;\n            //设置依赖事件\n            ev.dependEvent = event;\n            module.eventFactory.addEvent(dom,ev);\n        }\n        return true;\n    }\n\n    /**\n      * 注册扩展事件\n      * @param eventName    事件名\n      * @param handleObj    事件处理集\n      */\n    public static regist(eventName:string,handleObj:any) {\n        this.extendEventMap.set(eventName,handleObj);\n    }\n \n    /**\n     * 取消注册扩展事件\n     * @param eventName     事件名\n     */\n    static unregist(eventName:string) {\n        return this.extendEventMap.delete(eventName);\n    }\n\n    /**\n     * 获取扩展事件\n     * @param eventName     事件名\n     * @returns             事件处理集\n     */\n    public static get(eventName:string):any{\n        return this.extendEventMap.get(eventName);\n    }\n}\n","import { NEvent } from \"./event\";\nimport { Module } from \"./module\";\nimport { IRenderedDom } from \"./types\";\n\n/**\n * 事件工厂\n * 每个模块一个事件工厂，用于管理模块内虚拟dom对应的事件对象\n */\nexport class EventFactory{\n    /**\n     * 所属模块\n     */\n    private module:Module;\n    /**\n     * 事件map\n     * key:虚拟domkey，\n     * value: {\n     *          eventName1:\n     *            {\n     *              own:[event对象,...],\n     *              delg:[{key:被代理key,event:event对象},...],\n     *              toDelg:[event对象],\n     *              capture:useCapture\n     *           },\n     *           eventName2:...\n     *           bindMap:{},\n     *        }\n     *    eventName:事件名，如click等\n     *    配置项:\n     *        own:自己的事件数组,\n     *        delg:代理事件数组（代理子对象）,\n     *        bindMap:已绑定事件map，其中键为事件名，值为capture，解绑时需要\n     *        capture:在own和delg都存在时，如果capture为true，则先执行own，再执行delg，为false时则相反。\n     *                如果只有own，则和html event的cature事件处理机制相同\n     */\n    private eventMap:Map<number,any>;\n\n    /**\n     * domkey对应event对象数组\n     * key: dom key\n     * value: NEvent数组\n     */\n    private addedEvents:Map<number,NEvent[]>;\n\n    /**\n     * 构造器\n     * @param module 模块\n     */\n    constructor(module:Module){\n        this.module = module;\n        this.eventMap = new Map();\n        this.addedEvents = new Map();\n    }\n\n    /**\n     * 保存事件\n     * @param key       dom key \n     * @param event     事件对象\n     */\n    public addEvent(dom:IRenderedDom,event: NEvent){\n        const key = dom.key;\n        //判断是否已添加，避免重复添加\n        if(this.addedEvents.has(key) && this.addedEvents.get(key).includes(event)){\n            return;\n        }\n        //代理事件，如果无父节点，则直接处理为自有事件\n        if(event.delg){\n            if(dom.parent){\n                this.addToArr(dom.parent.key,event,dom.key);\n            }else{ //不存在父对象，设置delg为false\n                event.delg = false;\n            }\n        }\n        \n        // 自有事件\n        if(!event.delg){\n            this.addToArr(dom.key,event);\n        }\n        //添加到addedEvents\n        if(!this.addedEvents.has(key)){\n            this.addedEvents.set(key,[event]);\n        }else{\n            this.addedEvents.get(key).push(event);\n        }\n    }\n\n    /**\n     * 添加到dom的own或delg事件队列\n     * @param key       dom key \n     * @param event     事件对象\n     * @param key1      被代理dom key，仅对代理事件有效\n     */\n    private addToArr(key:number,event:NEvent,key1?:number){\n        let cfg;\n        if(!this.eventMap.has(key)){\n            cfg = {bindMap:{}};\n            this.eventMap.set(key,cfg);\n        }else{\n            cfg = this.eventMap.get(key);\n        }\n        if(!cfg[event.name]){\n            cfg[event.name] = { //eventname对应配置不存在\n                delg:[],\n                own:[]\n            }\n        }\n        //类型：delg或own\n        let type;\n        let value;\n        //代理事件\n        if(key1){\n            type = 'delg';\n            value = {key:key1,event:event};\n        }else{ //非代理事件\n            type = 'own';\n            value = event;\n            cfg[event.name].capture = event.capture||false;\n        }\n        cfg[event.name][type].push(value);\n    }\n\n    /**\n     * 获取事件对象\n     * @param key   dom key\n     * @returns     事件对象\n     */\n    public getEvent(key:number):any{\n        return this.eventMap.get(key);\n    }\n\n    /**\n     * 删除事件\n     * @param event     事件对象\n     * @param key       对应dom keys\n     */\n    public removeEvent(dom:IRenderedDom,event: NEvent) {\n        if(!this.addedEvents.has(dom.key) || !this.addedEvents.get(dom.key).includes(event)){\n            return;\n        }\n        //从dom event数组移除\n        const arr = this.addedEvents.get(dom.key);\n        arr.splice(arr.indexOf(event),1);\n\n        //处理delg和own数组\n        if(event.delg){ //代理事件\n            //找到父对象\n            if(!dom.parent || !this.eventMap.has(dom.parent.key)){\n                return;\n            }\n            let cfg = this.eventMap.get(dom.parent.key);\n            if(!cfg[event.name]){\n                return;\n            }\n            let obj = cfg[event.name];\n            let index = obj.delg.findIndex(item=>item.key===dom.key && item.event===event);\n            if(index !== -1){\n                obj.delg.splice(index,1);\n                // 解绑事件\n                if(obj.delg.length === 0 && obj.own.length===0){\n                    this.unbind(dom.parent.key,event.name);\n                }\n            }\n        }else{ //own\n            let cfg = this.eventMap.get(dom.key);\n            if(!cfg[event.name]){\n                return;\n            }\n            let obj = cfg[event.name];\n            let index = obj.own.findIndex(item=>item===event);\n            if(index !== -1){\n                obj.own.splice(index,1);\n                // 解绑事件\n                if(obj.delg.length === 0 && obj.own.length===0){\n                    this.unbind(dom.key,event.name);\n                }\n            }\n        }\n    }\n\n    /**\n     * 绑定dom事件\n     * @param dom   渲染dom节点          \n     */\n    public bind(dom:IRenderedDom){\n        if(!this.eventMap.has(dom.key) ){\n            return;\n        }\n        const el = this.module.getElement(dom.key);\n        const cfg = this.eventMap.get(dom.key);\n        for(let key of Object.keys(cfg)){\n            // bindMap 不是事件名\n            if(key === 'bindMap'){\n                continue;\n            }\n            el.addEventListener(key,handler,cfg[key].capture);\n            cfg.bindMap[key] = {handler:handler,capture:cfg[key].capture};\n        }\n        const me = this;\n        function handler(e){\n            me.handler.apply(me,[me.module,e]);\n        }\n    }\n\n    /**\n     * 从eventfactory解绑所有事件\n     * @param key           dom key\n     * @param eventName     事件名\n     */\n    public unbind(key:number,eventName:string){\n        if(!this.eventMap.has(key)){\n            return;\n        }\n        const eobj = this.eventMap.get(key);\n        if(!eobj.bindMap || !eobj[eventName]){\n            return;\n        }\n        const el = this.module.getElement(key);\n        const cfg = eobj.bindMap[eventName];\n        //从html element解绑\n        if(el && cfg){\n            el.removeEventListener(eventName,cfg.handler,cfg.capture);\n        }\n        delete eobj.bindMap[eventName];\n    }\n\n    /**\n     * 解绑html element事件\n     * @param key   dom key\n     */\n    public unbindAll(key:number){\n        if(!this.eventMap.has(key)){\n            return;\n        }\n        const eobj = this.eventMap.get(key);\n        if(!eobj.bindMap){\n            return;\n        }\n        const el = this.module.getElement(key);\n        if(el){\n            for(let key of Object.keys(eobj.bindMap)){\n                const v = eobj.bindMap[key];\n                el.removeEventListener(key,v.handler,v.capture);\n            }\n        }\n        eobj.bindMap = {};\n    }\n\n    /**\n     * 是否拥有key对应的事件对象\n     * @param key   dom key\n     * @returns     如果key对应事件存在，返回true，否则返回false\n     */\n    public hasEvent(key:number):boolean{\n        return this.eventMap.has(key);\n    }\n\n    /**\n     * 清除工厂所有事件\n     */\n    public clear(){\n        //解绑事件\n        for(let key of this.addedEvents.keys()){\n            this.unbindAll(key);\n        }\n        this.addedEvents.clear();\n        this.eventMap.clear();\n    }\n\n    /**\n     * 事件handler\n     * @param module    模块\n     * @param e         HTML Event\n     */\n    \n    private handler(module,e){\n        //从事件element获取事件\n        let el = e.currentTarget;\n        const key = el.key;\n        const dom = module.domManager.getRenderedDom(key);\n        if(!dom){\n            return;\n        }\n        const eobj = this.eventMap.get(key);\n        if(!eobj || !eobj[e.type]){\n            return;\n        }\n        const evts = eobj[e.type];\n        if(evts.capture){ //先执行自己的事件\n            doOwn(evts.own);\n            doDelg(evts.delg);\n        }else{\n            if(!doDelg(evts.delg)){\n                doOwn(evts.own);\n            }\n        }\n    \n        /**\n         * 处理自有事件\n         * @param events \n         * @returns \n         */\n        function doOwn(events){\n            if(!events){\n                return;\n            }\n            let nopopo = false;\n            for(let i=0;i<events.length;i++){\n                const ev = events[i];\n                if(typeof ev.handler === 'string'){\n                    module.invokeMethod(ev.handler,dom.model, dom,ev, e);\n                }else if(typeof ev.handler === 'function'){\n                    ev.handler.apply(module,[dom.model,dom,ev,e]);\n                }\n                if(ev.once){  //移除事件\n                    events.splice(i--,1);\n                }\n                nopopo = ev.nopopo;\n            }\n            if(nopopo){\n                e.stopPropagation();\n            }\n        }\n\n        /**\n         * 处理代理事件\n         * @param events \n         * @returns         是否禁止冒泡\n         */\n        function doDelg(events):boolean{\n            if(!events){\n                return false;\n            }\n            const elArr = e.path || (e.composedPath?e.composedPath():[]);\n            let nopopo = false;\n            for(let i=0;i<events.length;i++){\n                const evo = events[i];\n                const ev = evo.event;\n                for(let j=0;j<elArr.length && elArr[j]!==el;j++){\n                    const k = elArr[j].key;\n                    if(k === evo.key){\n                        const dom1 = module.domManager.getRenderedDom(k);\n                        if(typeof ev.handler === 'string'){\n                            module.invokeMethod(ev.handler,dom1.model, dom1,ev, e);\n                        }else if(typeof ev.handler === 'function'){\n                            ev.handler.apply(module,[dom1.model,dom1,ev,e]);\n                        }\n                        // 保留nopopo\n                        nopopo = ev.nopopo;\n                        if(ev.once){  //移除代理事件，需要从被代理元素删除\n                            //从当前dom删除\n                            events.splice(i--,1);\n                            //从被代理dom删除\n                            const ind = module.eventFactory.get(k).indexOf(ev);\n                            module.eventFactory.get(k).splice(ind,1);\n                        }\n                        break;\n                    }\n                }\n            }\n            return nopopo;\n        }\n    }\n}","import { Module } from \"./module\";\n\n/**\n * NCache模块-存储在内存中\n */\nexport class NCache{\n    private cacheData:any;\n    /**\n     * 订阅map，格式为 {key:[{module:订阅模块,handler:},...]}\n     */\n    private subscribeMap = new Map();\n    \n    constructor(){\n        this.cacheData = {};\n    }\n\n    /**\n     * 通过提供的键名从内存中拿到对应的值\n     * @param key   键，支持\".\"（多级数据分割）\n     * @reutrns     值或undefined\n     */\n    public get(key:string){\n        let p = this.cacheData;\n        if(key.indexOf('.') !== -1){\n            let arr = key.split('.');\n            if(arr.length>1){\n                for(let i=0;i<arr.length-1 && p;i++){\n                    p = p[arr[i]];\n                }\n                if(p){\n                    key = arr[arr.length-1];\n                }\n            }\n        }\n        if(p){\n            return p[key];\n        }\n    }\n\n    /**\n     * 通过提供的键名和值将其存储在内存中\n     * @param key       键 \n     * @param value     值\n     */\n    public set(key:string,value:any){\n        let p = this.cacheData;\n        let key1 = key;\n        if(key.indexOf('.') !== -1){\n            let arr = key.split('.');\n            if(arr.length>1){\n                for(let i=0;i<arr.length-1;i++){\n                    if(!p[arr[i]] || typeof p[arr[i]] !== 'object'){\n                        p[arr[i]] = {};\n                    }\n                    p = p[arr[i]];        \n                }\n                key = arr[arr.length-1];\n            }\n        }\n        \n        if(p){\n            p[key] = value;\n        }\n\n        //处理订阅\n        if(this.subscribeMap.has(key1)){\n            let arr = this.subscribeMap.get(key1);\n            for(let a of arr){\n                this.invokeSubscribe(a.module,a.handler,value);\n            }\n        }\n    }\n\n    /**\n     * 通过提供的键名将其移除\n     * @param key   键 \n     */\n    public remove(key:string){\n        let p = this.cacheData;\n        if(key.indexOf('.') !== -1){\n            let arr = key.split('.');\n            if(arr.length>1){\n                for(let i=0;i<arr.length-1 && p;i++){\n                    p = p[arr[i]];\n                }\n                if(p){\n                    key = arr[arr.length-1];\n                }\n            }\n        }\n        \n        if(p){\n            delete p[key];\n        }       \n    }\n    /**\n     * 订阅\n     * @param module    订阅的模块\n     * @param key       字段key\n     * @param handler   回调函数 参数为key对应value \n     */\n    public subscribe(module:Module,key:string,handler:Function|string){\n        if(!this.subscribeMap.has(key)){\n            this.subscribeMap.set(key,[{module:module,handler:handler}]);\n        }else{\n            let arr = this.subscribeMap.get(key);\n            if(!arr.find(item=>item.module === module && item.handler === handler)){\n                arr.push({module:module,handler:handler});\n            }\n        }\n        //如果存在值，则执行订阅回调\n        let v = this.get(key);\n        if(v){\n            this.invokeSubscribe(module,handler,v);\n        }\n    }\n\n    /**\n     * 调用订阅方法\n     * @param module    模块\n     * @param foo       方法或方法名\n     * @param v         值\n     */\n    private invokeSubscribe(module:Module,foo:Function|string,v:any){\n        if(typeof foo === 'string'){\n            module.invokeMethod(<string>foo,v);\n        }else{\n            foo.call(module,v);\n        }\n    }\n}","import { NCache } from \"./cache\";\nimport { Module } from \"./module\";\n\n/**\n * 全局缓存\n */\nexport class GlobalCache{\n    //NCache实例\n    private static cache:NCache = new NCache();\n\n    /**\n     * 保存到cache\n     * @param key       键，支持\".\"（多级数据分割）\n     * @param value     值\n     */\n    public static set(key:string,value:any){\n        this.cache.set(key,value);\n    }\n\n    /**\n     * 从cache读取\n     * @param key   键，支持\".\"（多级数据分割）\n     * @returns     缓存的值或undefined\n     */\n    public static get(key){\n        return this.cache.get(key);\n    }\n\n    /**\n     * 订阅\n     * @param module    订阅的模块\n     * @param key       字段key\n     * @param handler   回调函数 参数为key对应value\n     */\n    public static subscribe(module:Module,key:string,handler:Function){\n        this.cache.subscribe(module,key,handler);\n    }\n\n    /**\n     * 从cache移除\n     * @param key   键，支持\".\"（多级数据分割）\n     */\n    public static remove(key){\n        this.cache.remove(key);\n    }\n\n}","import { Module } from \"./module\";\n/**\n * 模型类\n * 对数据做代理\n * 注意:以下5个属性名不能用\n *      __source:源数据对象\n *      __key:模型的key\n *      __module:所属模块\n *      __parent:父模型\n *      __name:在父对象中的属性名\n */\nexport class Model {\n    /**\n     * @param data \t\t数据\n     * @param module \t模块对象\n     * @param parent    父模型\n     * @param name      模型在父对象中的prop name\n     * @returns         模型代理对象\n     */\n    constructor(data: any, module: Module, parent?:any, name?:any) {\n        //数据不存在或已经代理，无需再创建\n        if(!data || data.__source){\n            return;\n        }\n        \n        // 创建模型\n        let proxy = new Proxy(data, {\n            set(src: any, key: string, value: any, receiver: any){\n                let value1 = value;\n                //proxy转换为源对象，否则比较会出错\n                if(value && value.__source){\n                    const source = value.__source;\n                    // 已经被代理，但是可能没添加当前module\n                    if(source){\n                        //可能父传子，需要添加引用\n                        if(value.__module !== module){\n                            module.modelManager.add(source,value);\n                            value.__module.modelManager.bindModel(value,module);\n                            //保存value在本模块中的属性名\n                            module.modelManager.setModelName(value,key);\n                        }\n                        value1 = source;\n                    }\n                }\n                //值未变,proxy 不处理\n                if (src[key] === value1) {\n                    return true;\n                }\n                let ov = src[key];\n                let r = Reflect.set(src, key, value1, receiver);\n                module.modelManager.update(receiver, key, ov, value);\n                return r;\n            },\n            get(src: any, key: string | symbol, receiver){\n                //如果为代理，则返回源数据\n                if(key === '__source'){\n                    return receiver?src:undefined;\n                }\n                //如果为代理，则返回module\n                if(key === '__module'){\n                    return receiver?module:undefined;\n                }\n                //如果为代理，则返回key\n                if(key === '__key'){\n                    return receiver?module.modelManager.getModelKey(src):undefined;\n                }\n                //父模型\n                if(key === '__parent'){\n                    return parent;\n                }\n\n                if(key === '__name'){\n                    return name;\n                }\n\n                let res = Reflect.get(src, key, receiver);\n                //只处理object和array\n                if(res && (res.constructor === Object || res.constructor === Array)){\n                    let m = module.modelManager.getModel(res);\n                    if(!m){\n                        m = new Model(res,module,receiver,key);\n                    }\n                    res = m;\n                }\n                return res;\n            },\n            deleteProperty(src: any, key: any){\n                let oldValue = src[key];\n                delete src[key];\n                module.modelManager.update(proxy,key,oldValue,undefined);\n                return true;\n            }\n        });\n        module.modelManager.add(data,proxy);\n        return proxy;\n    }\n}","import { ModuleFactory } from \"./modulefactory\";\nimport { Model } from \"./model\";\nimport { Module } from \"./module\";\nimport { Renderer } from \"./renderer\";\nimport { Util } from \"./util\";\n\n/**\n * 模型工厂\n */\nexport class ModelManager {\n    /**\n     * 所属模块\n     */\n    public module:Module;\n\n    /**\n     * 数据map\n     * {data:{model:model,key:key}\n     * 其中：\n     *      data:       初始数据对象\n     *      model:      model对象\n     */\n    private dataMap: WeakMap<object,any> = new WeakMap();\n\n    /**\n     * 存储模型对应属性名，如果为父传子，则需要保存属于该模型的属性名\n     * key: model\n     * value: model名字\n     */\n    private nameMap:WeakMap<object,any> = new WeakMap();\n    /** \n     * model对应监听器map \n     *  key:model\n     *  value:{key1:{f:foo1,deep:true/false},key2:,...}\n     *        其中：prop为被监听属性，foo为监听器方法，deep为是否深度监听\n     */\n    private watchMap:WeakMap<object,any> = new WeakMap();\n\n    /**\n     * 是否存在深度watcher\n     */\n    private hasDeepWatch:boolean = false;\n\n    /**\n     * 绑定module map，slot引用外部数据时有效\n     * {model:[moduleid1,moduleid2,...]}\n     */\n    public bindMap:WeakMap<object,number[]> = new WeakMap();\n\n    \n    /**\n     * 构造器\n     * @param module    模块\n     */\n    constructor(module:Module){\n        this.module = module;\n    }\n\n    /**\n     * 获取model，不存在则新建\n     * @param data      数据\n     * @returns         model\n     */\n    public getModel(data:any):Model{\n        return this.dataMap.has(data)?this.dataMap.get(data).model:undefined;\n    }\n\n    /**\n     * 获取model key\n     * @param model     model对象\n     * @returns         model对应key\n     */\n    public getModelKey(data:any):number{\n        return this.dataMap.has(data)?this.dataMap.get(data).key:undefined;\n    }\n\n    /**\n     * 设置模型名\n     * @param model 模型 \n     * @param name  名\n     */\n    public setModelName(model:any,name:string){\n        if(!this.nameMap.has(model)){\n            this.nameMap.set(model,name);\n        }\n    }    \n\n    /**\n     * 获取模型名\n     * @param model 模型 \n     * @returns     模型名\n     */\n    public getModelName(model:any):string{\n        return this.nameMap.get(model);\n    }\n\n    /**\n     * 添加数据到map\n     * @param data      原始数据\n     * @param model     模型\n     */\n    public add(data,model){\n        //避免重复添加\n        if(this.dataMap.has(data)){\n            return;\n        }\n        this.dataMap.set(data,{model:model,key:model.__key || Util.genId()});\n    }\n    \n    /**\n     * 添加绑定\n     * @param model     模型 \n     * @param moduleId  模块id\n     */\n    public bindModel(model:any,module:Module){\n        if(!model){\n            return;\n        }\n        bind(this.bindMap,model,module);\n        /**\n         * 绑定\n         * @param bindMap \n         * @param model \n         * @param module \n         */\n        function bind(bindMap,model,module){\n            if(model.__module === module){\n                return;\n            }\n            let mids;\n            if(!bindMap.has(model)){\n                mids = [];\n                bindMap.set(model,mids);\n            }else{\n                mids = bindMap.get(model);\n            }\n            if(!mids.includes(module.id)){\n                mids.push(module.id);\n            }\n            //级联绑定\n            for(let key of Object.keys(model)){\n                if(model[key] && typeof model[key] === 'object'){\n                    bind(bindMap,model[key],module);\n                }\n            }\n        }\n    }\n\n    /**\n     * 更新导致渲染\n     * 如果不设置oldValue和newValue，则直接强制渲染\n     * @param model     model\n     * @param key       属性\n     * @param oldValue  旧值\n     * @param newValue  新值\n     */\n    public update(model: Model, key: string, oldValue?: any, newValue?: any) {\n        //处理watch\n        handleWatcher(this.module,model);\n        //添加module渲染\n        Renderer.add(this.module);\n        //对绑定模块添加渲染\n        if(this.bindMap.has(model)){\n            for(let id of this.bindMap.get(model)){\n                const m = ModuleFactory.get(id);\n                if(m){\n                    handleWatcher(m,model);\n                    Renderer.add(m);\n                }\n            }\n        }\n        \n        /**\n         * 处理watcher\n         * @param mdl   模块\n         * @param model 模型\n         */  \n        function handleWatcher(mdl,model){\n            const map = mdl.modelManager.watchMap;\n            let watcher = map.get(model);\n            //当前model存在watcher\n            if(watcher && watcher[key]){\n                //查找对应key是否存在watch\n                watcher[key].f.call(mdl,model,key,oldValue,newValue);\n            }else if(mdl.modelManager.hasDeepWatch){   //进行deep查找\n                for(let m = model;m && m.__parent;m=m.__parent){\n                    //如果已经跨模块，则表示为父传子，父模块指向当前模块\n                    let pm = m.__parent.__module === mdl?m.__parent:mdl.model;\n                    if(!map.has(pm)){\n                        continue;\n                    }\n                    const watcher = map.get(pm);\n                    const name = mdl.modelManager.getModelName(m)||m.__name;\n                    if(watcher && watcher[name]){\n                        let cfg = watcher[name];\n                        // 当前model或父model deep watch\n                        if(cfg.deep){\n                            cfg.f.call(mdl,model,key,oldValue,newValue);\n                            //找到即跳出循环\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * 监听某个数据项\n     * 注意：执行此操作时，该数据项必须已经存在，否则监听失败\n     * @param model     带watch的model\n     * @param key       数据项名或数组\n     * @param operate   数据项变化时执行方法\n     * @param module    指定模块，如果指定，则表示该model绑定的所有module都会触发watch事件，在model父(模块)传子(模块)传递的是对象时会导致多个watch出发\n     * @param deep      是否深度观察，如果是深度观察，则子对象更改，也会触发观察事件\n     * \n     * @returns         unwatch函数\n     */\n    public watch(model:Model,key: string|string[], operate: Function,deep?:boolean):Function {\n        if(!operate || typeof operate !== 'function'){\n            return;\n        }\n        const me = this;\n        //设置深度watch标志\n        this.hasDeepWatch = deep;\n        //撤销watch数组，数据项为{m:model,k:监听属性,f:触发方法}\n        let arr = [];\n        if(Array.isArray(key)){\n            for(let k of key){\n                watchOne(model,k,operate);\n            }\n        }else{\n            watchOne(model,key,operate);\n        }\n\n        //返回取消watch函数\n        return ()=>{\n            //避免二次取消\n            if(!Array.isArray(arr)){\n                return;\n            }\n            for(let f of arr){\n                let obj = me.watchMap.get(f.m);\n                if(!obj){\n                    continue;\n                }\n                delete obj[f.k];\n                //已经无监听从watchMap移除\n                if(Object.keys(obj).length === 0){\n                    me.watchMap.delete(f.m);\n                }\n            }\n            //释放arr\n            arr = null;\n        }\n        \n        /**\n         * 监听一个\n         * @param model     当前model  \n         * @param key       监听属性，可以支持多级属性，如果为多级属性，倒数第二级对应数据项必须为对象\n         * @param operate   操作方法\n         * @returns \n         */\n        function watchOne(model:Model,key:string,operate:Function){\n            if (!model || typeof model !== 'object') {\n                return;\n            }\n            let index;\n            //如果带'.'，则只取最里面那个对象\n            if ((index = key.lastIndexOf('.')) !== -1) {\n                model = me.get(model,key.substring(0, index));\n                key = key.substring(index + 1);\n                if (!model || typeof model !== 'object') {\n                    return;\n                }\n            }\n            \n            if(!me.watchMap.has(model)){\n                me.watchMap.set(model,{});\n            }\n            const obj= me.watchMap.get(model);\n            obj[key] = {f:operate,deep:deep};\n            //保存用于撤销watch\n            arr.push({m:model,k:key});\n        }\n    }\n\n    \n    /**\n     * 查询model子属性\n     * @param key       属性名，可以分级，如 name.firstName\n     * @param model     模型\n     * @returns         属性对应model proxy\n     */\n    public get(model:Model, key?: string):any {\n        if(key){\n            if (key.indexOf('.') !== -1) {    //层级字段\n                let arr = key.split('.');\n                for (let i = 0; i < arr.length - 1; i++) {\n                    model = model[arr[i]];\n                    if (!model) {\n                        break;\n                    }\n                }\n                if (!model) {\n                    return;\n                }\n                key = arr[arr.length - 1];\n            }\n            model = model[key];\n        }\n        return model;\n    }\n\n    /**\n     * 设置值\n     * @param model     模型\n     * @param key       子属性，可以分级，如 name.firstName\n     * @param value     属性值\n     */\n    public set(model:Model,key:string,value:any){\n        if (key.indexOf('.') !== -1) {    //层级字段\n            let arr = key.split('.');\n            for (let i = 0; i < arr.length - 1; i++) {\n                //不存在，则创建新的model\n                if (!model[arr[i]]) {\n                    model[arr[i]] = {};\n                }\n                model = model[arr[i]];\n            }\n            key = arr[arr.length - 1];\n        }\n        model[key] = value;\n    }\n}","import { NCache } from \"./cache\";\nimport { Directive } from \"./directive\";\nimport { VirtualDom } from \"./virtualdom\";\nimport { NEvent } from \"./event\";\nimport { Expression } from \"./expression\";\nimport { GlobalCache } from \"./globalcache\";\nimport { Module } from \"./module\";\nimport { IRenderedDom } from \"./types\";\n\n/**\n * 指令管理器\n * $directives  指令集\n * $expressions 表达式集\n * $events      事件集\n * $savedoms    dom相关缓存 包括 html dom 和 参数\n * $doms        渲染树\n */\nexport  class ObjectManager {\n    /**\n     * NCache\n     */\n    public cache:NCache;\n\n    /**\n     * 模块\n     */\n    public module:Module;\n\n    /**\n     * module   模块\n     * @param module \n     */\n    constructor(module:Module){\n        this.module = module;\n        this.cache = new NCache();\n    }\n\n    /**\n     * 保存到cache\n     * @param key       键，支持\".\"（多级数据分割）\n     * @param value     值\n     */\n     public set(key:string,value:any){\n        this.cache.set(key+'',value);\n    }\n\n    /**\n     * 从cache读取\n     * @param key   键，支持\".\"（多级数据分割）\n     * @returns     缓存的值或undefined\n     */\n    public get(key:string){\n        return this.cache.get(key);\n    }\n\n    /**\n     * 从cache移除\n     * @param key   键，支持\".\"（多级数据分割）\n     */\n    public remove(key:string){\n        this.cache.remove(key);\n    }\n\n    /**\n     * 设置事件参数\n     * @param id        事件id\n     * @param key       dom key\n     * @param name      参数名  \n     * @param value     参数值\n     */\n    public setEventParam(id:number,key:number,name:string,value:any){\n        this.cache.set('$events.' + id + '.$params.' + key + '.' + name,value);\n    }\n\n    /**\n     * 获取事件参数值\n     * @param id        事件id\n     * @param key       dom key \n     * @param name      参数名\n     * @returns         参数值\n     */\n    public getEventParam(id:number,key:number,name:string){\n        return this.get('$events.' + id + '.$params.' + key + '.' + name);\n    }\n\n    /**\n     * 移除事件参数\n     * @param id        事件id\n     * @param key       dom key\n     * @param name      参数名\n     */\n    public removeEventParam(id:number,key:number,name:string){\n        this.remove('$events.' + id + '.$params.' + key + '.' + name);\n    }\n\n    /**\n     * 清空事件参数\n     * @param id        事件id\n     * @param key       dom key \n     */\n    public clearEventParam(id:number,key?:number){\n        if(key){    //删除对应dom的事件参数\n            this.remove('$events.' + id + '.$params.' + key);    \n        }else{      //删除所有事件参数\n            this.remove('$events.' + id + '.$params');\n        }\n    }\n\n    /**\n     * 设置dom参数值\n     * @param key       dom key \n     * @param name      参数名\n     * @param value     参数值\n     */\n    public setDomParam(key:number,name:string,value:any){\n        this.set('$domparam.' + key + '.' + name ,value);\n    }\n\n    /**\n     * 获取dom参数值\n     * @param key       dom key\n     * @param name      参数名\n     * @returns         参数值\n     */\n    public getDomParam(key:number,name:string):any{\n        return this.get('$domparam.' + key + '.' + name);\n    }\n\n    /**\n     * 移除dom参数值\n     * @param key       dom key\n     * @param name      参数名\n     */\n    public removeDomParam(key:number,name:string){\n        this.remove('$domparam.' + key + '.' + name);\n    }\n\n    /**\n     * 清除element 参数集\n     * @param key   dom key\n     */\n    public clearDomParams(key:number){\n        this.remove('$domparam.' + key);\n    }\n    \n    /**\n     * 清除缓存dom对象集\n     */\n    public clearAllDomParams(){\n        this.remove('$domparam');\n    }\n}\n","import { Module } from \"./module\";\nimport { ModuleFactory } from \"./modulefactory\";\nimport { IRenderedDom } from \"./types\";\nimport { VirtualDom } from \"./virtualdom\";\n\n\n/**\n * dom 管理器，用于管理模块的虚拟dom，旧渲染树\n */\nexport class DomManager{\n    /**\n     * 所属模块\n     */\n    private module:Module;\n\n    /**\n     * 虚拟dom树\n     */\n    public vdomTree:VirtualDom;\n\n    /**\n     * 渲染过的树\n     */\n    public renderedTree:IRenderedDom;\n\n    /**\n     *  key:html node映射\n     */\n    public elementMap:Map<number,Node> = new Map();\n\n    constructor(module:Module){\n        this.module = module;\n    }\n    /**\n     * 从origin tree 获取虚拟dom节点\n     * @param key   dom key\n     */\n    public getOriginDom(key:number):VirtualDom{\n        if(!this.vdomTree){\n            return null;\n        }\n        return find(this.vdomTree);\n        function find(dom:VirtualDom){\n            if(dom.key === key){\n                return dom;\n            }\n            if(dom.children){\n                for(let d of dom.children){\n                    let d1 = find(d);\n                    if(d1){\n                        return d1;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * 从渲染树中获取key对应的渲染节点\n     * @param key   dom key\n     */\n     public getRenderedDom(key:number):IRenderedDom{\n        if(!this.renderedTree){\n            return;\n        }\n        return find(this.renderedTree,key);\n        /**\n         * 递归查找\n         * @param dom   渲染dom  \n         * @param key   待查找key\n         * @returns     key对应renderdom 或 undefined\n         */\n        function find(dom:IRenderedDom,key:number):IRenderedDom{\n            if(dom.key === key){\n                return dom;\n            }\n            if(dom.children){\n                for(let d of dom.children){\n                    if(!d){\n                        continue;\n                    }\n                    let d1 = find(d,key);\n                    if(d1){\n                        return d1;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * 克隆渲染后的dom节点\n     * @param key   dom key或dom节点\n     * @param deep  是否深度复制（复制子节点）\n     */\n    public cloneRenderedDom(key:IRenderedDom|number,deep?:boolean):IRenderedDom{\n        let src:IRenderedDom;\n        if(typeof key === 'string'){\n            src = this.getRenderedDom(key);\n        }else{\n            src = <IRenderedDom>key;\n        }\n    \n        if(!src){\n            return null;\n        }\n        let dst:any = {\n            key:key,\n            vdom:src.vdom,\n            tagName:src.tagName,\n            staticNum:src.staticNum,\n            textContent:src.textContent,\n            moduleId:src.moduleId\n        };\n        if(src.props){\n            dst.props = {};\n            for(let k of Object.keys(src.props)){\n                dst.props[k] = src.props[k];\n            }\n        }\n        if(src.assets){\n            dst.assets = {};\n            for(let k of Object.keys(src.assets)){\n                dst.assets[k] = src.assets[k];\n            }\n        }\n\n        if(deep && src.children){\n            dst.children = [];\n            for(let c of src.children){\n                dst.children.push(this.cloneRenderedDom(c))\n            }\n        }\n        return dst;\n    }\n\n\n    /**\n     * 清除html element map 节点\n     * @param dom   dom节点，如果为空，则清空map\n     */\n    public clearElementMap(dom?:IRenderedDom){\n        if(dom){\n            this.elementMap.delete(dom.key);\n            //带自定义key的移除\n            if(dom.props && dom.props['key']){\n                this.elementMap.delete(dom.props['key']);\n            }\n        }else{\n            this.elementMap.clear();\n        }\n    }\n\n    /**\n     * 获取html node\n     * @param key   dom key \n     * @returns     html node\n     */\n    public getElement(key:number):Node{\n        return this.elementMap.get(key);\n    }\n\n    /**\n     * save html node\n     * @param key   dom key\n     * @param node  html node\n     */\n    public saveElement(key:number,node:Node){\n        this.elementMap.set(key,node);\n    }\n\n    /**\n     * 释放node\n     * 包括从dom树解挂，释放对应结点资源\n     * @param dom       虚拟dom\n     */\n    public freeNode(dom:IRenderedDom){\n        if(dom.moduleId){  //子模块\n            let m = ModuleFactory.get(dom.moduleId);\n            if(m){\n                m.unmount();\n            }\n        }else{      //普通节点\n            //从map移除\n            this.clearElementMap(dom);\n            //解绑所有事件\n            this.module.eventFactory.unbindAll(dom.key);\n            //子节点递归操作\n            if(dom.children){\n                for(let d of dom.children){\n                    this.freeNode(d);\n                }\n            }\n        }\n    }\n\n    /**\n     * 重置\n     */\n    public reset(){\n        this.renderedTree = null;\n        this.elementMap.clear();\n    }\n}","import { DefineElement } from \"../core/defineelement\";\nimport { DefineElementManager } from \"../core/defineelementmanager\";\nimport { NError } from \"../core/error\";\nimport { NodomMessage } from \"../core/nodom\";\nimport { VirtualDom } from \"../core/virtualdom\";\nimport { Directive } from \"../core/directive\";\nimport { Module } from \"../core/module\";\n\n/**\n * module 元素\n */\nclass MODULE extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        //类名\n        let clazz = node.getProp('name');\n        if (!clazz) {\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'MODULE', 'className');\n        }\n        node.delProp('name');\n        node.addDirective(new Directive('module',clazz));\n    }\n}\n\n/**\n * for 元素\n */\nclass FOR extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        //条件\n        let cond = node.getProp('cond');\n        if (!cond) {\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'FOR', 'cond');\n        }\n        node.delProp('cond');\n        node.addDirective(new Directive('repeat',cond));\n    }\n}\n/**\n * 递归元素\n */\nclass RECUR extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        //条件\n        let cond = node.getProp('cond');\n        node.delProp('cond');\n        node.addDirective(new Directive('recur',cond));\n    }\n}\n\n/**\n * IF 元素\n */\nclass IF extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        //条件\n        let cond = node.getProp('cond');\n        if (!cond) {\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'IF', 'cond');\n        }\n        node.delProp('cond');\n        node.addDirective(new Directive('if',cond));\n    }\n}\n\nclass ELSE extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        node.addDirective(new Directive('else',null));\n    }\n}\n/**\n * ELSEIF 元素\n */\nclass ELSEIF extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        //条件\n        let cond = node.getProp('cond');\n        if (!cond) {\n            throw new NError('itemnotempty', NodomMessage.TipWords['element'], 'ELSEIF', 'cond');\n        }\n        node.delProp('cond');\n        node.addDirective(new Directive('elseif',cond));\n    }\n}\n/**\n * ENDIF 元素\n */\nclass ENDIF extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        node.addDirective(new Directive('endif',null));\n    }\n}\n\n/**\n * 替代器\n */\nclass SLOT extends DefineElement{\n    constructor(node: VirtualDom,module:Module){\n        super(node);\n        //条件\n        let cond = node.getProp('name') || 'default';\n        node.delProp('name');\n        node.addDirective(new Directive('slot',cond));\n    }\n}\n\nDefineElementManager.add([MODULE,FOR,IF,RECUR,ELSE,ELSEIF,ENDIF,SLOT]);","import { NEvent } from \"../core/event\";\nimport { GlobalCache } from \"../core/globalcache\";\nimport { Model } from \"../core/model\";\nimport { ModelManager } from \"../core/modelmanager\";\nimport { Module } from \"../core/module\";\nimport { ModuleFactory } from \"../core/modulefactory\";\nimport { createDirective } from \"../core/nodom\";\nimport { Renderer } from \"../core/renderer\";\nimport { Router } from \"../core/router\";\nimport { IRenderedDom } from \"../core/types\";\nimport { Util } from \"../core/util\";\n\nexport default (function () {\n    /**\n     * 指令类型初始化\n     * 每个指令类型都有一个名字、处理函数和优先级，处理函数不能用箭头函数\n     * 处理函数在渲染时执行，包含两个参数 module(模块)、dom(目标虚拟dom)、src(源虚拟dom)\n     * 处理函数的this指向指令\n     * 处理函数的返回值 true 表示继续，false 表示后续指令不再执行 \n     */\n\n    /**\n     * module 指令\n     * 用于指定该元素为模块容器，表示子模块\n     * 用法 x-module='模块类名'\n     */\n    createDirective(\n        'module',\n        function (module: Module, dom: IRenderedDom) {\n            let m: Module;\n            //存在moduleId，表示已经渲染过，不渲染\n            let mid = module.objectManager.getDomParam(dom.key, 'moduleId');\n            if (mid) {\n                m = ModuleFactory.get(mid);\n            } else {\n                let cls = this.value;\n                if(typeof cls === 'string'){\n                    cls = cls.toLocaleLowerCase();\n                }\n                m = ModuleFactory.get(cls);\n                if (!m) {\n                    return true;\n                }\n                //设置编译源id\n                if(this.params && this.params.srcId){\n                    m.compileMid = this.params.srcId;\n                }\n                mid = m.id;\n                //保留modelId\n                module.objectManager.setDomParam(dom.key, 'moduleId', mid);\n                module.addChild(m);\n            }\n            //保存到dom上，提升渲染性能\n            dom.moduleId = mid;\n            //变成文本节点，作为子模块占位符，子模块渲染后插入到占位符前面\n            delete dom.tagName;\n            //设置props，如果改变了props，启动渲染\n            let o: any = {};\n            if (dom.props) {\n                for (let p of Object.keys(dom.props)) {\n                    let v = dom.props[p];\n                    if (p[0] === '$') { //数据\n                        if (!o.$data) {\n                            o.$data = {};\n                        }\n                        o.$data[p.substring(1)] = v;\n                        //删除属性\n                        delete dom.props[p];\n                    } else {\n                        o[p] = v;\n                    }\n                }\n            }\n            //传递给模块\n            m.setProps(o, dom);\n            return true;\n        },\n        8\n    );\n\n    /**\n     *  model指令\n     */\n    createDirective(\n        'model',\n        function (module: Module, dom: IRenderedDom) {\n            let model: Model = module.get(this.value,dom.model);\n            if (model) {\n                dom.model = model;\n            }\n            return true;\n        },\n        1\n    );\n\n    /**\n     * 指令名 repeat\n     * 描述：重复指令\n     */\n    createDirective(\n        'repeat',\n        function (module: Module, dom: IRenderedDom) {\n            let rows = this.value;\n            // 无数据，不渲染\n            if (!Util.isArray(rows) || rows.length === 0) {\n                return false;\n            }\n            const src = dom.vdom;\n            //索引名\n            const idxName = src.getProp('index');\n            const parent = dom.parent;\n            //禁用该指令\n            this.disabled = true;\n            //避免在渲染时对src设置了model，此处需要删除\n            delete src.model;\n            for (let i = 0; i < rows.length; i++) {\n                if(!rows[i]){\n                    continue;\n                }\n                if (idxName) {\n                    rows[i][idxName] = i;\n                }\n                //渲染一次-1，所以需要+1\n                src.staticNum++;\n                let d = Renderer.renderDom(module, src, rows[i], parent, rows[i].__key);\n                //删除$index属性\n                if (idxName) {\n                    delete d.props['index'];\n                }\n            }\n            //启用该指令\n            this.disabled = false;\n            return false;\n        },\n        2\n    );\n\n    /**\n     * 递归指令\n     * 作用：在dom内部递归，用于具有相同数据结构的节点递归生成\n     * 递归指令不允许嵌套\n     * name表示递归名字，必须与内部的recur标签的ref保持一致，名字默认为default\n     * 典型模版\n     * ```\n     * <recur name='r1'>\n     *      <div>...</div>\n     *      <p>...</p>\n     *      <recur ref='r1' />\n     * </recur>\n     * ```\n     */\n    createDirective(\n        'recur',\n        function (module: Module, dom: IRenderedDom) {\n            const src = dom.vdom;\n            //当前节点是递归节点存放容器\n            if (dom.props.hasOwnProperty('ref')) {\n                //如果出现在repeat中，src为单例，需要在使用前清空子节点，避免沿用上次的子节点\n                src.children = [];\n                //递归存储名\n                const name = '$recurs.' + (dom.props['ref'] || 'default');\n                let node = module.objectManager.get(name);\n                if (!node) {\n                    return true;\n                }\n                let model = dom.model;\n                let cond = node.getDirective('recur');\n                let m = model[cond.value];\n                //不存在子层数组，不再递归\n                if (!m) {\n                    return true;\n                }\n\n                //克隆，后续可以继续用\n                let node1 = node.clone();\n                //recur子节点不为数组，依赖子层数据，否则依赖repeat数据\n                if (!Array.isArray(m)) {  \n                    node1.model = m;\n                    //避免key相同，进行子节点key处理\n                    Util.setNodeKey(node1, m.__key, true);\n                }\n                src.children = [node1];\n                node1.parent = src;\n            } else { //递归节点\n                let data = dom.model[this.value];\n                if (!data) {\n                    return true;\n                }\n                //递归名，默认default\n                const name = '$recurs.' + (dom.props['name'] || 'default');\n                if (!module.objectManager.get(name)) {\n                    module.objectManager.set(name, src);\n                }\n            }\n            return true;\n        },\n        2\n    );\n\n    /**\n     * 指令名 if\n     * 描述：条件指令\n     */\n    createDirective('if',\n        function (module: Module, dom: IRenderedDom) {\n            if(!dom.parent){\n                return;\n            }\n            module.objectManager.setDomParam(dom.parent.key, '$if', this.value);\n            return this.value;\n        },\n        5\n    );\n\n    /**\n     * 指令名 else\n     * 描述：else指令\n     */\n    createDirective(\n        'else',\n        function (module: Module, dom: IRenderedDom) {\n            if(!dom.parent){\n                return;\n            }\n            return  !module.objectManager.getDomParam(dom.parent.key, '$if');\n        },\n        5\n    );\n\n    /**\n     * elseif 指令\n     */\n    createDirective('elseif',\n        function (module: Module, dom: IRenderedDom) {\n            if(!dom.parent){\n                return;\n            }\n            let v = module.objectManager.getDomParam(dom.parent.key, '$if');\n            if (v === true) {\n                return false;\n            } else {\n                if (!this.value) {\n                    return false;\n                } else {\n                    module.objectManager.setDomParam(dom.parent.key, '$if', true);\n                }\n            }\n            return true;\n        },\n        5\n    );\n\n    /**\n     * elseif 指令\n     */\n    createDirective(\n        'endif',\n        function (module: Module, dom: IRenderedDom) {\n            if(!dom.parent){\n                return;\n            }\n            module.objectManager.removeDomParam(dom.parent.key, '$if');\n            //endif 不显示\n            return false;\n        },\n        5\n    );\n\n    /**\n     * 指令名 show\n     * 描述：显示指令\n     */\n    createDirective(\n        'show',\n        function (module: Module, dom: IRenderedDom) {\n            //show指令参数 {origin:通过style设置的初始display属性,rendered:是否渲染过}\n            let showParam = module.objectManager.getDomParam(dom.key, '$show');\n            //为false且未渲染过，则不渲染\n            if(!this.value && (!showParam || !showParam.rendered)){\n                return false;\n            }\n            if(!showParam){\n                showParam = {};\n                module.objectManager.setDomParam(dom.key, '$show',showParam);\n            }\n            let style = dom.props['style'];\n            const reg =  /display\\s*\\:[\\w\\-]+/;\n            let regResult;\n            let display;\n            if(style){\n                regResult = reg.exec(style);\n                //保存第一个style display属性\n                if(regResult !== null){\n                    let ra = regResult[0].split(':');\n                    display = ra[1].trim();\n                    //保存第一个display属性\n                    if(!showParam.origin && display !== 'none'){\n                        showParam.origin = display;\n                    }\n                }\n            }\n\n            // 渲染标识，value为false且尚未进行渲染，则不渲染\n            if(!this.value){  \n                if(style){\n                    if(display){\n                        //把之前的display替换为none\n                        if(display!=='none'){\n                            style = style.substring(0,regResult.index) + 'display:none' + style.substring(regResult.index + regResult[0].length);\n                        }\n                    }else{\n                        style += ';display:none';\n                    }\n                }else{\n                    style = 'display:none';\n                }\n            }else{\n                //设置渲染标志\n                showParam.rendered = true;\n                if(display === 'none'){\n                    if(showParam.origin){\n                        style = style.substring(0,regResult.index) + 'display:' + showParam.origin + style.substring(regResult.index + regResult[0].length);\n                    }else{\n                        style = style.substring(0,regResult.index) + style.substring(regResult.index + regResult[0].length);\n                    }\n                }\n            }\n            if(style){\n                dom.props['style'] = style;\n            }\n            return true;\n        },\n        5\n    );\n\n    /**\n     * 指令名 field\n     * 描述：字段指令\n     */\n    createDirective('field',\n        function (module: Module, dom: IRenderedDom) {\n            const type: string = dom.props['type'] || 'text';\n            const tgname = dom.tagName.toLowerCase();\n            const model = dom.model;\n            if (!model) {\n                return true;\n            }\n            let dataValue = module.get(this.value,model);\n            if (type === 'radio') {\n                let value = dom.props['value'];\n                if (dataValue == value) {\n                    dom.props['checked'] = 'checked';\n                    Util.setDomAsset(dom, 'checked', true);\n                } else {\n                    delete dom.props['checked'];\n                    Util.setDomAsset(dom, 'checked', false);\n                }\n            } else if (type === 'checkbox') {\n                //设置状态和value\n                let yv = dom.props['yes-value'];\n                //当前值为yes-value\n                if (dataValue == yv) {\n                    dom.props['value'] = yv;\n                    Util.setDomAsset(dom, 'checked', true);\n                } else { //当前值为no-value\n                    dom.props['value'] = dom.props['no-value'];\n                    Util.setDomAsset(dom, 'checked', false);\n                }\n            } else if (tgname === 'select') { //下拉框\n                dom.props['value'] = dataValue;\n                Util.setDomAsset(dom, 'value', dataValue);\n            } else {\n                let v = (dataValue !== undefined && dataValue !== null) ? dataValue : '';\n                dom.props['value'] = v;\n                Util.setDomAsset(dom, 'value', v);\n            }\n            let event: NEvent = GlobalCache.get('$fieldChangeEvent');\n            if (!event) {\n                event = new NEvent(null, 'change',\n                    function (model, dom) {\n                        const el = <any>this.getElement(dom.key);\n                        if (!el) {\n                            return;\n                        }\n                        let directive = dom.vdom.getDirective('field');\n                        let type = dom.props['type'];\n                        let field = directive.value;\n                        let v = el.value;\n\n                        //根据选中状态设置checkbox的value\n                        if (type === 'checkbox') {\n                            if (dom.props['yes-value'] == v) {\n                                v = dom.props['no-value'];\n                            } else {\n                                v = dom.props['yes-value'];\n                            }\n                        } else if (type === 'radio') {\n                            if (!el.checked) {\n                                v = undefined;\n                            }\n                        }\n\n                        //修改字段值,需要处理.运算符\n                        let arr = field.split('.')\n                        if (arr.length === 1) {\n                            model[field] = v;\n                        } else {\n                            let temp = model;\n                            field = arr.pop();\n                            for (let i = 0; i < arr.length && temp; i++) {\n                                temp = temp[arr[i]];\n                            }\n                            if (temp) {\n                                temp[field] = v;\n                            }\n                        }\n                    }\n                );\n                GlobalCache.set('$fieldChangeEvent', event);\n            }\n            dom.vdom.addEvent(event);\n            return true;\n        },\n        10\n    );\n\n    /**\n     * route指令\n     */\n    createDirective('route',\n        function (module: Module, dom: IRenderedDom) {\n            //a标签需要设置href\n            if (dom.tagName.toLowerCase() === 'a') {\n                dom.props['href'] = 'javascript:void(0)';\n            }\n            dom.props['path'] = this.value;\n            //有激活属性\n            if (dom.props['active']) {\n                let acName = dom.props['active'];\n                delete dom.props['active'];\n                //active 转expression\n                Router.addActiveField(module, this.value, dom.model, acName);\n                if ((Router.currentPath&&this.value.startsWith(Router.currentPath)||!Router.currentPath) && dom.model[acName]) {\n                    Router.go(this.value);\n                }\n            }\n\n            //添加click事件,避免重复创建事件对象，创建后缓存\n            let event: NEvent = GlobalCache.get('$routeClickEvent');\n            if (!event) {\n                event = new NEvent(null, 'click',\n                    function (model, dom, evObj, e) {\n                        let path = dom.props['path'];\n                        if (Util.isEmpty(path)) {\n                            return;\n                        }\n                        Router.go(path);\n                    }\n                );\n                GlobalCache.set('$routeClickEvent', event);\n            }\n            //为virtual dom添加事件\n            dom.vdom.addEvent(event);\n            return true;\n        },\n        10\n    );\n\n    /**\n     * 增加router指令\n     */\n    createDirective('router',\n        function (module: Module, dom: IRenderedDom) {\n            Router.routerKeyMap.set(module.id, dom.key);\n            return true;\n        },\n        10\n    );\n\n    /**\n     * 插头指令\n     * 用于模块中，可实现同名替换\n     */\n    createDirective('slot',\n        function (module: Module, dom: IRenderedDom) {\n            this.value = this.value || 'default';\n            let mid = dom.parent.moduleId;\n            const src = dom.vdom;\n            //父dom有module指令，表示为替代节点，替换子模块中的对应的slot节点；否则为子模块定义slot节点\n            if (mid) {\n                let m = ModuleFactory.get(mid);\n                if (m) {\n                    //缓存当前替换节点\n                    m.objectManager.set('$slots.' + this.value, { dom: src, model: dom.model });\n                }\n            } else { //源slot节点\n                //获取替换节点进行替换，如果没有，则渲染子节点\n                const cfg = module.objectManager.get('$slots.' + this.value);\n                const children = cfg?cfg.dom.children:src.children;\n                if(children){\n                    for (let d of children) {\n                        let model;\n                        if (src.hasProp('innerrender') ) {  //内部数据渲染\n                            model = dom.model;\n                        }else if(cfg){  //外部数据渲染\n                            model = cfg.model;\n                            //绑定数据\n                            model.__module.modelManager.bindModel(model,module);\n                        }\n                        //以dom key作为附加key\n                        Renderer.renderDom(module, d, model, dom.parent, src.key+'s');\n                    }\n                }\n            }\n            return false;\n        },\n        5\n    );\n\n    /**\n     * 指令名 \n     * 描述：动画指令\n     */\n    createDirective('animation',\n        function (module: Module, dom: IRenderedDom) {\n\n            const confObj = this.value\n            if (!Util.isObject(confObj)) {\n                return new Error('未找到animation配置对象');\n            }\n\n            // 获得tigger\n            const tigger = confObj.tigger == false ? false : true;\n\n            // 用于判断是动画还是过渡\n            const type = confObj.type || \"transition\";\n            // 用于判断是否是 进入/离开动画 \n            const isAppear = confObj.isAppear == false ? false : true;\n\n            // 提取 动画/过渡 名\n            const nameEnter = confObj.name?.enter || confObj.name;\n            const nameLeave = confObj.name?.leave || confObj.name;\n\n            // 提取 动画/过渡 持续时间\n            const durationEnter = confObj.duration?.enter || confObj.duration || '';\n            const durationLeave = confObj.duration?.leavr || confObj.duration || '';\n\n            // 提取 动画/过渡 延迟时间\n            const delayEnter = confObj.delay?.enter || confObj.delay || '0s';\n            const delayLeave = confObj.delay?.leave || confObj.delay || '0s';\n\n            // 提取 动画/过渡 时间函数\n            const timingFunctionEnter = confObj.timingFunction?.enter || confObj.timingFunction || 'ease';\n            const timingFunctionLeave = confObj.timingFunction?.leave || confObj.timingFunction || 'ease';\n\n            // 提取动画/过渡 钩子函数\n            const beforeEnter =\n                confObj.hooks?.enter?.before ? confObj.hooks.enter.before : confObj.hooks?.before || undefined;\n            const afterEnter =\n                confObj.hooks?.enter?.after ? confObj.hooks.enter.after : confObj.hooks?.after || undefined;\n            const beforeLeave =\n                confObj.hooks?.leave?.before ? confObj.hooks.leave.before : confObj.hooks?.before || undefined;\n            const afterLeave =\n                confObj.hooks?.leave?.after ? confObj.hooks.leave.after : confObj.hooks?.after || undefined;\n\n            // 定义动画或者过渡结束回调。\n            let handler = () => {\n                const el: HTMLElement = <HTMLElement>module.getElement(dom.key)\n                // 离开动画结束之后隐藏元素\n                if (!tigger) {\n                    if (isAppear) {\n                        // 离开动画结束之后 把元素隐藏\n                        el.style.display = 'none';\n                    }\n                    if (afterLeave) {\n                        afterLeave.apply(module.model, [module]);\n                    }\n                    // 这里如果style里面写了width和height 那么给他恢复成他写的，不然\n                    [el.style.width, el.style.height] = getOriginalWidthAndHeight(dom);\n                    // 结束之后删除掉离开动画相关的类\n                    el.classList.remove(nameLeave + '-leave-active')\n                    if (type == 'animation') {\n                        el.classList.add(nameLeave + '-leave-to')\n                    }\n                } else {\n                    if (afterEnter) {\n                        afterEnter.apply(module.model, [module]);\n                    }\n                    // 进入动画结束之后删除掉相关的类\n                    el.classList.remove(nameEnter + '-enter-active')\n                    if (type == 'animation') {\n                        el.classList.add(nameEnter + '-enter-to')\n                    }\n                }\n                // 清除事件监听\n                el.removeEventListener('animationend', handler);\n                el.removeEventListener('transitionend', handler);\n            }\n\n            // 获得真实dom\n            let el: HTMLElement = <HTMLElement>module.getElement(dom.key);\n\n        if (!tigger) {\n                // tigger为false 播放Leave动画\n                if (el) {\n                    if (el.getAttribute('class').indexOf(`${nameLeave}-leave-to`) != -1) {\n                        // 当前已经处于leave动画播放完成之后，若是进入离开动画，这时候需要他保持隐藏状态。\n                        dom.props['class'] += ` ${nameLeave}-leave-to`;\n                        if (isAppear) {\n                            dom.props[\"style\"]\n                                ? (dom.props[\"style\"] += \";display:none;\")\n                                : (dom.props[\"style\"] = \"display:none;\");\n                        }\n                        return true;\n                    }\n                    // // 确保在触发动画之前还是隐藏状态\n                    // 调用函数触发 Leave动画/过渡\n                    changeStateFromShowToHide(el);\n                    return true;\n                } else {\n                    // el不存在，第一次渲染\n                    if (isAppear) {\n                        // 是进入离开动画，管理初次渲染的状态，让他隐藏\n                        dom.props[\"style\"]\n                            ? (dom.props[\"style\"] += \";display:none;\")\n                            : (dom.props[\"style\"] = \"display:none;\");\n                    }\n\n                    // 下一帧\n                    setTimeout(() => {\n                        // el已经渲染出来，取得el 根据动画/过渡的类型来做不同的事\n                        let el: HTMLElement = <HTMLElement>module.getElement(dom.key)\n                        if (isAppear) {\n                            // 动画/过渡 是进入离开动画/过渡，并且当前是需要让他隐藏所以我们不播放动画，直接隐藏。\n                            el.classList.add(`${nameLeave}-leave-to`)\n                            // 这里必须将这个属性加入到dom中,否则该模块其他数据变化触发增量渲染时,diff会将这个节点重新渲染,导致显示异常\n                            // 这里添加添加属性是为了避免diff算法重新渲染该节点\n                            dom.props['class'] += ` ${nameLeave}-leave-to`;\n                            el.style.display = 'none'\n                        } else {\n                            //  动画/过渡 是 **非进入离开动画/过渡** 我们不管理元素的隐藏，所以我们让他播放一次Leave动画。\n                            changeStateFromShowToHide(el);\n                        }\n                    }, 0);\n                }\n                // 通过虚拟dom将元素渲染出来\n                return true\n            } else {\n                // tigger为true 播放Enter动画\n                if (el) {\n                    if (el.getAttribute('class').indexOf(`${nameEnter}-enter-to`) != -1) {\n                        // 这里不需要像tigger=false时那样处理，这时候他已经处于进入动画播放完毕状态，\n                        // 模块内其他数据变化引起该指令重新执行，这时候需要他保持现在显示的状态，直接返回true\n                        dom.props['class'] += ` ${nameEnter}-enter-to`;\n                        return true;\n                    }\n                    if (isAppear) {\n                        // 如果是进入离开动画，在播放enter动画之前确保该元素是隐藏状态\n                        // 确保就算diff更新了该dom还是有隐藏属性\n                        dom.props[\"style\"]\n                            ? (dom.props[\"style\"] += \";display:none;\")\n                            : (dom.props[\"style\"] = \"display:none;\");\n                    }\n                    // 调用函数触发Enter动画/过渡\n                    changeStateFromHideToShow(el);\n                } else {\n                    // el不存在，是初次渲染\n                    if (isAppear) {\n                        // 管理初次渲染元素的隐藏显示状态\n                        dom.props[\"style\"]\n                            ? (dom.props[\"style\"] += \";display:none;\")\n                            : (dom.props[\"style\"] = \"display:none;\");\n                    }\n                    // 下一帧\n                    setTimeout(() => {\n                        // 等虚拟dom把元素更新上去了之后，取得元素\n                        let el: HTMLElement = <HTMLElement>module.getElement(dom.key)\n                        if (isAppear) {\n                            // 这里必须将这个属性加入到dom中,否则该模块其他数据变化触发增量渲染时,diff会将这个节点重新渲染,导致显示异常\n                            // 这里添加添加属性是为了避免diff算法重新渲染该节点\n                            dom.props['class'] += ` ${nameEnter}-enter-to`;\n                            el.style.display = 'none';\n                        }\n                        // Enter动画与Leave动画不同，\n                        // 不管动画是不是进入离开动画，在初次渲染的时候都要执行一遍动画\n                        // Leave动画不一样，如果是开始离开动画，并且初次渲染的时候需要隐藏，那么我们没有必要播放一遍离开动画\n                        changeStateFromHideToShow(el);\n                    }, 0);\n                }\n                // 通过虚拟dom将元素渲染出来\n                return true\n            }\n            /**\n             * 播放Leave动画\n             * @param el 真实dom\n             */\n            function changeStateFromShowToHide(el: HTMLElement) {\n                // 动画类型是transitiojn\n                if (type == 'transition') {\n                    // 前面已经对transition的初始状态进行了设置，我们需要在下一帧设置结束状态才能触发过渡\n\n                    // 获得宽高的值 因为 宽高的auto 百分比 calc计算值都无法拿来触发动画或者过渡。\n                    let [width, height] = getElRealSzie(el);\n                    // setTimeout(() => {\n                    requestAnimationFrame(() => {\n                        // 移除掉上一次过渡的最终状态\n                        el.classList.remove(nameEnter + '-enter-to')\n\n                        // 设置过渡的类名\n                        el.classList.add(nameLeave + '-leave-active');\n\n                        // 设置离开过渡的开始类\n                        el.classList.add(nameLeave + '-leave-from');\n\n                        // fold过渡的开始状态\n                        if (nameLeave == 'fold-height') {\n                            el.style.height = height;\n                        } else if (nameLeave == 'fold-width') {\n                            el.style.width = width;\n                        }\n\n                        // 处理离开过渡的延时\n                        el.style.transitionDelay = delayEnter;\n                        // 处理过渡的持续时间\n                        if (durationEnter != '') {\n                            el.style.transitionDuration = durationEnter;\n                        }\n                        // 处理过渡的时间函数\n                        if (timingFunctionEnter != 'ease') {\n                            el.style.transitionTimingFunction = timingFunctionEnter;\n                        }\n                        // 在触发过渡之前执行hook\n                        if (beforeLeave) {\n                            beforeLeave.apply(module.model, [module]);\n                        }\n                        requestAnimationFrame(() => {\n                            // 添加结束状态\n                            el.classList.add(nameLeave + '-leave-to');\n                            // 在动画或者过渡开始之前移除掉初始状态\n                            el.classList.remove(nameLeave + '-leave-from');\n\n                            if (nameLeave == 'fold-height') {\n                                el.style.height = '0px';\n                            } else if (nameLeave == 'fold-width') {\n                                el.style.width = '0px';\n                            }\n                            // 添加过渡结束事件监听\n                            el.addEventListener('transitionend', handler);\n                        })\n\n                    });\n                } else {\n                    requestAnimationFrame(() => {\n                        // 动画类型是aniamtion\n                        el.classList.remove(nameEnter + '-enter-to');\n\n                        // 动画延时时间\n                        el.style.animationDelay = delayLeave;\n\n                        // 动画持续时间\n                        if (durationLeave != '') {\n                            el.style.animationDuration = durationLeave;\n                        }\n\n                        if (timingFunctionLeave != 'ease') {\n                            el.style.animationTimingFunction = timingFunctionLeave;\n                        }\n                        // 在触发动画之前执行hook\n                        if (beforeLeave) {\n                            beforeLeave.apply(module.model, [module]);\n                        }\n                        // 触发一次回流reflow\n                        void el.offsetWidth;\n                        // 添加动画类名\n                        el.classList.add(nameLeave + '-leave-active');\n                        //添加动画结束时间监听\n                        el.addEventListener('animationend', handler);\n                        // })\n                    })\n                }\n            }\n\n            /**\n             * 播放Enter动画\n             * @param el 真实dom\n             */\n            function changeStateFromHideToShow(el: HTMLElement) {\n                // 动画类型是transition\n                if (type == 'transition') {\n                    // 对于进入/离开动画\n                    // Enter过渡的延迟时间与Leave过渡的延迟时间处理不一样\n                    // 我们这里把延迟统一设置成0s，然后通过定时器来设置延时，\n                    // 这样可以避免先渲染一片空白区域占位，然后再延时一段时间执行过渡效果。\n\n                    el.style.transitionDelay = '0s';\n                    let delay = parseFloat(delayEnter) * 1000;\n                    setTimeout(() => {\n\n                        let [width, height] = getElRealSzie(el);\n                        // 在第一帧设置初始状态\n                        // 移除掉上一次过渡的最终状态\n                        el.classList.remove(nameLeave + '-leave-to');\n                        // 添加过渡的类名\n                        el.classList.add(nameEnter + '-enter-active');\n                        // 给进入过渡设置开始类名\n                        el.classList.add(nameEnter + '-enter-from');\n                        // 获得元素的真实尺寸\n                        if (nameEnter == 'fold-height') {\n                            el.style.height = '0px'\n                        } else if (nameEnter == 'fold-width') {\n                            el.style.width = '0px'\n                        }\n                        // 设置过渡持续时间\n                        if (durationEnter != '') {\n                            el.style.transitionDuration = durationEnter;\n                        }\n                        // 设置过渡时间函数\n                        if (timingFunctionEnter != 'ease') {\n                            el.style.transitionTimingFunction = timingFunctionEnter;\n                        }\n                        // 第二帧将带有初始状态的元素显示出来,如果不开这一帧那么fade的进入过渡在初次渲染的时候会被当作离开过渡触发。\n                        requestAnimationFrame(() => {\n                            // 下一帧请求过渡效果\n                            // 过渡开始之前先将元素显示\n                            if (isAppear) {\n                                el.style.display = '';\n                            }\n                            // 第三帧触发过渡\n                            requestAnimationFrame(() => {\n                                if (beforeEnter) {\n                                    beforeEnter.apply(module.model, [module]);\n                                }\n                                // 增加 过渡 结束类名\n                                el.classList.add(nameEnter + '-enter-to');\n                                // 移除过渡的开始类名\n                                el.classList.remove(nameEnter + '-enter-from');\n\n                                if (nameEnter == 'fold-height') {\n                                    el.style.height = height;\n                                } else if (nameEnter == 'fold-width') {\n                                    el.style.width = width;\n                                }\n                                el.addEventListener('transitionend', handler);\n                            })\n                        })\n                    }, delay);\n                } else {\n                    // 动画类型是aniamtion\n                    // 这里动画的延迟时间也与过渡类似的处理方式。\n                    el.style.animationDelay = \"0s\";\n                    let delay = parseFloat(delayEnter) * 1000;\n                    setTimeout(() => {\n                        // 动画开始之前先将元素显示\n                        requestAnimationFrame(() => {\n                            el.classList.remove(nameLeave + '-leave-to');\n\n                            // 设置动画的持续时间\n                            if (durationEnter != '') {\n                                el.style.animationDuration = durationEnter;\n                            }\n\n                            // 设置动画的时间函数\n                            if (timingFunctionEnter != 'ease') {\n                                el.style.animationTimingFunction = durationEnter;\n                            }\n                            if (isAppear) {\n                                el.style.display = '';\n                            }\n                            // 在触发过渡之前执行hook \n                            if (beforeEnter) {\n                                beforeEnter.apply(module.model, [module]);\n                            }\n                            // 触发一次回流reflow\n                            void el.offsetWidth;\n                            // 重新添加类名\n                            el.classList.add(nameEnter + '-enter-active');\n                            el.addEventListener('animationend', handler);\n                        })\n                    }, delay);\n                }\n            }\n\n            /**\n             * 获取真实dom绘制出来之后的宽高\n             * @param el 真实dom\n             * @returns 真实dom绘制出来之后的宽高\n             */\n            function getElRealSzie(el: HTMLElement) {\n                if (el.style.display == 'none') {\n                    // 获取原先的\n                    const position = window.getComputedStyle(el).getPropertyValue(\"position\")\n                    const vis = window.getComputedStyle(el).getPropertyValue(\"visibility\")\n\n                    // 先脱流\n                    el.style.position = 'absolute';\n                    // 然后将元素变为\n                    el.style.visibility = 'hidden';\n\n                    el.style.display = '';\n\n                    let width = window.getComputedStyle(el).getPropertyValue(\"width\");\n                    let height = window.getComputedStyle(el).getPropertyValue(\"height\");\n\n                    // 还原样式\n                    el.style.position = position;\n                    el.style.visibility = vis;\n                    el.style.display = 'none';\n\n                    return [width, height]\n                } else {\n                    let width = window.getComputedStyle(el).getPropertyValue(\"width\");\n                    let height = window.getComputedStyle(el).getPropertyValue(\"height\");\n                    return [width, height]\n                }\n            }\n\n            /**\n             * 如果dom上得style里面有width/height\n             * @param dom 虚拟dom\n             * @returns 获得模板上的width/height 如果没有则返回空字符串\n             */\n            function getOriginalWidthAndHeight(dom: IRenderedDom): Array<string> {\n                const oStyle = dom.vdom.getProp('style');\n                let width: string;\n                let height: string;\n                if (oStyle) {\n                    let arr = oStyle.trim().split(/;\\s*/);\n                    for (const a of arr) {\n                        if (a.startsWith('width')) {\n                            width = a.split(\":\")[1];\n                        }\n                        if (a.startsWith('height')) {\n                            height = a.split(':')[1];\n                        }\n                    }\n                }\n                width = width || '';\n                height = height || '';\n                return [width, height];\n            }\n        },\n        10\n    );\n}());\n","import { NEvent } from \"../core/event\";\nimport { Module } from \"../core/module\";\nimport { EventManager } from \"../core/eventmanager\";\nimport { IRenderedDom } from \"../core/types\";\n\n/**\n * tap事件\n */\nEventManager.regist('tap',{\n    touchstart(dom:IRenderedDom,module:Module,evtObj:NEvent,e: TouchEvent) {\n        let tch = e.touches[0];\n        evtObj.dependEvent.setParam(module,dom,'pos', { sx: tch.pageX, sy: tch.pageY, t: Date.now() });\n    },\n    touchmove(dom:IRenderedDom,module:Module,evtObj:NEvent,e: TouchEvent) {\n        let pos = evtObj.dependEvent.getParam(module,dom,'pos');\n        if(!pos){\n            return;\n        }\n        let tch = e.touches[0];\n        let dx = tch.pageX - pos.sx;\n        let dy = tch.pageY - pos.sy;\n        //判断是否移动\n        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) {\n            pos.move = true;\n        }\n    },\n    touchend(dom:IRenderedDom,module:Module,evtObj:NEvent,e: TouchEvent) {\n        let pos = evtObj.dependEvent.getParam(module,dom,'pos');\n        if(!pos){\n            return;\n        }\n        evtObj.dependEvent.removeParam(module,dom,'pos');\n        let dt = Date.now() - pos.t;\n        \n        //点下时间不超过200ms,触发事件\n        if (!pos.move && dt < 200) {\n            let foo = evtObj.dependEvent.handler;\n            if(typeof foo === 'string'){\n                module.invokeMethod(<string>evtObj.dependEvent.handler,dom.model,dom,evtObj.dependEvent,e);\n            }else{\n                foo.apply(module,[dom.model,dom,evtObj.dependEvent,e]);\n            }\n        }\n    }\n});\n\n/**\n * swipe事件\n */\n EventManager.regist('swipe',{\n    touchstart(dom:IRenderedDom,module:Module,evtObj:NEvent,e: TouchEvent){\n        let tch = e.touches[0];\n        let t = Date.now();\n        evtObj.dependEvent.setParam(module,dom,'swipe', {\n            oldTime: [t, t],\n            speedLoc: [{ x: tch.pageX, y: tch.pageY }, { x: tch.pageX, y: tch.pageY }],\n            oldLoc: { x: tch.pageX, y: tch.pageY }\n        });\n    },\n    touchmove(dom:IRenderedDom,module:Module,evtObj:NEvent,e: TouchEvent){\n        let nt = Date.now();\n        let tch = e.touches[0];\n        let mv = evtObj.dependEvent.getParam(module,dom,'swipe');\n        //50ms记录一次\n        if (nt - mv.oldTime[1] > 50) {\n            mv.speedLoc[0] = { x: mv.speedLoc[1].x, y: mv.speedLoc[1].y };\n            mv.speedLoc[1] = { x: tch.pageX, y: tch.pageY };\n            mv.oldTime[0] = mv.oldTime[1];\n            mv.oldTime[1] = nt;\n        }\n        mv.oldLoc = { x: tch.pageX, y: tch.pageY };\n    },\n    touchend(dom:IRenderedDom,module:Module,evtObj:NEvent,e: any){\n        let mv = evtObj.dependEvent.getParam(module,dom,'swipe');\n        let nt = Date.now();\n\n        //取值序号 0 或 1，默认1，如果释放时间与上次事件太短，则取0\n        let ind = (nt - mv.oldTime[1] < 30) ? 0 : 1;\n        let dx = mv.oldLoc.x - mv.speedLoc[ind].x;\n        let dy = mv.oldLoc.y - mv.speedLoc[ind].y;\n        let s = Math.sqrt(dx * dx + dy * dy);\n        let dt = nt - mv.oldTime[ind];\n        //超过300ms 不执行事件\n        if (dt > 300 || s < 10) {\n            return;\n        }\n        let v0 = s / dt;\n        //速度>0.1,触发swipe事件\n        if (v0 > 0.05) {\n            let sname = '';\n            if (dx < 0 && Math.abs(dy / dx) < 1) {\n                e.v0 = v0; //添加附加参数到e\n                sname = 'swipeleft';\n            }\n            if (dx > 0 && Math.abs(dy / dx) < 1) {\n                e.v0 = v0;\n                sname = 'swiperight';\n            }\n            if (dy > 0 && Math.abs(dx / dy) < 1) {\n                e.v0 = v0;\n                sname = 'swipedown';\n            }\n            if (dy < 0 && Math.abs(dx / dy) < 1) {\n                e.v0 = v0;\n                sname = 'swipeup';\n            }\n            //处理swipe\n            if (evtObj.dependEvent.name === sname) {\n                let foo = evtObj.dependEvent.handler;\n                if(typeof foo === 'string'){\n                    module.invokeMethod(foo,dom.model, dom,evtObj.dependEvent, e);\n                }else if(typeof foo === 'function'){\n                    foo.apply(module,[dom.model,dom,evtObj.dependEvent,e]);\n                }\n            }\n        }\n    }\n});\n\n//把swpie注册到4个方向\nEventManager.regist('swipeleft',EventManager.get('swipe'));\nEventManager.regist('swiperight',EventManager.get('swipe'));\nEventManager.regist('swipeup',EventManager.get('swipe'));\nEventManager.regist('swipedown',EventManager.get('swipe'));\n\n/**\n * double click\n */\nEventManager.regist('dblclick',{\n    click(dom:IRenderedDom,module:Module,evtObj:NEvent,e: MouseEvent) {\n        let firstClick = evtObj.dependEvent.getParam(module,dom,'firstClick');\n        if(firstClick){\n            let t = Date.now();\n            //两次点击在300ms内，视为双击\n            if(t - firstClick < 300){\n                let foo = evtObj.dependEvent.handler;\n                if(typeof foo === 'string'){\n                    module.invokeMethod(<string>evtObj.dependEvent.handler,dom.model,dom,evtObj.dependEvent,e);\n                }else{\n                    foo.apply(module,[dom.model,dom,evtObj.dependEvent,e]);\n                }\n            }\n        }else{\n            evtObj.dependEvent.setParam(module,dom,'firstClick', Date.now());\n        }\n        \n        //延迟清理firstClick\n        setTimeout(()=>{\n            evtObj.dependEvent.removeParam(module,dom,'firstClick')\n        },500);\n        \n        \n    },\n    \n});","import { Compiler } from \"./compiler\";\nimport { CssManager } from \"./cssmanager\";\nimport { Model } from \"./model\";\nimport { ModuleFactory } from \"./modulefactory\";\nimport { ObjectManager } from \"./objectmanager\";\nimport { Renderer } from \"./renderer\";\nimport { Util } from \"./util\";\nimport { DiffTool } from \"./difftool\";\nimport { EModuleState, IRenderedDom } from \"./types\";\nimport { EventFactory } from \"./eventfactory\";\nimport { DomManager } from \"./dommanager\";\nimport { ModelManager } from \"./modelmanager\";\nimport { VirtualDom } from \"./virtualdom\";\nimport { NEvent } from \"./event\";\n\n\n/**\n * 模块类\n * 模块方法说明：模板内使用的方法，包括事件，都直接在模块内定义\n *      方法this：指向module实例\n *      事件参数: model(当前按钮对应model),dom(事件对应虚拟dom),eventObj(事件对象),e(实际触发的html event)\n *      表达式方法：参数按照表达式方式给定即可\n * 模块事件\n *      onBeforeFirstRender 首次渲染前\n *      onFirstRender       首次渲染后\n *      onBeforeRender      增量渲染前\n *      onRender            增量渲染后\n *      onCompile           编译后\n *      onBeforeMount       挂载到html dom树前（onFirstRender渲染后）\n *      onMount             挂载到html dom树后(首次渲染到html树后)\n *      onBeforeUnMount     从html dom树解挂前\n *      onUnmount           从html dom树解挂后\n *      onBeforeUpdate      更新到html dom树前（onRender后，针对增量渲染）\n *      onUpdate            更新到html dom树后（针对增量渲染）\n */\nexport class Module {\n    /**\n     * 模块id(全局唯一)\n     */\n    public id: number;\n\n    /**\n     * 模型，代理过的data\n     */\n    public model:Model;\n\n    /**\n     * 子模块类集合，模板中引用的模块类需要声明\n     * 如果类已经通过registModule注册过，这里不再需要定义，只需import即可\n     */\n    public modules: any;\n\n    /**\n     * 父模块通过dom节点传递的属性\n     */\n    public props:any;\n\n    /**\n     * 编译后的根结点props\n     */\n    private originProps:Map<string,any> = new Map<string,any>();\n\n    /**\n     * 更改后的props\n     */\n    private changedProps:any;\n\n    /**\n     * dom 管理器，管理虚拟dom、渲染dom和html node\n     */\n    public domManager:DomManager;\n\n    /**\n     * 不渲染的属性（这些属性用于生产模板，不作为属性渲染到模块根节点）\n     */\n    private excludedProps:string[];\n\n    /**\n     * 父模块 id\n     */\n    public parentId: number;\n\n    /**\n     * 子模块id数组\n     */\n    public children: Array<number> = [];\n\n    /**\n     * 模块状态\n     */\n    public state: EModuleState;\n\n    /**\n     * 放置模块的容器\n     */\n    private container: HTMLElement;\n\n    /**\n     * 模型管理器\n     */\n    public modelManager:ModelManager;\n    \n    /**\n     * 对象管理器，用于管理虚拟dom节点、指令、表达式、事件对象及其运行时参数\n     */\n    public objectManager:ObjectManager;\n\n    /**\n     * 事件工厂\n     */\n    public eventFactory:EventFactory;\n\n    /**\n     * 来源dom，子模块对应dom\n     */\n    public srcDom:IRenderedDom;\n\n    /**\n     * 源element\n     */\n    public srcElement:Node;\n\n    /**\n     * 源节点传递的事件，需要追加到模块根节点上\n     */\n    public events:NEvent[];\n\n    /**\n     * 生成dom时的keyid，每次编译置0\n     */\n    private domKeyId:number;\n\n    /**\n     * 旧模板串\n     */\n    private oldTemplate:string;\n\n    /**\n     * 编译来源模块id\n     */\n    public compileMid:number;\n\n    /**\n     * 是否已渲染过\n     */\n    private hasRendered:boolean;\n\n    /**\n     * 构造器\n     */\n    constructor() {\n        this.id = Util.genId();\n        this.modelManager = new ModelManager(this);\n        this.domManager = new DomManager(this);\n        this.objectManager = new ObjectManager(this);\n        this.eventFactory = new EventFactory(this);\n        //初始化model\n        this.model = new Model(this.data()||{} , this);\n        // 设置状态为未挂载\n        this.state = EModuleState.UNMOUNTED;\n        //加入模块工厂\n        ModuleFactory.add(this);\n    }\n\n    /**\n     * 模板串方法，使用时重载\n     * @param props     props对象，在模板容器dom中进行配置，从父模块传入\n     * @returns         模板串\n     */\n    public template(props?:any):string{\n        return null;\n    }\n\n    /**\n     * 数据方法，使用时重载\n     * @returns      model数据\n     */\n    public data():any{\n        return {};\n    }\n    \n    /**\n     * 模型渲染\n     */\n    public render(): boolean {\n        if(this.state === EModuleState.UNMOUNTED){\n            return;\n        }\n        //检测模板并编译\n        let templateStr = this.template(this.props);\n        //与旧模板不一样，需要重新编译\n        if(templateStr !== this.oldTemplate){\n            this.oldTemplate = templateStr;\n            this.compile();\n        }\n        //不存在domManager.vdomTree，不渲染\n        if(!this.domManager.vdomTree){\n            return;\n        }\n        if (!this.hasRendered) {    //首次渲染\n            this.doModuleEvent('onBeforeFirstRender');\n        }\n        //渲染前事件\n        this.doModuleEvent('onBeforeRender');\n        //保留旧树\n        const oldTree = this.domManager.renderedTree;\n        //渲染\n        this.domManager.renderedTree = Renderer.renderDom(this,this.domManager.vdomTree,this.model);\n        if(!this.hasRendered) {    //首次渲染\n            this.doModuleEvent('onFirstRender');\n            this.hasRendered = true;\n        }\n        //每次渲染后事件\n        this.doModuleEvent('onRender');\n        \n        //渲染树为空，解挂\n        if(!this.domManager.renderedTree){\n            this.unmount();\n            this.hasRendered = true;\n            return;\n        }\n        \n        //已经挂载\n        if(this.state === EModuleState.MOUNTED){\n            if(oldTree && this.model){\n                // 比较节点\n                let changeDoms = DiffTool.compare(this.domManager.renderedTree,oldTree);\n                this.doModuleEvent('onBeforeUpdate');\n                //执行更改\n                if(changeDoms.length>0){\n                    Renderer.handleChangedDoms(this,changeDoms);\n                    //执行更新到html事件\n                    this.doModuleEvent('onUpdate');\n                }\n            }\n        }else { //未挂载\n            this.mount();\n        }\n    }\n\n    /**\n     * 添加子模块\n     * @param module    模块id或模块\n     */\n    public addChild(module: number|Module) {\n        let mid;\n        if(typeof module === 'number'){\n            mid = module;\n            module = ModuleFactory.get(mid);\n        }else{\n            mid = module.id;\n        }\n        if (!this.children.includes(mid)) {\n            this.children.push(mid);\n            module.parentId = this.id;\n        }\n    }\n\n    /**\n     * 移除子模块\n     * @param module    子模块\n     */\n    public removeChild(module: Module) {\n        let ind=this.children.indexOf(module.id);\n        if (ind !== -1) {\n            module.unmount();\n            this.children.splice(ind,1);\n        }\n    }\n\n    /**\n     * 激活模块(准备渲染)\n     * @param type  0 手动， 1父节点setProps激活，默认0\n     */\n    public active() {\n        //如果为unmounted，则设置渲染为准备好状态\n        if(this.state === EModuleState.UNMOUNTED){\n            this.state = EModuleState.READY;\n        }\n        Renderer.add(this);\n    }\n\n    /**\n     * 挂载到html dom\n     */\n    public mount(){\n        //执行挂载事件\n        this.doModuleEvent('onBeforeMount');\n        //渲染到fragment\n        let rootEl = new DocumentFragment();\n        const el = Renderer.renderToHtml(this,this.domManager.renderedTree,rootEl,true);\n        if(this.container){ //自带容器（主模块或路由模块）\n            this.container.appendChild(rootEl);\n        }else if(this.srcDom){\n            const pm = this.getParent();\n            if(!pm){\n                return;\n            }\n            //替换占位符\n            this.srcElement = pm.getElement(this.srcDom.key);\n            if (this.srcElement) {\n                this.srcElement.parentElement.replaceChild(el, this.srcElement);\n            }\n            pm.saveElement(this.srcDom.key, el);\n        }\n        //执行挂载事件\n        this.doModuleEvent('onMount');\n        this.state = EModuleState.MOUNTED;\n    }\n\n    /**\n     * 解挂，从htmldom 移除\n     */\n    public unmount(){\n        // 主模块或状态为unmounted的模块不用处理\n        if (this.state === EModuleState.UNMOUNTED || ModuleFactory.getMain() === this) {\n            return;\n        }\n        //从render列表移除\n        Renderer.remove(this.id);\n        //清空event factory\n        this.eventFactory.clear();\n        // this.hasRendered = false;\n        this.doModuleEvent('onBeforeUnMount');\n        //module根与源el切换\n        const el = this.getElement(1);\n        if (el) {\n            if (this.container) { //带容器(路由方法加载)\n                this.container.removeChild(el);\n            } else if (this.srcDom) {\n                const pm = this.getParent();\n                if (pm) {\n                    //设置模块占位符\n                    if (el.parentElement) {\n                        el.parentElement.replaceChild(this.srcElement, el);\n                    }\n                    pm.saveElement(this.srcDom.key, this.srcElement);    \n                }\n            }    \n        }\n        this.domManager.reset();\n        //设置状态\n        this.state = EModuleState.UNMOUNTED;\n        this.doModuleEvent('onUnMount');\n        //子模块递归卸载\n        if (this.children) {\n            for (let id of this.children) {\n                let m = ModuleFactory.get(id);\n                if (m) {\n                    m.unmount();\n                }\n            }\n        }\n    }\n    \n    \n    /**\n     * 获取父模块\n     * @returns     父模块   \n     */\n    public getParent(): Module {\n        if (this.parentId) {\n            return ModuleFactory.get(this.parentId);\n        }\n    }\n\n    /**\n     * 执行模块事件\n     * @param eventName \t事件名\n     * @returns             执行结果，各事件返回值如下：\n     *                          onBeforeRender：如果为true，表示不进行渲染\n     */\n    private doModuleEvent(eventName: string):boolean{\n        let foo = this[eventName];\n        if(foo && typeof foo==='function'){\n            return foo.apply(this,[this.model]);\n        }\n    }\n\n    /**\n     * 获取模块方法\n     * @param name  方法名\n     * @returns     方法\n     */\n    public getMethod(name: string): Function {\n        return this[name];\n    }\n\n    /**\n     * 设置渲染容器\n     * @param el        容器\n     */\n    public setContainer(el:HTMLElement){\n        this.container = el;\n    }\n\n    /**\n     * 调用方法\n     * @param methodName    方法名\n     */\n    public invokeMethod(methodName: string,arg1?:any,arg2?:any,arg3?:any,arg4?:any,arg5?:any,arg6?:any,arg7?:any,arg8?:any) {\n        let m:Module = this;\n        let foo = m[methodName];\n        if(!foo && this.compileMid){\n            m = ModuleFactory.get(this.compileMid);\n            if(m){\n                foo = m[methodName];\n            }\n        }\n        if (foo && typeof foo === 'function') {\n            let args = [];\n            for(let i=1;i<arguments.length;i++){\n                args.push(arguments[i]);\n            }\n            return foo.apply(m, args);\n        }\n    }\n\n    /**\n     * 设置props\n     * @param props     属性值\n     * @param dom       子模块对应渲染后节点\n     */\n    public setProps(props:any,dom:IRenderedDom){\n        let dataObj = props.$data;\n        this.changedProps = {};\n        delete props.$data;\n        //props数据复制到模块model\n        if(dataObj){\n            for(let d of Object.keys(dataObj)){\n                this.model[d] = dataObj[d];\n            }\n        }\n\n        //保留src dom\n        this.srcDom = dom;\n\n        //如果不存在旧的props，则change为true，否则初始化为false\n        let change:boolean = false;\n        \n        if(!this.props){\n            this.changedProps = props;\n            change = true;\n        }else{\n            for(let k of Object.keys(props)){\n                // object 默认改变\n                if(props[k] !== this.props[k]){\n                    change = true;\n                    //保留更改的属性\n                    this.changedProps[k] = props[k];\n                }\n            }\n        }\n\n        //保存事件数组\n        this.events = dom.vdom.events;\n\n        //合并根dom属性\n        if(change){\n            this.mergeProps(this.changedProps);\n        }\n        \n        //props发生改变或unmounted，激活模块\n        if(change || this.state === EModuleState.UNMOUNTED){\n            this.active();\n        }\n\n        //保存props\n        this.props = props;\n    }\n\n    /**\n     * 编译\n     */\n    public compile(){\n        //注册子模块\n        if(this.modules && Array.isArray(this.modules)){\n            for (let cls of this.modules) {\n                ModuleFactory.addClass(cls);\n            }\n            delete this.modules;\n        }\n        if(!this.oldTemplate){\n            return;\n        }\n        //重置初始domkey\n        this.domKeyId = 0;\n        //清空孩子节点\n        this.children = [];\n        //清理css url\n        CssManager.clearModuleRules(this);\n        //编译\n        this.domManager.vdomTree = new Compiler(this).compile(this.oldTemplate);\n        if(!this.domManager.vdomTree){\n            return;\n        }\n        //保存originProps(由编译后的节点属性确认)\n        if(this.domManager.vdomTree.props){\n            for(let p of this.domManager.vdomTree.props){\n                this.originProps.set(p[0],p[1]);\n            }\n        }\n        //合并属性\n        this.mergeProps(this.props);\n        //添加从源dom传递的事件\n        if(this.events){\n            for(let ev of this.events){\n                this.domManager.vdomTree.addEvent(ev);\n            }\n        }\n        //增加编译后事件\n        this.doModuleEvent('onCompile');\n    }\n\n    /**\n     * 设置不渲染到根dom的属性集合\n     * @param props     待移除的属性名属组\n     */\n    public setExcludeProps(props:string[]){\n        this.excludedProps = props;\n    }\n    /**\n    * 合并根节点属性\n    * @param dom       dom节点 \n    * @param props     属性集合\n    * @returns         是否改变\n    */\n    private mergeProps(props){\n        if(!props || !this.domManager.vdomTree){\n            return;\n        }\n        //设置根属性\n        for(let k of Object.keys(props)){\n            //排除的props不添加到属性\n            if(!this.excludedProps || !this.excludedProps.includes(k)){\n                //如果dom自己有k属性，则处理为数组\n                if(this.originProps.has(k)){ \n                    this.domManager.vdomTree.setProp(k,[props[k],this.originProps.get(k)]);\n                }else{  //dom自己无此属性\n                    this.domManager.vdomTree.setProp(k,props[k]);\n                }\n            }\n        }\n    }\n\n    \n\n    /**\n     * 获取html node\n     * @param key   dom key \n     * @returns     html node\n     */\n    public getElement(key:number):Node{\n        return this.domManager.elementMap.get(key);\n    }\n\n    /**\n     * save html node\n     * @param key   dom key\n     * @param node  html node\n     */\n    public saveElement(key:number,node:Node){\n        this.domManager.elementMap.set(key,node);\n    }\n\n    /**\n     * 获取模块类名对应的第一个子模块(如果设置deep，则深度优先)\n     * @param name          子模块类名或别名\n     * @param deep          是否深度获取\n     * @param attrs         属性集合\n     */\n    public getModule(name:string,deep?:boolean,attrs?:any):Module{\n        if(!this.children){\n            return;\n        }\n        const cls = ModuleFactory.getClass(name);\n        if(!cls){\n            return;\n        }\n        return find(this);\n        /**\n         * 查询\n         * @param mdl   模块\n         * @returns     符合条件的子模块\n         */\n        function find(mdl){\n            for(let id of mdl.children){\n                let m:Module = ModuleFactory.get(id);\n                if(m){\n                    if(m.constructor === cls){\n                        if(attrs){  //属性集合不为空\n                            //全匹配标识\n                            let matched:boolean = true;\n                            for(let k of Object.keys(attrs)){\n                                if(!m.props || m.props[k] !== attrs[k]){\n                                    matched = false;\n                                    break;\n                                }\n                            }\n                            if(matched){\n                                return m;\n                            }\n                        }else{\n                            return m;\n                        }\n                    }\n                    //递归查找\n                    if(deep){\n                        let r = find(m);\n                        if(r){\n                            return r;\n                        }\n                    }\n                }\n            }\n        }\n        \n    }\n\n    /**\n     * 获取模块类名对应的所有子模块\n     * @param className     子模块类名\n     * @param deep          深度查询\n     */\n     public getModules(className:string,deep?:boolean):Module[]{\n        if(!this.children){\n            return;\n        }\n        let arr = [];\n        find(this);\n        return arr;\n\n        /**\n         * 查询\n         * @param module \n         */\n        function find(module:Module){\n            if(!module.children){\n                return;\n            }\n            for(let id of module.children){\n                let m:Module = ModuleFactory.get(id);\n                if(m && m.constructor){\n                    if(m.constructor.name === className){\n                        arr.push(m);\n                    }\n                    if(deep){\n                        find(m);\n                    }\n                }\n            }   \n        }\n    }\n\n\n    /**\n     * 监听\n     * 如果第一个参数为属性名，则第二个参数为钩子函数，第三个参数为deep，默认model为根模型\n     * 否则按照以下说明\n     * @param model     模型或属性\n     * @param key       属性/属性数组，支持多级属性\n     * @param operate   钩子函数\n     * @param deep      是否深度监听\n     * @returns         可回收监听器，执行后取消监听\n     */\n    public watch(model:Model|string|string[],key:string|string[]|Function,operate?:Function|boolean,deep?:boolean){\n        if(model['__key']){\n            return this.modelManager.watch(model,<any>key,<Function>operate,deep);\n        }else{\n            return this.modelManager.watch(this.model,<any>model,<any>key,<boolean>operate);\n        }\n    }\n\n    /**\n     * 设置模型属性值\n     * 如果第一个参数为属性名，则第二个参数为属性值，默认model为根模型\n     * 否则按照以下说明\n     * @param model     模型\n     * @param key       子属性，可以分级，如 name.firstName\n     * @param value     属性值\n     */\n    public set(model:Model|string,key:any,value?:any){\n        if(model['__key']){\n            this.modelManager.set(model,key,value);\n        }else{\n            this.modelManager.set(this.model,<string>model,key);\n        }\n    }\n\n    /**\n     * 获取模型属性值\n     * 如果第一个参数为属性名，默认model为根模型\n     * 否则按照以下说明\n     * @param model     模型\n     * @param key       属性名，可以分级，如 name.firstName，如果为null，则返回自己\n     * @returns         属性值\n     */\n    public get(model:Model|string, key?:any):any {\n        if(model['__key']){\n            return this.modelManager.get(model,key);\n        }else{\n            return this.modelManager.get(this.model,<string>model);\n        }\n    }\n\n    /**\n     * 获取dom key id\n     * @returns     key id\n     */\n    public getDomKeyId():number{\n        return ++this.domKeyId;\n    }\n}","import { Module } from \"./module\";\n\n/**\n * 工厂基类\n */\nexport class NFactory {\n    /**\n     * 模块名\n     */\n    private moduleId:number;\n    /**\n     * 工厂item对象\n     */\n    private items:Map<number|string,any> = new Map();\n    \n    /**\n     * @param module 模块\n     */\n    constructor(module?:Module) {\n        if (module !== undefined) {\n            this.moduleId = module.id;\n        }\n    }\n\n    /**\n     * 添加到工厂\n     * @param name \titem name\n     * @param item\titem\n     */\n    public add(name:string|number, item:any) {\n        this.items.set(name,item);\n    }\n\n    /**\n     * 获得item\n     * @param name \titem name\n     * @returns     item\n     */\n    public get(name:string|number):any{\n        return this.items.get(name);\n    }\n\n    \n    /**\n     * 从容器移除\n     * @param name \titem name\n     */\n    public remove(name:string|number) {\n        this.items.delete(name);\n    }\n\n    /**\n     * 是否拥有该项\n     * @param name  item name\n     * @return      true/false\n     */\n    public has(name:string|number):boolean{\n        return this.items.has(name);\n    }\n}\n"],"names":["DefineElementManager","static","clazz","alias","Array","isArray","c","this","elements","set","name","toUpperCase","tagName","get","has","Map","DirectiveType","constructor","handle","prio","DirectiveManager","directiveTypes","delete","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","NodomMessage_en","TipWords","application","system","module","moduleClass","model","directive","directiveType","expression","event","method","filter","filterType","data","dataItem","route","routeView","plugin","resource","root","element","ErrorMsgs","unknown","paramException","invoke","invoke1","invoke2","invoke3","exist","exist1","notexist","notexist1","notupd","notremove","notremove1","namedinvalid","initial","jsonparse","timeout","config","config1","itemnotempty","itemincorrect","needEndTag","needStartTag","tagError","wrongTemplate","wrongExpression","WeekDays","NodomMessage_zh","ModuleFactory","item","modules","size","mainModule","id","addClass","tp","Reflect","construct","classes","aliasMap","clazzName","toLowerCase","modulePath","m","import","k","Object","keys","Expression","exprStr","Util","genId","allModelField","funStr","compile","execFunc","Function","reg","r","retS","index","exec","s","substring","lch","length","handleFunc","startsWith","isKeyWord","s1","indexOf","lastIndex","str","ind1","lastIndexOf","ind2","fn1","trim","val","v","call","console","error","NError","message","CssManager","dom","add","cls","cssPreName","props","parent","addRules","textContent","undefined","cssText","scopeName","sheet","document","createElement","head","appendChild","styleSheets","clearModuleRules","regImp","re","startIndex","beginNum","test","handleImport","txt","insertRule","cssRules","handleStyle","arr","objectManager","push","ind","css","importMap","importIndex","rules","i","selectorText","deleteRule","Renderer","waitList","includes","moduleId","splice","render","shift","src","key","key1","genUniqueKey","dst","vdom","currentModuleRoot","staticNum","directives","type","styleReg","classReg","a","getStyleString","getClassString","handleProps","handleStyleDom","getProp","assets","p","d","handleDirectives","events","evt","eventFactory","addEvent","children","renderDom","expressions","expr","v1","el","getElement","renderToHtml","attrs","attributes","setAttribute","removeAttribute","parentEl","isRenderChild","newEl","newText","genSub","pEl","forEach","el1","isSvg","saveElement","bind","handleStyleTextDom","node","createTextNode","changeDoms","repArr","updateToHtml","n1","parentElement","removeChild","domManager","freeNode","n2","replaceChild","sort","b","childNodes","insertBefore","RequestManager","time","Date","now","requestMap","url","obj","rejectReqTick","compare","params","rand","$rand","Math","random","async","req","XMLHttpRequest","withCredentials","onload","status","responseText","JSON","parse","ontimeout","onerror","pa","isObject","ar","join","FormData","fd","append","open","user","pwd","header","getOwnProps","setRequestHeader","send","catch","NodomMessage","Route","isEmpty","path","o","addChild","routes","child","pathArr","split","param","paramIndex","prePath","j","clone","getOwnPropertyNames","EModuleState","Router","currentPath","setTimeout","load","start","parentModule","diff","getMain","routerKeyMap","mid","getModule","isFunction","onDefaultLeave","onLeave","activeFieldMap","unmount","dependHandle","ii","onDefaultEnter","onEnter","startStyle","path1","basePath","history","replaceState","pushState","go","path2","arr1","arr2","getRouteList","len","retArr1","retArr2","stringify","slice","p1","p2","field","find","pm","me","state","MOUNTED","setContainer","active","setDomActive","fullPath","foo","retArr","preNode","window","addEventListener","Scheduler","tasks","func","thiser","scheduleTick","dispatch","requestAnimationFrame","createDirective","handler","priority","addType","Error","errorName","p3","p4","super","msg","arguments","p5","args","RegExp","replace","generatedId","keyWordMap","srcObj","expKey","extra","map","WeakMap","prop","getCloneObj","isMap","co","o1","o2","o3","o4","o5","o6","retObj","assign","subObj","obj1","obj2","cmp","keys1","keys2","Number","isInteger","srcNode","nodes","pnode","parentNode","bnode","nextSibling","timeStamp","format","isString","date","isNaN","getDay","getMonth","getDate","getHours","getMinutes","getSeconds","S","getMilliseconds","getFullYear","paths","evalStr","deep","setNodeKey","x","y","initKeyMap","Directive","getType","disabled","NEvent","eventName","eventStr","delg","nopopo","once","capture","ontouchend","setParam","setEventParam","getParam","getEventParam","removeParam","removeEventParam","clearParam","clearEventParam","VirtualDom","tag","getDomKeyId","removeDirectives","removeDirective","findIndex","addDirective","sortDirective","hasDirective","typeName","getDirective","remove","addProp","removedClassMap","removeClass","setStaticOnce","values","clsArr","pv","addStyle","style","removedStyleMap","sa1","removeStyle","styleStr","sa","hasProp","propName","isExpr","setProp","clear","pName","pValue","delProp","setAsset","assetName","delAsset","setDomParam","getDomParam","removeDomParam","voidTagMap","Set","Compiler","elementStr","template","compileTemplate","domArr","isClosed","warnStartTagNotClose","temp","pop","genKey","srcStr","compileEndTag","compileStartTag","compileText","match","textArr","current","tagStartPos","trimStart","compileAttributes","tagEndPos","isVoidTag","selfClosed","handleSelfClosingTag","warnEndTagNotMatch","pos","handleCloseTag","matchExp","isExprText","preHandleText","text","div","innerHTML","postHandleNode","hasClass","dir","srcId","handleSlot","slotCt","warn","DiffTool","changeArr","addChange","isChange","addObj","newStartIdx","newEndIdx","oldStartIdx","oldEndIdx","newStartNode","newEndNode","oldStartNode","oldEndNode","ch","hasOwnProperty","compareChildren","dom1","loc","DefineElement","EventManager","evts","ev","dependEvent","handleObj","extendEventMap","EventFactory","eventMap","addedEvents","addToArr","cfg","bindMap","own","getEvent","removeEvent","unbind","eobj","removeEventListener","unbindAll","hasEvent","currentTarget","getRenderedDom","doOwn","invokeMethod","stopPropagation","doDelg","elArr","composedPath","evo","NCache","cacheData","subscribeMap","invokeSubscribe","subscribe","GlobalCache","cache","Model","__source","proxy","Proxy","receiver","value1","source","__module","modelManager","bindModel","setModelName","ov","update","getModelKey","res","getModel","deleteProperty","oldValue","ModelManager","dataMap","nameMap","getModelName","__key","mids","newValue","handleWatcher","mdl","watchMap","watcher","f","hasDeepWatch","__parent","__name","watch","operate","watchOne","ObjectManager","clearDomParams","clearAllDomParams","DomManager","getOriginDom","vdomTree","d1","renderedTree","cloneRenderedDom","clearElementMap","elementMap","reset","MODULE","FOR","cond","IF","RECUR","ELSE","ELSEIF","ENDIF","SLOT","toLocaleLowerCase","compileMid","$data","setProps","rows","idxName","node1","showParam","rendered","regResult","display","origin","tgname","dataValue","setDomAsset","yv","checked","acName","addActiveField","evObj","confObj","tigger","isAppear","nameEnter","enter","nameLeave","leave","durationEnter","duration","durationLeave","leavr","delayEnter","delay","delayLeave","timingFunctionEnter","timingFunction","timingFunctionLeave","beforeEnter","hooks","before","afterEnter","after","beforeLeave","afterLeave","classList","width","height","oStyle","getOriginalWidthAndHeight","getAttribute","changeStateFromHideToShow","changeStateFromShowToHide","getElRealSzie","transitionDelay","transitionDuration","transitionTimingFunction","animationDelay","animationDuration","animationTimingFunction","offsetWidth","parseFloat","position","getComputedStyle","getPropertyValue","vis","visibility","regist","touchstart","evtObj","tch","touches","sx","pageX","sy","pageY","t","touchmove","dx","dy","abs","move","touchend","dt","oldTime","speedLoc","oldLoc","nt","mv","sqrt","v0","sname","click","firstClick","Module","UNMOUNTED","templateStr","oldTemplate","hasRendered","doModuleEvent","oldTree","handleChangedDoms","mount","parentId","READY","rootEl","DocumentFragment","container","srcDom","getParent","srcElement","getMethod","methodName","arg1","arg2","arg3","arg4","arg5","arg6","arg7","arg8","dataObj","changedProps","change","mergeProps","domKeyId","originProps","setExcludeProps","excludedProps","getClass","matched","getModules","className","NFactory","items","language","addTask","querySelector","request"],"mappings":"yCAKaA,qBAUFC,WAAWC,EAAUC,GACxB,GAAGC,MAAMC,QAAQH,GACb,IAAI,IAAII,KAAKJ,EACTK,KAAKC,SAASC,IAAIH,EAAEI,KAAKC,cAAeL,QAG5CC,KAAKC,SAASC,KAAKN,GAAOD,EAAMQ,MAAMC,cAAeT,GAStDD,WAAWW,GACd,OAAOL,KAAKC,SAASK,IAAID,EAAQD,eAQ9BV,WAAWW,GACd,OAAOL,KAAKC,SAASM,IAAIF,EAAQD,gBA/BtBX,8BAAuC,IAAIe,UCNhDC,cAsBVC,YAAYP,EAAYQ,EAAiBC,GACrCZ,KAAKG,KAAOA,EACZH,KAAKY,KAAOA,GAAM,EAAEA,EAAK,GACzBZ,KAAKW,OAASA,SCxBRE,iBAYHnB,eAAeS,EAAYQ,EAAgBC,GAC9CZ,KAAKc,eAAeZ,IAAIC,EAAM,IAAIM,cAAcN,EAAKQ,EAAOC,IAOzDlB,kBAAkBS,GACrBH,KAAKc,eAAeC,OAAOZ,GAQxBT,eAAeS,GAClB,OAAOH,KAAKc,eAAeR,IAAIH,GAQ5BT,eAAeS,GAClB,OAAOH,KAAKc,eAAeP,IAAIJ;;;;;;;;;;;;;;;AC0BhC,SAASa,EAAUC,EAASC,EAAYC,EAAGC,GAE9C,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUC,GAAS,IAAMC,EAAKN,EAAUO,KAAKF,IAAW,MAAOG,GAAKL,EAAOK,IACpF,SAASC,EAASJ,GAAS,IAAMC,EAAKN,EAAiB,MAAEK,IAAW,MAAOG,GAAKL,EAAOK,IACvF,SAASF,EAAKI,GAJlB,IAAeL,EAIaK,EAAOC,KAAOT,EAAQQ,EAAOL,QAJ1CA,EAIyDK,EAAOL,MAJhDA,aAAiBN,EAAIM,EAAQ,IAAIN,GAAE,SAAUG,GAAWA,EAAQG,OAITO,KAAKR,EAAWK,GAClGH,GAAMN,EAAYA,EAAUa,MAAMhB,EAASC,GAAc,KAAKS,WDnEnDd,gCAA2C,IAAIL,UELrD0B,EAAkB,CAI3BC,SAAS,CACLC,YAAY,cACZC,OAAO,SACPC,OAAO,SACPC,YAAY,cACZC,MAAM,QACNC,UAAU,YACVC,cAAc,iBACdC,WAAW,aACXC,MAAM,QACNC,OAAO,SACPC,OAAO,SACPC,WAAW,cACXC,KAAK,OACLC,SAAS,YACTC,MAAM,QACNC,UAAU,kBACVC,OAAO,SACPC,SAAS,WACTC,KAAK,OACLC,QAAQ,cAKZC,UAAU,CACNC,QAAQ,gBACRC,eAAe,oCACfC,OAAO,uCACPC,QAAQ,8CACRC,QAAQ,8CACRC,QAAQ,6CACRC,MAAM,uBACNC,OAAO,6BACPC,SAAS,mBACTC,UAAU,yBACVC,OAAO,0BACPC,UAAU,0BACVC,WAAW,8BACXC,aAAa,oCACbC,QAAQ,2BACRC,UAAU,mBACVC,QAAQ,mBACRC,OAAO,6BACPC,QAAQ,mCACRC,aAAa,8CACnBC,cAAc,oCACRC,WAAY,4BACZC,aAAc,+BACdC,SAAS,oBACTC,cAAc,iBACdC,gBAAgB,0BAGpBC,SAAS,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,QC1DrCC,EAAkB,CAI3BjD,SAAU,CACNC,YAAa,KACbC,OAAQ,KACRC,OAAQ,KACRC,YAAa,MACbC,MAAO,KACPC,UAAW,KACXC,cAAe,OACfC,WAAY,MACZC,MAAO,KACPC,OAAQ,KACRC,OAAQ,MACRC,WAAY,QACZC,KAAM,KACNC,SAAU,MACVC,MAAO,KACPC,UAAW,OACXC,OAAQ,KACRC,SAAU,KACVC,KAAM,IACNC,QAAS,MAKbC,UAAW,CACPC,QAAS,OACTC,eAAgB,wBAChBC,OAAQ,uBACRC,QAAS,6BACTC,QAAS,6BACTC,QAAS,oBACTC,MAAO,UACPC,OAAQ,gBACRC,SAAU,UACVC,UAAW,gBACXC,OAAQ,WACRC,UAAW,WACXC,WAAY,eACZC,aAAc,6BACdC,QAAS,cACTC,UAAW,WACXC,QAAS,OACTC,OAAQ,aACRC,QAAS,oBACTC,aAAc,2BACdC,cAAe,yBACfC,WAAY,YACZC,aAAc,mBACdC,SAAS,YACTC,cAAc,SACdC,gBAAgB,cAEpBC,SAAU,CAAC,MAAM,MAAO,MAAM,MAAM,MAAM,MAAM,cCvDvCE,cA0BF3F,WAAW4F,GAEY,IAAtBtF,KAAKuF,QAAQC,OACbxF,KAAKyF,WAAaH,GAEtBtF,KAAKuF,QAAQrF,IAAIoF,EAAKI,GAAIJ,GAE1BtF,KAAK2F,SAASL,EAAK5E,aAOhBhB,WAAWS,GACd,IAAIyF,SAAYzF,EAChB,MAAW,WAAPyF,EACO5F,KAAKuF,QAAQjF,IAAIH,GAGd,WAAPyF,EAQQC,QAAQC,UAAU3F,EAAK,KAP1BH,KAAK+F,QAAQxF,IAAIJ,KACjBA,EAAOH,KAAKgG,SAAS1F,IAAIH,IAE1BH,KAAK+F,QAAQxF,IAAIJ,GACT0F,QAAQC,UAAe9F,KAAK+F,QAAQzF,IAAIH,GAAM,SADzD,GAcLT,gBAAgBuG,GACnB,MAAM9F,EAAO8F,EAAUC,cACvB,OAAOlG,KAAK+F,QAAQxF,IAAIJ,IAASH,KAAKgG,SAASzF,IAAIJ,GAQhDT,gBAAgBC,EAAYC,GAE/B,IAAIO,EAAOR,EAAMQ,KAAK+F,cAClBlG,KAAK+F,QAAQxF,IAAIJ,KAGrBH,KAAK+F,QAAQ7F,IAAIC,EAAMR,GAEnBC,GACAI,KAAKgG,SAAS9F,IAAIN,EAAMsG,cAAc/F,IASvCT,gBAAgBS,GAEnB,OADAA,EAAOA,EAAK+F,cACLlG,KAAK+F,QAAQxF,IAAIJ,GAAMH,KAAK+F,QAAQzF,IAAIH,GAAMH,KAAK+F,QAAQzF,IAAIN,KAAKgG,SAAS1F,IAAIH,IAQrFT,YAAkByG,4CACrB,IAAIC,QAAUC,OAAOF,GACrB,GAAGC,EAEC,IAAI,IAAIE,KAAKC,OAAOC,KAAKJ,GACrB,GAAGA,EAAEE,GAAGnG,KAEJ,OADAH,KAAK2F,SAASS,EAAEE,IACTF,EAAEE,MASzB5G,cAAcgG,GACV1F,KAAKuF,QAAQxE,OAAO2E,GAMxBhG,eAAe0G,GACXpG,KAAKyF,WAAaW,EAOtB1G,iBACI,OAAOM,KAAKyF,YAlIDJ,sBAA+B,IAAI7E,IAKpC6E,sBAA+B,IAAI7E,IAOnC6E,uBAA8B,IAAI7E,UCbvCiG,WA6BT/F,YAAYgG,GAGR,GAFA1G,KAAK0F,GAAKiB,KAAKC,QACf5G,KAAK6G,eAAgB,GAChBH,EACD,OAEJ1G,KAAK0G,QAAUA,EACf,MAAMI,EAAS9G,KAAK+G,QAAQL,GAC5B1G,KAAKgH,SAAW,IAAIC,SAAS,SAAS,UAAYH,GAQ9CC,QAAQL,GAEZ,MAAMQ,EAAM,yIACZ,IAAIC,EACAC,EAAO,GACPC,EAAQ,EAEZ,KAAgC,QAAzBF,EAAED,EAAII,KAAKZ,KAAmB,CACjC,IAAIa,EAAIJ,EAAE,GAIV,GAHGE,EAAQF,EAAEE,QACTD,GAAQV,EAAQc,UAAUH,EAAMF,EAAEE,QAE1B,MAATE,EAAE,IAAuB,MAATA,EAAE,IAAuB,MAATA,EAAE,GACjCH,GAAQG,MACP,CACD,IAAIE,EAAMF,EAAEA,EAAEG,OAAO,GACrB,GAAW,MAARD,EACCL,GAAQG,OACN,GAAW,MAARE,GAAuB,MAARA,EACpBL,GAAQO,EAAWJ,QAEnB,GAAGA,EAAEK,WAAW,UACTjB,KAAKkB,UAAUN,IACL,MAATA,EAAE,IAAqB,MAAPA,EAAE,GACtBH,GAAQG,MACP,CACD,IAAIO,EAAK,GACNP,EAAEK,WAAW,SACZE,EAAK,MACLP,EAAIA,EAAEC,UAAU,IAEpBJ,GAAQU,EAAI,UAAYP,GAED,IAApBA,EAAEQ,QAAQ,OACT/H,KAAK6G,eAAgB,IAKrCQ,EAAQH,EAAIc,UAKhB,OAHGX,EAAQX,EAAQgB,SACfN,GAAQV,EAAQc,UAAUH,IAEvBD,EAOP,SAASO,EAAWM,GAChB,MAAMC,EAAOD,EAAIE,YAAY,KACvBC,EAAOH,EAAIF,QAAQ,KAEnBM,IAAiB,IAAVD,EAAYH,EAAIT,UAAU,EAAEY,GAAMH,EAAIT,UAAU,EAAEU,IAAOI,OAEtE,OAAG3B,KAAKkB,UAAUQ,IAAmB,MAAXJ,EAAI,GACnBA,GAGE,IAAVG,EACQ,QAAUC,EAAMJ,EAAIT,UAAUa,EAAIX,QAElC,UAAYO,GAWxBM,IAAIjG,EAAcE,GACrB,IAAIgG,EACJ,IACIA,EAAIxI,KAAKgH,SAASyB,KAAKnG,EAAOE,GAChC,MAAOZ,GACL8G,QAAQC,MAAM,IAAIC,OAAO,kBAAkB5I,KAAK0G,SAASmC,SACzDH,QAAQC,MAAM/G,GAGlB,OADA5B,KAAKyB,MAAQ+G,EACNA,SChIFM,WA8BFpJ,sBAAsB4C,EAAcyG,EAAiBzF,EAAkB0F,GAC1E,GAAiC,UAA9BD,EAAI1I,QAAQ6F,cACX,OAAO,EAEX,GAAG8C,EAAI,CACH,IAAIC,EAAMjJ,KAAKkJ,WAAa5G,EAAOoD,GAChCpC,EAAK6F,MAAa,MACjB7F,EAAK6F,MAAa,MAAIJ,EAAII,MAAa,MAAI,IAAMF,EAEjD3F,EAAK6F,MAAa,MAAIF,EAG9B,OAAO,EASJvJ,0BAA0B4C,EAAcyG,GAC3C,SAAIA,EAAIK,QAA+C,UAArCL,EAAIK,OAAO/I,QAAQ6F,iBAIrC4C,WAAWO,SAAS/G,EAAOyG,EAAIO,YAA0C,SAA9BP,EAAIK,OAAOD,MAAa,MAAa,IAAMnJ,KAAKkJ,WAAa5G,EAAOoD,QAAG6D,IAC3G,GASJ7J,gBAAgB4C,EAAckH,EAAeC,GAEhD,IAAIzJ,KAAK0J,MAAM,CAEX,IAAIA,EAAQC,SAASC,cAAc,SACnCD,SAASE,KAAKC,YAAYJ,GAC1B1J,KAAK0J,MAAQC,SAASI,YAAY,GAInCN,GACCzJ,KAAKgK,iBAAiB1H,GAK1B,MAAM4E,EAAM,+DAGN+C,EAAS,mBAGf,IAGIC,EAHAC,GAAmB,EAEnBC,EAAkB,EAEtB,KAAiC,QAA1BF,EAAGhD,EAAII,KAAKkC,KACf,GAAGS,EAAOI,KAAKH,EAAG,IACdI,EAAaJ,EAAG,SACd,GAAa,MAAVA,EAAG,IACR,GAAGC,GAAY,KAAOC,GAAY,EAAE,CAChC,IAAIG,EAAMf,EAAQhC,UAAU2C,EAAWD,EAAG7C,MAAM,GAClC,MAAXkD,EAAI,GACHvK,KAAK0J,MAAMc,WAAWD,EAAIzB,WAAWY,MAAMe,SAAS3B,WAAWY,MAAMe,SAAS/C,OAAO,GAErFgD,EAAYpI,EAAOiI,EAAId,GAE3BU,GAAc,EACdC,EAAW,QAGI,IAAhBD,GACCA,EAAaD,EAAG7C,MAChB+C,KAEAA,IAYZ,SAASM,EAAYpI,EAAckH,EAAeC,GAE9C,IAAItC,EADQ,WACAG,KAAKkC,GACjB,GAAIrC,EAAJ,CAIA,GAAGsC,EAAU,CACT,IAAIkB,EAAMrI,EAAOsI,cAActK,IAAI,aAC/BqK,IACAA,EAAM,GACNrI,EAAOsI,cAAc1K,IAAI,YAAYyK,IAEzCA,EAAIE,KAAMpB,EAAY,IAAMtC,EAAE,IAE9BqC,EAAUC,EAAY,IAAMD,EAGhCV,WAAWY,MAAMc,WAAWhB,EAAQV,WAAWY,MAAMe,SAAS3B,WAAWY,MAAMe,SAAS/C,OAAO,IAQnG,SAAS4C,EAAad,GAClB,IAAIsB,EAAMtB,EAAQzB,QAAQ,KACtBG,EAAOsB,EAAQrB,YAAY,KAC/B,IAAY,IAAT2C,IAAwB,IAAV5C,GAAe4C,GAAK5C,EACjC,OAEJ,IAAI6C,EAAMvB,EAAQhC,UAAUsD,EAAI5C,GAC7BY,WAAWkC,UAAUzK,IAAIwK,KAI5BjC,WAAWY,MAAMc,WAAWhB,EAAQV,WAAWmC,eAC/CnC,WAAWkC,UAAU9K,IAAI6K,GAAI,KAU9BrL,wBAAwB4C,GAC3B,IAAI4I,EAAQ5I,EAAOsI,cAActK,IAAI,aACrC,GAAI4K,GAA0B,IAAjBA,EAAMxD,OAAnB,CAIA,IAAI,IAAIyD,EAAE,EAAEA,EAAEnL,KAAK0J,MAAMe,SAAS/C,OAAOyD,IAAI,CACzC,IAAIhE,EAAInH,KAAK0J,MAAMe,SAASU,GACzBhE,EAAEiE,eAAmD,IAAnCF,EAAMnD,QAAQZ,EAAEiE,eACjCpL,KAAK0J,MAAM2B,WAAWF,KAK9B7I,EAAOsI,cAAc1K,IAAI,YAAY,MA/K1B4I,qBAAY,IAAItI,IAKhBsI,uBAAc,EAKdA,sBAAa,0BCjBnBwC,SAcF5L,WAAW4C,GAETtC,KAAKuL,SAASC,SAASlJ,EAAOoD,KAE/B1F,KAAKuL,SAASV,KAAKvI,EAAOoD,IAQ3BhG,cAAc+L,GACjB,IAAIpE,GAC8C,KAA9CA,EAAQrH,KAAKuL,SAASxD,QAAQ0D,KAE9BzL,KAAKuL,SAASG,OAAOrE,EAAM,EAAE,MAM9B3H,gBACH,KAAKM,KAAKuL,SAAS7D,OAAO,GAAG,CACzB,IAAIhC,EAAK1F,KAAKuL,SAAS,GACvB,GAAG7F,EAAG,CACQL,cAAc/E,IAAIoF,GAC1BiG,SAGN3L,KAAKuL,SAASK,SAaflM,iBAAiB4C,EAAcuJ,EAAerJ,EAAY4G,EAAqB0C,GAElF,MAAMC,EAAOD,EAAInF,KAAKqF,aAAaH,EAAIC,IAAIA,GAAKD,EAAIC,IAEpDtJ,EAAQqJ,EAAIrJ,OAASA,EACrB,IAAIyJ,EAAmB,CACnBH,IAAIC,EACJG,KAAKL,GA8BT,GA5BGA,EAAIxL,SACH4L,EAAI5L,QAAUwL,EAAIxL,QAElB4L,EAAI9C,MAAQ,IAEZ8C,EAAI3C,YAAcuC,EAAIvC,YAGtBF,GAOI5G,IACAA,EAAQ4G,EAAO5G,OAGnByJ,EAAI7C,OAASA,IAVbpJ,KAAKmM,kBAAoBF,EAErBzJ,IACAA,EAAQF,EAAOE,QAUvByJ,EAAIzJ,MAAQA,EACZyJ,EAAIG,UAAYP,EAAIO,UAEjBP,EAAIQ,YAAcR,EAAIQ,WAAW3E,OAAO,GAAqC,UAAhCmE,EAAIQ,WAAW,GAAGC,KAAKnM,MACnE0L,EAAIQ,WAAW,GAAG/E,KAAKhF,EAAO2J,GAE/BA,EAAI5L,QAAQ,CAGX,GA0EJ,WACI,IAAIwL,EAAI1C,OAA4B,IAAnB0C,EAAI1C,MAAM3D,KACvB,OAGJ,MAAM+G,EAAW,WACXC,EAAW,WACjB,IAAI/K,EACJ,IAAI,IAAI6E,KAAKuF,EAAI1C,MAAM,CACnB,GAAGtJ,MAAMC,QAAQwG,EAAE,IAAI,CACnB7E,EAAQ,GACR,IAAI,IAAI0J,EAAE,EAAEA,EAAE7E,EAAE,GAAGoB,OAAOyD,IAAI,CAC1B,IAAIsB,EAAInG,EAAE,GAAG6E,GACVsB,aAAahG,WACZhF,EAAMoJ,KAAK4B,EAAElE,IAAIjG,EAAO2J,EAAIzJ,QAG5Bf,EAAMoJ,KAAK4B,GAGhBF,EAASlC,KAAK/D,EAAE,IACf7E,EAAQoK,EAAIa,eAAejL,GACtB+K,EAASnC,KAAK/D,EAAE,MACrB7E,EAAQoK,EAAIc,eAAelL,SAG/BA,EADK6E,EAAE,aAAcG,WACbH,EAAE,GAAGiC,IAAIjG,EAAO2J,EAAIzJ,OAGpB8D,EAAE,GAEd2F,EAAI9C,MAAM7C,EAAE,IAAM7E,GA3GtBmL,IAEI9D,WAAW+D,eAAevK,EAAOuJ,EAAIP,SAASa,kBAA2C,SAAzBN,EAAIiB,QAAQ,WAEzEjB,EAAIkB,QAAUlB,EAAIkB,OAAOvH,KAAK,EAC7B,IAAI,IAAIwH,KAAKnB,EAAIkB,OACbd,EAAIe,EAAE,IAAMA,EAAE,GAK1B,IA6CJ,WACI,IAAInB,EAAIQ,YAAsC,IAAxBR,EAAIQ,WAAW3E,OACjC,OAAO,EAGX,IAAI,IAAIuF,KAAKpB,EAAIQ,WAEb,GAAiB,UAAdY,EAAEX,KAAKnM,OAGN8M,EAAE3F,KAAKhF,EAAO2J,GACd,OAAO,EAGf,OAAO,EA3DHiB,GACA,OAAO,KAGX,GAAGrB,EAAIsB,OACH,IAAI,IAAIC,KAAOvB,EAAIsB,OACf7K,EAAO+K,aAAaC,SAASrB,EAAImB,GAIzC,GAAGvB,EAAI0B,UAAY1B,EAAI0B,SAAS7F,OAAO,EAAE,CACrCuE,EAAIsB,SAAW,GACf,IAAI,IAAIxN,KAAK8L,EAAI0B,SACbjC,SAASkC,UAAUlL,EAAOvC,EAAEkM,EAAIzJ,MAAMyJ,EAAIH,GAAQ,YAI1D,GAAGD,EAAI4B,YAAY,CACf,IAAIhM,EAAQ,GACZ,IAAI,IAAIiM,KAAQ7B,EAAI4B,YAChB,GAAIC,aAAgBjH,WAAY,CAC5B,IAAIkH,EAAKD,EAAKnF,IAAIjG,EAAO2J,EAAIzJ,OAC7Bf,QAAgB8H,IAAPoE,EAAmBA,EAAK,QAEjClM,GAASiM,EAGjBzB,EAAI3C,YAAc7H,OAElBwK,EAAI3C,YAAcuC,EAAIvC,YAU9B,OAPmB,IAAhBuC,EAAIO,YACHP,EAAIO,UAAU,GAGfhD,GACC6C,EAAI7C,OAAOmE,SAAS1C,KAAKoB,GAEtBA,EAoEJvM,oBAAoB4C,EAAeuJ,GACtC,IAAI+B,EAAKtL,EAAOuL,WAAWhC,EAAIC,KAC/B,IAAI8B,EACA,OAAO5N,KAAK8N,aAAaxL,EAAOuJ,EAAI,MAClC,GAAGA,EAAIxL,QAAQ,CAEXuN,EAAI9B,IAAMD,EAAIC,IACpB,IAAIiC,EAAsBH,EAAII,WAC1BrD,EAAM,GACV,IAAI,IAAIQ,EAAE,EAAEA,EAAE4C,EAAMrG,OAAOyD,IACvBR,EAAIE,KAAKkD,EAAM5C,GAAGhL,MAGtB,IAAI,IAAI6M,KAAKzG,OAAOC,KAAKqF,EAAI1C,OAAO,CAEhC,IAAI2B,EADU8C,EAAIK,aAAajB,OAAiBzD,IAAfsC,EAAI1C,MAAM6D,GAAe,GAAGnB,EAAI1C,MAAM6D,KAE1C,KAAzBlC,EAAIH,EAAI5C,QAAQiF,KAChBrC,EAAIe,OAAOZ,EAAI,GAIvB,GAAGH,EAAIjD,OAAO,EACV,IAAI,IAAI+E,KAAK9B,EACKiD,EAAIM,gBAAgBzB,GAI1C,GAAIZ,EAAIkB,OACJ,IAAK,IAAIzG,KAAKC,OAAOC,KAAKqF,EAAIkB,QAC1Ba,EAAGtH,GAAKuF,EAAIkB,OAAOzG,QAIrBsH,EAAItE,YAAcuC,EAAIvC,YAEhC,OAAOsE,EAUJlO,oBAAoB4C,EAAeuJ,EAAkBsC,EAAcC,GACtE,IAAIR,EAaJ,OAXIA,EADD/B,EAAIxL,QACEgO,EAAMxC,GAENyC,EAAQzC,GAGd+B,GAAM/B,EAAIxL,SAAY+N,GAwDzB,SAASG,EAAOC,EAAWtC,GACnBA,EAAKqB,UAAYrB,EAAKqB,SAAS7F,OAAS,GACxCwE,EAAKqB,SAASkB,SAAQnJ,IAClB,IAAIoJ,EACApJ,EAAKjF,SACLqO,EAAML,EAAM/I,GACZiJ,EAAOG,EAAKpJ,IAEZoJ,EAAMJ,EAAQhJ,GAEfoJ,GACCF,EAAI1E,YAAY4E,MAlE5BH,CAAOX,EAAI/B,GAEZ+B,GAAMO,GACLA,EAASrE,YAAY8D,GAElBA,EAOP,SAASS,EAAMtF,EAAiB4F,GAE5B,GAAmB,UAAhB5F,EAAI1I,QACH,OAEJ,IAAIuN,EAAIjE,SAASC,cAAcb,EAAI1I,SAEnCiC,EAAOsM,YAAY7F,EAAI+C,IAAI8B,GAErBA,EAAI9B,IAAM/C,EAAI+C,IAEpB,IAAI,IAAIkB,KAAKzG,OAAOC,KAAKuC,EAAII,OACzByE,EAAGK,aAAajB,OAAiBzD,IAAfR,EAAII,MAAM6D,GAAe,GAAGjE,EAAII,MAAM6D,IAG5D,GAAGjE,EAAIgE,OACH,IAAK,IAAIC,KAAKzG,OAAOC,KAAKuC,EAAIgE,QAC1Ba,EAAGZ,GAAKjE,EAAIgE,OAAOC,GAK3B,OADA1K,EAAO+K,aAAawB,KAAK9F,GAClB6E,EAMX,SAASU,EAAQvF,GAEb,GAAGD,WAAWgG,mBAAmBxM,EAAOyG,GACnC,OAEL,IAAIgG,EAAOpF,SAASqF,eAAuBjG,EAAIO,aAAe,IAE9D,OADAhH,EAAOsM,YAAY7F,EAAI+C,IAAIiD,GACpBA,GA+BRrP,yBAAyB4C,EAAc2M,GAE1C,MAAMC,EAAQ,GAERvE,EAAM,GAEZ,IAAK,IAAIrF,KAAQ2J,EACb,GAAe,IAAZ3J,EAAK,GACJgG,SAAS6D,aAAa7M,EAAQgD,EAAK,SACjC,GAAgB,IAAZA,EAAK,GAAU,CACrB,MAAMkJ,EAAMlM,EAAOuL,WAAWvI,EAAK,GAAGwG,KAChCsD,EAAK9M,EAAOuL,WAAWvI,EAAK,GAAGwG,KACjC0C,GAAOY,GAAMA,EAAGC,gBAAkBb,GAClCA,EAAIc,YAAYF,GAEpB9M,EAAOiN,WAAWC,SAASlK,EAAK,SACd,IAAZA,EAAK,GACX4J,EAAOrE,KAAKvF,GAEZqF,EAAIE,KAAKvF,GAKjB,GAAG4J,EAAOxH,OAAO,EACb,IAAI,IAAIpC,KAAQ4J,EAAO,CACnB,MAAMV,EAAMlM,EAAOuL,WAAWvI,EAAK,GAAGwG,KACtC,IAAI2D,EACDnK,EAAK,GAAGmG,UACPnJ,EAAOiN,WAAWC,SAASlK,EAAK,IAChCmK,EAAKnN,EAAOuL,WAAWvI,EAAK,GAAGwG,OAE/B2D,EAAKnN,EAAOuL,WAAWvI,EAAK,GAAGwG,KAC/BxJ,EAAOiN,WAAWC,SAASlK,EAAK,KAGpC,MAAM8J,EAAK9D,SAASwC,aAAaxL,EAAQgD,EAAK,GAAI,MAAM,GACpDkJ,GAAOiB,GACPjB,EAAIkB,aAAaN,EAAIK,GAM9B9E,EAAIjD,OAAS,GACZiD,EAAIgF,MAAK,CAAClD,EAAEmD,IAAInD,EAAE,GAAGmD,EAAE,GAAG,GAAG,IAGjC,IAAI,IAAItK,KAAQqF,EAAI,CAChB,MAAM6D,EAAmBlM,EAAOuL,WAAWvI,EAAK,GAAGwG,KACnD,GAAe,IAAZxG,EAAK,GAAS,CACb,MAAM8J,EAAK9D,SAASwC,aAAaxL,EAAQgD,EAAK,GAAI,MAAM,GACpDkJ,EAAIqB,YAAcrB,EAAIqB,WAAWnI,OAAS,EAAIpC,EAAK,GACnDkJ,EAAIsB,aAAaV,EAAIZ,EAAIqB,WAAWvK,EAAK,KAGzCkJ,EAAI1E,YAAYsF,OAEnB,CACD,MAAMA,EAAK9M,EAAOuL,WAAWvI,EAAK,GAAGwG,KACjCsD,GAAMA,IAAOZ,EAAIqB,WAAWvK,EAAK,MAC7BkJ,EAAIqB,WAAWnI,OAAO,EAAIpC,EAAK,GAC/BkJ,EAAIsB,aAAaV,EAAIZ,EAAIqB,WAAWvK,EAAK,KACpC8J,IAAOZ,EAAIqB,WAAWrB,EAAIqB,WAAWnI,OAAO,IACjD8G,EAAI1E,YAAYsF,OArZtB9D,kBAA6B,SCZlCyE,eA8BTrQ,eAAqBgF,4CACjB,MAAMsL,EAAOC,KAAKC,MAClB,GAAGlQ,KAAKmQ,WAAW5P,IAAImE,EAAO0L,KAAK,CAC/B,MAAMC,EAAMrQ,KAAKmQ,WAAW7P,IAAIoE,EAAO0L,KACvC,GAAGJ,EAAOK,EAAIL,KAAOhQ,KAAKsQ,eAAiB3J,KAAK4J,QAAQF,EAAIG,OAAO9L,EAAO8L,QACtE,OAOR,OAJAxQ,KAAKmQ,WAAWjQ,IAAIwE,EAAO0L,IAAI,CAC3BJ,KAAKA,EACLQ,OAAO9L,EAAO8L,SAEX,IAAInP,SAAQ,CAACC,EAASC,KACH,iBAAXmD,IACPA,EAAS,CACL0L,IAAK1L,IAGbA,EAAO8L,OAAS9L,EAAO8L,QAAU,GAE7B9L,EAAO+L,OACP/L,EAAO8L,OAAOE,MAAQC,KAAKC,UAE/B,IAAIR,EAAc1L,EAAO0L,IACzB,MAAMS,GAAkC,IAAjBnM,EAAOmM,MACxBC,EAAsB,IAAIC,eAEhCD,EAAIE,gBAAkBtM,EAAOsM,gBAE7B,MAAMnO,GAAkB6B,EAAO7B,QAAU,OAAOzC,cAEhD0Q,EAAIrM,QAAUoM,EAAQnM,EAAOD,QAAU,EAEvCqM,EAAIG,OAAS,KACT,GAAmB,MAAfH,EAAII,OAAgB,CACpB,IAAI/J,EAAI2J,EAAIK,aACZ,GAAoB,SAAhBzM,EAAO4H,KACP,IACInF,EAAIiK,KAAKC,MAAMlK,GACjB,MAAOvF,GACLL,EAAO,CAAE+K,KAAM,cAGvBhL,EAAQ6F,QAER5F,EAAO,CAAE+K,KAAM,QAAS8D,IAAKA,KAIrCU,EAAIQ,UAAY,IAAM/P,EAAO,CAAE+K,KAAM,YACrCwE,EAAIS,QAAU,IAAMhQ,EAAO,CAAE+K,KAAM,QAAS8D,IAAKA,IAEjD,IAAIpN,EAAO,KACX,OAAQH,GACJ,IAAK,MAED,IAAI2O,EACJ,GAAI7K,KAAK8K,SAAS/M,EAAO8L,QAAS,CAC9B,IAAIkB,EAAe,GACnB,IAAI,IAAIpL,KAAKC,OAAOC,KAAK9B,EAAO8L,QAAQ,CACpC,MAAMhI,EAAI9D,EAAO8L,OAAOlK,GACrBkC,MAAAA,GAGHkJ,EAAG7G,KAAKvE,EAAI,IAAMkC,GAEtBgJ,EAAKE,EAAGC,KAAK,UAENpI,IAAPiI,KAC0B,IAAtBpB,EAAIrI,QAAQ,KACZqI,GAAO,IAAMoB,EAEbpB,GAAO,IAAMoB,GAIrB,MACJ,IAAK,OACD,GAAI9M,EAAO8L,kBAAkBoB,SACzB5O,EAAO0B,EAAO8L,WACX,CACH,IAAIqB,EAAe,IAAID,SACvB,IAAI,IAAItL,KAAKC,OAAOC,KAAK9B,EAAO8L,QAAQ,CACpC,MAAMhI,EAAI9D,EAAO8L,OAAOlK,GACrBkC,MAAAA,GAGHqJ,EAAGC,OAAOxL,EAAGkC,GAEjBxF,EAAO6O,GAKnBf,EAAIiB,KAAKlP,EAAQuN,EAAKS,EAAOnM,EAAOsN,KAAMtN,EAAOuN,KAE7CvN,EAAOwN,QACPvL,KAAKwL,YAAYzN,EAAOwN,QAAQzD,SAASnJ,IACrCwL,EAAIsB,iBAAiB9M,EAAMZ,EAAOwN,OAAO5M,OAGjDwL,EAAIuB,KAAKrP,MACVsP,OAAOpI,IACN,OAAQA,EAAGoC,MACP,IAAK,QACD,MAAM,IAAI1D,OAAO,YAAa2J,eAAapQ,SAAmB,SAAG+H,EAAGkG,KACxE,IAAK,UACD,MAAM,IAAIxH,OAAO,WACrB,IAAK,YACD,MAAM,IAAIA,OAAO,oBAQjClJ,oBACI,MAAMsQ,EAAOC,KAAKC,MAClB,IAAI,IAAIpE,KAAO9L,KAAKmQ,WAAW3J,OACxBwJ,EAAOhQ,KAAKmQ,WAAW7P,IAAIwL,GAAKkE,KAAOhQ,KAAKsQ,eAC3CtQ,KAAKmQ,WAAWpP,OAAO+K,IAnJ5BiE,6BAAuB,IAMvBA,0BAA6B,IAAIvP,UCR9BgS,MAsDV9R,YAAYgE,EAAkB0E,GAC1B,GA/CJpJ,YAAuB,GAIvBA,UAAW,GAIXA,cAAwB,GAuCf0E,IAAUiC,KAAK8L,QAAQ/N,EAAOgO,MAAnC,CAGA1S,KAAK0F,GAAKiB,KAAKC,QAEf,IAAI,IAAI+L,KAAKpM,OAAOC,KAAK9B,GACrB1E,KAAK2S,GAAKjO,EAAOiO,GAErB3S,KAAKoJ,OAASA,EAEXpJ,KAAK0S,MACJ1S,KAAKqR,QAENjI,GACCA,EAAOwJ,SAAS5S,MAGhB0E,EAAOmO,QAAUhT,MAAMC,QAAQ4E,EAAOmO,SACtCnO,EAAOmO,OAAOpE,SAASnJ,IACnB,IAAIkN,MAAMlN,EAAKtF,UASpB4S,SAASE,GACZ9S,KAAKuN,SAAS1C,KAAKiI,GACnBA,EAAM1J,OAASpJ,KAMXqR,QACJ,IAAI0B,EAAwB/S,KAAK0S,KAAKM,MAAM,KACxCjE,EAAa/O,KAAKoJ,OAClB6J,EAAsB,GACtBC,GAAqB,EACrBC,EAAiB,GACrB,IAAK,IAAIhI,EAAI,EAAGA,EAAI4H,EAAQrL,OAAQyD,IAAK,CACrC,IAAI3C,EAAIuK,EAAQ5H,GAAG7C,OACnB,GAAU,KAANE,EAAJ,CAKA,GAAIA,EAAEZ,WAAW,KACQ,IAAjBqL,EAAMvL,SACNwL,EAAa/H,GAEjB8H,EAAMpI,KAAKrC,EAAEhB,UAAU,QACpB,CACH0L,GAAc,EACdD,EAAQ,GACRjT,KAAK0S,KAAOlK,EACZ,IAAI4K,EAAI,EACR,KAAOA,EAAIrE,EAAKxB,SAAS7F,OAAQ0L,IAAK,CAClC,IAAIjM,EAAI4H,EAAKxB,SAAS6F,GACtB,GAAIjM,EAAEuL,OAASlK,EAAG,CACduG,EAAO5H,EACP,OAKJiM,IAAMrE,EAAKxB,SAAS7F,SACJ,KAAZyL,IACA,IAAIX,MAAM,CAAEE,KAAMS,GAASpE,GAC3BA,EAAOA,EAAKxB,SAASwB,EAAKxB,SAAS7F,OAAS,IAEhDyL,EAAU3K,GAKlBxI,KAAKwQ,QAAuB,IAAd0C,EAAgB,GAAGD,OAjC7BF,EAAQrH,OAAOP,IAAK,IAyChCkI,QACI,IAAIlM,EAAI,IAAIqL,MAUZ,OATAjM,OAAO+M,oBAAoBtT,MAAMyO,SAAQnJ,IACzB,SAATA,IAGH6B,EAAE7B,GAAQtF,KAAKsF,OAEhBtF,KAAKgD,OACJmE,EAAEnE,KAAO2D,KAAK0M,MAAMrT,KAAKgD,OAEtBmE,GC7Gf,IAAYoM,yBAAAA,EAAAA,iBAAAA,uCAQRA,6BAIAA,+BCnDSC,OAiDT9T,UAAUgT,GAEFA,IAAS1S,KAAKyT,eAKmB,IAAjCzT,KAAKuL,SAASxD,QAAQ2K,IACtB1S,KAAKuL,SAASV,KAAK6H,GAIvBgB,YAAW,KACP1T,KAAK2T,SACN,IAMCjU,cAEJ,GAA6B,IAAzBM,KAAKuL,SAAS7D,OACd,OAGJ,IAAIgL,EAAe1S,KAAKuL,SAASK,QACjC5L,KAAK4T,MAAMlB,GAAM1Q,MAAK,KAElBhC,KAAK2T,UAQLjU,aAAmBgT,4CACvB,IAEImB,EAFAC,EAAO9T,KAAKuQ,QAAQvQ,KAAKyT,YAAaf,GAG1C,GAAgB,OAAZoB,EAAK,IAKL,GAHAD,EAAexO,cAAc0O,UAG1B/T,KAAKgU,aAAaxO,KAAK,EAAE,CACxB,MAAMyO,EAAMjU,KAAKgU,aAAaxN,OAAO7E,OAAOF,MAC5C,GAAGwS,IAAQJ,EAAanO,GAAG,CACvB,MAAMU,EAAIf,cAAc/E,IAAI2T,GACzB7N,IACCyN,EAAezN,UAK3ByN,QAAqB7T,KAAKkU,UAAUJ,EAAK,IAG7C,IAAK,IAAI3I,EAAI2I,EAAK,GAAGpM,OAAS,EAAGyD,GAAK,EAAGA,IAAK,CAC1C,MAAMhE,EAAI2M,EAAK,GAAG3I,GAClB,IAAKhE,EAAE7E,OACH,SAEJ,MAAMA,QAAuBtC,KAAKkU,UAAU/M,GACxCR,KAAKwN,WAAWnU,KAAKoU,iBACrBpU,KAAKoU,eAAe9R,EAAOE,OAE3BmE,KAAKwN,WAAWhN,EAAEkN,UAClBlN,EAAEkN,QAAQ/R,EAAOE,OAGrBxC,KAAKsU,eAAevT,OAAOuB,EAAOoD,IAElCpD,EAAOiS,UAEX,GAAuB,IAAnBT,EAAK,GAAGpM,OAAc,CACtB,IAAIxE,EAAe4Q,EAAK,GACxB,GAAc,OAAV5Q,EAAgB,CAChB,MAAMZ,QAAuBtC,KAAKkU,UAAUhR,GAE5ClD,KAAKwU,aAAalS,EAAQY,EAAO4Q,EAAK,GAAKA,EAAK,GAAGxR,OAAS,YAIhE,IAAK,IAAImS,EAAK,EAAGA,EAAKX,EAAK,GAAGpM,OAAQ+M,IAAM,CACxC,MAAMvR,EAAe4Q,EAAK,GAAGW,GAE7B,IAAKvR,IAAUA,EAAMZ,OACjB,SAEJ,MAAMA,QAAuBtC,KAAKkU,UAAUhR,GAE5ClD,KAAKwU,aAAalS,EAAQY,EAAO2Q,GAE7BlN,KAAKwN,WAAWnU,KAAK0U,iBACrB1U,KAAK0U,eAAepS,EAAOE,OAG3BmE,KAAKwN,WAAWjR,EAAMyR,UACtBzR,EAAMyR,QAAQrS,EAAOE,OAEzBqR,EAAevR,EAKvB,GAAwB,IAApBtC,KAAK4U,WAAkB,CACvB,IAAIC,GAAgBrB,OAAOsB,UAAU,IAAMpC,EAEvCA,EAAK9K,WAAW5H,KAAKyT,aACrBsB,QAAQC,aAAaH,EAAO,GAAIA,GAEhCE,QAAQE,UAAUJ,EAAO,GAAIA,GAIrC7U,KAAKyT,YAAcf,EAEnB1S,KAAK4U,WAAa,KAOflV,gBAAgBgT,GACnB1S,KAAKkV,GAAGxC,GAQJhT,iBAAuBwD,4CAC3B,IAAIZ,EAASY,EAAMZ,OAEnB,MAAsB,iBAAXA,EACAA,GAGU,iBAAXA,IACNA,QAAe+C,cAAcsO,KAAKrR,IAGhB,mBAAXA,IACPY,EAAMZ,OAAS+C,cAAc/E,IAAIgC,IAE9BY,EAAMZ,WAQT5C,eAAemV,EAAeM,GAElC,IAAIC,EAAqB,KACrBC,EAAqB,KAErBR,IAEAO,EAAOpV,KAAKsV,aAAaT,GAAO,IAEhCM,IACAE,EAAOrV,KAAKsV,aAAaH,IAG7B,IAAII,EAAM,EACG,OAATH,IACAG,EAAMH,EAAK1N,QAGF,OAAT2N,EACIA,EAAK3N,OAAS6N,IACdA,EAAMF,EAAK3N,QAGf6N,EAAM,EAGV,IAAIC,EAAU,GAEVC,EAAU,GACVtK,EAAI,EACR,IAAKA,EAAI,EAAGA,EAAIoK,GAERH,EAAKjK,GAAGzF,KAAO2P,EAAKlK,GAAGzF,GAFVyF,IAIb,GAAIiG,KAAKsE,UAAUN,EAAKjK,GAAGnI,QAAUoO,KAAKsE,UAAUL,EAAKlK,GAAGnI,MAAO,CAC/DmI,IACA,MAQC,OAATiK,IACAI,EAAUJ,EAAKO,MAAMxK,IAIZ,OAATkK,IACAI,EAAUJ,EAAKM,MAAMxK,IAIzB,IAAIyK,EAAY,KAEZC,EAAY,KAChB,GAAIR,GAAQlK,EAAI,EAEZ,IAAK,IAAIiI,EAAIjI,EAAI,EAAGiI,GAAK,EAAGA,IACxB,GAAKwC,GAKE,IAAKC,GACJR,EAAKjC,GAAG9Q,OAAQ,CAChBuT,EAAKR,EAAKjC,GACV,YAPJ,GAAIiC,EAAKjC,GAAG9Q,OAAQ,CAChBsT,EAAKP,EAAKjC,GACV,SAUhB,MAAO,CAACwC,EAAIJ,EAASC,EAASI,GAU3BnW,sBAAsB4C,EAAgBoQ,EAAclQ,EAAYsT,GACnE,IAAKtT,IAAUsT,EACX,OAEJ,IAAInL,EAAM6I,OAAOc,eAAehU,IAAIgC,EAAOoD,IACtCiF,OAEyEpB,IAAnEoB,EAAIoL,MAAKzQ,GAAQA,EAAK9C,QAAUA,GAAS8C,EAAKwQ,QAAUA,KAC/DnL,EAAIE,KAAK,CAAE6H,KAAMA,EAAMlQ,MAAOA,EAAOsT,MAAOA,IAF5CtC,OAAOc,eAAepU,IAAIoC,EAAOoD,GAAI,CAAC,CAAEgN,KAAMA,EAAMlQ,MAAOA,EAAOsT,MAAOA,KAYzEpW,oBAAoB4C,EAAgBY,EAAc8S,GACtD,MAAMC,EAAKjW,KAEX,IAAI2S,EAAI,CACJD,KAAMxP,EAAMwP,MAMhB,GAJK/L,KAAK8L,QAAQvP,EAAMF,QACpB2P,EAAQ,KAAIzP,EAAMF,MAEtBV,EAAOE,MAAc,OAAImQ,EACtBqD,EACC,GAAGA,EAAGE,QAAU3C,eAAa4C,QACzB7T,EAAO8T,aAA0BJ,EAAGnI,WAAW2F,OAAOQ,aAAa1T,IAAI0V,EAAGtQ,MAE1EpD,EAAO+T,SACPrW,KAAKsW,aAAaN,EAAI9S,EAAMqT,eAE5B,GAAGP,EAAY,QAAE,CACb,MAAMQ,EAAMR,EAAY,QACxBA,EAAY,QAAKxT,IACbgU,EAAIhU,GACJF,EAAO8T,aAA0BJ,EAAGnI,WAAW2F,OAAOQ,aAAa1T,IAAI0V,EAAGtQ,MAE1EpD,EAAO+T,SACPJ,EAAGK,aAAaN,EAAG9S,EAAMqT,UAEzBP,EAAY,QAAIQ,QAGpBR,EAAY,QAAKxT,IACbF,EAAO8T,aAA0BJ,EAAGnI,WAAW2F,OAAOQ,aAAa1T,IAAI0V,EAAGtQ,MAE1EpD,EAAO+T,SACPJ,EAAGK,aAAaN,EAAG9S,EAAMqT,iBAElBP,EAAY,SAa/BtW,oBAAoB4C,EAAgBoQ,GACxC,IAAI/H,EAAM6I,OAAOc,eAAehU,IAAIgC,EAAOoD,IAC3C,GAAKiF,EAGL,IAAK,IAAIgI,KAAKhI,EACVgI,EAAEnQ,MAAMmQ,EAAEmD,OAASnD,EAAED,OAASA,EAUtChT,oBAAoBgT,EAAcW,GAC9B,IAAKrT,KAAKsD,KACN,MAAO,GAEX,IAAIyP,EAAoBL,EAAKM,MAAM,KAC/BjE,EAAc/O,KAAKsD,KACnB4P,EAAqB,EACrBuD,EAAuB,GACvBF,EAAmB,GACnBG,EAAiB1W,KAAKsD,KAC1B,IAAK,IAAI6H,EAAI,EAAGA,EAAI4H,EAAQrL,OAAQyD,IAAK,CACrC,IAAI3C,EAAYuK,EAAQ5H,GAAG7C,OAC3B,GAAU,KAANE,EACA,SAEJ,IAAIuN,GAAgB,EACpB,IAAK,IAAI3C,EAAI,EAAGA,EAAIrE,EAAKxB,SAAS7F,OAAQ0L,IACtC,GAAIrE,EAAKxB,SAAS6F,GAAGV,OAASlK,EAAG,CAEzBkO,IAAY1W,KAAKsD,OACjBoT,EAAQH,SAAWA,EACnBG,EAAQ1T,KAAO+L,EAAK/L,KACpByT,EAAO5L,KAAK6L,IAIhB3H,EAAOsE,EAAQtE,EAAKxB,SAAS6F,GAAGC,QAAUtE,EAAKxB,SAAS6F,GAExDrE,EAAK/L,KAAO,GACZ0T,EAAU3H,EACVgH,GAAO,EAEP7C,EAAa,EACb,MAIRqD,GAAY,IAAM/N,EAEbuN,GACG7C,EAAanE,EAAKyB,OAAO9I,SACzBqH,EAAK/L,KAAK+L,EAAKyB,OAAO0C,MAAiB1K,GASnD,OAJIuG,IAAS/O,KAAKsD,OACdyL,EAAKwH,SAAWA,EAChBE,EAAO5L,KAAKkE,IAET0H,GA5ZIjD,gBAA0B,GAc3BA,kBAAqB,EAKpBA,sBAA0C,IAAIhT,IAK/CgT,oBAAoC,IAAIhT,IAKxCgT,YAAa,IAAIhB,MAoYnCmE,OAAOC,iBAAiB,YAAY,SAAUhV,GAE1C,MAAMsU,EAAQnB,QAAQmB,MACjBA,IAGL1C,OAAOoB,WAAa,EACpBpB,OAAO0B,GAAGgB,aCrbDW,UAELnX,kBACNmX,UAAUC,MAAMrI,SAASnJ,IACrBqB,KAAKwN,WAAW7O,EAAKyR,QACpBzR,EAAK0R,OACP1R,EAAKyR,KAAKtO,KAAKnD,EAAK0R,QAEpB1R,EAAKyR,WAUFrX,aAAauX,GACnBJ,UAAUK,WACPP,OAAOQ,sBACTR,OAAOQ,sBAAsBN,UAAUjD,OAEvC+C,OAAOjD,WAAWmD,UAAUjD,MAAMqD,GAAc,IAS3CvX,eAAe8W,EAAaQ,GAClC,IAAIrQ,KAAKwN,WAAWqC,GACnB,MAAM,IAAI5N,OAAO,SAAS,oBAAoB,IAAI,YAGnDiO,UAAUC,MAAMjM,KAAK,CAACkM,KAAKP,EAAIQ,OAAOA,IAOhCtX,kBAAkB8W,GACxB,IAAI7P,KAAKwN,WAAWqC,GACnB,MAAM,IAAI5N,OAAO,SAAS,uBAAuB,IAAI,YAEtD,IAAIkC,GAAO,GACkC,KAAzCA,EAAM+L,UAAUC,MAAM/O,QAAQyO,KACjCK,UAAUC,MAAMpL,OAAOZ,EAAI,aCYdsM,EAAgBjX,EAAckX,EAAkBC,GAC5D,OAAOzW,iBAAiB0W,QAAQpX,EAAKkX,EAAQC,GD9DjCT,gBAAmB,+BEDrBjO,eAAe4O,MACzB9W,YAAY+W,EAAiB7B,EAAWC,EAAW6B,EAAWC,GAC1DC,MAAMH,GACN,IAAII,EAAatF,eAAa/O,UAAUiU,GACxC,QAAWlO,IAARsO,EAEC,YADA7X,KAAK6I,QAAU,QAInB,IAAI2H,EAAuB,CAACqH,GAC5B,IAAI,IAAI1M,EAAE,EAAEA,EAAE2M,UAAUpQ,OAAOyD,IAC3BqF,EAAO3F,KAAKiN,UAAU3M,IAE1BnL,KAAK6I,QAAU7I,KAAK+G,QAAQ9E,MAAM,KAAKuO,GAQnCzJ,QAAQ8E,EAAa+J,EAAUC,EAAU6B,EAAUC,EAAUI,GACjE,IAAI7Q,EACA8Q,EAAOF,UACPzQ,EAAQ,EACZ,MAC8C,IAAtCwE,EAAI9D,QAAQ,IAAOV,EAAQ,MAC3BH,EAAM,IAAI+Q,OAAO,MAAQ5Q,EAAQ,MAAO,KACxCwE,EAAMA,EAAIqM,QAAQhR,EAAK8Q,EAAK3Q,EAAQ,IACpCA,IAKR,OAAOwE,SChCFlF,KAcFjH,eACH,OAAOM,KAAKmY,cAMTzY,oBACH,CACI,YAAY,UAAU,QAAQ,OAAO,QACrC,OAAO,QAAQ,UAAU,SAAS,KAClC,SAAS,OAAO,OAAO,OAAO,QAC9B,QAAQ,MAAM,WAAW,OAAO,KAChC,KAAK,aAAa,MAAM,MAAM,OAC9B,OAAO,SAAS,QAAQ,SAAS,OACjC,QAAQ,OAAO,MAAM,OAAO,QAC5B,SAAS,MAAM,QAAQ,OAAO,QAC9B,OAAO,OAAQ,MAAM,MAAM,OAC3B,WAAW,WAAW,QAAQ,gBAAgB,OAC9C,MAAM,SAAS,SAAS,YAAY,SACpC,gBAAgB,YAAY,WAC9B+O,SAAQnJ,IACNtF,KAAKoY,WAAWlY,IAAIoF,GAAK,MAQ1B5F,iBAAiBS,GACpB,OAAOH,KAAKoY,WAAW7X,IAAIJ,GAaxBT,aAAa2Y,EAAgBC,EAA4BC,GAC5D,IAAItC,EAAKjW,KACLwY,EAA4B,IAAIC,QACpC,OAAOpF,EAAMgF,EAAQC,EAAQC,GAS7B,SAASlF,EAAMxH,EAAKyM,EAAQC,GAExB,IAAK1M,GAAsB,iBAARA,GAAoBlF,KAAKwN,WAAWtI,GACnD,OAAOA,EAEX,IAAII,EAGJ,OAAIJ,EAAIwH,OAAS1M,KAAKwN,WAAWtI,EAAIwH,OAC1BxH,EAAIwH,MAAMkF,IACVtC,EAAGxE,SAAS5F,IACnBI,EAAM,IAAI1F,OAEViS,EAAItY,IAAI2L,EAAKI,GACb1F,OAAO+M,oBAAoBzH,GAAK4C,SAASiK,IAEjCJ,IACIA,EAAO5X,cAAgBuX,QAAmBK,EAAQjO,KAAKqO,IACpD/R,KAAK7G,QAAQwY,IAAmBA,EAAQ9M,SAASkN,MAK5DzM,EAAIyM,GAAQC,EAAY9M,EAAI6M,GAAOJ,EAAQC,QAExCtC,EAAG2C,MAAM/M,IAChBI,EAAM,IAAIzL,IAEVqL,EAAI4C,SAAQ,CAAChN,EAAOqK,KAEZwM,IACIA,EAAO5X,cAAgBuX,QAAmBK,EAAQjO,KAAKyB,IAC5CwM,EAAQ9M,SAASM,KAIpCG,EAAI/L,IAAI4L,EAAK6M,EAAYlX,EAAO6W,EAAQC,QAErCtC,EAAGnW,QAAQ+L,KAClBI,EAAM,IAAIpM,MAEVgM,EAAI4C,SAAQ,SAAUnJ,EAAM6F,GACxBc,EAAId,GAAKwN,EAAYrT,EAAMgT,EAAQC,OAGpCtM,GASX,SAAS0M,EAAYlX,EAAO6W,EAAQC,GAChC,GAAqB,iBAAV9W,IAAuBkF,KAAKwN,WAAW1S,GAAQ,CACtD,IAAIoX,EAAK,KAMT,OAFIA,EAHCL,EAAIjY,IAAIkB,GAGJ+W,EAAIlY,IAAImB,GAFR4R,EAAM5R,EAAO6W,EAAQC,GAIvBM,EAEX,OAAOpX,GAQR/B,aAAaoZ,EAAaC,EAAaC,EAAaC,EAAaC,EAAaC,GACjF,IAAIlD,EAAKjW,KACT,IAAK,IAAImL,EAAI,EAAGA,EAAI2M,UAAUpQ,OAAQyD,IAClC,IAAKnL,KAAKyR,SAASqG,UAAU3M,IACzB,MAAM,IAAIvC,OAAO,SAAU,aAAcuC,EAAI,GAAI,UAGzD,IAAIiO,EAAS7S,OAAO8S,OAAOpX,MAAM,KAAM6V,WAEvC,OAEA,SAAgBzH,GACZ,IAAK,IAAIsC,KAAKpM,OAAOC,KAAK6J,IAClB4F,EAAGxE,SAASpB,EAAIsC,KAAOsD,EAAGnW,QAAQuQ,EAAIsC,OACtCyG,EAAOzG,GAAKsD,EAAG5C,MAAM+F,EAAOzG,KANxC2G,CAAOF,GACAA,EAeJ1Z,cAAc6Z,EAAMC,GAQvB,OAPIjT,OAAO8S,OACP9S,OAAO8S,OAAOE,EAAMC,GAEpBxZ,KAAKmS,YAAYqH,GAAM/K,SAAQ,SAAUzB,GACrCuM,EAAKvM,GAAKwM,EAAKxM,MAGhBuM,EASJ7Z,eAAemM,EAAQI,GAC1B,OACA,SAASwN,EAAIX,EAAGC,GACZ,GAAGD,IAAOC,EACN,OAAO,EAEX,IAAIW,EAAQnT,OAAOC,KAAKsS,GACpBa,EAAQpT,OAAOC,KAAKuS,GACxB,GAAGW,EAAMhS,SAAWiS,EAAMjS,OACtB,OAAO,EAEX,IAAI,IAAIpB,KAAKoT,EACT,GAAoB,iBAAVZ,EAAGxS,IAAoC,iBAAVyS,EAAGzS,GAAgB,CACtD,IAAIa,EAAIsS,EAAIX,EAAGxS,GAAGyS,EAAGzS,IACrB,IAAIa,EACA,OAAO,OAET,GAAG2R,EAAGxS,KAAOyS,EAAGzS,GAClB,OAAO,EAGf,OAAO,EApBJmT,CAAI5N,EAAII,GA4BZvM,mBAAmB2Q,GACtB,OAAKA,EAGE9J,OAAO+M,oBAAoBjD,GAFvB,GAUR3Q,kBAAkB8W,GACrB,OAAOA,MAAAA,GAAqCA,EAAI9V,cAAgBuG,SAQ7DvH,eAAe2Q,GAClB,OAAOxQ,MAAMC,QAAQuQ,GAOlB3Q,aAAa2Q,GAChB,OAAOA,MAAAA,GAAqCA,EAAI3P,cAAgBF,IAQ7Dd,gBAAgB2Q,GACnB,OAAOA,MAAAA,GAAqCA,EAAI3P,cAAgB6F,OAQ7D7G,aAAa8I,GAChB,OAAOoR,OAAOC,UAAUrR,GAOrB9I,gBAAgB8I,GACnB,MAAoB,iBAANA,EAQX9I,iBAAiB8I,GACpB,MAAoB,kBAANA,EAOX9I,gBAAgB8I,GACnB,MAAoB,iBAANA,EAQX9I,sBAAsB8I,GACzB,MAAO,cAAc6B,KAAK7B,GAQvB9I,eAAe2Q,GAClB,GAAIA,MAAAA,EACA,OAAO,EACX,IAAIzK,SAAYyK,EAChB,GAAIrQ,KAAKyR,SAASpB,GAAM,CACpB,IAAI7J,EAAOD,OAAOC,KAAK6J,GACvB,QAAa9G,IAAT/C,EACA,OAAuB,IAAhBA,EAAKkB,YAEb,GAAW,WAAP9B,EACP,MAAe,KAARyK,EAEX,OAAO,EASJ3Q,mBAAmBoa,EAAeC,GACrC,IAAIC,EAAcF,EAAQG,WACtBC,EAAcJ,EAAQK,YAC1B,GAAc,OAAVH,EACA,OAEJA,EAAM1K,YAAYwK,IACW9Z,KAAKF,QAAQia,GAAiBA,EAAQ,CAAOA,IAClEtL,SAAQ,SAAUM,GAClBmL,MAAAA,EACAF,EAAMlQ,YAAYiF,GAElBiL,EAAMlK,aAAaf,EAAMmL,MAS9Bxa,aAAakO,GAEhB,IAAImM,EAAkBnM,EAAGiC,WACzB,IAAK,IAAI1E,EAAI4O,EAAMrS,OAAS,EAAGyD,GAAK,EAAGA,IACnCyC,EAAG0B,YAAYyK,EAAM5O,IAWtBzL,kBAAkB0a,EAA4BC,GACjD,GAAIra,KAAKsa,SAASF,GAAY,CAG1B,IADU,QACF/P,KAAa+P,GAGjB,MAAM,IAAIxR,OAAO,SAAU,kBAAmB,IAAK,cAAe,QAFlEwR,EAAYR,OAAeQ,GAMnC,IAAIG,EAAa,IAAItK,KAAKmK,GAE1B,GAAII,MAAMD,EAAKE,UACX,MAAM,IAAI7R,OAAO,SAAU,kBAAmB,IAAK,cAAe,QAGtE,IAUIsB,EAVAyI,EAAI,CACJ,KAAM4H,EAAKG,WAAa,EACxB,KAAMH,EAAKI,UACX,KAAMJ,EAAKK,WACX,KAAML,EAAKK,WACX,KAAML,EAAKM,aACX,KAAMN,EAAKO,aACXC,EAAKR,EAAKS,mBAiBd,OAZI9Q,EAAG,OAAO5C,KAAK+S,MACfA,EAASA,EAAOnC,QAAQhO,EAAG,IAAKqQ,EAAKU,cAAgB,IAAIzT,UAAU,EAAI0C,EAAG,GAAGxC,UAGjF1H,KAAKmS,YAAYQ,GAAGlE,SAAQ,SAAUnI,IAC9B4D,EAAG,IAAI+N,OAAO,IAAM3R,EAAI,KAAKgB,KAAK+S,MAClCA,EAASA,EAAOnC,QAAQhO,EAAG,GAAmB,IAAfA,EAAG,GAAGxC,OAAWiL,EAAErM,IAAI,KAAOqM,EAAErM,IAAIkB,WAAWmL,EAAErM,GAAG,IAAIoB,aAK/F2S,EAASA,EAAOnC,QAAQ,OAAQ3F,eAAapN,SAASoV,EAAKE,SAAW,KAUnE/a,kBAAkBmM,EAAa+J,EAAUC,EAAU6B,EAAUC,EAAUI,GAC1E,IAAI7Q,EACA8Q,EAAOF,UACPzQ,EAAQ,EACZ,MAC8C,IAAtCwE,EAAI9D,QAAQ,IAAOV,EAAQ,MAC3BH,EAAM,IAAI+Q,OAAO,MAAQ5Q,EAAQ,MAAO,KACxCwE,EAAMA,EAAIqM,QAAQhR,EAAK8Q,EAAK3Q,EAAQ,IACpCA,IAKR,OAAOwE,EASJnM,aAAa8W,EAAenG,EAAU2H,GACzC,GAAKxB,EAGL,OAAO3Q,QAAQ5D,MAAMuU,EAAKnG,GAAO,KAAM2H,GAQpCtY,iBAAiBwb,GACpB,OAAOA,EAAMvJ,KAAK,KAAKuG,QAAQ,iBAAkB,KAQ9CxY,YAAYyb,GACf,OAAO,IAAIlU,SAAS,UAAUkU,KAAvB,GASJzb,kBAAkBqP,EAAiBrJ,EAAW0V,GAEjD,GADArM,EAAKjD,IAAM9L,KAAKgM,aAAa+C,EAAKjD,IAAIpG,GACnC0V,GAAQrM,EAAKxB,SACZ,IAAI,IAAIxN,KAAKgP,EAAKxB,SACd5G,KAAK0U,WAAWtb,EAAE2F,GAAG,GAW1BhG,mBAAmBqJ,EAAiB5I,EAAYsB,GAC/CsH,EAAIgE,SACJhE,EAAIgE,OAAS,IAEjBhE,EAAIgE,OAAO5M,GAAQsB,EAShB/B,oBAAoB4b,EAASC,GAQhC,OAAOD,EAAI,IAAMC,GA9eN5U,iBAAsB,EAKvBA,gBAAa,IAAInG,IA8enCmG,KAAK6U,mBCnfSC,UAmCV/a,YAAY4L,EAAa7K,GAErB,GADAzB,KAAK0F,GAAKiB,KAAKC,QACZ0F,IACCtM,KAAKsM,KAAOzL,iBAAiB6a,QAAQpP,IACjCtM,KAAKsM,MACL,MAAM,IAAI1D,OAAO,YAAY2J,eAAapQ,SAAoB,UAAEmK,GAIpE3F,KAAK2T,SAAS7Y,GACdzB,KAAKyB,MAAiBA,EAAO6G,OACxB7G,aAAiBgF,WACtBzG,KAAK2C,WAAalB,EAElBzB,KAAKyB,MAAQA,EAUd6F,KAAKhF,EAAcyG,GAEtB,QAAG/I,KAAK2b,WAGL3b,KAAK2C,aACJ3C,KAAKyB,MAAQzB,KAAK2C,WAAW4F,IAAIjG,EAAOyG,EAAIvG,QAEzCxC,KAAKsM,KAAK3L,OAAOsB,MAAMjC,KAAK,CAACsC,EAAOyG,KAMxCsK,QACH,IAAIpG,EAAI,IAAIwO,UAIZ,OAHAxO,EAAEX,KAAOtM,KAAKsM,KACdW,EAAEtK,WAAa3C,KAAK2C,WACpBsK,EAAExL,MAAQzB,KAAKyB,MACRwL,SC/EF2O,OA+CTlb,YAAY4B,EAAcuZ,EAAmBC,EAA8BzE,GAMvE,GALArX,KAAK0F,GAAKiB,KAAKC,QACf5G,KAAKsC,OAASA,EACdtC,KAAKG,KAAO0b,EAGRC,EAAU,CACV,IAAIlW,SAAYkW,EAChB,GAAW,WAAPlW,EAAiB,CACWkW,EAAUxT,OACjC0K,MAAM,KAAKvE,SAAQ,CAACnJ,EAAM6F,KAE3B,GADA7F,EAAOA,EAAKgD,OACF,IAAN6C,EACAnL,KAAKqX,QAAU/R,OAEf,OAAQA,GACJ,IAAK,OACDtF,KAAK+b,MAAO,EACZ,MACJ,IAAK,SACD/b,KAAKgc,QAAS,EACd,MACJ,IAAK,OACDhc,KAAKic,MAAO,EACZ,MACJ,IAAK,UACDjc,KAAKkc,SAAU,UAKjB,aAAPtW,IACPyR,EAAoByE,GAQ5B,GAJIzE,IACArX,KAAKqX,QAAUA,GAGf1N,SAASwS,WACT,OAAQnc,KAAKG,MACT,IAAK,QACDH,KAAKG,KAAO,MACZ,MACJ,IAAK,YACDH,KAAKG,KAAO,aACZ,MACJ,IAAK,UACDH,KAAKG,KAAO,WACZ,MACJ,IAAK,YACDH,KAAKG,KAAO,iBAIpB,OAAQH,KAAKG,MACT,IAAK,MACDH,KAAKG,KAAO,QACZ,MACJ,IAAK,aACDH,KAAKG,KAAO,YACZ,MACJ,IAAK,WACDH,KAAKG,KAAO,UACZ,MACJ,IAAK,YACDH,KAAKG,KAAO,aAarBic,SAAS9Z,EAAcyG,EAAiB5I,EAAcsB,GACzDa,EAAOsI,cAAcyR,cAAcrc,KAAK0F,GAAGqD,EAAI+C,IAAI3L,EAAKsB,GAUrD6a,SAASha,EAAcyG,EAAiB5I,GAC3C,OAAOmC,EAAOsI,cAAc2R,cAAcvc,KAAK0F,GAAGqD,EAAI+C,IAAI3L,GASvDqc,YAAYla,EAAcyG,EAAiB5I,GAC9C,OAAOmC,EAAOsI,cAAc6R,iBAAiBzc,KAAK0F,GAAGqD,EAAI+C,IAAI3L,GAO1Duc,WAAWpa,EAAcyG,GAC5BzG,EAAOsI,cAAc+R,gBAAgB3c,KAAK0F,GAAGqD,EAAI+C,YC7J5C8Q,WA2GZlc,YAAYmc,EAAc/Q,EAAcxJ,GA3BjCtC,oBAAyB,EAoBzBA,iBAAsB,EAQ5BA,KAAK8L,IAAMA,IAAQxJ,EAASA,EAAOwa,cAAgBnW,KAAKC,SACxD5G,KAAKoM,UAAY,EACbyQ,IACH7c,KAAKK,QAAUwc,GASVE,iBAAiB1Q,GAClBrM,KAAKqM,YAIVA,EAAWoC,SAASxB,IACnBjN,KAAKgd,gBAAgB/P,MAShB+P,gBAAgBva,GACtB,IAAKzC,KAAKqM,WACT,OAGD,IAAIvB,GAGK,KAFJA,EAAM9K,KAAKqM,WAAW4Q,WACxB3X,GAASA,EAAKgH,KAAKnM,OAASsC,MAG9BzC,KAAKqM,WAAWX,OAAOZ,EAAK,GAEE,IAA3B9K,KAAKqM,WAAW3E,eACZ1H,KAAKqM,WAUP6Q,aAAaza,EAAsBkN,GACzC,GAAK3P,KAAKqM,YAEH,GACNrM,KAAKqM,WAAW0J,MAAMzQ,GAASA,EAAKgH,KAAKnM,OAASsC,EAAU6J,KAAKnM,OAEjE,YAJAH,KAAKqM,WAAa,GAMnBrM,KAAKqM,WAAWxB,KAAKpI,GAEjBkN,GACH3P,KAAKmd,gBAQAA,gBACDnd,KAAKqM,YAGNrM,KAAKqM,WAAW3E,OAAS,GAC5B1H,KAAKqM,WAAWsD,MAAK,CAAClD,EAAGmD,IACjB/O,iBAAiB6a,QAAQjP,EAAEH,KAAKnM,MAAMS,KAC5CC,iBAAiB6a,QAAQ9L,EAAEtD,KAAKnM,MAAMS,MACnC,EACD,IAUCwc,aAAaC,GACnB,OACCrd,KAAKqM,aACiE,IAAtErM,KAAKqM,WAAW4Q,WAAW3X,GAASA,EAAKgH,KAAKnM,OAASkd,IAUlDC,aAAa5a,GACnB,GAAK1C,KAAKqM,WAGV,OAAOrM,KAAKqM,WAAW0J,MAAMzQ,GAASA,EAAKgH,KAAKnM,OAASuC,IAQnDsG,IAAID,EAAiB1B,GACtBrH,KAAKuN,WACTvN,KAAKuN,SAAW,IAEblG,EACHrH,KAAKuN,SAAS7B,OAAOrE,EAAO,EAAG0B,GAE/B/I,KAAKuN,SAAS1C,KAAK9B,GAEpBA,EAAIK,OAASpJ,KAOPud,OAAOxU,GACb,IAAI1B,EAAQrH,KAAKuN,SAASxF,QAAQgB,IACnB,IAAX1B,GACHrH,KAAKuN,SAAS7B,OAAOrE,EAAO,GAQvB1B,SAASsD,GAGf,GAFAjJ,KAAKwd,QAAQ,QAASvU,GAElBjJ,KAAKyd,iBAAmBzd,KAAKyd,gBAAgBjY,KAAO,EAAG,CAC1D,IAAImF,EAAe1B,EAAKX,OAAO0K,MAAM,OACrC,IAAK,IAAIvG,KAAK9B,EACH,KAAN8B,GAGJzM,KAAKyd,gBAAgB1c,OAAO0L,IASxBiR,YAAYzU,GAElB,IADSjJ,KAAK8M,QAAQ,SAErB,OAEI9M,KAAKyd,kBACTzd,KAAKyd,gBAAkB,IAAIjd,KAE5B,IAAImK,EAAM1B,EAAIX,OAAO0K,MAAM,OAC3B,IAAK,IAAIvG,KAAK9B,EACH,KAAN8B,GAGJzM,KAAKyd,gBAAgBvd,IAAIuM,GAAG,GAE7BzM,KAAK2d,gBAOChR,eAAeiR,GACrB,IAAIC,EAAS,GACb,IAAK,IAAIC,KAAMF,EAAQ,CACtB,IAAIjT,EAAMmT,EAAGxV,OAAO0K,MAAM,OAC1B,IAAK,IAAIvG,KAAK9B,EACR3K,KAAKyd,iBAAoBzd,KAAKyd,gBAAgBld,IAAIkM,IACjDoR,EAAOrS,SAASiB,IACpBoR,EAAOhT,KAAK4B,GAKhB,GAAIoR,EAAOnW,OAAS,EACnB,OAAOmW,EAAOlM,KAAK,KAQdoM,SAASC,GAEf,GADAhe,KAAKwd,QAAQ,QAASQ,GACD,iBAAVA,GAENhe,KAAKie,iBAAmBje,KAAKie,gBAAgBzY,KAAO,EAAG,CAC1D,IAAImF,EAAMqT,EAAM1V,OAAO0K,MAAM,WAC7B,IAAK,IAAIvG,KAAK9B,EAAK,CAClB,GAAU,KAAN8B,EACH,SAED,IAAIyR,EAAMzR,EAAEuG,MAAM,WAER,KADFkL,EAAI,GAAG5V,QAEdtI,KAAKyd,gBAAgB1c,OAAOmd,EAAI,GAAG5V,SAKvCtI,KAAK2d,gBAOCQ,YAAYC,GACbpe,KAAKyd,kBACTzd,KAAKyd,gBAAkB,IAAIjd,KAE5B,IAAImK,EAAMyT,EAAS9V,OAAO0K,MAAM,OAChC,IAAK,IAAIvG,KAAK9B,EACH,KAAN8B,GAGJzM,KAAKyd,gBAAgBvd,IAAIuM,GAAG,GAE7BzM,KAAK2d,gBAOCjR,eAAekR,GACrB,IAAIpF,EAAM,IAAIhY,IACd,IAAK,IAAIsd,KAAMF,EAAQ,CACtB,IAAIS,EAAKP,EAAGxV,OAAO0K,MAAM,WACzB,IAAK,IAAIzL,KAAK8W,EAAI,CACjB,GAAU,KAAN9W,EACH,SAED,IAAI2W,EAAM3W,EAAEyL,MAAM,WAEbhT,KAAKie,iBAAoBje,KAAKie,gBAAgB1d,IAAI2d,EAAI,KAC1D1F,EAAItY,IAAIge,EAAI,GAAIA,EAAI,KAKvB,GAAI1F,EAAIhT,KAAO,EACd,MAAO,IAAIgT,GAAKA,KAAKlT,GAASA,EAAKqM,KAAK,OAAMA,KAAK,KAS9C2M,QAAQC,GACd,GAAIve,KAAKmJ,MACR,OAAOnJ,KAAKmJ,MAAM5I,IAAIge,GAUjBzR,QAAQyR,EAAkBC,GAChC,GAAIxe,KAAKmJ,MACR,OAAOnJ,KAAKmJ,MAAM7I,IAAIie,GASjBE,QAAQF,EAAkB/V,GAC3BxI,KAAKmJ,QACTnJ,KAAKmJ,MAAQ,IAAI3I,KAED,UAAb+d,EACCve,KAAKie,iBAERje,KAAKie,gBAAgBS,QAEC,UAAbH,GACNve,KAAKyd,iBAERzd,KAAKyd,gBAAgBiB,QAGvB1e,KAAKmJ,MAAMjJ,IAAIqe,EAAU/V,GACzBxI,KAAK2d,gBAQCH,QAAQmB,EAAOC,GACrB,IAAId,EAAK9d,KAAK8M,QAAQ6R,GACtB,GAAKb,EAEE,GAAIje,MAAMC,QAAQge,GAAK,CAC7B,GAAIA,EAAGtS,SAASoT,GACf,OAAO,EAERd,EAAGjT,KAAK+T,OACF,CAAA,GAAId,IAAOc,EAGjB,OAAO,EAFP5e,KAAKye,QAAQE,EAAO,CAACb,EAAIc,SAPzB5e,KAAKye,QAAQE,EAAOC,GAWrB,OAAO,EAQDC,QAAQ1V,GACd,GAAKnJ,KAAKmJ,MAAV,CAGA,GAAIxC,KAAK7G,QAAQqJ,GAChB,IAAK,IAAI6D,KAAe7D,EACvBnJ,KAAKmJ,MAAMpI,OAAOiM,QAGnBhN,KAAKmJ,MAAMpI,OAAeoI,GAG3BnJ,KAAK2d,iBAQCmB,SAASC,EAAmBtd,GAC7BzB,KAAK+M,SACT/M,KAAK+M,OAAS,IAAIvM,KAEnBR,KAAK+M,OAAO7M,IAAI6e,EAAWtd,GAC3BzB,KAAK2d,gBAQCqB,SAASD,GACV/e,KAAK+M,SAGV/M,KAAK+M,OAAOhM,OAAOge,GACnB/e,KAAK2d,iBASCvB,SAAS9Z,EAAgBnC,EAAcsB,GAC7Ca,EAAOsI,cAAcqU,YAAYjf,KAAK8L,IAAK3L,EAAMsB,GAS3C6a,SAASha,EAAgBnC,GAC/B,OAAOmC,EAAOsI,cAAcsU,YAAYlf,KAAK8L,IAAK3L,GAQ5Cqc,YAAYla,EAAgBnC,GAClCmC,EAAOsI,cAAcuU,eAAenf,KAAK8L,IAAK3L,GAMvCwd,iBACiB,IAApB3d,KAAKoM,YACRpM,KAAKoM,UAAY,GAOZiH,QACN,IAAIpH,EAAkB,IAAI2Q,WAAW5c,KAAKK,QAASL,KAAK8L,KACxD,GAAI9L,KAAKK,QAAS,CAEjB,GAAIL,KAAKmJ,OAASnJ,KAAKmJ,MAAM3D,KAAO,EACnC,IAAK,IAAIwH,KAAKhN,KAAKmJ,MAClB8C,EAAIwS,QAAQzR,EAAE,GAAIA,EAAE,IAItB,GAAIhN,KAAK+M,QAAU/M,KAAK+M,OAAOvH,KAAO,EACrC,IAAK,IAAIwH,KAAKhN,KAAK+M,OAClBd,EAAI6S,SAAS9R,EAAE,GAAIA,EAAE,IAIvB,GAAIhN,KAAKqM,YAAcrM,KAAKqM,WAAW3E,OAAS,EAAG,CAClDuE,EAAII,WAAa,GACjB,IAAK,IAAIY,KAAKjN,KAAKqM,WAClBJ,EAAII,WAAWxB,KAAKoC,EAAEoG,SAOxB,GAHApH,EAAIkB,OAASnN,KAAKmN,OAGdnN,KAAKuN,SACR,IAAK,IAAIxN,KAAKC,KAAKuN,SAClBtB,EAAIjD,IAAIjJ,EAAEsT,cAIZpH,EAAIwB,YAAczN,KAAKyN,YACvBxB,EAAI3C,YAActJ,KAAKsJ,YAGxB,OADA2C,EAAIG,UAAYpM,KAAKoM,UACdH,EAODqB,SAAS1K,GACV5C,KAAKmN,OAEAnN,KAAKmN,OAAO3B,SAAS5I,IAC9B5C,KAAKmN,OAAOtC,KAAKjI,GAFjB5C,KAAKmN,OAAS,CAACvK,IChkBlB,MAAMwc,EAAa,IAAIC,IACtB,uEAAuErM,MAAM,YASjEsM,SAmCZ5e,YAAY4B,GArBJtC,YAA4B,GAK5BA,aAAsB,GAKtBA,iBAAsB,EAKtBA,cAAmB,GAO1BA,KAAKsC,OAASA,EAQRyE,QAAQwY,GACd,IAAIA,EACH,OAOD,GAJAvf,KAAKwf,SAAWD,EAAWrH,QAAQ,0BAA2B,IAAI5P,OAClEiX,EAAavf,KAAKwf,SAElBxf,KAAKyf,gBAAgBF,GACM,IAAvBvf,KAAK0f,OAAOhY,OACf,MAAM,IAAIkB,OAAO,iBAGlB,IAAK,IAAIuC,EAAInL,KAAK0f,OAAOhY,OAAS,EAAGyD,GAAK,EAAGA,IAC5C,IAAKnL,KAAK0f,OAAOvU,GAAGwU,gBACYpW,IAA3BvJ,KAAK0f,OAAOvU,GAAG9K,SAClBL,KAAK4f,qBAAqB5f,KAAK0f,OAAOvU,KAElCnL,KAAK0f,OAAOvU,EAAI,GAAGwU,UAAU,CACjC3f,KAAK0f,OAAOvU,GAAGwU,UAAW,EAC1B,IAAIE,EAAO7f,KAAK0f,OAAOI,MACvB9f,KAAK0f,OAAOvU,EAAI,GAAGnC,IAAI6W,GAY1B,IAAI9W,EACJ,GATK/I,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,GAAGiY,WACxC3f,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,GAAGiY,UAAW,EAC/C3f,KAAK4f,qBAAqB5f,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,KAOxD1H,KAAK0f,OAAOhY,OAAS,EAExBqB,EAAM,IAAI6T,WAAW,MAAO5c,KAAK+f,SAAU/f,KAAKsC,QAEhDtC,KAAK0f,OAAOjR,SAASnJ,IACpByD,EAAIC,IAAI1D,MAETyD,EAAI4W,UAAW,MACT,CAAA,GAA0B,GAAtB3f,KAAK0f,OAAOhY,OAStB,MAAM,IAAIkB,OAAO,iBARb5I,KAAK0f,OAAO,GAAGrf,UAAYL,KAAK0f,OAAO,GAAGtC,aAAa,UAC1DrU,EAAM/I,KAAK0f,OAAO,IAElB3W,EAAM,IAAI6T,WAAW,MAAO5c,KAAK+f,SAAU/f,KAAKsC,QAChDyG,EAAIC,IAAIhJ,KAAK0f,OAAO,IACpB3W,EAAI4W,UAAW,GAKjB,OAAO5W,EAOAgX,SACP,OAAO/f,KAAKsC,OAAOwa,cAOZ2C,gBAAgBO,GACvB,KAAyB,IAAlBA,EAAOtY,QAKXsY,EAJEA,EAAOpY,WAAW,KAEJ,KAAboY,EAAO,GAEDhgB,KAAKigB,cAAcD,GAGnBhgB,KAAKkgB,gBAAgBF,GAItBhgB,KAAKmgB,YAAYH,GAUrBE,gBAAgBF,GAEvB,MAAMI,EAAQ,0BAA0B9Y,KAAK0Y,GAE7C,IAAII,EAgBH,OADApgB,KAAKqgB,QAAQxV,KAAKmV,EAAO,IAClBA,EAAOxY,UAAU,GAOzB,GArBCxH,KAAKsgB,QAAU,IAAI1D,WAClBwD,EAAM,GAAGla,cACTlG,KAAK+f,SACL/f,KAAKsC,QAGNtC,KAAK0f,OAAO7U,KAAK7K,KAAKsgB,SAEtBtgB,KAAKsgB,QAAQC,YAAcvgB,KAAKwf,SAAS9X,OAASsY,EAAOtY,OACzDsY,EAASA,EAAOxY,UAAU4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,QAAQ8Y,aAS1DR,EAAShgB,KAAKygB,kBAAkBT,IAGrBpY,WAAW,KASrB,OAPA5H,KAAKsgB,QAAQI,UAAY1gB,KAAKwf,SAAS9X,OAASsY,EAAOxY,UAAU,GAAGE,OAChE1H,KAAK2gB,UAAU3gB,KAAKsgB,WAClBtgB,KAAKsgB,QAAQM,YACjB5gB,KAAK4f,qBAAqB5f,KAAKsgB,SAEhCtgB,KAAK6gB,wBAECb,EAAOxY,UAAU,GAAGgZ,YAG3B,MAAM,IAAI5X,OAAO,aAAc5I,KAAKsgB,QAAQjgB,SAStCogB,kBAAkBT,GAEzB,KAAwB,GAAjBA,EAAOtY,SAAgBsY,EAAOpY,WAAW,MAAM,CAErD,MAAMwY,EACL,yFAAyF9Y,KACxF0Y,GAGF,GAAII,EAAO,CAEV,IAAIjgB,EAAqB,MAAdigB,EAAM,GAAG,GAASA,EAAM,GAAGla,cAAcka,EAAM,GAC1D,GAAa,MAATjgB,EAEHH,KAAK6gB,uBACL7gB,KAAKsgB,QAAQM,YAAa,MACpB,CAEN,IAAInf,EAAc2e,EAAM,GAErBA,EAAM,GAAGxY,WAAW,MAEpBwY,EAAM,GAAGxY,WAAW,KADpBwY,EAAM,GAAG5Y,UAAU,EAAG4Y,EAAM,GAAG1Y,OAAS,GAGxC0Y,EAAM,QALN7W,EAOC9H,GAASA,EAAMmG,WAAW,QAC7BnG,EAAQ,IAAIgF,WAAWhF,EAAM+F,UAAU,EAAG/F,EAAMiG,OAAS,IAEzD1H,KAAKsgB,QAAQlU,WAAa,GAGvBjM,EAAKyH,WAAW,MAEnB5H,KAAKsgB,QAAQpD,aAAa,IAAIzB,UAAUtb,EAAKqH,UAAU,GAAI/F,IACjDtB,EAAKyH,WAAW,MAE1B5H,KAAKsgB,QAAQhT,SACZ,IAAIsO,OAAO5b,KAAKsC,OAAQnC,EAAKqH,UAAU,GAAI/F,IAI5CzB,KAAKsgB,QAAQ7B,QAAQte,EAAMsB,IAI9B,IAAI2e,EAEG,CACN,GAAIpgB,KAAKsgB,QACR,MAAM,IAAI1X,OAAO,WAAY5I,KAAKsgB,QAAQjgB,SAE3C,MAAM,IAAIuI,OAAO,iBALjBoX,EAASA,EAAOxY,UAAU4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,QAAQ8Y,YAQ3D,OAAOR,EAQAC,cAAcD,GAErB,MAAMI,EAAQ,wBAAwB9Y,KAAK0Y,GAC3C,IAAII,EAkEH,MAAM,IAAIxX,OAAO,aAAc5I,KAAKsgB,QAAQjgB,SAlElC,CAEV,MAAMF,EAAOigB,EAAM,GAAGla,cAAcoC,OACpC,IAAItI,KAAKsgB,SAAWtgB,KAAKsgB,QAAQjgB,UAAYF,EAoBtC,CAON,GAA2B,IAAvBH,KAAK0f,OAAOhY,OACf1H,KAAK8gB,mBAAmB3gB,EAAM6f,OACxB,CAEN,IAAIe,EAAM,EACV,IAAK,IAAI5V,EAAInL,KAAK0f,OAAOhY,OAAS,EAAGyD,GAAK,EAAGA,IAC5C,IAAKnL,KAAK0f,OAAOvU,GAAGwU,UAAYxf,IAASH,KAAK0f,OAAOvU,GAAG9K,QAAS,CAChE0gB,EAAM5V,EACN,MAGF,GAAY,IAAR4V,EAAW,CAEd,IAAK,IAAI5V,EAAInL,KAAK0f,OAAOhY,OAAS,EAAGyD,GAAK4V,EAAK5V,IAM9C,QAL+B5B,IAA3BvJ,KAAK0f,OAAOvU,GAAG9K,SAAyB8K,IAAM4V,GAEjD/gB,KAAK4f,qBAAqB5f,KAAK0f,OAAOvU,KAGlCnL,KAAK0f,OAAOvU,EAAI,GAAGwU,SAAU,CACjC3f,KAAK0f,OAAOvU,GAAGwU,UAAW,EAC1B,IAAIE,EAAO7f,KAAK0f,OAAOI,MACvB9f,KAAK0f,OAAOvU,EAAI,GAAGnC,IAAI6W,GAGzB7f,KAAKsgB,aAAU/W,OAGfvJ,KAAK8gB,mBAAmB3gB,EAAM6f,GAIhC,OAAOA,EAAOxY,UAAU4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,OAAS,GAzDxD,GAAI1H,KAAK0f,OAAOhY,OAAS,EAExB,OAAOsY,EAAOxY,UAAU4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,OAAS,GAClD,GAA0B,GAAtB1H,KAAK0f,OAAOhY,OAEtB1H,KAAKghB,iBACLhhB,KAAKsgB,aAAU/W,MACT,CAGN,IAAIsW,EAAO7f,KAAK0f,OAAOI,MACvB9f,KAAKghB,iBACLhhB,KAAKsgB,QAAWtgB,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,GAAGiY,cAEjDpW,EADAvJ,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,GAGpC1H,KAAKsgB,QAAUtgB,KAAKsgB,QAAQtX,IAAI6W,GAAQ7f,KAAK0f,OAAO7U,KAAKgV,IA+C5D,OAAOG,EAAOxY,UAAU4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,OAAS,GAAG8Y,YAQpDL,YAAYH,GAEnB,MAAQA,EAAOpY,WAAW,MAA0B,IAAlBoY,EAAOtY,QACxC,GAAIsY,EAAOpY,WAAW,KAAM,CAE3B,MAAMqZ,EAAW,mBAAmB3Z,KAAK0Y,GACrCiB,GAEHjhB,KAAKqgB,QAAQxV,KAAK,IAAIpE,WAAWwa,EAAS,KAC1CjhB,KAAKkhB,YAAa,EAClBlB,EAASA,EAAOxY,UAAUyZ,EAAS5Z,MAAQ4Z,EAAS,GAAGvZ,UAGV,iBAAtC1H,KAAKqgB,QAAQrgB,KAAKqgB,QAAQ3Y,QAC7B1H,KAAKqgB,QAAQrgB,KAAKqgB,QAAQ3Y,SAAW,IACtC1H,KAAKqgB,QAAQxV,KAAK,KACrBmV,EAASA,EAAOxY,UAAU,QAErB,CAEN,MAAM4Y,EAAQ,aAAa9Y,KAAK0Y,GAChC,GAAII,EAAO,CACV,IAAI7V,EAGHA,GAFGvK,KAAKsgB,SAAWtgB,KAAKsgB,QAAQjgB,QAE1BL,KAAKmhB,cACVnB,EAAOxY,UAAU,EAAG4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,UAO7C1H,KAAKqgB,QAAQxV,KAAKN,GAEnByV,EAASA,EAAOxY,UAAU4Y,EAAM/Y,MAAQ+Y,EAAM,GAAG1Y,QAInD,IAAI0Z,EAAO,IAAIxE,gBAAWrT,EAAWvJ,KAAK+f,UA0C1C,OAzCG/f,KAAKkhB,YACPE,EAAK3T,YAAc,IAAIzN,KAAKqgB,SAE5Be,EAAKhV,WAAa,GAElBgV,EAAK9X,YAActJ,KAAKqgB,QAAQ1O,KAAK,IAGlC3R,KAAKsgB,SAEJtgB,KAAKkhB,YAGwB,IAA5BE,EAAK9X,YAAY5B,SAFrB1H,KAAKsgB,QAAQtX,IAAIoY,IAUdphB,KAAKkhB,YAG+B,IAAnCE,EAAK9X,YAAYhB,OAAOZ,SAF5B1H,KAAK0f,OAAO7U,KAAKuW,GAcnBA,EAAKzB,UAAW,EAEhB3f,KAAKkhB,YAAa,EAClBlhB,KAAKqgB,QAAU,GAERL,EAQAmB,cAAclZ,GAErB,GADU,WACFoC,KAAKpC,GAAM,CAClB,IAAIoZ,EAAM1X,SAASC,cAAc,OAEjC,OADAyX,EAAIC,UAAYrZ,EACToZ,EAAI/X,YAAc,GAE1B,OAAOrB,EAMAsZ,iBACP,IAAI5hB,EAAQF,qBAAqBa,IAAIN,KAAKsgB,QAAQjgB,SAC9CV,GACHkG,QAAQC,UAAUnG,EAAO,CAACK,KAAKsgB,QAAStgB,KAAKsC,SAE9C,MAAMyM,EAAO/O,KAAKsgB,QAElB,GAAIjb,cAAcmc,SAASzS,EAAK1O,SAAU,CACzC,MAAMohB,EAAiB,IAAIhG,UAAU,SAAU1M,EAAK1O,SACpDohB,EAAIjR,OAAS,CAAEkR,MAAO1hB,KAAKsC,OAAOoD,IAClCqJ,EAAKmO,aAAauE,GAClB1S,EAAK1O,QAAU,OAMTshB,aACP,IAQIC,EARA7Y,EAAM/I,KAAKsgB,QACf,GACEvX,EAAIwE,UACmB,IAAxBxE,EAAIwE,SAAS7F,QACZqB,EAAIqU,aAAa,UAKnB,IAAK,IAAIhK,EAAI,EAAGA,EAAIrK,EAAIwE,SAAS7F,OAAQ0L,IAAK,CAC7C,IAAIrT,EAAIgJ,EAAIwE,SAAS6F,GACjBrT,EAAEqd,aAAa,UAKdwE,EAQJ7Y,EAAIwE,SAAS7B,OAAO0H,IAAK,IANzBwO,EAAS,IAAIhF,WAAW,MAAO5c,KAAK+f,UACpC6B,EAAO1E,aAAa,IAAIzB,UAAU,SAElC1S,EAAIwE,SAAS7B,OAAO0H,EAAG,EAAGwO,IAK3BA,EAAO5Y,IAAIjJ,KAOLihB,iBACPhhB,KAAKuhB,iBACLvhB,KAAKsgB,QAAQnD,gBACbnd,KAAK2hB,aACL3hB,KAAKsgB,QAAQX,UAAW,EAKjBkB,uBACP7gB,KAAKuhB,iBACLvhB,KAAKsgB,QAAQnD,gBACTnd,KAAK0f,OAAOhY,OAAS,GACxB1H,KAAK0f,OAAOI,MACZ9f,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,GAAGsB,IAAIhJ,KAAKsgB,SAC7CtgB,KAAKsgB,QAAUtgB,KAAK0f,OAAO1f,KAAK0f,OAAOhY,OAAS,IAEhD1H,KAAKsgB,aAAU/W,EAQTuX,mBAAmB3gB,EAAc6f,GACxCtX,QAAQmZ,KACP,sBACC7hB,KAAKsC,OAAO5B,YAAYP,cACfA,+BACAH,KAAKwf,SAAShY,UACvB,EACAxH,KAAKwf,SAAS9X,OAASsY,EAAOtY,cACvBvH,OAAU6f,EAAOxY,UAAUrH,EAAKuH,OAAS,KACjD,8BACA,GACA,8BACA,IAOMkY,qBAAqB7W,GAC5BL,QAAQmZ,KACP,sBAAsB7hB,KAAKsC,OAAO5B,YAAYP,YAC7C4I,EAAI1I,uBACWL,KAAKwf,SAAShY,UAC7B,EACAuB,EAAIwX,iBACCvgB,KAAKwf,SAAShY,UACnBuB,EAAIwX,YACJxX,EAAI2X,eACC1gB,KAAKwf,SAAShY,UAAUuB,EAAI2X,aAClC,8BACA,GACA,8BACA,IAQMC,UAAU5X,GACjB,OAAOqW,EAAW7e,IAAIwI,EAAI1I,gBChjBfyhB,SAQFpiB,eAAemM,EAAiBI,GACnC,MAAM8V,EAAY,GAElB,OADAxR,EAAQ1E,EAAII,GACL8V,EASP,SAASxR,EAAQ1E,EAAiBI,GACzBJ,EAAIxL,QAYDwL,EAAIxL,UAAY4L,EAAI5L,QACpB2hB,EAAU,EAAEnW,EAAII,EAAKA,EAAI7C,UAErByC,EAAIO,WAAaH,EAAIG,YAsHrC,SAAkBP,EAAiBI,GAC/B,IAAI,IAAIe,IAAK,CAAC,QAAQ,UAAU,CAE5B,IAAInB,EAAImB,IAAMf,EAAIe,IAAMnB,EAAImB,KAAOf,EAAIe,GACnC,OAAO,EACL,GAAGnB,EAAImB,IAAMf,EAAIe,GAAG,CACtB,IAAIxG,EAAOD,OAAOC,KAAKqF,EAAImB,IACvB0M,EAAQnT,OAAOC,KAAKyF,EAAIe,IAC5B,GAAGxG,EAAKkB,SAAWgS,EAAMhS,OACrB,OAAO,EAEP,IAAI,IAAIpB,KAAKE,EACT,GAAGqF,EAAImB,GAAG1G,KAAO2F,EAAIe,GAAG1G,GACpB,OAAO,GAM3B,OAAO,EAzIwC2b,CAASpW,EAAII,IAChD+V,EAAU,EAAEnW,EAAI,KAAKI,EAAI7C,QAEzByC,EAAIJ,UAYpB,SAAyBI,EAAII,GAEzB,GAAKJ,EAAI0B,UAAoC,IAAxB1B,EAAI0B,SAAS7F,OAO9B,GAAKuE,EAAIsB,UAAoC,IAAxBtB,EAAIsB,SAAS7F,OAE3B,CAEH,IAAIwa,EAAO,IAENC,EAAYC,EAAUC,EAAYC,GAAa,CAAC,EAAEzW,EAAI0B,SAAS7F,OAAO,EAAE,EAAEuE,EAAIsB,SAAS7F,OAAO,IAC9F6a,EAAaC,EAAWC,EAAaC,GAAc,CACpD7W,EAAI0B,SAAS4U,GACbtW,EAAI0B,SAAS6U,GACbnW,EAAIsB,SAAS8U,GACbpW,EAAIsB,SAAS+U,IAGjB,KAAMH,GAAeC,GAAaC,GAAeC,GACzCG,EAAa3W,MAAQyW,EAAazW,KAClCyE,EAAQgS,EAAaE,GAClBN,IAAgBE,GACfL,EAAU,EAAEO,EAAa,KAAKtW,EAAIkW,GAEtCI,EAAe1W,EAAI0B,WAAW4U,GAC9BM,EAAexW,EAAIsB,WAAW8U,IACvBK,EAAW5W,MAAQ0W,EAAW1W,KACrCyE,EAAQiS,EAAWE,GAChBJ,IAAcF,GACbJ,EAAU,EAAEQ,EAAW,KAAKvW,EAAImW,GAEpCI,EAAa3W,EAAI0B,WAAW6U,GAC5BM,EAAazW,EAAIsB,WAAW+U,IACrBC,EAAazW,MAAQ4W,EAAW5W,KAEvCyE,EAAQgS,EAAaG,GAElBP,IAAgBG,GACfN,EAAU,EAAEO,EAAa,KAAKtW,EAAIkW,GAEtCI,EAAe1W,EAAI0B,WAAW4U,GAC9BO,EAAazW,EAAIsB,WAAW+U,IACrBE,EAAW1W,MAAQ2W,EAAa3W,KACvCyE,EAAQiS,EAAWC,GAChBL,IAAcC,GACbL,EAAU,EAAGQ,EAAY,KAAKvW,EAAKmW,GAEvCI,EAAa3W,EAAI0B,WAAW6U,GAC5BK,EAAexW,EAAIsB,WAAW8U,KAG9BH,EAAOK,EAAazW,KAAMkW,EAAU,EAAGO,EAAc,KAAKtW,EAAIkW,GAE9DI,EAAe1W,EAAI0B,WAAW4U,IAKtC,GAAGA,GAAaC,EACZ,IAAK,IAAIjX,EAAIgX,EAAahX,GAAKiX,EAAWjX,IAEtC6W,EAAU,EAAEnW,EAAI0B,SAASpC,GAAI,KAAMc,EAAId,GAK/C,GAAGkX,GAAaC,EACZ,IAAK,IAAInX,EAAIkX,EAAYhb,EAAM8D,EAAGA,GAAKmX,EAAWnX,IAAI9D,IAAS,CAC3D,IAAIsb,EAAG1W,EAAIsB,SAASpC,GAEpB,GAAG+W,EAAOU,eAAeD,EAAG7W,KAAK,CAC7B,IAAI6G,EAAIuP,EAAOS,EAAG7W,KAClB,GAAGzE,IAAUsL,EAAE,GACXA,EAAE,GAAK,EAEPpC,EAAQoC,EAAE,GAAGgQ,OACZ,CACD,IAAIlO,GAC6D,KAA7DA,EAAGsN,EAAU9E,WAAU3X,GAAMA,EAAK,GAAGwG,MAAQ6G,EAAE,GAAG7G,QAClDiW,EAAUrW,OAAO+I,EAAG,SAI5BuN,EAAU,EAAEW,EAAG,KAAK1W,GAEpB5E,UAhFZwE,EAAI0B,SAASkB,SAAQ,CAACnJ,EAAK+B,IAAU2a,EAAU,EAAG1c,EAAK,KAAM2G,EAAI5E,UANjE4E,EAAIsB,UAAYtB,EAAIsB,SAAS7F,OAAS,GACtCuE,EAAIsB,SAASkB,SAAQnJ,GAAQ0c,EAAU,EAAE1c,EAAK,KAAK2G,KAhB/C4W,CAAgBhX,EAAII,IAlBvBA,EAAI5L,QAOL2hB,EAAU,EAAEnW,EAAII,EAAKA,EAAI7C,SANpByC,EAAIO,WAAaH,EAAIG,YAAcP,EAAIvC,cAAgB2C,EAAI3C,YAC5D0Y,EAAU,EAAEnW,EAAI,KAAKI,EAAI7C,QACpByC,EAAIJ,WAAaQ,EAAIR,UAC1BuW,EAAU,EAAEnW,EAAII,EAAKA,EAAI7C,QA+JzC,SAAS4Y,EAAU1V,EAAYvD,EAAmB+Z,EAAmB1Z,EAAqB2Z,GACtF,MAAMpQ,EAAI,CAACrG,EAAKvD,EAAI+Z,EAAK1Z,EAAO2Z,GAEhC,OADAhB,EAAUlX,KAAK8H,GACRA,UC1LNqQ,cAMTtiB,YAAYqO,GACJA,EAAKuP,QAAQ,QACbvP,EAAK1O,QAAU0O,EAAKjC,QAAQ,OAC5BiC,EAAK8P,QAAQ,QAEb9P,EAAK1O,QAAU,aCXd4iB,aAcFvjB,yBAAyB4C,EAAcyG,EAAiBnG,GAC3D,IAAIsgB,EAAOljB,KAAKM,IAAIsC,EAAMzC,MAC1B,IAAK+iB,EACD,OAAO,EAEX,IAAI,IAAIpX,KAAOvF,OAAOC,KAAK0c,GAAM,CAC7B,IAAIC,EAAK,IAAIvH,OAAOtZ,EAAOwJ,EAAIoX,EAAKpX,IACpCqX,EAAGjH,QAAUtZ,EAAMsZ,QACnBiH,EAAGnH,OAASpZ,EAAMoZ,OAClBmH,EAAGpH,KAAOnZ,EAAMmZ,KAChBoH,EAAGlH,KAAOrZ,EAAMqZ,KAEhBkH,EAAGC,YAAcxgB,EACjBN,EAAO+K,aAAaC,SAASvE,EAAIoa,GAErC,OAAO,EAQJzjB,cAAcmc,EAAiBwH,GAClCrjB,KAAKsjB,eAAepjB,IAAI2b,EAAUwH,GAOtC3jB,gBAAgBmc,GACZ,OAAO7b,KAAKsjB,eAAeviB,OAAO8a,GAQ/Bnc,WAAWmc,GACd,OAAO7b,KAAKsjB,eAAehjB,IAAIub,IAnDpBoH,4BAAiB,IAAIziB,UCF3B+iB,aAwCT7iB,YAAY4B,GACRtC,KAAKsC,OAASA,EACdtC,KAAKwjB,SAAW,IAAIhjB,IACpBR,KAAKyjB,YAAc,IAAIjjB,IAQpB8M,SAASvE,EAAiBnG,GAC7B,MAAMkJ,EAAM/C,EAAI+C,IAEb9L,KAAKyjB,YAAYljB,IAAIuL,IAAQ9L,KAAKyjB,YAAYnjB,IAAIwL,GAAKN,SAAS5I,KAIhEA,EAAMmZ,OACFhT,EAAIK,OACHpJ,KAAK0jB,SAAS3a,EAAIK,OAAO0C,IAAIlJ,EAAMmG,EAAI+C,KAEvClJ,EAAMmZ,MAAO,GAKjBnZ,EAAMmZ,MACN/b,KAAK0jB,SAAS3a,EAAI+C,IAAIlJ,GAGtB5C,KAAKyjB,YAAYljB,IAAIuL,GAGrB9L,KAAKyjB,YAAYnjB,IAAIwL,GAAKjB,KAAKjI,GAF/B5C,KAAKyjB,YAAYvjB,IAAI4L,EAAI,CAAClJ,KAY1B8gB,SAAS5X,EAAWlJ,EAAamJ,GACrC,IAAI4X,EAcArX,EACA7K,EAdAzB,KAAKwjB,SAASjjB,IAAIuL,GAIlB6X,EAAM3jB,KAAKwjB,SAASljB,IAAIwL,IAHxB6X,EAAM,CAACC,QAAQ,IACf5jB,KAAKwjB,SAAStjB,IAAI4L,EAAI6X,IAItBA,EAAI/gB,EAAMzC,QACVwjB,EAAI/gB,EAAMzC,MAAQ,CACd4b,KAAK,GACL8H,IAAI,KAOT9X,GACCO,EAAO,OACP7K,EAAQ,CAACqK,IAAIC,EAAKnJ,MAAMA,KAExB0J,EAAO,MACP7K,EAAQmB,EACR+gB,EAAI/gB,EAAMzC,MAAM+b,QAAUtZ,EAAMsZ,UAAS,GAE7CyH,EAAI/gB,EAAMzC,MAAMmM,GAAMzB,KAAKpJ,GAQxBqiB,SAAShY,GACZ,OAAO9L,KAAKwjB,SAASljB,IAAIwL,GAQtBiY,YAAYhb,EAAiBnG,GAChC,IAAI5C,KAAKyjB,YAAYljB,IAAIwI,EAAI+C,OAAS9L,KAAKyjB,YAAYnjB,IAAIyI,EAAI+C,KAAKN,SAAS5I,GACzE,OAGJ,MAAM+H,EAAM3K,KAAKyjB,YAAYnjB,IAAIyI,EAAI+C,KAIrC,GAHAnB,EAAIe,OAAOf,EAAI5C,QAAQnF,GAAO,GAG3BA,EAAMmZ,KAAK,CAEV,IAAIhT,EAAIK,SAAWpJ,KAAKwjB,SAASjjB,IAAIwI,EAAIK,OAAO0C,KAC5C,OAEJ,IAAI6X,EAAM3jB,KAAKwjB,SAASljB,IAAIyI,EAAIK,OAAO0C,KACvC,IAAI6X,EAAI/gB,EAAMzC,MACV,OAEJ,IAAIkQ,EAAMsT,EAAI/gB,EAAMzC,MAChBkH,EAAQgJ,EAAI0L,KAAKkB,WAAU3X,GAAMA,EAAKwG,MAAM/C,EAAI+C,KAAOxG,EAAK1C,QAAQA,KAC1D,IAAXyE,IACCgJ,EAAI0L,KAAKrQ,OAAOrE,EAAM,GAEC,IAApBgJ,EAAI0L,KAAKrU,QAAiC,IAAjB2I,EAAIwT,IAAInc,QAChC1H,KAAKgkB,OAAOjb,EAAIK,OAAO0C,IAAIlJ,EAAMzC,WAGxC,CACD,IAAIwjB,EAAM3jB,KAAKwjB,SAASljB,IAAIyI,EAAI+C,KAChC,IAAI6X,EAAI/gB,EAAMzC,MACV,OAEJ,IAAIkQ,EAAMsT,EAAI/gB,EAAMzC,MAChBkH,EAAQgJ,EAAIwT,IAAI5G,WAAU3X,GAAMA,IAAO1C,KAC7B,IAAXyE,IACCgJ,EAAIwT,IAAInY,OAAOrE,EAAM,GAEE,IAApBgJ,EAAI0L,KAAKrU,QAAiC,IAAjB2I,EAAIwT,IAAInc,QAChC1H,KAAKgkB,OAAOjb,EAAI+C,IAAIlJ,EAAMzC,QAUnC0O,KAAK9F,GACR,IAAI/I,KAAKwjB,SAASjjB,IAAIwI,EAAI+C,KACtB,OAEJ,MAAM8B,EAAK5N,KAAKsC,OAAOuL,WAAW9E,EAAI+C,KAChC6X,EAAM3jB,KAAKwjB,SAASljB,IAAIyI,EAAI+C,KAClC,IAAI,IAAIA,KAAOvF,OAAOC,KAAKmd,GAEZ,YAAR7X,IAGH8B,EAAGgJ,iBAAiB9K,EAAIuL,EAAQsM,EAAI7X,GAAKoQ,SACzCyH,EAAIC,QAAQ9X,GAAO,CAACuL,QAAQA,EAAQ6E,QAAQyH,EAAI7X,GAAKoQ,UAEzD,MAAMjG,EAAKjW,KACX,SAASqX,EAAQzV,GACbqU,EAAGoB,QAAQpV,MAAMgU,EAAG,CAACA,EAAG3T,OAAOV,KAShCoiB,OAAOlY,EAAW+P,GACrB,IAAI7b,KAAKwjB,SAASjjB,IAAIuL,GAClB,OAEJ,MAAMmY,EAAOjkB,KAAKwjB,SAASljB,IAAIwL,GAC/B,IAAImY,EAAKL,UAAYK,EAAKpI,GACtB,OAEJ,MAAMjO,EAAK5N,KAAKsC,OAAOuL,WAAW/B,GAC5B6X,EAAMM,EAAKL,QAAQ/H,GAEtBjO,GAAM+V,GACL/V,EAAGsW,oBAAoBrI,EAAU8H,EAAItM,QAAQsM,EAAIzH,gBAE9C+H,EAAKL,QAAQ/H,GAOjBsI,UAAUrY,GACb,IAAI9L,KAAKwjB,SAASjjB,IAAIuL,GAClB,OAEJ,MAAMmY,EAAOjkB,KAAKwjB,SAASljB,IAAIwL,GAC/B,IAAImY,EAAKL,QACL,OAEJ,MAAMhW,EAAK5N,KAAKsC,OAAOuL,WAAW/B,GAClC,GAAG8B,EACC,IAAI,IAAI9B,KAAOvF,OAAOC,KAAKyd,EAAKL,SAAS,CACrC,MAAMpb,EAAIyb,EAAKL,QAAQ9X,GACvB8B,EAAGsW,oBAAoBpY,EAAItD,EAAE6O,QAAQ7O,EAAE0T,SAG/C+H,EAAKL,QAAU,GAQZQ,SAAStY,GACZ,OAAO9L,KAAKwjB,SAASjjB,IAAIuL,GAMtB4S,QAEH,IAAI,IAAI5S,KAAO9L,KAAKyjB,YAAYjd,OAC5BxG,KAAKmkB,UAAUrY,GAEnB9L,KAAKyjB,YAAY/E,QACjB1e,KAAKwjB,SAAS9E,QASVrH,QAAQ/U,EAAOV,GAEnB,IAAIgM,EAAKhM,EAAEyiB,cACX,MAAMvY,EAAM8B,EAAG9B,IACT/C,EAAMzG,EAAOiN,WAAW+U,eAAexY,GAC7C,IAAI/C,EACA,OAEJ,MAAMkb,EAAOjkB,KAAKwjB,SAASljB,IAAIwL,GAC/B,IAAImY,IAASA,EAAKriB,EAAE0K,MAChB,OAEJ,MAAM4W,EAAOe,EAAKriB,EAAE0K,MAepB,SAASiY,EAAMpX,GACX,IAAIA,EACA,OAEJ,IAAI6O,GAAS,EACb,IAAI,IAAI7Q,EAAE,EAAEA,EAAEgC,EAAOzF,OAAOyD,IAAI,CAC5B,MAAMgY,EAAKhW,EAAOhC,GACO,iBAAfgY,EAAG9L,QACT/U,EAAOkiB,aAAarB,EAAG9L,QAAQtO,EAAIvG,MAAOuG,EAAIoa,EAAIvhB,GACvB,mBAAfuhB,EAAG9L,SACf8L,EAAG9L,QAAQpV,MAAMK,EAAO,CAACyG,EAAIvG,MAAMuG,EAAIoa,EAAGvhB,IAE3CuhB,EAAGlH,MACF9O,EAAOzB,OAAOP,IAAI,GAEtB6Q,EAASmH,EAAGnH,OAEbA,GACCpa,EAAE6iB,kBASV,SAASC,EAAOvX,GACZ,IAAIA,EACA,OAAO,EAEX,MAAMwX,EAAQ/iB,EAAE8Q,OAAS9Q,EAAEgjB,aAAahjB,EAAEgjB,eAAe,IACzD,IAAI5I,GAAS,EACb,IAAI,IAAI7Q,EAAE,EAAEA,EAAEgC,EAAOzF,OAAOyD,IAAI,CAC5B,MAAM0Z,EAAM1X,EAAOhC,GACbgY,EAAK0B,EAAIjiB,MACf,IAAI,IAAIwQ,EAAE,EAAEA,EAAEuR,EAAMjd,QAAUid,EAAMvR,KAAKxF,EAAGwF,IAAI,CAC5C,MAAM9M,EAAIqe,EAAMvR,GAAGtH,IACnB,GAAGxF,IAAMue,EAAI/Y,IAAI,CACb,MAAMgX,EAAOxgB,EAAOiN,WAAW+U,eAAehe,GAQ9C,GAPyB,iBAAf6c,EAAG9L,QACT/U,EAAOkiB,aAAarB,EAAG9L,QAAQyL,EAAKtgB,MAAOsgB,EAAKK,EAAIvhB,GACzB,mBAAfuhB,EAAG9L,SACf8L,EAAG9L,QAAQpV,MAAMK,EAAO,CAACwgB,EAAKtgB,MAAMsgB,EAAKK,EAAGvhB,IAGhDoa,EAASmH,EAAGnH,OACTmH,EAAGlH,KAAK,CAEP9O,EAAOzB,OAAOP,IAAI,GAElB,MAAML,EAAMxI,EAAO+K,aAAa/M,IAAIgG,GAAGyB,QAAQob,GAC/C7gB,EAAO+K,aAAa/M,IAAIgG,GAAGoF,OAAOZ,EAAI,GAE1C,QAIZ,OAAOkR,EAxERkH,EAAKhH,SACJqI,EAAMrB,EAAKW,KACXa,EAAOxB,EAAKnH,OAER2I,EAAOxB,EAAKnH,OACZwI,EAAMrB,EAAKW,YC/RdiB,OAOTpkB,cAFQV,kBAAe,IAAIQ,IAGvBR,KAAK+kB,UAAY,GAQdzkB,IAAIwL,GACP,IAAIkB,EAAIhN,KAAK+kB,UACb,IAAyB,IAAtBjZ,EAAI/D,QAAQ,KAAY,CACvB,IAAI4C,EAAMmB,EAAIkH,MAAM,KACpB,GAAGrI,EAAIjD,OAAO,EAAE,CACZ,IAAI,IAAIyD,EAAE,EAAEA,EAAER,EAAIjD,OAAO,GAAKsF,EAAE7B,IAC5B6B,EAAIA,EAAErC,EAAIQ,IAEX6B,IACClB,EAAMnB,EAAIA,EAAIjD,OAAO,KAIjC,GAAGsF,EACC,OAAOA,EAAElB,GASV5L,IAAI4L,EAAWrK,GAClB,IAAIuL,EAAIhN,KAAK+kB,UACThZ,EAAOD,EACX,IAAyB,IAAtBA,EAAI/D,QAAQ,KAAY,CACvB,IAAI4C,EAAMmB,EAAIkH,MAAM,KACpB,GAAGrI,EAAIjD,OAAO,EAAE,CACZ,IAAI,IAAIyD,EAAE,EAAEA,EAAER,EAAIjD,OAAO,EAAEyD,IACnB6B,EAAErC,EAAIQ,KAA4B,iBAAd6B,EAAErC,EAAIQ,MAC1B6B,EAAErC,EAAIQ,IAAM,IAEhB6B,EAAIA,EAAErC,EAAIQ,IAEdW,EAAMnB,EAAIA,EAAIjD,OAAO,IAS7B,GALGsF,IACCA,EAAElB,GAAOrK,GAIVzB,KAAKglB,aAAazkB,IAAIwL,GAAM,CAC3B,IAAIpB,EAAM3K,KAAKglB,aAAa1kB,IAAIyL,GAChC,IAAI,IAAIU,KAAK9B,EACT3K,KAAKilB,gBAAgBxY,EAAEnK,OAAOmK,EAAE4K,QAAQ5V,IAS7C8b,OAAOzR,GACV,IAAIkB,EAAIhN,KAAK+kB,UACb,IAAyB,IAAtBjZ,EAAI/D,QAAQ,KAAY,CACvB,IAAI4C,EAAMmB,EAAIkH,MAAM,KACpB,GAAGrI,EAAIjD,OAAO,EAAE,CACZ,IAAI,IAAIyD,EAAE,EAAEA,EAAER,EAAIjD,OAAO,GAAKsF,EAAE7B,IAC5B6B,EAAIA,EAAErC,EAAIQ,IAEX6B,IACClB,EAAMnB,EAAIA,EAAIjD,OAAO,KAK9BsF,UACQA,EAAElB,GASVoZ,UAAU5iB,EAAcwJ,EAAWuL,GACtC,GAAIrX,KAAKglB,aAAazkB,IAAIuL,GAErB,CACD,IAAInB,EAAM3K,KAAKglB,aAAa1kB,IAAIwL,GAC5BnB,EAAIoL,MAAKzQ,GAAMA,EAAKhD,SAAWA,GAAUgD,EAAK+R,UAAYA,KAC1D1M,EAAIE,KAAK,CAACvI,OAAOA,EAAO+U,QAAQA,SAJpCrX,KAAKglB,aAAa9kB,IAAI4L,EAAI,CAAC,CAACxJ,OAAOA,EAAO+U,QAAQA,KAQtD,IAAI7O,EAAIxI,KAAKM,IAAIwL,GACdtD,GACCxI,KAAKilB,gBAAgB3iB,EAAO+U,EAAQ7O,GAUpCyc,gBAAgB3iB,EAAckU,EAAoBhO,GACpC,iBAARgO,EACNlU,EAAOkiB,aAAqBhO,EAAIhO,GAEhCgO,EAAI/N,KAAKnG,EAAOkG,UCzHf2c,YASFzlB,WAAWoM,EAAWrK,GACzBzB,KAAKolB,MAAMllB,IAAI4L,EAAIrK,GAQhB/B,WAAWoM,GACd,OAAO9L,KAAKolB,MAAM9kB,IAAIwL,GASnBpM,iBAAiB4C,EAAcwJ,EAAWuL,GAC7CrX,KAAKolB,MAAMF,UAAU5iB,EAAOwJ,EAAIuL,GAO7B3X,cAAcoM,GACjB9L,KAAKolB,MAAM7H,OAAOzR,IAnCPqZ,kBAAe,IAAIL,aCGzBO,MAQT3kB,YAAYsC,EAAWV,EAAgB8G,EAAajJ,GAEhD,IAAI6C,GAAQA,EAAKsiB,SACb,OAIJ,IAAIC,EAAQ,IAAIC,MAAMxiB,EAAM,CACxB9C,IAAI2L,EAAUC,EAAarK,EAAYgkB,GACnC,IAAIC,EAASjkB,EAEb,GAAGA,GAASA,EAAM6jB,SAAS,CACvB,MAAMK,EAASlkB,EAAM6jB,SAElBK,IAEIlkB,EAAMmkB,WAAatjB,IAClBA,EAAOujB,aAAa7c,IAAI2c,EAAOlkB,GAC/BA,EAAMmkB,SAASC,aAAaC,UAAUrkB,EAAMa,GAE5CA,EAAOujB,aAAaE,aAAatkB,EAAMqK,IAE3C4Z,EAASC,GAIjB,GAAI9Z,EAAIC,KAAS4Z,EACb,OAAO,EAEX,IAAIM,EAAKna,EAAIC,GACT3E,EAAItB,QAAQ3F,IAAI2L,EAAKC,EAAK4Z,EAAQD,GAEtC,OADAnjB,EAAOujB,aAAaI,OAAOR,EAAU3Z,EAAKka,EAAIvkB,GACvC0F,GAEX7G,IAAIuL,EAAUC,EAAsB2Z,GAEhC,GAAW,aAAR3Z,EACC,OAAO2Z,EAAS5Z,OAAItC,EAGxB,GAAW,aAARuC,EACC,OAAO2Z,EAASnjB,OAAOiH,EAG3B,GAAW,UAARuC,EACC,OAAO2Z,EAASnjB,EAAOujB,aAAaK,YAAYra,QAAKtC,EAGzD,GAAW,aAARuC,EACC,OAAO1C,EAGX,GAAW,WAAR0C,EACC,OAAO3L,EAGX,IAAIgmB,EAAMtgB,QAAQvF,IAAIuL,EAAKC,EAAK2Z,GAEhC,GAAGU,IAAQA,EAAIzlB,cAAgB6F,QAAU4f,EAAIzlB,cAAgBb,OAAO,CAChE,IAAIuG,EAAI9D,EAAOujB,aAAaO,SAASD,GACjC/f,IACAA,EAAI,IAAIif,MAAMc,EAAI7jB,EAAOmjB,EAAS3Z,IAEtCqa,EAAM/f,EAEV,OAAO+f,GAEXE,eAAexa,EAAUC,GACrB,IAAIwa,EAAWza,EAAIC,GAGnB,cAFOD,EAAIC,GACXxJ,EAAOujB,aAAaI,OAAOV,EAAMzZ,EAAIwa,OAAS/c,IACvC,KAIf,OADAjH,EAAOujB,aAAa7c,IAAIhG,EAAKuiB,GACtBA,SCrFFgB,aA6CT7lB,YAAY4B,GAhCJtC,aAA+B,IAAIyY,QAOnCzY,aAA8B,IAAIyY,QAOlCzY,cAA+B,IAAIyY,QAKnCzY,mBAAuB,EAMxBA,aAAmC,IAAIyY,QAQ1CzY,KAAKsC,OAASA,EAQX8jB,SAASpjB,GACZ,OAAOhD,KAAKwmB,QAAQjmB,IAAIyC,GAAMhD,KAAKwmB,QAAQlmB,IAAI0C,GAAMR,WAAM+G,EAQxD2c,YAAYljB,GACf,OAAOhD,KAAKwmB,QAAQjmB,IAAIyC,GAAMhD,KAAKwmB,QAAQlmB,IAAI0C,GAAM8I,SAAIvC,EAQtDwc,aAAavjB,EAAUrC,GACtBH,KAAKymB,QAAQlmB,IAAIiC,IACjBxC,KAAKymB,QAAQvmB,IAAIsC,EAAMrC,GASxBumB,aAAalkB,GAChB,OAAOxC,KAAKymB,QAAQnmB,IAAIkC,GAQrBwG,IAAIhG,EAAKR,GAETxC,KAAKwmB,QAAQjmB,IAAIyC,IAGpBhD,KAAKwmB,QAAQtmB,IAAI8C,EAAK,CAACR,MAAMA,EAAMsJ,IAAItJ,EAAMmkB,OAAShgB,KAAKC,UAQxDkf,UAAUtjB,EAAUF,GACnBE,GAUJ,SAASqM,EAAK+U,EAAQphB,EAAMF,GACxB,GAAGE,EAAMojB,WAAatjB,EAClB,OAEJ,IAAIskB,EACAhD,EAAQrjB,IAAIiC,GAIZokB,EAAOhD,EAAQtjB,IAAIkC,IAHnBokB,EAAO,GACPhD,EAAQ1jB,IAAIsC,EAAMokB,IAIlBA,EAAKpb,SAASlJ,EAAOoD,KACrBkhB,EAAK/b,KAAKvI,EAAOoD,IAGrB,IAAI,IAAIoG,KAAOvF,OAAOC,KAAKhE,GACpBA,EAAMsJ,IAA8B,iBAAftJ,EAAMsJ,IAC1B+C,EAAK+U,EAAQphB,EAAMsJ,GAAKxJ,GAxBpCuM,CAAK7O,KAAK4jB,QAAQphB,EAAMF,GAsCrB2jB,OAAOzjB,EAAcsJ,EAAawa,EAAgBO,GAMrD,GAJAC,EAAc9mB,KAAKsC,OAAOE,GAE1B8I,SAAStC,IAAIhJ,KAAKsC,QAEftC,KAAK4jB,QAAQrjB,IAAIiC,GAChB,IAAI,IAAIkD,KAAM1F,KAAK4jB,QAAQtjB,IAAIkC,GAAO,CAClC,MAAM4D,EAAIf,cAAc/E,IAAIoF,GACzBU,IACC0gB,EAAc1gB,EAAE5D,GAChB8I,SAAStC,IAAI5C,IAUzB,SAAS0gB,EAAcC,EAAIvkB,GACvB,MAAMgW,EAAMuO,EAAIlB,aAAamB,SAC7B,IAAIC,EAAUzO,EAAIlY,IAAIkC,GAEtB,GAAGykB,GAAWA,EAAQnb,GAElBmb,EAAQnb,GAAKob,EAAEze,KAAKse,EAAIvkB,EAAMsJ,EAAIwa,EAASO,QACzC,GAAGE,EAAIlB,aAAasB,aACtB,IAAI,IAAI/gB,EAAI5D,EAAM4D,GAAKA,EAAEghB,SAAShhB,EAAEA,EAAEghB,SAAS,CAE3C,IAAIpR,EAAK5P,EAAEghB,SAASxB,WAAamB,EAAI3gB,EAAEghB,SAASL,EAAIvkB,MACpD,IAAIgW,EAAIjY,IAAIyV,GACR,SAEJ,MAAMiR,EAAUzO,EAAIlY,IAAI0V,GAClB7V,EAAO4mB,EAAIlB,aAAaa,aAAatgB,IAAIA,EAAEihB,OACjD,GAAGJ,GAAWA,EAAQ9mB,GAAM,CACxB,IAAIwjB,EAAMsD,EAAQ9mB,GAElB,GAAGwjB,EAAIvI,KAAK,CACRuI,EAAIuD,EAAEze,KAAKse,EAAIvkB,EAAMsJ,EAAIwa,EAASO,GAElC,UAmBjBS,MAAM9kB,EAAYsJ,EAAsByb,EAAkBnM,GAC7D,IAAImM,GAA8B,mBAAZA,EAClB,OAEJ,MAAMtR,EAAKjW,KAEXA,KAAKmnB,aAAe/L,EAEpB,IAAIzQ,EAAM,GACV,GAAG9K,MAAMC,QAAQgM,GACb,IAAI,IAAIxF,KAAKwF,EACT0b,EAAShlB,EAAM8D,EAAEihB,QAGrBC,EAAShlB,EAAMsJ,EAAIyb,GAIvB,MAAO,KAEH,GAAI1nB,MAAMC,QAAQ6K,GAAlB,CAGA,IAAI,IAAIuc,KAAKvc,EAAI,CACb,IAAI0F,EAAM4F,EAAG+Q,SAAS1mB,IAAI4mB,EAAE9gB,GACxBiK,WAGGA,EAAI6W,EAAE5gB,GAEkB,IAA5BC,OAAOC,KAAK6J,GAAK3I,QAChBuO,EAAG+Q,SAASjmB,OAAOmmB,EAAE9gB,IAI7BuE,EAAM,OAUV,SAAS6c,EAAShlB,EAAYsJ,EAAWyb,GACrC,IAAK/kB,GAA0B,iBAAVA,EACjB,OAEJ,IAAI6E,EAEJ,IAAwC,KAAnCA,EAAQyE,EAAI3D,YAAY,QACzB3F,EAAQyT,EAAG3V,IAAIkC,EAAMsJ,EAAItE,UAAU,EAAGH,IACtCyE,EAAMA,EAAItE,UAAUH,EAAQ,IACvB7E,GAA0B,iBAAVA,GACjB,OAIJyT,EAAG+Q,SAASzmB,IAAIiC,IAChByT,EAAG+Q,SAAS9mB,IAAIsC,EAAM,IAEfyT,EAAG+Q,SAAS1mB,IAAIkC,GACvBsJ,GAAO,CAACob,EAAEK,EAAQnM,KAAKA,GAE3BzQ,EAAIE,KAAK,CAACzE,EAAE5D,EAAM8D,EAAEwF,KAWrBxL,IAAIkC,EAAasJ,GACpB,GAAGA,EAAI,CACH,IAA0B,IAAtBA,EAAI/D,QAAQ,KAAa,CACzB,IAAI4C,EAAMmB,EAAIkH,MAAM,KACpB,IAAK,IAAI7H,EAAI,EAAGA,EAAIR,EAAIjD,OAAS,IAC7BlF,EAAQA,EAAMmI,EAAIQ,KADcA,KAMpC,IAAK3I,EACD,OAEJsJ,EAAMnB,EAAIA,EAAIjD,OAAS,GAE3BlF,EAAQA,EAAMsJ,GAElB,OAAOtJ,EASJtC,IAAIsC,EAAYsJ,EAAWrK,GAC9B,IAA0B,IAAtBqK,EAAI/D,QAAQ,KAAa,CACzB,IAAI4C,EAAMmB,EAAIkH,MAAM,KACpB,IAAK,IAAI7H,EAAI,EAAGA,EAAIR,EAAIjD,OAAS,EAAGyD,IAE3B3I,EAAMmI,EAAIQ,MACX3I,EAAMmI,EAAIQ,IAAM,IAEpB3I,EAAQA,EAAMmI,EAAIQ,IAEtBW,EAAMnB,EAAIA,EAAIjD,OAAS,GAE3BlF,EAAMsJ,GAAOrK,SC3TPgmB,cAeV/mB,YAAY4B,GACRtC,KAAKsC,OAASA,EACdtC,KAAKolB,MAAQ,IAAIN,OAQb5kB,IAAI4L,EAAWrK,GACnBzB,KAAKolB,MAAMllB,IAAI4L,EAAI,GAAGrK,GAQnBnB,IAAIwL,GACP,OAAO9L,KAAKolB,MAAM9kB,IAAIwL,GAOnByR,OAAOzR,GACV9L,KAAKolB,MAAM7H,OAAOzR,GAUfuQ,cAAc3W,EAAUoG,EAAW3L,EAAYsB,GAClDzB,KAAKolB,MAAMllB,IAAI,WAAawF,EAAK,YAAcoG,EAAM,IAAM3L,EAAKsB,GAU7D8a,cAAc7W,EAAUoG,EAAW3L,GACtC,OAAOH,KAAKM,IAAI,WAAaoF,EAAK,YAAcoG,EAAM,IAAM3L,GASzDsc,iBAAiB/W,EAAUoG,EAAW3L,GACzCH,KAAKud,OAAO,WAAa7X,EAAK,YAAcoG,EAAM,IAAM3L,GAQrDwc,gBAAgBjX,EAAUoG,GAC1BA,EACC9L,KAAKud,OAAO,WAAa7X,EAAK,YAAcoG,GAE5C9L,KAAKud,OAAO,WAAa7X,EAAK,YAU/BuZ,YAAYnT,EAAW3L,EAAYsB,GACtCzB,KAAKE,IAAI,aAAe4L,EAAM,IAAM3L,EAAMsB,GASvCyd,YAAYpT,EAAW3L,GAC1B,OAAOH,KAAKM,IAAI,aAAewL,EAAM,IAAM3L,GAQxCgf,eAAerT,EAAW3L,GAC7BH,KAAKud,OAAO,aAAezR,EAAM,IAAM3L,GAOpCunB,eAAe5b,GAClB9L,KAAKud,OAAO,aAAezR,GAMxB6b,oBACH3nB,KAAKud,OAAO,oBC5IPqK,WAqBTlnB,YAAY4B,GAFLtC,gBAA8B,IAAIQ,IAGrCR,KAAKsC,OAASA,EAMXulB,aAAa/b,GAChB,OAAI9L,KAAK8nB,SAIT,SAAS/R,EAAKhN,GACV,GAAGA,EAAI+C,MAAQA,EACX,OAAO/C,EAEX,GAAGA,EAAIwE,SACH,IAAI,IAAIN,KAAKlE,EAAIwE,SAAS,CACtB,IAAIwa,EAAKhS,EAAK9I,GACd,GAAG8a,EACC,OAAOA,GAThBhS,CAAK/V,KAAK8nB,UAFN,KAsBPxD,eAAexY,GACnB,GAAI9L,KAAKgoB,aAGT,OAOA,SAASjS,EAAKhN,EAAiB+C,GAC3B,GAAG/C,EAAI+C,MAAQA,EACX,OAAO/C,EAEX,GAAGA,EAAIwE,SACH,IAAI,IAAIN,KAAKlE,EAAIwE,SAAS,CACtB,IAAIN,EACA,SAEJ,IAAI8a,EAAKhS,EAAK9I,EAAEnB,GAChB,GAAGic,EACC,OAAOA,GAlBhBhS,CAAK/V,KAAKgoB,aAAalc,GA8B3Bmc,iBAAiBnc,EAAwBsP,GAC5C,IAAIvP,EAOJ,GALIA,EADc,iBAARC,EACA9L,KAAKskB,eAAexY,GAENA,GAGpBD,EACA,OAAO,KAEX,IAAII,EAAU,CACVH,IAAIA,EACJI,KAAKL,EAAIK,KACT7L,QAAQwL,EAAIxL,QACZ+L,UAAUP,EAAIO,UACd9C,YAAYuC,EAAIvC,YAChBmC,SAASI,EAAIJ,UAEjB,GAAGI,EAAI1C,MAAM,CACT8C,EAAI9C,MAAQ,GACZ,IAAI,IAAI7C,KAAKC,OAAOC,KAAKqF,EAAI1C,OACzB8C,EAAI9C,MAAM7C,GAAKuF,EAAI1C,MAAM7C,GAGjC,GAAGuF,EAAIkB,OAAO,CACVd,EAAIc,OAAS,GACb,IAAI,IAAIzG,KAAKC,OAAOC,KAAKqF,EAAIkB,QACzBd,EAAIc,OAAOzG,GAAKuF,EAAIkB,OAAOzG,GAInC,GAAG8U,GAAQvP,EAAI0B,SAAS,CACpBtB,EAAIsB,SAAW,GACf,IAAI,IAAIxN,KAAK8L,EAAI0B,SACbtB,EAAIsB,SAAS1C,KAAK7K,KAAKioB,iBAAiBloB,IAGhD,OAAOkM,EAQJic,gBAAgBnf,GAChBA,GACC/I,KAAKmoB,WAAWpnB,OAAOgI,EAAI+C,KAExB/C,EAAII,OAASJ,EAAII,MAAW,KAC3BnJ,KAAKmoB,WAAWpnB,OAAOgI,EAAII,MAAW,MAG1CnJ,KAAKmoB,WAAWzJ,QASjB7Q,WAAW/B,GACd,OAAO9L,KAAKmoB,WAAW7nB,IAAIwL,GAQxB8C,YAAY9C,EAAWiD,GAC1B/O,KAAKmoB,WAAWjoB,IAAI4L,EAAIiD,GAQrBS,SAASzG,GACZ,GAAGA,EAAI0C,SAAS,CACZ,IAAIrF,EAAIf,cAAc/E,IAAIyI,EAAI0C,UAC3BrF,GACCA,EAAEmO,eAQN,GAJAvU,KAAKkoB,gBAAgBnf,GAErB/I,KAAKsC,OAAO+K,aAAa8W,UAAUpb,EAAI+C,KAEpC/C,EAAIwE,SACH,IAAI,IAAIN,KAAKlE,EAAIwE,SACbvN,KAAKwP,SAASvC,GASvBmb,QACHpoB,KAAKgoB,aAAe,KACpBhoB,KAAKmoB,WAAWzJ,gBCzFxBjf,qBAAqBuJ,IAAI,CArGzB,MAAMqf,eAAerF,cACjBtiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GAEN,IAAIpP,EAAQoP,EAAKjC,QAAQ,QACzB,IAAKnN,EACD,MAAM,IAAIiJ,OAAO,eAAgB2J,eAAapQ,SAAkB,QAAG,SAAU,aAEjF4M,EAAK8P,QAAQ,QACb9P,EAAKmO,aAAa,IAAIzB,UAAU,SAAS9b,MAOjD,MAAM2oB,YAAYtF,cACdtiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GAEN,IAAIwZ,EAAOxZ,EAAKjC,QAAQ,QACxB,IAAKyb,EACD,MAAM,IAAI3f,OAAO,eAAgB2J,eAAapQ,SAAkB,QAAG,MAAO,QAE9E4M,EAAK8P,QAAQ,QACb9P,EAAKmO,aAAa,IAAIzB,UAAU,SAAS8M,MAmBjD,MAAMC,WAAWxF,cACbtiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GAEN,IAAIwZ,EAAOxZ,EAAKjC,QAAQ,QACxB,IAAKyb,EACD,MAAM,IAAI3f,OAAO,eAAgB2J,eAAapQ,SAAkB,QAAG,KAAM,QAE7E4M,EAAK8P,QAAQ,QACb9P,EAAKmO,aAAa,IAAIzB,UAAU,KAAK8M,MAtB7C,MAAME,cAAczF,cAChBtiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GAEN,IAAIwZ,EAAOxZ,EAAKjC,QAAQ,QACxBiC,EAAK8P,QAAQ,QACb9P,EAAKmO,aAAa,IAAIzB,UAAU,QAAQ8M,MAoBhD,MAAMG,aAAa1F,cACftiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GACNA,EAAKmO,aAAa,IAAIzB,UAAU,OAAO,SAM/C,MAAMkN,eAAe3F,cACjBtiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GAEN,IAAIwZ,EAAOxZ,EAAKjC,QAAQ,QACxB,IAAKyb,EACD,MAAM,IAAI3f,OAAO,eAAgB2J,eAAapQ,SAAkB,QAAG,SAAU,QAEjF4M,EAAK8P,QAAQ,QACb9P,EAAKmO,aAAa,IAAIzB,UAAU,SAAS8M,MAMjD,MAAMK,cAAc5F,cAChBtiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GACNA,EAAKmO,aAAa,IAAIzB,UAAU,QAAQ,SAOhD,MAAMoN,aAAa7F,cACftiB,YAAYqO,EAAiBzM,GACzBsV,MAAM7I,GAEN,IAAIwZ,EAAOxZ,EAAKjC,QAAQ,SAAW,UACnCiC,EAAK8P,QAAQ,QACb9P,EAAKmO,aAAa,IAAIzB,UAAU,OAAO8M,QClF3CnR,EACI,UACA,SAAU9U,EAAgByG,GACtB,IAAI3C,EAEA6N,EAAM3R,EAAOsI,cAAcsU,YAAYnW,EAAI+C,IAAK,YACpD,GAAImI,EACA7N,EAAIf,cAAc/E,IAAI2T,OACnB,CACH,IAAIhL,EAAMjJ,KAAKyB,MAKf,GAJkB,iBAARwH,IACNA,EAAMA,EAAI6f,qBAEd1iB,EAAIf,cAAc/E,IAAI2I,IACjB7C,EACD,OAAO,EAGRpG,KAAKwQ,QAAUxQ,KAAKwQ,OAAOkR,QAC1Btb,EAAE2iB,WAAa/oB,KAAKwQ,OAAOkR,OAE/BzN,EAAM7N,EAAEV,GAERpD,EAAOsI,cAAcqU,YAAYlW,EAAI+C,IAAK,WAAYmI,GACtD3R,EAAOsQ,SAASxM,GAGpB2C,EAAI0C,SAAWwI,SAERlL,EAAI1I,QAEX,IAAIsS,EAAS,GACb,GAAI5J,EAAII,MACJ,IAAK,IAAI6D,KAAKzG,OAAOC,KAAKuC,EAAII,OAAQ,CAClC,IAAIX,EAAIO,EAAII,MAAM6D,GACL,MAATA,EAAE,IACG2F,EAAEqW,QACHrW,EAAEqW,MAAQ,IAEdrW,EAAEqW,MAAMhc,EAAExF,UAAU,IAAMgB,SAEnBO,EAAII,MAAM6D,IAEjB2F,EAAE3F,GAAKxE,EAMnB,OADApC,EAAE6iB,SAAStW,EAAG5J,IACP,IAEX,GAMJqO,EACI,SACA,SAAU9U,EAAgByG,GACtB,IAAIvG,EAAeF,EAAOhC,IAAIN,KAAKyB,MAAMsH,EAAIvG,OAI7C,OAHIA,IACAuG,EAAIvG,MAAQA,IAET,IAEX,GAOJ4U,EACI,UACA,SAAU9U,EAAgByG,GACtB,IAAImgB,EAAOlpB,KAAKyB,MAEhB,IAAKkF,KAAK7G,QAAQopB,IAAyB,IAAhBA,EAAKxhB,OAC5B,OAAO,EAEX,MAAMmE,EAAM9C,EAAImD,KAEVid,EAAUtd,EAAIiB,QAAQ,SACtB1D,EAASL,EAAIK,OAEnBpJ,KAAK2b,UAAW,SAET9P,EAAIrJ,MACX,IAAK,IAAI2I,EAAI,EAAGA,EAAI+d,EAAKxhB,OAAQyD,IAAK,CAClC,IAAI+d,EAAK/d,GACL,SAEAge,IACAD,EAAK/d,GAAGge,GAAWhe,GAGvBU,EAAIO,YACJ,IAAIa,EAAI3B,SAASkC,UAAUlL,EAAQuJ,EAAKqd,EAAK/d,GAAI/B,EAAQ8f,EAAK/d,GAAGwb,OAE7DwC,UACOlc,EAAE9D,MAAa,MAK9B,OADAnJ,KAAK2b,UAAW,GACT,IAEX,GAiBJvE,EACI,SACA,SAAU9U,EAAgByG,GACtB,MAAM8C,EAAM9C,EAAImD,KAEhB,GAAInD,EAAII,MAAMyZ,eAAe,OAAQ,CAEjC/W,EAAI0B,SAAW,GAEf,MAAMpN,EAAO,YAAc4I,EAAII,MAAW,KAAK,WAC/C,IAAI4F,EAAOzM,EAAOsI,cAActK,IAAIH,GACpC,IAAK4O,EACD,OAAO,EAEX,IAEI3I,EAFQ2C,EAAIvG,MACLuM,EAAKuO,aAAa,SACV7b,OAEnB,IAAK2E,EACD,OAAO,EAIX,IAAIgjB,EAAQra,EAAKsE,QAEZxT,MAAMC,QAAQsG,KACfgjB,EAAM5mB,MAAQ4D,EAEdO,KAAK0U,WAAW+N,EAAOhjB,EAAEugB,OAAO,IAEpC9a,EAAI0B,SAAW,CAAC6b,GAChBA,EAAMhgB,OAASyC,MACZ,CAEH,IADW9C,EAAIvG,MAAMxC,KAAKyB,OAEtB,OAAO,EAGX,MAAMtB,EAAO,YAAc4I,EAAII,MAAY,MAAK,WAC3C7G,EAAOsI,cAActK,IAAIH,IAC1BmC,EAAOsI,cAAc1K,IAAIC,EAAM0L,GAGvC,OAAO,IAEX,GAOJuL,EAAgB,MACZ,SAAU9U,EAAgByG,GACtB,GAAIA,EAAIK,OAIR,OADA9G,EAAOsI,cAAcqU,YAAYlW,EAAIK,OAAO0C,IAAK,MAAO9L,KAAKyB,OACtDzB,KAAKyB,QAEhB,GAOJ2V,EACI,QACA,SAAU9U,EAAgByG,GACtB,GAAIA,EAAIK,OAGR,OAAS9G,EAAOsI,cAAcsU,YAAYnW,EAAIK,OAAO0C,IAAK,SAE9D,GAMJsL,EAAgB,UACZ,SAAU9U,EAAgByG,GACtB,GAAIA,EAAIK,OAIR,OAAU,IADF9G,EAAOsI,cAAcsU,YAAYnW,EAAIK,OAAO0C,IAAK,UAIhD9L,KAAKyB,QAGNa,EAAOsI,cAAcqU,YAAYlW,EAAIK,OAAO0C,IAAK,OAAO,IAGzD,KAEX,GAMJsL,EACI,SACA,SAAU9U,EAAgByG,GACtB,GAAIA,EAAIK,OAKR,OAFA9G,EAAOsI,cAAcuU,eAAepW,EAAIK,OAAO0C,IAAK,QAE7C,IAEX,GAOJsL,EACI,QACA,SAAU9U,EAAgByG,GAEtB,IAAIsgB,EAAY/mB,EAAOsI,cAAcsU,YAAYnW,EAAI+C,IAAK,SAE1D,KAAI9L,KAAKyB,OAAW4nB,GAAcA,EAAUC,UACxC,OAAO,EAEPD,IACAA,EAAY,GACZ/mB,EAAOsI,cAAcqU,YAAYlW,EAAI+C,IAAK,QAAQud,IAEtD,IAEIE,EACAC,EAHAxL,EAAQjV,EAAII,MAAa,MA6C7B,OAzCG6U,IACCuL,EAJS,sBAIOjiB,KAAK0W,GAEJ,OAAduL,KAECC,EADSD,EAAU,GAAGvW,MAAM,KACf,GAAG1K,OAEZ+gB,EAAUI,QAAsB,SAAZD,IACpBH,EAAUI,OAASD,IAM3BxpB,KAAKyB,OAeL4nB,EAAUC,UAAW,EACN,SAAZE,IAEKxL,EADDqL,EAAUI,OACDzL,EAAMxW,UAAU,EAAE+hB,EAAUliB,OAAS,WAAagiB,EAAUI,OAASzL,EAAMxW,UAAU+hB,EAAUliB,MAAQkiB,EAAU,GAAG7hB,QAEpHsW,EAAMxW,UAAU,EAAE+hB,EAAUliB,OAAS2W,EAAMxW,UAAU+hB,EAAUliB,MAAQkiB,EAAU,GAAG7hB,UAnBjGsW,EACIwL,EAEc,SAAVA,IACCxL,EAAQA,EAAMxW,UAAU,EAAE+hB,EAAUliB,OAAS,eAAiB2W,EAAMxW,UAAU+hB,EAAUliB,MAAQkiB,EAAU,GAAG7hB,SAGjHsW,GAAS,gBAGbA,EAAQ,eAabA,IACCjV,EAAII,MAAa,MAAI6U,IAElB,IAEX,GAOJ5G,EAAgB,SACZ,SAAU9U,EAAgByG,GACtB,MAAMuD,EAAevD,EAAII,MAAY,MAAK,OACpCugB,EAAS3gB,EAAI1I,QAAQ6F,cACrB1D,EAAQuG,EAAIvG,MAClB,IAAKA,EACD,OAAO,EAEX,IAAImnB,EAAYrnB,EAAOhC,IAAIN,KAAKyB,MAAMe,GACtC,GAAa,UAAT8J,EAEIqd,GADQ5gB,EAAII,MAAa,OAEzBJ,EAAII,MAAe,QAAI,UACvBxC,KAAKijB,YAAY7gB,EAAK,WAAW,YAE1BA,EAAII,MAAe,QAC1BxC,KAAKijB,YAAY7gB,EAAK,WAAW,SAElC,GAAa,aAATuD,EAAqB,CAE5B,IAAIud,EAAK9gB,EAAII,MAAM,aAEfwgB,GAAaE,GACb9gB,EAAII,MAAa,MAAI0gB,EACrBljB,KAAKijB,YAAY7gB,EAAK,WAAW,KAEjCA,EAAII,MAAa,MAAIJ,EAAII,MAAM,YAC/BxC,KAAKijB,YAAY7gB,EAAK,WAAW,SAElC,GAAe,WAAX2gB,EACP3gB,EAAII,MAAa,MAAIwgB,EACrBhjB,KAAKijB,YAAY7gB,EAAK,QAAS4gB,OAC5B,CACH,IAAInhB,EAAI,MAACmhB,EAAiDA,EAAY,GACtE5gB,EAAII,MAAa,MAAIX,EACrB7B,KAAKijB,YAAY7gB,EAAK,QAASP,GAEnC,IAAI5F,EAAgBuiB,YAAY7kB,IAAI,qBA6CpC,OA5CKsC,IACDA,EAAQ,IAAIgZ,OAAO,KAAM,UACrB,SAAUpZ,EAAOuG,GACb,MAAM6E,EAAU5N,KAAK6N,WAAW9E,EAAI+C,KACpC,IAAK8B,EACD,OAEJ,IAAInL,EAAYsG,EAAImD,KAAKoR,aAAa,SAClChR,EAAOvD,EAAII,MAAY,KACvB2M,EAAQrT,EAAUhB,MAClB+G,EAAIoF,EAAGnM,MAGE,aAAT6K,EAEI9D,EADAO,EAAII,MAAM,cAAgBX,EACtBO,EAAII,MAAM,YAEVJ,EAAII,MAAM,aAEF,UAATmD,IACFsB,EAAGkc,UACJthB,OAAIe,IAKZ,IAAIoB,EAAMmL,EAAM9C,MAAM,KACtB,GAAmB,IAAfrI,EAAIjD,OACJlF,EAAMsT,GAAStN,MACZ,CACH,IAAIqX,EAAOrd,EACXsT,EAAQnL,EAAImV,MACZ,IAAK,IAAI3U,EAAI,EAAGA,EAAIR,EAAIjD,QAAUmY,EAAM1U,IACpC0U,EAAOA,EAAKlV,EAAIQ,IAEhB0U,IACAA,EAAK/J,GAAStN,OAK9B2c,YAAYjlB,IAAI,oBAAqB0C,IAEzCmG,EAAImD,KAAKoB,SAAS1K,IACX,IAEX,IAMJwU,EAAgB,SACZ,SAAU9U,EAAgByG,GAOtB,GALkC,MAA9BA,EAAI1I,QAAQ6F,gBACZ6C,EAAII,MAAY,KAAI,sBAExBJ,EAAII,MAAY,KAAInJ,KAAKyB,MAErBsH,EAAII,MAAc,OAAG,CACrB,IAAI4gB,EAAShhB,EAAII,MAAc,cACxBJ,EAAII,MAAc,OAEzBqK,OAAOwW,eAAe1nB,EAAQtC,KAAKyB,MAAOsH,EAAIvG,MAAOunB,IAChDvW,OAAOC,aAAazT,KAAKyB,MAAMmG,WAAW4L,OAAOC,eAAeD,OAAOC,cAAgB1K,EAAIvG,MAAMunB,IAClGvW,OAAO0B,GAAGlV,KAAKyB,OAKvB,IAAImB,EAAgBuiB,YAAY7kB,IAAI,oBAepC,OAdKsC,IACDA,EAAQ,IAAIgZ,OAAO,KAAM,SACrB,SAAUpZ,EAAOuG,EAAKkhB,EAAOroB,GACzB,IAAI8Q,EAAO3J,EAAII,MAAY,KACvBxC,KAAK8L,QAAQC,IAGjBc,OAAO0B,GAAGxC,MAGlByS,YAAYjlB,IAAI,mBAAoB0C,IAGxCmG,EAAImD,KAAKoB,SAAS1K,IACX,IAEX,IAMJwU,EAAgB,UACZ,SAAU9U,EAAgByG,GAEtB,OADAyK,OAAOQ,aAAa9T,IAAIoC,EAAOoD,GAAIqD,EAAI+C,MAChC,IAEX,IAOJsL,EAAgB,QACZ,SAAU9U,EAAgByG,GACtB/I,KAAKyB,MAAQzB,KAAKyB,OAAS,UAC3B,IAAIwS,EAAMlL,EAAIK,OAAOqC,SACrB,MAAMI,EAAM9C,EAAImD,KAEhB,GAAI+H,EAAK,CACL,IAAI7N,EAAIf,cAAc/E,IAAI2T,GACtB7N,GAEAA,EAAEwE,cAAc1K,IAAI,UAAYF,KAAKyB,MAAO,CAAEsH,IAAK8C,EAAKrJ,MAAOuG,EAAIvG,YAEpE,CAEH,MAAMmhB,EAAMrhB,EAAOsI,cAActK,IAAI,UAAYN,KAAKyB,OAChD8L,EAAWoW,EAAIA,EAAI5a,IAAIwE,SAAS1B,EAAI0B,SAC1C,GAAGA,EACC,IAAK,IAAIN,KAAKM,EAAU,CACpB,IAAI/K,EACAqJ,EAAIyS,QAAQ,eACZ9b,EAAQuG,EAAIvG,MACPmhB,IACLnhB,EAAQmhB,EAAInhB,MAEZA,EAAMojB,SAASC,aAAaC,UAAUtjB,EAAMF,IAGhDgJ,SAASkC,UAAUlL,EAAQ2K,EAAGzK,EAAOuG,EAAIK,OAAQyC,EAAIC,IAAI,MAIrE,OAAO,IAEX,GAOJsL,EAAgB,aACZ,SAAU9U,EAAgByG,+CAEtB,MAAMmhB,EAAUlqB,KAAKyB,MACrB,IAAKkF,KAAK8K,SAASyY,GACf,OAAO,IAAI1S,MAAM,oBAIrB,MAAM2S,EAA2B,GAAlBD,EAAQC,OAGjB7d,EAAO4d,EAAQ5d,MAAQ,aAEvB8d,EAA+B,GAApBF,EAAQE,SAGnBC,aAAYH,EAAQ/pB,2BAAMmqB,QAASJ,EAAQ/pB,KAC3CoqB,aAAYL,EAAQ/pB,2BAAMqqB,QAASN,EAAQ/pB,KAG3CsqB,aAAgBP,EAAQQ,+BAAUJ,QAASJ,EAAQQ,UAAY,GAC/DC,aAAgBT,EAAQQ,+BAAUE,QAASV,EAAQQ,UAAY,GAG/DG,aAAaX,EAAQY,4BAAOR,QAASJ,EAAQY,OAAS,KACtDC,aAAab,EAAQY,4BAAON,QAASN,EAAQY,OAAS,KAGtDE,aAAsBd,EAAQe,qCAAgBX,QAASJ,EAAQe,gBAAkB,OACjFC,aAAsBhB,EAAQe,qCAAgBT,QAASN,EAAQe,gBAAkB,OAGjFE,uBACFjB,EAAQkB,4BAAOd,4BAAOe,QAASnB,EAAQkB,MAAMd,MAAMe,kBAASnB,EAAQkB,4BAAOC,cAAU9hB,EACnF+hB,uBACFpB,EAAQkB,4BAAOd,4BAAOiB,OAAQrB,EAAQkB,MAAMd,MAAMiB,iBAAQrB,EAAQkB,4BAAOG,aAAShiB,EAChFiiB,uBACFtB,EAAQkB,4BAAOZ,4BAAOa,QAASnB,EAAQkB,MAAMZ,MAAMa,kBAASnB,EAAQkB,4BAAOC,cAAU9hB,EACnFkiB,uBACFvB,EAAQkB,4BAAOZ,4BAAOe,OAAQrB,EAAQkB,MAAMZ,MAAMe,iBAAQrB,EAAQkB,4BAAOG,aAAShiB,EAGtF,IAAI8N,EAAU,KACV,MAAMzJ,EAA+BtL,EAAOuL,WAAW9E,EAAI+C,KAEtDqe,GAgBGmB,GACAA,EAAWrpB,MAAMK,EAAOE,MAAO,CAACF,IAGpCsL,EAAG8d,UAAUnO,OAAO8M,EAAY,iBACpB,aAAR/d,GACAsB,EAAG8d,UAAU1iB,IAAIqhB,EAAY,eArB7BD,IAEAxc,EAAGoQ,MAAMwL,QAAU,QAEnBiC,GACAA,EAAWxpB,MAAMK,EAAOE,MAAO,CAACF,KAGnCsL,EAAGoQ,MAAM2N,MAAO/d,EAAGoQ,MAAM4N,QAuVlC,SAAmC7iB,GAC/B,MAAM8iB,EAAS9iB,EAAImD,KAAKY,QAAQ,SAChC,IAAI6e,EACAC,EACJ,GAAIC,EAAQ,CACR,IAAIlhB,EAAMkhB,EAAOvjB,OAAO0K,MAAM,QAC9B,IAAK,MAAMvG,KAAK9B,EACR8B,EAAE7E,WAAW,WACb+jB,EAAQlf,EAAEuG,MAAM,KAAK,IAErBvG,EAAE7E,WAAW,YACbgkB,EAASnf,EAAEuG,MAAM,KAAK,IAMlC,OAFA2Y,EAAQA,GAAS,GACjBC,EAASA,GAAU,GACZ,CAACD,EAAOC,GAxWyBE,CAA0B/iB,GAE9D6E,EAAG8d,UAAUnO,OAAOgN,EAAY,iBACpB,aAARje,GACAsB,EAAG8d,UAAU1iB,IAAIuhB,EAAY,cAarC3c,EAAGsW,oBAAoB,eAAgB7M,GACvCzJ,EAAGsW,oBAAoB,gBAAiB7M,IAIxCzJ,EAA+BtL,EAAOuL,WAAW9E,EAAI+C,KAE7D,GAAKqe,EA6CM,CAEH,GAAIvc,EAAI,CACJ,IAAkE,GAA9DA,EAAGme,aAAa,SAAShkB,QAAQ,GAAGsiB,cAIpC,OADAthB,EAAII,MAAa,OAAK,IAAIkhB,cACnB,EAEPD,IAGArhB,EAAII,MAAa,MACVJ,EAAII,MAAa,OAAK,iBACtBJ,EAAII,MAAa,MAAI,iBAGhC6iB,EAA0Bpe,QAGtBwc,IAEArhB,EAAII,MAAa,MACVJ,EAAII,MAAa,OAAK,iBACtBJ,EAAII,MAAa,MAAI,iBAGhCuK,YAAW,KAEP,IAAI9F,EAA+BtL,EAAOuL,WAAW9E,EAAI+C,KACrDse,IAGArhB,EAAII,MAAa,OAAK,IAAIkhB,aAC1Bzc,EAAGoQ,MAAMwL,QAAU,QAKvBwC,EAA0Bpe,KAC3B,GAGP,OAAO,EAtFP,OAAIA,GACkE,GAA9DA,EAAGme,aAAa,SAAShkB,QAAQ,GAAGwiB,eAEpCxhB,EAAII,MAAa,OAAK,IAAIohB,aACtBH,IACArhB,EAAII,MAAa,MACVJ,EAAII,MAAa,OAAK,iBACtBJ,EAAII,MAAa,MAAI,kBAEzB,IAIX8iB,EAA0Bre,IACnB,IAGHwc,IAEArhB,EAAII,MAAa,MACVJ,EAAII,MAAa,OAAK,iBACtBJ,EAAII,MAAa,MAAI,iBAIhCuK,YAAW,KAEP,IAAI9F,EAA+BtL,EAAOuL,WAAW9E,EAAI+C,KACrDse,GAEAxc,EAAG8d,UAAU1iB,IAAI,GAAGuhB,cAGpBxhB,EAAII,MAAa,OAAK,IAAIohB,aAC1B3c,EAAGoQ,MAAMwL,QAAU,QAGnByC,EAA0Bre,KAE/B,IAGA,GAkDX,SAASqe,EAA0Bre,GAE/B,GAAY,cAARtB,EAAsB,CAItB,IAAKqf,EAAOC,GAAUM,EAActe,GAEpCuJ,uBAAsB,KAElBvJ,EAAG8d,UAAUnO,OAAO8M,EAAY,aAGhCzc,EAAG8d,UAAU1iB,IAAIuhB,EAAY,iBAG7B3c,EAAG8d,UAAU1iB,IAAIuhB,EAAY,eAGZ,eAAbA,EACA3c,EAAGoQ,MAAM4N,OAASA,EACE,cAAbrB,IACP3c,EAAGoQ,MAAM2N,MAAQA,GAIrB/d,EAAGoQ,MAAMmO,gBAAkBtB,EAEN,IAAjBJ,IACA7c,EAAGoQ,MAAMoO,mBAAqB3B,GAGP,QAAvBO,IACApd,EAAGoQ,MAAMqO,yBAA2BrB,GAGpCQ,GACAA,EAAYvpB,MAAMK,EAAOE,MAAO,CAACF,IAErC6U,uBAAsB,KAElBvJ,EAAG8d,UAAU1iB,IAAIuhB,EAAY,aAE7B3c,EAAG8d,UAAUnO,OAAOgN,EAAY,eAEf,eAAbA,EACA3c,EAAGoQ,MAAM4N,OAAS,MACE,cAAbrB,IACP3c,EAAGoQ,MAAM2N,MAAQ,OAGrB/d,EAAGgJ,iBAAiB,gBAAiBS,cAK7CF,uBAAsB,KAElBvJ,EAAG8d,UAAUnO,OAAO8M,EAAY,aAGhCzc,EAAGoQ,MAAMsO,eAAiBvB,EAGL,IAAjBJ,IACA/c,EAAGoQ,MAAMuO,kBAAoB5B,GAGN,QAAvBO,IACAtd,EAAGoQ,MAAMwO,wBAA0BtB,GAGnCM,GACAA,EAAYvpB,MAAMK,EAAOE,MAAO,CAACF,IAGhCsL,EAAG6e,YAER7e,EAAG8d,UAAU1iB,IAAIuhB,EAAY,iBAE7B3c,EAAGgJ,iBAAiB,eAAgBS,MAUhD,SAAS2U,EAA0Bpe,GAE/B,GAAY,cAARtB,EAAsB,CAMtBsB,EAAGoQ,MAAMmO,gBAAkB,KAC3B,IAAIrB,EAAiC,IAAzB4B,WAAW7B,GACvBnX,YAAW,KAEP,IAAKiY,EAAOC,GAAUM,EAActe,GAGpCA,EAAG8d,UAAUnO,OAAOgN,EAAY,aAEhC3c,EAAG8d,UAAU1iB,IAAIqhB,EAAY,iBAE7Bzc,EAAG8d,UAAU1iB,IAAIqhB,EAAY,eAEZ,eAAbA,EACAzc,EAAGoQ,MAAM4N,OAAS,MACE,cAAbvB,IACPzc,EAAGoQ,MAAM2N,MAAQ,OAGA,IAAjBlB,IACA7c,EAAGoQ,MAAMoO,mBAAqB3B,GAGP,QAAvBO,IACApd,EAAGoQ,MAAMqO,yBAA2BrB,GAGxC7T,uBAAsB,KAGdiT,IACAxc,EAAGoQ,MAAMwL,QAAU,IAGvBrS,uBAAsB,KACdgU,GACAA,EAAYlpB,MAAMK,EAAOE,MAAO,CAACF,IAGrCsL,EAAG8d,UAAU1iB,IAAIqhB,EAAY,aAE7Bzc,EAAG8d,UAAUnO,OAAO8M,EAAY,eAEf,eAAbA,EACAzc,EAAGoQ,MAAM4N,OAASA,EACE,cAAbvB,IACPzc,EAAGoQ,MAAM2N,MAAQA,GAErB/d,EAAGgJ,iBAAiB,gBAAiBS,WAG9CyT,OACA,CAGHld,EAAGoQ,MAAMsO,eAAiB,KAC1B,IAAIxB,EAAiC,IAAzB4B,WAAW7B,GACvBnX,YAAW,KAEPyD,uBAAsB,KAClBvJ,EAAG8d,UAAUnO,OAAOgN,EAAY,aAGX,IAAjBE,IACA7c,EAAGoQ,MAAMuO,kBAAoB9B,GAIN,QAAvBO,IACApd,EAAGoQ,MAAMwO,wBAA0B/B,GAEnCL,IACAxc,EAAGoQ,MAAMwL,QAAU,IAGnB2B,GACAA,EAAYlpB,MAAMK,EAAOE,MAAO,CAACF,IAGhCsL,EAAG6e,YAER7e,EAAG8d,UAAU1iB,IAAIqhB,EAAY,iBAC7Bzc,EAAGgJ,iBAAiB,eAAgBS,QAEzCyT,IASX,SAASoB,EAActe,GACnB,GAAwB,QAApBA,EAAGoQ,MAAMwL,QAAmB,CAE5B,MAAMmD,EAAWhW,OAAOiW,iBAAiBhf,GAAIif,iBAAiB,YACxDC,EAAMnW,OAAOiW,iBAAiBhf,GAAIif,iBAAiB,cAGzDjf,EAAGoQ,MAAM2O,SAAW,WAEpB/e,EAAGoQ,MAAM+O,WAAa,SAEtBnf,EAAGoQ,MAAMwL,QAAU,GAEnB,IAAImC,EAAQhV,OAAOiW,iBAAiBhf,GAAIif,iBAAiB,SACrDjB,EAASjV,OAAOiW,iBAAiBhf,GAAIif,iBAAiB,UAO1D,OAJAjf,EAAGoQ,MAAM2O,SAAWA,EACpB/e,EAAGoQ,MAAM+O,WAAaD,EACtBlf,EAAGoQ,MAAMwL,QAAU,OAEZ,CAACmC,EAAOC,GAIf,MAAO,CAFKjV,OAAOiW,iBAAiBhf,GAAIif,iBAAiB,SAC5ClW,OAAOiW,iBAAiBhf,GAAIif,iBAAiB,cA8BtE,ICr6BR5J,aAAa+J,OAAO,MAAM,CACtBC,WAAWlkB,EAAiBzG,EAAc4qB,EAActrB,GACpD,IAAIurB,EAAMvrB,EAAEwrB,QAAQ,GACpBF,EAAO9J,YAAYhH,SAAS9Z,EAAOyG,EAAI,MAAO,CAAEskB,GAAIF,EAAIG,MAAOC,GAAIJ,EAAIK,MAAOC,EAAGxd,KAAKC,SAE1Fwd,UAAU3kB,EAAiBzG,EAAc4qB,EAActrB,GACnD,IAAImf,EAAMmM,EAAO9J,YAAY9G,SAASha,EAAOyG,EAAI,OACjD,IAAIgY,EACA,OAEJ,IAAIoM,EAAMvrB,EAAEwrB,QAAQ,GAChBO,EAAKR,EAAIG,MAAQvM,EAAIsM,GACrBO,EAAKT,EAAIK,MAAQzM,EAAIwM,IAErB5c,KAAKkd,IAAIF,GAAM,GAAKhd,KAAKkd,IAAID,GAAM,KACnC7M,EAAI+M,MAAO,IAGnBC,SAAShlB,EAAiBzG,EAAc4qB,EAActrB,GAClD,IAAImf,EAAMmM,EAAO9J,YAAY9G,SAASha,EAAOyG,EAAI,OACjD,IAAIgY,EACA,OAEJmM,EAAO9J,YAAY5G,YAAYla,EAAOyG,EAAI,OAC1C,IAAIilB,EAAK/d,KAAKC,MAAQ6Q,EAAI0M,EAG1B,IAAK1M,EAAI+M,MAAQE,EAAK,IAAK,CACvB,IAAIxX,EAAM0W,EAAO9J,YAAY/L,QACX,iBAARb,EACNlU,EAAOkiB,aAAqB0I,EAAO9J,YAAY/L,QAAQtO,EAAIvG,MAAMuG,EAAImkB,EAAO9J,YAAYxhB,GAExF4U,EAAIvU,MAAMK,EAAO,CAACyG,EAAIvG,MAAMuG,EAAImkB,EAAO9J,YAAYxhB,QASlEqhB,aAAa+J,OAAO,QAAQ,CACzBC,WAAWlkB,EAAiBzG,EAAc4qB,EAActrB,GACpD,IAAIurB,EAAMvrB,EAAEwrB,QAAQ,GAChBK,EAAIxd,KAAKC,MACbgd,EAAO9J,YAAYhH,SAAS9Z,EAAOyG,EAAI,QAAS,CAC5CklB,QAAS,CAACR,EAAGA,GACbS,SAAU,CAAC,CAAE5S,EAAG6R,EAAIG,MAAO/R,EAAG4R,EAAIK,OAAS,CAAElS,EAAG6R,EAAIG,MAAO/R,EAAG4R,EAAIK,QAClEW,OAAQ,CAAE7S,EAAG6R,EAAIG,MAAO/R,EAAG4R,EAAIK,UAGvCE,UAAU3kB,EAAiBzG,EAAc4qB,EAActrB,GACnD,IAAIwsB,EAAKne,KAAKC,MACVid,EAAMvrB,EAAEwrB,QAAQ,GAChBiB,EAAKnB,EAAO9J,YAAY9G,SAASha,EAAOyG,EAAI,SAE5CqlB,EAAKC,EAAGJ,QAAQ,GAAK,KACrBI,EAAGH,SAAS,GAAK,CAAE5S,EAAG+S,EAAGH,SAAS,GAAG5S,EAAGC,EAAG8S,EAAGH,SAAS,GAAG3S,GAC1D8S,EAAGH,SAAS,GAAK,CAAE5S,EAAG6R,EAAIG,MAAO/R,EAAG4R,EAAIK,OACxCa,EAAGJ,QAAQ,GAAKI,EAAGJ,QAAQ,GAC3BI,EAAGJ,QAAQ,GAAKG,GAEpBC,EAAGF,OAAS,CAAE7S,EAAG6R,EAAIG,MAAO/R,EAAG4R,EAAIK,QAEvCO,SAAShlB,EAAiBzG,EAAc4qB,EAActrB,GAClD,IAAIysB,EAAKnB,EAAO9J,YAAY9G,SAASha,EAAOyG,EAAI,SAC5CqlB,EAAKne,KAAKC,MAGVpF,EAAOsjB,EAAKC,EAAGJ,QAAQ,GAAK,GAAM,EAAI,EACtCN,EAAKU,EAAGF,OAAO7S,EAAI+S,EAAGH,SAASpjB,GAAKwQ,EACpCsS,EAAKS,EAAGF,OAAO5S,EAAI8S,EAAGH,SAASpjB,GAAKyQ,EACpChU,EAAIoJ,KAAK2d,KAAKX,EAAKA,EAAKC,EAAKA,GAC7BI,EAAKI,EAAKC,EAAGJ,QAAQnjB,GAEzB,GAAIkjB,EAAK,KAAOzmB,EAAI,GAChB,OAEJ,IAAIgnB,EAAKhnB,EAAIymB,EAEb,GAAIO,EAAK,IAAM,CACX,IAAIC,EAAQ,GAkBZ,GAjBIb,EAAK,GAAKhd,KAAKkd,IAAID,EAAKD,GAAM,IAC9B/rB,EAAE2sB,GAAKA,EACPC,EAAQ,aAERb,EAAK,GAAKhd,KAAKkd,IAAID,EAAKD,GAAM,IAC9B/rB,EAAE2sB,GAAKA,EACPC,EAAQ,cAERZ,EAAK,GAAKjd,KAAKkd,IAAIF,EAAKC,GAAM,IAC9BhsB,EAAE2sB,GAAKA,EACPC,EAAQ,aAERZ,EAAK,GAAKjd,KAAKkd,IAAIF,EAAKC,GAAM,IAC9BhsB,EAAE2sB,GAAKA,EACPC,EAAQ,WAGRtB,EAAO9J,YAAYjjB,OAASquB,EAAO,CACnC,IAAIhY,EAAM0W,EAAO9J,YAAY/L,QACX,iBAARb,EACNlU,EAAOkiB,aAAahO,EAAIzN,EAAIvG,MAAOuG,EAAImkB,EAAO9J,YAAaxhB,GACvC,mBAAR4U,GACZA,EAAIvU,MAAMK,EAAO,CAACyG,EAAIvG,MAAMuG,EAAImkB,EAAO9J,YAAYxhB,SAQvEqhB,aAAa+J,OAAO,YAAY/J,aAAa3iB,IAAI,UACjD2iB,aAAa+J,OAAO,aAAa/J,aAAa3iB,IAAI,UAClD2iB,aAAa+J,OAAO,UAAU/J,aAAa3iB,IAAI,UAC/C2iB,aAAa+J,OAAO,YAAY/J,aAAa3iB,IAAI,UAKjD2iB,aAAa+J,OAAO,WAAW,CAC3ByB,MAAM1lB,EAAiBzG,EAAc4qB,EAActrB,GAC/C,IAAI8sB,EAAaxB,EAAO9J,YAAY9G,SAASha,EAAOyG,EAAI,cACxD,GAAG2lB,EAAW,CAGV,GAFQze,KAAKC,MAENwe,EAAa,IAAI,CACpB,IAAIlY,EAAM0W,EAAO9J,YAAY/L,QACX,iBAARb,EACNlU,EAAOkiB,aAAqB0I,EAAO9J,YAAY/L,QAAQtO,EAAIvG,MAAMuG,EAAImkB,EAAO9J,YAAYxhB,GAExF4U,EAAIvU,MAAMK,EAAO,CAACyG,EAAIvG,MAAMuG,EAAImkB,EAAO9J,YAAYxhB,UAI3DsrB,EAAO9J,YAAYhH,SAAS9Z,EAAOyG,EAAI,aAAckH,KAAKC,OAI9DwD,YAAW,KACPwZ,EAAO9J,YAAY5G,YAAYla,EAAOyG,EAAI,gBAC5C,6YClHG4lB,OAmHTjuB,cA1FQV,iBAA8B,IAAIQ,IAyBnCR,cAA0B,GAkE7BA,KAAK0F,GAAKiB,KAAKC,QACf5G,KAAK6lB,aAAe,IAAIU,aAAavmB,MACrCA,KAAKuP,WAAa,IAAIqY,WAAW5nB,MACjCA,KAAK4K,cAAgB,IAAI6c,cAAcznB,MACvCA,KAAKqN,aAAe,IAAIkW,aAAavjB,MAErCA,KAAKwC,MAAQ,IAAI6iB,MAAMrlB,KAAKgD,QAAQ,GAAKhD,MAEzCA,KAAKkW,MAAQ3C,eAAaqb,UAE1BvpB,cAAc2D,IAAIhJ,MAQfwf,SAASrW,GACZ,OAAO,KAOJnG,OACH,MAAO,GAMJ2I,SACH,GAAG3L,KAAKkW,QAAU3C,eAAaqb,UAC3B,OAGJ,IAAIC,EAAc7uB,KAAKwf,SAASxf,KAAKmJ,OAOrC,GALG0lB,IAAgB7uB,KAAK8uB,cACpB9uB,KAAK8uB,YAAcD,EACnB7uB,KAAK+G,YAGL/G,KAAKuP,WAAWuY,SAChB,OAEC9nB,KAAK+uB,aACN/uB,KAAKgvB,cAAc,uBAGvBhvB,KAAKgvB,cAAc,kBAEnB,MAAMC,EAAUjvB,KAAKuP,WAAWyY,aAWhC,GATAhoB,KAAKuP,WAAWyY,aAAe1c,SAASkC,UAAUxN,KAAKA,KAAKuP,WAAWuY,SAAS9nB,KAAKwC,OACjFxC,KAAK+uB,cACL/uB,KAAKgvB,cAAc,iBACnBhvB,KAAK+uB,aAAc,GAGvB/uB,KAAKgvB,cAAc,aAGfhvB,KAAKuP,WAAWyY,aAGhB,OAFAhoB,KAAKuU,eACLvU,KAAK+uB,aAAc,GAKvB,GAAG/uB,KAAKkW,QAAU3C,eAAa4C,SAC3B,GAAG8Y,GAAWjvB,KAAKwC,MAAM,CAErB,IAAIyM,EAAa6S,SAASvR,QAAQvQ,KAAKuP,WAAWyY,aAAaiH,GAC/DjvB,KAAKgvB,cAAc,kBAEhB/f,EAAWvH,OAAO,IACjB4D,SAAS4jB,kBAAkBlvB,KAAKiP,GAEhCjP,KAAKgvB,cAAc,mBAI3BhvB,KAAKmvB,QAQNvc,SAAStQ,GACZ,IAAI2R,EACiB,iBAAX3R,GACN2R,EAAM3R,EACNA,EAAS+C,cAAc/E,IAAI2T,IAE3BA,EAAM3R,EAAOoD,GAEZ1F,KAAKuN,SAAS/B,SAASyI,KACxBjU,KAAKuN,SAAS1C,KAAKoJ,GACnB3R,EAAO8sB,SAAWpvB,KAAK0F,IAQxB4J,YAAYhN,GACf,IAAIwI,EAAI9K,KAAKuN,SAASxF,QAAQzF,EAAOoD,KACxB,IAAToF,IACAxI,EAAOiS,UACPvU,KAAKuN,SAAS7B,OAAOZ,EAAI,IAQ1BuL,SAEArW,KAAKkW,QAAU3C,eAAaqb,YAC3B5uB,KAAKkW,MAAQ3C,eAAa8b,OAE9B/jB,SAAStC,IAAIhJ,MAMVmvB,QAEHnvB,KAAKgvB,cAAc,iBAEnB,IAAIM,EAAS,IAAIC,iBACjB,MAAM3hB,EAAKtC,SAASwC,aAAa9N,KAAKA,KAAKuP,WAAWyY,aAAasH,GAAO,GAC1E,GAAGtvB,KAAKwvB,UACJxvB,KAAKwvB,UAAU1lB,YAAYwlB,QACzB,GAAGtvB,KAAKyvB,OAAO,CACjB,MAAMzZ,EAAKhW,KAAK0vB,YAChB,IAAI1Z,EACA,OAGJhW,KAAK2vB,WAAa3Z,EAAGnI,WAAW7N,KAAKyvB,OAAO3jB,KACxC9L,KAAK2vB,YACL3vB,KAAK2vB,WAAWtgB,cAAcK,aAAa9B,EAAI5N,KAAK2vB,YAExD3Z,EAAGpH,YAAY5O,KAAKyvB,OAAO3jB,IAAK8B,GAGpC5N,KAAKgvB,cAAc,WACnBhvB,KAAKkW,MAAQ3C,eAAa4C,QAMvB5B,UAEH,GAAIvU,KAAKkW,QAAU3C,eAAaqb,WAAavpB,cAAc0O,YAAc/T,KACrE,OAGJsL,SAASiS,OAAOvd,KAAK0F,IAErB1F,KAAKqN,aAAaqR,QAElB1e,KAAKgvB,cAAc,mBAEnB,MAAMphB,EAAK5N,KAAK6N,WAAW,GAC3B,GAAID,EACA,GAAI5N,KAAKwvB,UACLxvB,KAAKwvB,UAAUlgB,YAAY1B,QACxB,GAAI5N,KAAKyvB,OAAQ,CACpB,MAAMzZ,EAAKhW,KAAK0vB,YACZ1Z,IAEIpI,EAAGyB,eACHzB,EAAGyB,cAAcK,aAAa1P,KAAK2vB,WAAY/hB,GAEnDoI,EAAGpH,YAAY5O,KAAKyvB,OAAO3jB,IAAK9L,KAAK2vB,aASjD,GALA3vB,KAAKuP,WAAW6Y,QAEhBpoB,KAAKkW,MAAQ3C,eAAaqb,UAC1B5uB,KAAKgvB,cAAc,aAEfhvB,KAAKuN,SACL,IAAK,IAAI7H,KAAM1F,KAAKuN,SAAU,CAC1B,IAAInH,EAAIf,cAAc/E,IAAIoF,GACtBU,GACAA,EAAEmO,WAWXmb,YACH,GAAI1vB,KAAKovB,SACL,OAAO/pB,cAAc/E,IAAIN,KAAKovB,UAU9BJ,cAAcnT,GAClB,IAAIrF,EAAMxW,KAAK6b,GACf,GAAGrF,GAAoB,mBAANA,EACb,OAAOA,EAAIvU,MAAMjC,KAAK,CAACA,KAAKwC,QAS7BotB,UAAUzvB,GACb,OAAOH,KAAKG,GAOTiW,aAAaxI,GAChB5N,KAAKwvB,UAAY5hB,EAOd4W,aAAaqL,EAAmBC,EAAUC,EAAUC,EAAUC,EAAUC,EAAUC,EAAUC,EAAUC,GACzG,IAAIjqB,EAAWpG,KACXwW,EAAMpQ,EAAEypB,GAOZ,IANIrZ,GAAOxW,KAAK+oB,aACZ3iB,EAAIf,cAAc/E,IAAIN,KAAK+oB,YACxB3iB,IACCoQ,EAAMpQ,EAAEypB,KAGZrZ,GAAsB,mBAARA,EAAoB,CAClC,IAAIwB,EAAO,GACX,IAAI,IAAI7M,EAAE,EAAEA,EAAE2M,UAAUpQ,OAAOyD,IAC3B6M,EAAKnN,KAAKiN,UAAU3M,IAExB,OAAOqL,EAAIvU,MAAMmE,EAAG4R,IASrBiR,SAAS9f,EAAUJ,GACtB,IAAIunB,EAAUnnB,EAAM6f,MAIpB,GAHAhpB,KAAKuwB,aAAe,UACbpnB,EAAM6f,MAEVsH,EACC,IAAI,IAAIrjB,KAAK1G,OAAOC,KAAK8pB,GACrBtwB,KAAKwC,MAAMyK,GAAKqjB,EAAQrjB,GAKhCjN,KAAKyvB,OAAS1mB,EAGd,IAAIynB,GAAiB,EAErB,GAAIxwB,KAAKmJ,MAIL,IAAI,IAAI7C,KAAKC,OAAOC,KAAK2C,GAElBA,EAAM7C,KAAOtG,KAAKmJ,MAAM7C,KACvBkqB,GAAS,EAETxwB,KAAKuwB,aAAajqB,GAAK6C,EAAM7C,SARrCtG,KAAKuwB,aAAepnB,EACpBqnB,GAAS,EAabxwB,KAAKmN,OAASpE,EAAImD,KAAKiB,OAGpBqjB,GACCxwB,KAAKywB,WAAWzwB,KAAKuwB,eAItBC,GAAUxwB,KAAKkW,QAAU3C,eAAaqb,YACrC5uB,KAAKqW,SAITrW,KAAKmJ,MAAQA,EAMVpC,UAEH,GAAG/G,KAAKuF,SAAW1F,MAAMC,QAAQE,KAAKuF,SAAS,CAC3C,IAAK,IAAI0D,KAAOjJ,KAAKuF,QACjBF,cAAcM,SAASsD,UAEpBjJ,KAAKuF,QAEhB,GAAIvF,KAAK8uB,cAIT9uB,KAAK0wB,SAAW,EAEhB1wB,KAAKuN,SAAW,GAEhBzE,WAAWkB,iBAAiBhK,MAE5BA,KAAKuP,WAAWuY,SAAW,IAAIxI,SAAStf,MAAM+G,QAAQ/G,KAAK8uB,aACvD9uB,KAAKuP,WAAWuY,UAApB,CAIA,GAAG9nB,KAAKuP,WAAWuY,SAAS3e,MACxB,IAAI,IAAI6D,KAAKhN,KAAKuP,WAAWuY,SAAS3e,MAClCnJ,KAAK2wB,YAAYzwB,IAAI8M,EAAE,GAAGA,EAAE,IAMpC,GAFAhN,KAAKywB,WAAWzwB,KAAKmJ,OAElBnJ,KAAKmN,OACJ,IAAI,IAAIgW,KAAMnjB,KAAKmN,OACfnN,KAAKuP,WAAWuY,SAASxa,SAAS6V,GAI1CnjB,KAAKgvB,cAAc,cAOhB4B,gBAAgBznB,GACnBnJ,KAAK6wB,cAAgB1nB,EAQjBsnB,WAAWtnB,GACf,GAAIA,GAAUnJ,KAAKuP,WAAWuY,SAI9B,IAAI,IAAIxhB,KAAKC,OAAOC,KAAK2C,GAEjBnJ,KAAK6wB,eAAkB7wB,KAAK6wB,cAAcrlB,SAASlF,KAEhDtG,KAAK2wB,YAAYpwB,IAAI+F,GACpBtG,KAAKuP,WAAWuY,SAASrJ,QAAQnY,EAAE,CAAC6C,EAAM7C,GAAGtG,KAAK2wB,YAAYrwB,IAAIgG,KAElEtG,KAAKuP,WAAWuY,SAASrJ,QAAQnY,EAAE6C,EAAM7C,KAalDuH,WAAW/B,GACd,OAAO9L,KAAKuP,WAAW4Y,WAAW7nB,IAAIwL,GAQnC8C,YAAY9C,EAAWiD,GAC1B/O,KAAKuP,WAAW4Y,WAAWjoB,IAAI4L,EAAIiD,GAShCmF,UAAU/T,EAAYib,EAAcrN,GACvC,IAAI/N,KAAKuN,SACL,OAEJ,MAAMtE,EAAM5D,cAAcyrB,SAAS3wB,GACnC,GAAI8I,EAGJ,OAMA,SAAS8M,EAAKgR,GACV,IAAI,IAAIrhB,KAAMqhB,EAAIxZ,SAAS,CACvB,IAAInH,EAAWf,cAAc/E,IAAIoF,GACjC,GAAGU,EAAE,CACD,GAAGA,EAAE1F,cAAgBuI,EAAI,CACrB,IAAG8E,EAaC,OAAO3H,EAbF,CAEL,IAAI2qB,GAAkB,EACtB,IAAI,IAAIzqB,KAAKC,OAAOC,KAAKuH,GACrB,IAAI3H,EAAE+C,OAAS/C,EAAE+C,MAAM7C,KAAOyH,EAAMzH,GAAG,CACnCyqB,GAAU,EACV,MAGR,GAAGA,EACC,OAAO3qB,GAOnB,GAAGgV,EAAK,CACJ,IAAIjU,EAAI4O,EAAK3P,GACb,GAAGe,EACC,OAAOA,KA/BpB4O,CAAK/V,MA6CRgxB,WAAWC,EAAiB7V,GAChC,IAAIpb,KAAKuN,SACL,OAEJ,IAAI5C,EAAM,GAEV,OAMA,SAASoL,EAAKzT,GACV,IAAIA,EAAOiL,SACP,OAEJ,IAAI,IAAI7H,KAAMpD,EAAOiL,SAAS,CAC1B,IAAInH,EAAWf,cAAc/E,IAAIoF,GAC9BU,GAAKA,EAAE1F,cACH0F,EAAE1F,YAAYP,OAAS8wB,GACtBtmB,EAAIE,KAAKzE,GAEVgV,GACCrF,EAAK3P,KAlBrB2P,CAAK/V,MACE2K,EAmCJ2c,MAAM9kB,EAA4BsJ,EAA6Byb,EAA0BnM,GAC5F,OAAG5Y,EAAa,MACLxC,KAAK6lB,aAAayB,MAAM9kB,EAAWsJ,EAAcyb,EAAQnM,GAEzDpb,KAAK6lB,aAAayB,MAAMtnB,KAAKwC,MAAWA,EAAWsJ,EAAayb,GAYxErnB,IAAIsC,EAAmBsJ,EAAQrK,GAC/Be,EAAa,MACZxC,KAAK6lB,aAAa3lB,IAAIsC,EAAMsJ,EAAIrK,GAEhCzB,KAAK6lB,aAAa3lB,IAAIF,KAAKwC,MAAcA,EAAMsJ,GAYhDxL,IAAIkC,EAAoBsJ,GAC3B,OAAGtJ,EAAa,MACLxC,KAAK6lB,aAAavlB,IAAIkC,EAAMsJ,GAE5B9L,KAAK6lB,aAAavlB,IAAIN,KAAKwC,MAAcA,GAQjDsa,cACH,QAAS9c,KAAK0wB,0GCjsBTQ,SAaTxwB,YAAY4B,GALJtC,WAA+B,IAAIQ,SAMxB+I,IAAXjH,IACAtC,KAAKyL,SAAWnJ,EAAOoD,IASxBsD,IAAI7I,EAAoBmF,GAC3BtF,KAAKmxB,MAAMjxB,IAAIC,EAAKmF,GAQjBhF,IAAIH,GACP,OAAOH,KAAKmxB,MAAM7wB,IAAIH,GAQnBod,OAAOpd,GACVH,KAAKmxB,MAAMpwB,OAAOZ,GAQfI,IAAIJ,GACP,OAAOH,KAAKmxB,MAAM5wB,IAAIJ,oMrBTFuE,EAAqC0E,GAC7D,IAAIlG,EAEJ,GADAkG,EAASA,GAAUoK,OAAOlQ,KACtBqD,KAAK7G,QAAQ4E,GACb,IAAK,IAAIY,KAA0BZ,EAC/BxB,EAAQ,IAAIsP,MAAMlN,EAAK8D,QAG3BlG,EAAQ,IAAIsP,MAAiB9N,EAAO0E,GAExC,OAAOlG,oBAhCiBvD,EAAUiO,EAAUwjB,4CAE5C,OAAOA,GAAU,MACb,IAAK,KACD7e,eAAenN,EACf,MACJ,IAAK,KACDmN,eAAerQ,EAGvB2U,UAAUwa,QAAQ/lB,SAASK,OAAQL,UAEnCuL,UAAUjD,QACV,IAAImT,EAAU1hB,cAAc/E,IAAIX,GAChConB,EAAI3Q,aAAazM,SAAS2nB,cAAc1jB,IACxCmZ,EAAI1Q,qCAoCqB1W,EAAUQ,GACnCkF,cAAcM,SAAShG,EAAMQ,uBAsBHuE,4CAC1B,aAAaqL,eAAewhB,QAAQ7sB"}