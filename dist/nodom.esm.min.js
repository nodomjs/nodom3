class DefineElementManager{static add(e,t){if(Array.isArray(e))for(let t of e)this.elements.set(t.name.toUpperCase(),t);else this.elements.set((t||e.name).toUpperCase(),e)}static get(e){return this.elements.get(e.toUpperCase())}static has(e){return this.elements.has(e.toUpperCase())}}DefineElementManager.elements=new Map;class DirectiveType{constructor(e,t,s){this.name=e,this.prio=s>=0?s:10,this.handle=t}}class DirectiveManager{static addType(e,t,s){this.directiveTypes.set(e,new DirectiveType(e,t,s))}static removeType(e){this.directiveTypes.delete(e)}static getType(e){return this.directiveTypes.get(e)}static hasType(e){return this.directiveTypes.has(e)}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function e(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))}DirectiveManager.directiveTypes=new Map;const t={TipWords:{application:"Application",system:"System",module:"Module",clazz:"类",moduleClass:"ModuleClass",model:"Model",directive:"Directive",directiveType:"Directive-type",expression:"Expression",event:"Event",method:"Method",filter:"Filter",filterType:"Filter-type",data:"Data",dataItem:"Data-item",route:"Route",routeView:"Route-container",plugin:"Plugin",resource:"Resource",root:"Root",element:"VirtualDom"},ErrorMsgs:{unknown:"unknown error",uninit:"{0}未初始化",paramException:"{0} '{1}' parameter error，see api",invoke:"method {0} parameter {1} must be {2}",invoke1:"method {0} parameter {1} must be {2} or {3}",invoke2:"method {0} parameter {1} or {2} must be {3}",invoke3:"method {0} parameter {1} not allowed empty",exist:"{0} is already exist",exist1:"{0} '{1}' is already exist",notexist:"{0} is not exist",notexist1:"{0} '{1}' is not exist",notupd:"{0} not allow to change",notremove:"{0} not allow to delete",notremove1:"{0} {1} not allow to delete",namedinvalid:"{0} {1} name error，see name rules",initial:"{0} init parameter error",jsonparse:"JSON parse error",timeout:"request overtime",config:"{0} config parameter error",config1:"{0} config parameter '{1}' error",itemnotempty:"{0} '{1}' config item '{2}' not allow empty",itemincorrect:"{0} '{1}' config item '{2}' error",needEndTag:"element {0} is not closed",needStartTag:"without start tag matchs {0}",tagError:"element {0} error",wrongTemplate:"wrong template",wrongExpression:"expression error: {0} "},WeekDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},s={TipWords:{application:"应用",system:"系统",module:"模块",clazz:"类",moduleClass:"模块类",model:"模型",directive:"指令",directiveType:"指令类型",expression:"表达式",event:"事件",method:"方法",filter:"过滤器",filterType:"过滤器类型",data:"数据",dataItem:"数据项",route:"路由",routeView:"路由容器",plugin:"插件",resource:"资源",root:"根",element:"元素"},ErrorMsgs:{unknown:"未知错误",uninit:"{0}未初始化",paramException:"{0}'{1}'方法参数错误，请参考api",invoke:"{0} 方法参数 {1} 必须为 {2}",invoke1:"{0} 方法参数 {1} 必须为 {2} 或 {3}",invoke2:"{0} 方法参数 {1} 或 {2} 必须为 {3}",invoke3:"{0} 方法参数 {1} 不能为空",exist:"{0} 已存在",exist1:"{0} '{1}' 已存在",notexist:"{0} 不存在",notexist1:"{0} '{1}' 不存在",notupd:"{0} 不可修改",notremove:"{0} 不可删除",notremove1:"{0} {1} 不可删除",namedinvalid:"{0} {1} 命名错误，请参考用户手册对应命名规范",initial:"{0} 初始化参数错误",jsonparse:"JSON解析错误",timeout:"请求超时",config:"{0} 配置参数错误",config1:"{0} 配置参数 '{1}' 错误",itemnotempty:"{0} '{1}' 配置项 '{2}' 不能为空",itemincorrect:"{0} '{1}' 配置项 '{2}' 错误",needEndTag:"{0} 标签未闭合",needStartTag:"未找到与 {0} 匹配的开始标签",tagError:"标签 {0} 错误",wrongTemplate:"模版格式错误",wrongExpression:"表达式 {0} 错误"},WeekDays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]};class ModuleFactory{static add(e){0===this.modules.size&&(this.mainModule=e),this.modules.set(e.id,e),this.addClass(e.constructor)}static get(e){let t,s=typeof e;return"number"===s?this.modules.get(e):("string"===s?(e=e.toLowerCase(),this.classes.has(e)||(e=this.aliasMap.get(e)),this.classes.has(e)&&(t=Reflect.construct(this.classes.get(e),[]))):t=Reflect.construct(e,[]),t?(t.init(),t):void 0)}static hasClass(e){const t=e.toLowerCase();return this.classes.has(t)||this.aliasMap.has(t)}static addClass(e,t){let s=e.name.toLowerCase();this.classes.has(s)||(this.classes.set(s,e),t&&this.aliasMap.set(t.toLowerCase(),s))}static getClass(e){return e=e.toLowerCase(),this.classes.has(e)?this.classes.get(e):this.classes.get(this.aliasMap.get(e))}static load(t){return e(this,void 0,void 0,(function*(){let e=yield import(t);if(e)for(let t of Object.keys(e))if(e[t].name)return this.addClass(e[t]),e[t]}))}static remove(e){this.modules.delete(e)}static setMain(e){this.mainModule=e}static getMain(){return this.mainModule}}ModuleFactory.modules=new Map,ModuleFactory.classes=new Map,ModuleFactory.aliasMap=new Map;class Expression{constructor(e){if(this.id=Util.genId(),!e||""===(e=e.trim()))return;Nodom.isDebug&&(this.exprStr=e);const t=this.compile(e);this.execFunc=new Function("$model","return "+t)}compile(e){const t=/('[\s\S]*?')|("[\s\S]*?")|(`[\s\S]*?`)|([a-zA-Z$_][\w$]*\s*?:)|((\.{3}|\.)?[a-zA-Z$_][\w$]*(\.[a-zA-Z$_][\w$]*)*(\s*[\[\(](\s*\))?)?)/g;let s,r="",i=0;for(;null!==(s=t.exec(e));){let o=s[0];if(i<s.index&&(r+=e.substring(i,s.index)),"'"===o[0]||'"'===o[0]||"`"===o[0])r+=o;else{let e=o[o.length-1];if(":"===e)r+=o;else if("("===e||")"===e)r+=n(o);else if(o.startsWith("this.")||Util.isKeyWord(o)||"."===o[0]&&"."!==o[1]||"$model"===o)r+=o;else{let e="";o.startsWith("...")&&(e="...",o=o.substring(3)),r+=e+"$model."+o}}i=t.lastIndex}return i<e.length&&(r+=e.substring(i)),r;function n(e){const t=(e=e.replace(/\s+/g,"")).lastIndexOf("("),s=e.indexOf("."),r=-1!==s?e.substring(0,s):e.substring(0,t);if(Util.isKeyWord(r)||"."===e[0])return e;if(-1===s){let t="this.invokeMethod('"+r+"'";return t+=")"!==e[e.length-1]?",":")",t}return"$model."+e}}val(e,t){if(!this.execFunc)return;let s;try{s=this.execFunc.call(e,t)}catch(e){Nodom.isDebug&&(console.error(new NError("wrongExpression",this.exprStr).message),console.error(e))}return this.value=s,s}}class CssManager{static handleStyleDom(e,t,s){if("this"===t.props.scope){let r=this.cssPreName+e.id;s.props.class?s.props.class=t.props.class+" "+r:s.props.class=r}}static handleStyleTextDom(e,t){return!(!t.parent||"style"!==t.parent.tagName)&&(CssManager.addRules(e,t.textContent,t.parent&&"this"===t.parent.props.scope?"."+this.cssPreName+e.id:void 0),!0)}static addRules(e,t,s){if(!this.sheet){let e=document.createElement("style");document.head.appendChild(e),this.sheet=document.styleSheets[0]}s&&this.clearModuleRules(e);const r=/(@[a-zA-Z]+\s+url\(.+?\))|([.#@a-zA-Z]\S*(\s*\S*\s*?)?{)|\}/g,i=/@[a-zA-Z]+\s+url/;let n,o=-1,a=0;for(;null!==(n=r.exec(t));)if(i.test(n[0]))d(n[0]);else if("}"===n[0]){if(o>=0&&--a<=0){let r=t.substring(o,n.index+1);"@"===r[0]?this.sheet.insertRule(r,CssManager.sheet.cssRules?CssManager.sheet.cssRules.length:0):l(e,r,s),o=-1,a=0}}else-1===o?(o=n.index,a++):a++;function l(e,t,s){let r=/.+(?=\{)/.exec(t);if(r){if(s){let i=e.objectManager.get("$cssRules");i||(i=[],e.objectManager.set("$cssRules",i)),i.push(s+" "+r[0]),t=s+" "+t}CssManager.sheet.insertRule(t,CssManager.sheet.cssRules?CssManager.sheet.cssRules.length:0)}}function d(e){let t=e.indexOf("("),s=e.lastIndexOf(")");if(-1===t||-1===s||t>=s)return;let r=e.substring(t,s);CssManager.importMap.has(r)||(CssManager.sheet.insertRule(e,CssManager.importIndex++),CssManager.importMap.set(r,!0))}}static clearModuleRules(e){let t=e.objectManager.get("$cssRules");if(t&&0!==t.length){for(let e=0;e<this.sheet.cssRules.length;e++){let s=this.sheet.cssRules[e];s.selectorText&&-1!==t.indexOf(s.selectorText)&&this.sheet.deleteRule(e--)}e.objectManager.set("$cssRules",[])}}}CssManager.importMap=new Map,CssManager.importIndex=0,CssManager.cssPreName="___nodommodule___";class Renderer{static setRootEl(e){this.rootEl=e}static getRootEl(){return this.rootEl}static getCurrentModule(){return this.currentModule}static add(e){this.waitList.includes(e.id)||this.waitList.push(e.id)}static remove(e){let t;-1!==(t=this.waitList.indexOf(e))&&this.waitList.splice(t,1,null)}static render(){for(;this.waitList.length>0;){let e=this.waitList[0];if(e){const t=ModuleFactory.get(e);this.currentModule=t,t.render(),this.currentModule=null}this.waitList.shift()}}static renderDom(e,t,s,r,i){const n=i?t.key+"_"+i:t.key;t.staticNum>0&&t.staticNum--;let o={key:n,model:s,vdom:t,staticNum:t.staticNum};t.tagName&&(o.tagName=t.tagName,o.props={},t.isSvg&&(o.isSvg=t.isSvg)),r?o.parent=r:this.currentRootDom=o;const a=t.getDirective("model");if(a&&a.exec(e,o),o.tagName){if(this.handleProps(e,t,o),"style"===t.tagName)CssManager.handleStyleDom(e,o,Renderer.currentRootDom);else if(t.assets&&t.assets.size>0){o.assets||(o.assets={});for(let e of t.assets)o.assets[e[0]]=e[1]}if(!this.handleDirectives(e,t,o))return null;if(t.events&&!t.hasDirective("module")){e.eventFactory.removeAllEvents(o);for(let r of t.events)r=r.handleExpr(e,s),1!==t.key&&(r.module=e),this.currentModule.eventFactory.addEvent(o,r)}if(t.children&&t.children.length>0){o.children=[];for(let s of t.children)this.renderDom(e,s,o.model,o,i||null)}}else if(t.expressions){let s="";for(let r of t.expressions)if(r instanceof Expression){let t=r.val(e,o.model);s+=void 0!==t?t:""}else s+=r;o.textContent=s}else o.textContent=t.textContent;return r&&r.children.push(o),o}static handleDirectives(e,t,s){if(!t.directives||0===t.directives.length)return!0;for(let r of t.directives)if("model"!==r.type.name&&!r.exec(e,s))return!1;return!0}static handleProps(e,t,s){if(s!==this.currentRootDom){if(t.props&&0!==t.props.size)for(let r of t.props)s.props[r[0]]=r[1]instanceof Expression?r[1].val(e,s.model):r[1]}else e.handleRootProps(t,s)}static updateToHtml(e,t){let s=e.getElement(t.key);if(!s)return this.renderToHtml(e,t,null);if(t.tagName){s.key=t.key;let e=s.attributes,r=[];if(e)for(let t=0;t<e.length;t++)r.push(e[t].name);for(let e of Object.keys(t.props)){let i;s.setAttribute(e,void 0===t.props[e]?"":t.props[e]),-1!==(i=r.indexOf(e))&&r.splice(i,1)}if(r.length>0)for(let e of r)s.removeAttribute(e);if(t.assets)for(let e of Object.keys(t.assets))s[e]=t.assets[e]}else s.textContent=t.textContent;return s}static renderToHtml(e,t,s,r){let i;return i=t.tagName?n(t):o(t),i&&t.tagName&&r&&function e(t,s){s.children&&s.children.length>0&&s.children.forEach((s=>{let r;s.tagName?(r=n(s),e(r,s)):r=o(s),r&&t.appendChild(r)}))}(i,t),i&&s&&s.appendChild(i),i;function n(t){if("style"===t.tagName)return;let s;t.isSvg?(s=document.createElementNS("http://www.w3.org/2000/svg",t.tagName),"svg"===t.tagName&&s.setAttribute("xmlns","http://www.w3.org/2000/svg")):s=document.createElement(t.tagName),e.saveElement(t.key,s),s.key=t.key;for(let e of Object.keys(t.props))void 0!==t.props[e]&&null!==t.props[e]&&""!==t.props[e]&&s.setAttribute(e,t.props[e]);if(t.assets)for(let e of Object.keys(t.assets))s[e]=t.assets[e];return e.eventFactory.unbindAll(t.key),e.eventFactory.bind(t.key),s}function o(t){if(CssManager.handleStyleTextDom(e,t))return;let s=document.createTextNode(t.textContent||"");return e.saveElement(t.key,s),s}}static handleChangedDoms(e,t){const s=[],r=[],i=[];for(let n of t)switch(n[0]){case 1:r.push(n);break;case 2:Renderer.updateToHtml(e,n[1]);break;case 3:const t=e.getElement(n[3].key),o=e.getElement(n[1].key);t&&o&&o.parentElement===t&&t.removeChild(o),e.domManager.freeNode(n[1]);break;case 4:i.push(n);break;default:s.push(n)}if(s.length>0)for(let t of s){const s=e.getElement(t[3].key);let r;t[2].moduleId?(e.domManager.freeNode(t[2]),r=e.getElement(t[2].key)):(r=e.getElement(t[2].key),e.domManager.freeNode(t[2]));const i=Renderer.renderToHtml(e,t[1],null,!0);s&&r&&s.replaceChild(i,r)}r.length>1&&r.sort(((e,t)=>e[4]>t[4]?1:-1));const n=i.length>0?{}:void 0;for(let t of r){const s=e.getElement(t[3].key),r=Renderer.renderToHtml(e,t[1],null,!0);s.childNodes&&s.childNodes.length>t[4]?s.insertBefore(r,s.childNodes[t[4]]):s.appendChild(r),n&&(n[t[3].key+"_"+t[4]]=!0)}for(let t of i){const s=e.getElement(t[3].key),r=e.getElement(t[1].key);if(r&&r!==s.childNodes[t[4]]){if(!n[t[3].key+"_"+t[5]]){const e=document.createTextNode("");s.childNodes.length>t[5]?s.insertBefore(e,s.childNodes[t[5]]):s.appendChild(e)}s.replaceChild(r,s.childNodes[t[4]]),n[t[3].key+"_"+t[4]]=!0}}}}Renderer.waitList=[];class RequestManager{static request(t){return e(this,void 0,void 0,(function*(){const e=Date.now();if(this.requestMap.has(t.url)){const s=this.requestMap.get(t.url);if(e-s.time<this.rejectReqTick&&Util.compare(s.params,t.params))return new Promise(((e,t)=>{e(null)}))}return this.requestMap.set(t.url,{time:e,params:t.params}),new Promise(((e,s)=>{"string"==typeof t&&(t={url:t}),t.params=t.params||{},t.rand&&(t.params.$rand=Math.random());let r=t.url;const i=!1!==t.async,n=new XMLHttpRequest;n.withCredentials=t.withCredentials;const o=(t.method||"GET").toUpperCase();n.timeout=i?t.timeout:0,n.onload=()=>{if(200===n.status){let r=n.responseText;if("json"===t.type)try{r=JSON.parse(r)}catch(e){s({type:"jsonparse"})}e(r)}else s({type:"error",url:r})},n.ontimeout=()=>s({type:"timeout"}),n.onerror=()=>s({type:"error",url:r});let a=null;switch(o){case"GET":let e;if(Util.isObject(t.params)){let s=[];for(let e of Object.keys(t.params)){const r=t.params[e];null!=r&&s.push(e+"="+r)}e=s.join("&")}void 0!==e&&(-1!==r.indexOf("?")?r+="&"+e:r+="?"+e);break;case"POST":if(t.params instanceof FormData)a=t.params;else{let e=new FormData;for(let s of Object.keys(t.params)){const r=t.params[s];null!=r&&e.append(s,r)}a=e}}n.open(o,r,i,t.user,t.pwd),t.header&&Util.getOwnProps(t.header).forEach((e=>{n.setRequestHeader(e,t.header[e])})),n.send(a)})).catch((e=>{switch(e.type){case"error":throw new NError("notexist1",r.TipWords.resource,e.url);case"timeout":throw new NError("timeout");case"jsonparse":throw new NError("jsonparse")}}))}))}static clearCache(){const e=Date.now();if(this.requestMap)for(let t of this.requestMap)e-t[1].time>this.rejectReqTick&&this.requestMap.delete(t[0])}}RequestManager.rejectReqTick=500,RequestManager.requestMap=new Map;class Route{constructor(e,t){if(this.params=[],this.data={},this.children=[],e&&!Util.isEmpty(e.path)){this.id=Util.genId();for(let t of Object.keys(e))this[t]=e[t];this.parent=t,this.path&&this.parse(),t&&t.addChild(this),e.routes&&Array.isArray(e.routes)&&e.routes.forEach((e=>{new Route(e,this)}))}}addChild(e){this.children.push(e),e.parent=this}parse(){let e=this.path.split("/"),t=this.parent,s=[],r=-1,i="";for(let n=0;n<e.length;n++){let o=e[n].trim();if(""!==o){if(o.startsWith(":"))0===s.length&&(r=n),s.push(o.substring(1));else{r=-1,s=[],this.path=o;let e=0;for(;e<t.children.length;e++){let s=t.children[e];if(s.path===o){t=s;break}}e===t.children.length&&(""!==i&&(new Route({path:i},t),t=t.children[t.children.length-1]),i=o)}this.params=-1===r?[]:s}else e.splice(n--,1)}}clone(){let e=new Route;return Object.getOwnPropertyNames(this).forEach((t=>{"data"!==t&&(e[t]=this[t])})),this.data&&(e.data=Util.clone(this.data)),e}}class Scheduler{static dispatch(){Scheduler.tasks.forEach((e=>{Util.isFunction(e.func)&&(e.thiser?e.func.call(e.thiser):e.func())}))}static start(e){Scheduler.dispatch(),window.requestAnimationFrame?window.requestAnimationFrame(Scheduler.start):window.setTimeout(Scheduler.start,e||50)}static addTask(e,t){if(!Util.isFunction(e))throw new NError("invoke","Scheduler.addTask","0","function");Scheduler.tasks.push({func:e,thiser:t})}static removeTask(e){if(!Util.isFunction(e))throw new NError("invoke","Scheduler.removeTask","0","function");let t=-1;-1!==(t=Scheduler.tasks.indexOf(e))&&Scheduler.tasks.splice(t,1)}}Scheduler.tasks=[];var r=s;class Nodom{static app(e,t){Renderer.setRootEl(document.querySelector(t)||document.body),Scheduler.addTask(Renderer.render,Renderer),Scheduler.addTask(RequestManager.clearCache),Scheduler.start(),ModuleFactory.get(e).active()}static debug(){this.isDebug=!0}static setLang(e){switch(e||"zh"){case"zh":r=s;break;case"en":r=t}}static use(e,t){return e.name||new NError("notexist",r.TipWords.plugin),this["$"+e.name]||(this["$"+e.name]=Reflect.construct(e,t||[])),this["$"+e.name]}static createRoute(e,t){if(!Nodom.$Router)throw new NError("uninit",r.TipWords.route);let s;if(t=t||Nodom.$Router.getRoot(),Util.isArray(e))for(let r of e)s=new Route(r,t);else s=new Route(e,t);return s}static createDirective(e,t,s){return DirectiveManager.addType(e,t,s)}static registModule(e,t){ModuleFactory.addClass(e,t)}static request(t){return e(this,void 0,void 0,(function*(){return yield RequestManager.request(t)}))}}function i(e,t){return Nodom.app(e,t)}class NError extends Error{constructor(e,t,s,i,n){super(e);let o=r.ErrorMsgs[e];if(void 0===o)return void(this.message="未知错误");let a=[o];for(let e=1;e<arguments.length;e++)a.push(arguments[e]);this.message=this.compile.apply(null,a)}compile(e,t,s,r,i,n){let o,a=arguments,l=0;for(;-1!==e.indexOf("{"+l+"}");)o=new RegExp("\\{"+l+"\\}","g"),e=e.replace(o,a[l+1]),l++;return e}}class Util{static genId(){return this.generatedId++}static initKeyMap(){["arguments","boolean","break","byte","catch","char","const","default","delete","do","double","else","enum","eval","false","float","for","function","goto","if","in","instanceof","int","let","long","null","return","short","switch","this","throw","true","try","this","throw","typeof","var","while","with","Array","Date","JSON","Set","Map","eval","Infinity","isFinite","isNaN","isPrototypeOf","Math","new","NaN","Number","Object","prototype","String","isPrototypeOf","undefined","valueOf"].forEach((e=>{this.keyWordMap.set(e,!0)}))}static isKeyWord(e){return this.keyWordMap.has(e)}static clone(e,t,s){let r=this,i=new WeakMap;return n(e,t,s);function n(e,t,s){if(!e||"object"!=typeof e||Util.isFunction(e))return e;let n;return e.clone&&Util.isFunction(e.clone)?e.clone(s):(r.isObject(e)?(n=new Object,i.set(e,n),Object.getOwnPropertyNames(e).forEach((r=>{t&&(t.constructor===RegExp&&t.test(r)||Util.isArray(t)&&t.includes(r))||(n[r]=o(e[r],t,s))}))):r.isMap(e)?(n=new Map,e.forEach(((e,r)=>{t&&(t.constructor===RegExp&&t.test(r)||t.includes(r))||n.set(r,o(e,t,s))}))):r.isArray(e)&&(n=new Array,e.forEach((function(e,r){n[r]=o(e,t,s)}))),n)}function o(e,t,s){if("object"==typeof e&&!Util.isFunction(e)){let r=null;return r=i.has(e)?i.get(e):n(e,t,s),r}return e}}static compare(e,t){return function e(t,s){if(t===s)return!0;let r=Object.keys(t),i=Object.keys(s);if(r.length!==i.length)return!1;for(let i of r)if("object"==typeof t[i]&&"object"==typeof s[i]){let r=e(t[i],s[i]);if(!r)return!1}else if(t[i]!==s[i])return!1;return!0}(e,t)}static getOwnProps(e){return e?Object.getOwnPropertyNames(e):[]}static isFunction(e){return null!=e&&e.constructor===Function}static isArray(e){return Array.isArray(e)}static isMap(e){return null!=e&&e.constructor===Map}static isObject(e){return null!=e&&e.constructor===Object}static isEmpty(e){if(null==e)return!0;if(this.isObject(e)){let t=Object.keys(e);if(void 0!==t)return 0===t.length}else if("string"==typeof e)return""===e;return!1}static formatDate(e,t){if("string"==typeof e){if(!/^\d+$/.test(e))throw new NError("invoke","Util.formatDate","0","date string","date");e=Number(e)}let s=new Date(e);if(isNaN(s.getDay()))throw new NError("invoke","Util.formatDate","0","date string","date");let i,n={"M+":s.getMonth()+1,"d+":s.getDate(),"h+":s.getHours(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),S:s.getMilliseconds()};return(i=/(y+)/.exec(t))&&(t=t.replace(i[0],(s.getFullYear()+"").substring(4-i[0].length))),this.getOwnProps(n).forEach((function(e){(i=new RegExp("("+e+")").exec(t))&&(t=t.replace(i[0],1===i[0].length?n[e]:("00"+n[e]).substring((n[e]+"").length)))})),t=t.replace(/(E+)/,r.WeekDays[s.getDay()+""])}static compileStr(e,t,s,r,i,n){let o,a=arguments,l=0;for(;-1!==e.indexOf("{"+l+"}");)o=new RegExp("\\{"+l+"\\}","g"),e=e.replace(o,a[l+1]),l++;return e}}Util.generatedId=1,Util.keyWordMap=new Map,Util.initKeyMap();class Directive{constructor(e,t,s){if(this.id=Util.genId(),e&&(this.type=DirectiveManager.getType(e),!this.type))throw new NError("notexist1",r.TipWords.directive,e);"string"==typeof t?this.value=t.trim():t instanceof Expression?this.expression=t:this.value=t,this.templateModuleId=s}exec(e,t){return!!this.disabled||(this.expression&&(this.value=this.expression.val(e,t.model)),this.type.handle.apply(this,[e,t]))}clone(){let e=new Directive;return e.type=this.type,e.expression=this.expression,e.value=this.value,e.templateModuleId=this.templateModuleId,e}}class NEvent{constructor(e,t,s,r){if(this.id=Util.genId(),this.module=e,this.name=t,s){let e=typeof s;"string"===e?this.parseEvent(s.trim()):"function"===e?this.handler=s:s instanceof Expression&&(this.expr=s)}r&&(this.handler=r),this.touchOrNot()}handleExpr(e,t){if(!this.expr)return this;const s=this.expr.val(e,t);return s?new NEvent(e,this.name,s):void 0}parseEvent(e){e.split(":").forEach(((e,t)=>{if(e=e.trim(),0===t)this.handler=e;else switch(e){case"delg":this.delg=!0;break;case"nopopo":this.nopopo=!0;break;case"once":this.once=!0;break;case"capture":this.capture=!0}}))}touchOrNot(){if(document.ontouchend)switch(this.name){case"click":this.name="tap";break;case"mousedown":this.name="touchstart";break;case"mouseup":this.name="touchend";break;case"mousemove":this.name="touchmove"}else switch(this.name){case"tap":this.name="click";break;case"touchstart":this.name="mousedown";break;case"touchend":this.name="mouseup";break;case"touchmove":this.name="mousemove"}}setParam(e,t,s,r){e.objectManager.setEventParam(this.id,t.key,s,r)}getParam(e,t,s){return e.objectManager.getEventParam(this.id,t.key,s)}removeParam(e,t,s){return e.objectManager.removeEventParam(this.id,t.key,s)}clearParam(e,t){e.objectManager.clearEventParams(this.id,t.key)}}class VirtualDom{constructor(e,t,s){this.key=t||(s?s.getDomKeyId():Util.genId()),this.staticNum=1,e&&(this.tagName=e)}removeDirectives(e){this.directives&&e.forEach((e=>{this.removeDirective(e)}))}removeDirective(e){if(!this.directives)return;let t;-1!==(t=this.directives.findIndex((t=>t.type.name===e)))&&this.directives.splice(t,1),0===this.directives.length&&delete this.directives}addDirective(e,t){this.directives?this.directives.find((t=>t.type.name===e.type.name))||(this.directives.push(e),t&&this.sortDirective()):this.directives=[e]}sortDirective(){this.directives&&this.directives.length>1&&this.directives.sort(((e,t)=>DirectiveManager.getType(e.type.name).prio<DirectiveManager.getType(t.type.name).prio?-1:1))}hasDirective(e){return this.directives&&void 0!==this.directives.find((t=>t.type.name===e))}getDirective(e){if(this.directives)return this.directives.find((t=>t.type.name===e))}add(e,t){this.children||(this.children=[]),t?this.children.splice(t,0,e):this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);-1!==t&&this.children.splice(t,1)}hasProp(e){if(this.props)return this.props.has(e)}getProp(e,t){if(this.props)return this.props.get(e)}setProp(e,t){this.props||(this.props=new Map),"style"===e?this.removedStyleMap&&this.removedStyleMap.clear():"class"===e&&this.removedClassMap&&this.removedClassMap.clear(),this.props.set(e,t),this.setStaticOnce()}delProp(e){if(this.props){if(Util.isArray(e))for(let t of e)this.props.delete(t);else this.props.delete(e);this.setStaticOnce()}}setAsset(e,t){this.assets||(this.assets=new Map),this.assets.set(e,t),this.setStaticOnce()}delAsset(e){this.assets&&(this.assets.delete(e),this.setStaticOnce())}setParam(e,t,s){e.objectManager.setDomParam(this.key,t,s)}getParam(e,t){return e.objectManager.getDomParam(this.key,t)}removeParam(e,t){e.objectManager.removeDomParam(this.key,t)}setStaticOnce(){-1!==this.staticNum&&(this.staticNum=1)}clone(){let e=new VirtualDom(this.tagName,this.key);if(this.tagName){if(this.props&&this.props.size>0)for(let t of this.props)e.setProp(t[0],t[1]);if(this.assets&&this.assets.size>0)for(let t of this.assets)e.setAsset(t[0],t[1]);if(this.directives&&this.directives.length>0){e.directives=[];for(let t of this.directives)e.directives.push(t.clone())}if(e.events=this.events,this.children)for(let t of this.children)e.add(t.clone())}else e.expressions=this.expressions,e.textContent=this.textContent;return e.staticNum=this.staticNum,e}addEvent(e){this.events?this.events.includes(e)||this.events.push(e):this.events=[e]}}const n=new Set("area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr".split(","));class Compiler{constructor(e){this.domArr=[],this.textArr=[],this.isExprText=!1,this.template="",this.module=e}compile(e){if(e)return this.template=e.replace(/\<\!\-\-[\s\S]*?\-\-\>/g,"").trim(),e=this.template,this.compileTemplate(e),this.domArr.length>0&&this.forceClose(0),this.root}genKey(){return this.module.getDomKeyId()}compileTemplate(e){for(;0!==e.length;)e=e.startsWith("<")?"/"==e[1]?this.compileEndTag(e):this.compileStartTag(e):this.compileText(e)}compileStartTag(e){const t=/^<\s*([a-z][^\s\/\>]*)/i.exec(e);if(!t)return this.textArr.push(e[0]),e.substring(1);{const s=new VirtualDom(t[1].toLowerCase(),this.genKey(),this.module);"svg"===s.tagName&&(this.isSvg=!0),s.isSvg=this.isSvg,this.root||(this.root=s),this.current&&this.current.add(s),this.current=s,this.domArr.push(s),e=e.substring(t.index+t[0].length).trimStart()}return(e=this.compileAttributes(e)).startsWith(">")?(this.isVoidTab(this.current)&&this.handleCloseTag(this.current,!0),e.substring(1).trimStart()):e}compileAttributes(e){for(;0!==e.length&&">"!==e[0];){const t=/^((\/\>)|\$?[a-z_][\w-]*)(?:\s*=\s*((?:'[^']*')|(?:"[^"]*")|(?:`[^`]*`)|(?:{{[^}}]*}})))?/i.exec(e);if(!t){if(this.current)throw new NError("tagError",this.current.tagName);throw new NError("wrongTemplate")}if("/>"===t[0]){this.handleCloseTag(this.current,!0),e=e.substring(t.index+t[0].length).trimStart();break}{let e="$"!==t[1][0]?t[1].toLowerCase():t[1],s=t[3]?t[3].startsWith('"')||t[3].startsWith("'")?t[3].substring(1,t[3].length-1):t[3]:void 0;s&&s.startsWith("{{")&&(s=new Expression(s.substring(2,s.length-2)),this.current.staticNum=-1),e.startsWith("x-")?this.current.addDirective(new Directive(e.substring(2),s,this.module.id)):e.startsWith("e-")?this.current.addEvent(new NEvent(this.module,e.substring(2),s)):this.current.setProp(e,s)}e=e.substring(t.index+t[0].length).trimStart()}return e}compileEndTag(e){const t=/^<\/\s*([a-z][^\>]*)/i.exec(e);if(t){const s=t[1].toLowerCase().trim(),r=this.domArr.findLastIndex((e=>e.tagName===s));return this.forceClose(r),e.substring(t.index+t[0].length+1)}return e}forceClose(e){if(!(-1===e||e>this.domArr.length-1))for(let t=this.domArr.length-1;t>=e;t--)this.handleCloseTag(this.domArr[t])}compileText(e){for(;!e.startsWith("<")&&0!==e.length;)if(e.startsWith("{")){const t=/^{{([\s\S]*?)}}/i.exec(e);t?(this.textArr.push(new Expression(t[1])),this.isExprText=!0,e=e.substring(t.index+t[0].length)):("string"==typeof this.textArr[this.textArr.length]?this.textArr[this.textArr.length]+="{":this.textArr.push("{"),e=e.substring(1))}else{const t=/([^\<\{]*)/.exec(e);if(t){let s;s=this.current&&"pre"===this.current.tagName?this.preHandleText(e.substring(0,t.index+t[0].length)):this.preHandleText(e.substring(0,t.index+t[0].length).trim()),""!==s&&this.textArr.push(s)}e=e.substring(t.index+t[0].length)}let t=new VirtualDom(void 0,this.genKey());return this.isExprText?(t.expressions=[...this.textArr],t.staticNum=-1):t.textContent=this.textArr.join(""),this.current&&(this.isExprText||0!==t.textContent.length)&&this.current.add(t),this.isExprText=!1,this.textArr=[],e}preHandleText(e){if(/&[a-z]+;/.test(e)){let t=document.createElement("div");return t.innerHTML=e,t.textContent}return e}postHandleNode(e){let t=DefineElementManager.get(e.tagName);t&&Reflect.construct(t,[e,this.module]),ModuleFactory.hasClass(e.tagName)&&(e.addDirective(new Directive("module",e.tagName,this.module.id)),e.tagName="div")}handleSlot(e){if(!e.children||0===e.children.length||!e.hasDirective("module"))return;let t;for(let s=0;s<e.children.length;s++){let r=e.children[s];r.hasDirective("slot")||(t?e.children.splice(s--,1):(t=new VirtualDom("div",this.genKey()),t.addDirective(new Directive("slot","default",this.module.id)),e.children.splice(s,1,t)),t.add(r))}}handleCloseTag(e,t){this.postHandleNode(e),e.sortDirective(),t||this.handleSlot(e),this.domArr.pop(),this.domArr.length>0&&(this.current=this.domArr[this.domArr.length-1]),"svg"===e.tagName&&(this.isSvg=!1)}isVoidTab(e){return n.has(e.tagName)}}class DiffTool{static compare(e,t){const s=[];return r(e,t),s;function r(e,t){e.tagName?e.tagName!==t.tagName?i(5,e,t,t.parent):((e.staticNum||t.staticNum)&&function(e,t){for(let s of["props","assets"]){if(!e[s]&&t[s]||e[s]&&!t[s])return!0;if(e[s]&&t[s]){let r=Object.keys(e[s]),i=Object.keys(t[s]);if(r.length!==i.length)return!0;for(let i of r)if(e[s][i]!==t[s][i])return!0}}return!1}(e,t)&&i(2,e,null,t.parent),e.moduleId||function(e,t){if(e.children&&0!==e.children.length)if(t.children&&0!==t.children.length){let n={},[o,a,l,d]=[0,e.children.length-1,0,t.children.length-1],[c,h,u,p]=[e.children[o],e.children[a],t.children[l],t.children[d]];for(;o<=a&&l<=d;)u.key===c.key?(r(c,u),o!==l&&i(4,c,null,t,o,l),c=e.children[++o],u=t.children[++l]):p.key===h.key?(r(h,p),d!==a&&i(4,h,null,t,a,d),h=e.children[--a],p=t.children[--d]):c.key===p.key?(r(c,p),o!==d&&i(4,c,null,t,o,d),c=e.children[++o],p=t.children[--d]):h.key===u.key?(r(h,u),a!==l&&i(4,h,null,t,a,l),h=e.children[--a],u=t.children[++l]):(n[c.key]=i(1,c,null,t,o),c=e.children[++o]);if(o<=a)for(let s=o;s<=a;s++)i(1,e.children[s],null,t,s);if(l<=d)for(let e=l,o=e;e<=d;e++,o++){let a=t.children[e];if(n.hasOwnProperty(a.key)){let t=n[a.key];if(o!==t[4])t[0]=4,t[5]=e,r(t[1],a);else{let e;-1!==(e=s.findIndex((e=>e[1].key===t[1].key)))&&s.splice(e,1)}}else i(3,a,null,t),o--}}else e.children.forEach(((e,s)=>i(1,e,null,t,s)));else t.children&&t.children.length>0&&t.children.forEach((e=>i(3,e,null,t)))}(e,t)):t.tagName?i(5,e,t,t.parent):(e.staticNum||t.staticNum)&&e.textContent!==t.textContent?i(2,e,null,t.parent):e.moduleId!==t.moduleId&&i(5,e,t,t.parent)}function i(e,t,r,i,n,o){const a=[e,t,r,i,n,o];return s.push(a),a}}}class DefineElement{constructor(e){e.hasProp("tag")?(e.tagName=e.getProp("tag"),e.delProp("tag")):e.tagName="div"}}class EventManager{static handleExtendEvent(e,t,s){let r=this.get(s.name);if(!r)return!1;for(let i of Object.keys(r)){let n=new NEvent(e,i,r[i]);n.capture=s.capture,n.nopopo=s.nopopo,n.delg=s.delg,n.once=s.once,n.dependEvent=s,e.eventFactory.addEvent(t,n)}return!0}static regist(e,t){this.extendEventMap.set(e,t)}static unregist(e){return this.extendEventMap.delete(e)}static get(e){return this.extendEventMap.get(e)}}EventManager.extendEventMap=new Map;class EventFactory{constructor(e){this.module=e,this.eventMap=new Map,this.addedEvents=new Map}addEvent(e,t){const s=e.key;this.addedEvents.has(s)&&this.addedEvents.get(s).includes(t)||(t.delg&&(e.parent?this.addToArr(e.parent.key,t,e.key):t.delg=!1),t.delg||this.addToArr(e.key,t),this.addedEvents.has(s)?this.addedEvents.get(s).push(t):this.addedEvents.set(s,[t]))}addToArr(e,t,s){let r,i,n;this.eventMap.has(e)?r=this.eventMap.get(e):(r={bindMap:{}},this.eventMap.set(e,r)),r[t.name]||(r[t.name]={delg:[],own:[]}),s?(i="delg",n={key:s,event:t}):(i="own",n=t,r[t.name].capture=t.capture||!1),r[t.name][i].push(n)}getEvent(e){return this.eventMap.get(e)}removeAllEvents(e){if(this.addedEvents.has(e.key)){for(let t of this.addedEvents.get(e.key))this.removeEvent(e,t);this.addedEvents.delete(e.key)}}removeEvent(e,t){if(!this.addedEvents.has(e.key)||!this.addedEvents.get(e.key).includes(t))return;const s=this.addedEvents.get(e.key);if(s.splice(s.indexOf(t),1),t.delg){if(!e.parent||!this.eventMap.has(e.parent.key))return;let s=this.eventMap.get(e.parent.key);if(!s[t.name])return;let r=s[t.name],i=r.delg.findIndex((s=>s.key===e.key&&s.event===t));-1!==i&&r.delg.splice(i,1)}else{let s=this.eventMap.get(e.key);if(!s[t.name])return;let r=s[t.name],i=r.own.findIndex((e=>e===t));-1!==i&&r.own.splice(i,1)}}bind(e){if(!this.eventMap.has(e))return;const t=this.module.getElement(e),s=this.eventMap.get(e);for(let e of Object.keys(s))"bindMap"!==e&&(t.addEventListener(e,i,s[e].capture),s.bindMap[e]={handler:i,capture:s[e].capture});const r=this;function i(e){r.handler.apply(r,[r.module,e])}}unbind(e,t){if(!this.eventMap.has(e))return;const s=this.eventMap.get(e);if(!s.bindMap||!s[t])return;const r=this.module.getElement(e),i=s.bindMap[t];r&&i&&r.removeEventListener(t,i.handler,i.capture),delete s.bindMap[t]}unbindAll(e){if(!this.eventMap.has(e))return;const t=this.eventMap.get(e);if(!t.bindMap)return;const s=this.module.getElement(e);if(s)for(let e of Object.keys(t.bindMap)){const r=t.bindMap[e];s.removeEventListener(e,r.handler,r.capture)}t.bindMap={}}hasEvent(e){return this.eventMap.has(e)}clear(){for(let e of this.addedEvents.keys())this.unbindAll(e);this.addedEvents.clear(),this.eventMap.clear()}handler(e,t){let s=t.currentTarget;const r=s.key,i=e.domManager.getRenderedDom(r);if(!i)return;const n=this.eventMap.get(r);if(!n||!n[t.type])return;const o=n[t.type];function a(s){if(!s)return;let r=!1;for(let n=0;n<s.length;n++){const o=s[n],a=o.module!==e&&1===i.key?e.srcDom.model:i.model;"string"==typeof o.handler?o.module.invokeMethod(o.handler,a,i,o,t):"function"==typeof o.handler&&o.handler.apply(o.module,[a,i,o,t]),o.once&&s.splice(n--,1),r=o.nopopo}r&&t.stopPropagation()}function l(r){if(!r)return!1;const n=t.path||(t.composedPath?t.composedPath():[]);let o=!1;for(let a=0;a<r.length;a++){const l=r[a],d=l.event;for(let c=0;c<n.length&&n[c]!==s;c++){const s=n[c].key;if(s===l.key){const n=i.children.find((e=>e.key===s));if(!n)continue;const l=d.module!==e&&1===n.key?e.srcDom.model:n.model;if("string"==typeof d.handler?d.module.invokeMethod(d.handler,l,n,d,t):"function"==typeof d.handler&&d.handler.apply(d.module,l,n,d,t),o=d.nopopo,d.once){r.splice(a--,1);const t=e.eventFactory.get(s).indexOf(d);e.eventFactory.get(s).splice(t,1)}break}}}return o}o.capture?(a(o.own),l(o.delg)):l(o.delg)||a(o.own)}}class NCache{constructor(){this.subscribeMap=new Map,this.cacheData={}}get(e){let t=this.cacheData;if(-1!==e.indexOf(".")){let s=e.split(".");if(s.length>1){for(let e=0;e<s.length-1&&t;e++)t=t[s[e]];t&&(e=s[s.length-1])}}if(t)return t[e]}set(e,t){let s=this.cacheData,r=e;if(-1!==e.indexOf(".")){let t=e.split(".");if(t.length>1){for(let e=0;e<t.length-1;e++)s[t[e]]&&"object"==typeof s[t[e]]||(s[t[e]]={}),s=s[t[e]];e=t[t.length-1]}}if(s&&(s[e]=t),this.subscribeMap.has(r)){let e=this.subscribeMap.get(r);for(let s of e)this.invokeSubscribe(s.module,s.handler,t)}}remove(e){let t=this.cacheData;if(-1!==e.indexOf(".")){let s=e.split(".");if(s.length>1){for(let e=0;e<s.length-1&&t;e++)t=t[s[e]];t&&(e=s[s.length-1])}}t&&delete t[e]}subscribe(e,t,s){if(this.subscribeMap.has(t)){let r=this.subscribeMap.get(t);r.find((t=>t.module===e&&t.handler===s))||r.push({module:e,handler:s})}else this.subscribeMap.set(t,[{module:e,handler:s}]);let r=this.get(t);r&&this.invokeSubscribe(e,s,r)}invokeSubscribe(e,t,s){"string"==typeof t?e.invokeMethod(t,s):t.call(e,s)}}class GlobalCache{static set(e,t){this.cache.set(e,t)}static get(e){return this.cache.get(e)}static subscribe(e,t,s){this.cache.subscribe(e,t,s)}static remove(e){this.cache.remove(e)}}GlobalCache.cache=new NCache;class Model{constructor(e,t,s,r){if(!e||e.__source)return;let i=new Proxy(e,{set(e,s,r,i){let n=r;if(r&&r.__source){const e=r.__source;e&&(r.__module!==t&&(t.modelManager.add(e,r),r.__module.modelManager.bindModel(r,t),t.modelManager.setModelName(r,s)),n=e)}if(e[s]===n)return!0;let o=e[s],a=Reflect.set(e,s,n,i);return t.modelManager.update(i,s,o,r),a},get(e,i,n){if("__source"===i)return n?e:void 0;if("__module"===i)return n?t:void 0;if("__key"===i)return n?t.modelManager.getModelKey(e):void 0;if("__parent"===i)return s;if("__name"===i)return r;let o=Reflect.get(e,i,n);if(o&&(o.constructor===Object||o.constructor===Array)){let e=t.modelManager.getModel(o);e||(e=new Model(o,t,n,i)),o=e}return o},deleteProperty(e,s){let r=e[s];return delete e[s],t.modelManager.update(i,s,r,void 0),!0}});return t.modelManager.add(e,i),i}}class ModelManager{constructor(e){this.bindMap=new WeakMap,this.dataMap=new WeakMap,this.nameMap=new WeakMap,this.watchMap=new WeakMap,this.hasDeepWatch=!1,this.module=e}getModel(e){return this.dataMap.has(e)?this.dataMap.get(e).model:void 0}getModelKey(e){return this.dataMap.has(e)?this.dataMap.get(e).key:void 0}setModelName(e,t){this.nameMap.has(e)||this.nameMap.set(e,t)}getModelName(e){return this.nameMap.get(e)}add(e,t){this.dataMap.has(e)||this.dataMap.set(e,{model:t,key:t.__key||Util.genId()})}bindModel(e,t){e&&function e(t,s,r){if(s.__module===r)return;let i;t.has(s)?i=t.get(s):(i=[],t.set(s,i));i.includes(r.id)||i.push(r.id);for(let i of Object.keys(s))s[i]&&"object"==typeof s[i]&&e(t,s[i],r)}(this.bindMap,e,t)}update(e,t,s,r){if(i(this.module,e),Renderer.add(this.module),this.bindMap.has(e))for(let t of this.bindMap.get(e)){const s=ModuleFactory.get(t);s&&(i(s,e),Renderer.add(s))}function i(e,i){const n=e.modelManager.watchMap;let o=n.get(i);if(o&&o[t])o[t].f.call(e,i,t,s,r);else if(e.modelManager.hasDeepWatch)for(let o=i;o&&o.__parent;o=o.__parent){let a=o.__parent.__module===e?o.__parent:e.model;if(!n.has(a))continue;const l=n.get(a),d=e.modelManager.getModelName(o)||o.__name;if(l&&l[d]){let n=l[d];if(n.deep){n.f.call(e,i,t,s,r);break}}}}}watch(e,t,s,r){if(!s||"function"!=typeof s)return;const i=this;this.hasDeepWatch=r;let n=[];if(Array.isArray(t))for(let r of t)o(e,r,s);else o(e,t,s);return()=>{if(Array.isArray(n)){for(let e of n){let t=i.watchMap.get(e.m);t&&(delete t[e.k],0===Object.keys(t).length&&i.watchMap.delete(e.m))}n=null}};function o(e,t,s){if(!e||"object"!=typeof e)return;let o;if(-1!==(o=t.lastIndexOf("."))&&(e=i.get(e,t.substring(0,o)),t=t.substring(o+1),!e||"object"!=typeof e))return;i.watchMap.has(e)||i.watchMap.set(e,{});i.watchMap.get(e)[t]={f:s,deep:r},n.push({m:e,k:t})}}get(e,t){if(t){if(-1!==t.indexOf(".")){let s=t.split(".");for(let t=0;t<s.length-1&&(e=e[s[t]]);t++);if(!e)return;t=s[s.length-1]}e=e[t]}return e}set(e,t,s){if(-1!==t.indexOf(".")){let s=t.split(".");for(let t=0;t<s.length-1;t++)e[s[t]]||(e[s[t]]={}),e=e[s[t]];t=s[s.length-1]}e[t]=s}}class ObjectManager{constructor(e){this.module=e,this.cache=new NCache}set(e,t){this.cache.set(e+"",t)}get(e){return this.cache.get(e)}remove(e){this.cache.remove(e)}setEventParam(e,t,s,r){this.cache.set("$events."+e+".$params."+t+"."+s,r)}getEventParam(e,t,s){return this.get("$events."+e+".$params."+t+"."+s)}removeEventParam(e,t,s){this.remove("$events."+e+".$params."+t+"."+s)}clearEventParams(e,t){t?this.remove("$events."+e+".$params."+t):this.remove("$events."+e+".$params")}setDomParam(e,t,s){this.set("$domparam."+e+"."+t,s)}getDomParam(e,t){return this.get("$domparam."+e+"."+t)}removeDomParam(e,t){this.remove("$domparam."+e+"."+t)}clearDomParams(e){this.remove("$domparam."+e)}clearAllDomParams(){this.remove("$domparam")}}var o;!function(e){e[e.INIT=1]="INIT",e[e.UNMOUNTED=2]="UNMOUNTED",e[e.MOUNTED=3]="MOUNTED"}(o||(o={}));class DomManager{constructor(e){this.elementMap=new Map,this.module=e}getOriginDom(e){return this.vdomTree?function t(s){if("object"==typeof e){if(!Object.keys(e).find((t=>e[t]!==s.props.get(t))))return s}else if(s.key===e)return s;if(s.children)for(let e of s.children){let s=t(e);if(s)return s}}(this.vdomTree):null}getRenderedDom(e){if(this.renderedTree)return function e(t,s){if("object"==typeof s){if(!Object.keys(s).find((e=>s[e]!==t.props[e])))return t}else if(t.key===s)return t;if(t.children)for(let r of t.children){if(!r)continue;let t=e(r,s);if(t)return t}}(this.renderedTree,e)}clearElementMap(e){e?(this.elementMap.delete(e.key),e.props&&e.props.key&&this.elementMap.delete(e.props.key)):this.elementMap.clear()}getElement(e){return"object"==typeof e&&(e=this.getRenderedDom(e)),this.elementMap.get(e)}saveElement(e,t){this.elementMap.set(e,t)}freeNode(e){if(e.moduleId){let t=ModuleFactory.get(e.moduleId);t&&t.unmount()}else if(this.clearElementMap(e),this.module.eventFactory.unbindAll(e.key),e.children)for(let t of e.children)this.freeNode(t)}reset(){this.renderedTree=null,this.elementMap.clear()}}class Module{constructor(){this.children=[],this.id=Util.genId(),this.modelManager=new ModelManager(this),this.domManager=new DomManager(this),this.objectManager=new ObjectManager(this),this.eventFactory=new EventFactory(this),ModuleFactory.add(this)}init(){this.state=o.INIT,this.model=new Model(this.data()||{},this),this.doModuleEvent("onInit")}template(e){return null}data(){return{}}render(){if(this.state===o.UNMOUNTED)return;const e=this.template(this.props),t=void 0===this.oldTemplate;if(e!==this.oldTemplate&&(this.oldTemplate=e,this.compile()),!this.domManager.vdomTree)return;t&&this.doModuleEvent("onBeforeFirstRender"),this.doModuleEvent("onBeforeRender");const s=this.domManager.renderedTree;if(this.domManager.renderedTree=Renderer.renderDom(this,this.domManager.vdomTree,this.model),this.doModuleEvent("onRender"),t&&this.doModuleEvent("onFirstRender"),this.domManager.renderedTree)if(this.state===o.MOUNTED){if(s&&this.model){const e=DiffTool.compare(this.domManager.renderedTree,s);e.length>0&&(this.doModuleEvent("onBeforeUpdate"),Renderer.handleChangedDoms(this,e),this.doModuleEvent("onUpdate"))}}else this.mount();else this.unmount()}addChild(e){"number"==typeof e&&(e=ModuleFactory.get(e)),e&&(this.children.includes(e.id)||(this.children.push(e.id),e.parentId=this.id))}removeChild(e){let t=this.children.indexOf(e.id);-1!==t&&(e.unmount(),this.children.splice(t,1))}active(){this.state===o.UNMOUNTED&&(this.state=o.INIT),Renderer.add(this)}mount(){this.doModuleEvent("onBeforeMount");let e=new DocumentFragment;const t=Renderer.renderToHtml(this,this.domManager.renderedTree,e,!0);if(this===ModuleFactory.getMain())Renderer.getRootEl().append(t);else if(this.srcDom){const e=this.getParent();if(!e)return;this.srcElement=e.getElement(this.srcDom.key),this.srcElement&&this.srcElement.parentElement.replaceChild(t,this.srcElement),e.saveElement(this.srcDom.key,t)}this.doModuleEvent("onMount"),this.state=o.MOUNTED}unmount(){if(this.state===o.UNMOUNTED||ModuleFactory.getMain()===this)return;Renderer.remove(this.id),this.eventFactory.clear(),this.doModuleEvent("onBeforeUnMount");const e=this.getElement(1);if(e&&this.srcDom){const t=this.getParent();t&&(e.parentElement&&e.parentElement.replaceChild(this.srcElement,e),t.saveElement(this.srcDom.key,this.srcElement))}if(this.domManager.reset(),this.state=o.UNMOUNTED,this.children)for(let e of this.children){let t=ModuleFactory.get(e);t&&t.unmount()}this.doModuleEvent("onUnMount")}getParent(){if(this.parentId)return ModuleFactory.get(this.parentId)}doModuleEvent(e){let t=this[e];if(t&&"function"==typeof t)return t.apply(this,[this.model])}getMethod(e){return this[e]}setProps(e,t){let s=e.$data;if(delete e.$data,s)for(let e of Object.keys(s))this.model[e]=s[e];this.srcDom=t;let r=!1;if(this.props)for(let t of Object.keys(e))e[t]!==this.props[t]&&(r=!0);else r=!0;this.events=t.vdom.events,(r||this.state===o.UNMOUNTED)&&this.active(),this.props=e}compile(){if(this.modules&&Array.isArray(this.modules)){for(let e of this.modules)ModuleFactory.addClass(e);delete this.modules}if(this.oldTemplate&&(this.domKeyId=0,this.children=[],CssManager.clearModuleRules(this),this.objectManager.clearAllDomParams(),this.domManager.vdomTree=new Compiler(this).compile(this.oldTemplate),this.domManager.vdomTree)){if(this.events)for(let e of this.events)this.domManager.vdomTree.addEvent(e);this.doModuleEvent("onCompile")}}setExcludeProps(e){this.excludedProps=e}handleRootProps(e,t){const s={};if(e.props&&e.props.size>0)for(let r of e.props){let e;if(!this.excludedProps||!this.excludedProps.includes(r[0])){if(e=r[1]instanceof Expression?r[1].val(this,t.model):r[1],this.props&&this.props.hasOwnProperty(r[0])){let t=this.props[r[0]];t&&("style"===r[0]?(t=t.trim(),e=e?(e+";"+t).replace(/;{2,}/g,";"):t):"class"===r[0]?(t=t.trim(),e?e+=" "+t:e=t):e=t),s[r[0]]=!0}t.props[r[0]]=e}}if(this.props)for(let e of Object.keys(this.props))s[e]||this.excludedProps&&this.excludedProps.includes(e)||(t.props[e]=this.props[e])}getElement(e){return this.domManager.getElement(e)}saveElement(e,t){this.domManager.saveElement(e,t)}getModule(e,t,s){if(!this.children)return;const r=ModuleFactory.getClass(e);if(r)return function e(i){for(let n of i.children){let i=ModuleFactory.get(n);if(i){if(i.constructor===r){if(!s)return i;{let e=!0;for(let t of Object.keys(s))if(!i.props||i.props[t]!==s[t]){e=!1;break}if(e)return i}}if(t){let t=e(i);if(t)return t}}}}(this)}getModules(e,t){if(!this.children)return;let s=[];return function r(i){if(!i.children)return;for(let n of i.children){let i=ModuleFactory.get(n);i&&i.constructor&&(i.constructor.name===e&&s.push(i),t&&r(i))}}(this),s}watch(e,t,s,r){return e.__key?this.modelManager.watch(e,t,s,r):this.modelManager.watch(this.model,e,t,s)}set(e,t,s){e.__key?this.modelManager.set(e,t,s):this.modelManager.set(this.model,e,t)}get(e,t){return e.__key?this.modelManager.get(e,t):this.modelManager.get(this.model,e)}invokeMethod(e,t,s,r,i,n,o,a,l,d,c){if("function"==typeof this[e])return this[e].call(this,t,s,r,i,n,o,a,l,d,c)}invokeOuterMethod(e,t,s,r,i,n,o,a,l,d,c){if(!this.templateModuleId)return;const h=ModuleFactory.get(this.templateModuleId);return h?h.invokeMethod(e,t,s,r,i,n,o,a,l,d,c):void 0}getDomKeyId(){return++this.domKeyId}}class Router{constructor(e,t,s){this.root=new Route,this.waitList=[],this.activeModelMap=new Map,this.routerMap=new Map,this.basePath=e,this.onDefaultEnter=t,this.onDefaultLeave=s,window.addEventListener("popstate",(e=>{const t=history.state;t&&(this.startType=1,this.go(t))}))}go(e){e!==this.currentPath&&(-1===this.waitList.indexOf(e)&&this.waitList.push(e),setTimeout((()=>{this.load()}),0))}load(){if(0===this.waitList.length)return;let e=this.waitList.shift();this.start(e).then((()=>{this.load()}))}start(t){return e(this,void 0,void 0,(function*(){let e=this.compare(this.currentPath,t),s=null===e[0]?ModuleFactory.getMain():yield this.getModule(e[0]);for(let s=e[1].length-1;s>=0;s--){const r=e[1][s];if(!r.module)continue;const i=yield this.getModule(r);Util.isFunction(this.onDefaultLeave)&&this.onDefaultLeave(i,this.currentPath),Util.isFunction(r.onLeave)&&r.onLeave(i,t,this.currentPath);const n=i.getParent();n&&n.removeChild(i),i.unmount()}if(0===e[2].length){let t=e[0];if(null!==t){const s=yield this.getModule(t);this.dependHandle(s,t,e[3]?e[3].module:null)}}else for(let r=0;r<e[2].length;r++){const i=e[2][r];if(!i||!i.module)continue;const n=yield this.getModule(i);this.dependHandle(n,i,s),Util.isFunction(this.onDefaultEnter)&&this.onDefaultEnter(n,t),Util.isFunction(i.onEnter)&&i.onEnter(n,t),s=n}if(0===this.startType){let e=(this.basePath||"")+t;t.startsWith(this.currentPath)?history.replaceState(e,"",e):history.pushState(e,"",e)}this.currentPath=t,this.startType=0}))}getModule(t){return e(this,void 0,void 0,(function*(){let e=t.module;return"object"==typeof e?e:("string"==typeof e&&(e=yield ModuleFactory.load(e)),"function"==typeof e&&(t.module=ModuleFactory.get(e)),t.module)}))}compare(e,t){let s=null,r=null;e&&(s=this.getRouteList(e,!0)),t&&(r=this.getRouteList(t));let i=0;null!==s&&(i=s.length),null!==r?r.length<i&&(i=r.length):i=0;let n=[],o=[],a=0;for(a=0;a<i&&s[a].id===r[a].id;a++)if(JSON.stringify(s[a].data)!==JSON.stringify(r[a].data)){a++;break}null!==s&&(n=s.slice(a)),null!==r&&(o=r.slice(a));let l=null,d=null;if(r&&a>0)for(let e=a-1;e>=0;e--)if(l){if(!d&&r[e].module){d=r[e];break}}else if(r[e].module){l=r[e];continue}return[l,n,o,d]}addActiveModel(e,t,s,r){if(s&&r)if(this.activeModelMap.set(t,{moduleId:e,model:s,field:r}),this.routerMap.has(e)){const s=this.routerMap.get(e);s.paths?s.paths.includes(t)||s.paths.push(t):s.paths=[t]}else this.routerMap.set(e,{paths:[t]})}dependHandle(e,t,s){let r={path:t.path};if(Util.isEmpty(t.data)||(r.data=t.data),e.model.$route=r,s){const r=this.routerMap.get(s.id);r?(s=ModuleFactory.get(r.mid),e.srcDom=r.dom.children[0],s.addChild(e),e.active(),this.setDomActive(t.fullPath)):this.routerMap.set(s.id,{wait:{mid:e.id,path:t.path}})}}setDomActive(e){if(!this.activeModelMap.has(e))return;const t=this.activeModelMap.get(e);if(!this.routerMap.has(t.moduleId))return;const s=this.routerMap.get(t.moduleId).paths;if(s){t.model[t.field]=!0;for(let t of s)if(t!==e&&this.activeModelMap.has(t)){let e=this.activeModelMap.get(t);e.model[e.field]=!1}}}getRouteList(e,t){if(!this.root)return[];let s=e.split("/"),r=this.root,i=0,n=[],o="",a=this.root;for(let e=0;e<s.length;e++){let l=s[e].trim();if(""===l)continue;let d=!1;for(let e=0;e<r.children.length;e++)if(r.children[e].path===l){a!==this.root&&(a.fullPath=o,a.data=r.data,n.push(a)),r=t?r.children[e].clone():r.children[e],r.data={},a=r,d=!0,i=0;break}o+="/"+l,d||i<r.params.length&&(r.data[r.params[i++]]=l)}return r!==this.root&&(r.fullPath=o,n.push(r)),n}getRoot(){return this.root}registRouter(e,t,s){let r;if(this.routerMap.has(e)?(r=this.routerMap.get(e),r.mid=t.id,r.dom=s):(r={mid:t.id,dom:s},this.routerMap.set(e,r)),r.wait){const e=ModuleFactory.get(r.wait.mid);e.srcDom=s.children[0],t.addChild(e),e.active(),this.setDomActive(r.path),delete r.wait}}activePath(e){this.currentPath&&!e.startsWith(this.currentPath)||this.go(e)}}DefineElementManager.add([class MODULE extends DefineElement{constructor(e,t){super(e);let s=e.getProp("name");if(!s)throw new NError("itemnotempty",r.TipWords.element,"MODULE","className");e.delProp("name"),e.addDirective(new Directive("module",s,t.id))}},class FOR extends DefineElement{constructor(e,t){super(e);let s=e.getProp("cond");if(!s)throw new NError("itemnotempty",r.TipWords.element,"FOR","cond");e.delProp("cond"),e.addDirective(new Directive("repeat",s,t.id))}},class IF extends DefineElement{constructor(e,t){super(e);let s=e.getProp("cond");if(!s)throw new NError("itemnotempty",r.TipWords.element,"IF","cond");e.delProp("cond"),e.addDirective(new Directive("if",s,t.id))}},class RECUR extends DefineElement{constructor(e,t){super(e);let s=e.getProp("cond");e.delProp("cond"),e.addDirective(new Directive("recur",s,t.id))}},class ELSE extends DefineElement{constructor(e,t){super(e),e.addDirective(new Directive("else",null,t.id))}},class ELSEIF extends DefineElement{constructor(e,t){super(e);let s=e.getProp("cond");if(!s)throw new NError("itemnotempty",r.TipWords.element,"ELSEIF","cond");e.delProp("cond"),e.addDirective(new Directive("elseif",s,t.id))}},class ENDIF extends DefineElement{constructor(e,t){super(e),e.addDirective(new Directive("endif",null,t.id))}},class SLOT extends DefineElement{constructor(e,t){super(e);let s=e.getProp("name")||"default";e.delProp("name"),e.addDirective(new Directive("slot",s,t.id))}}]),Nodom.createDirective("module",(function(e,t){let s,r=e.objectManager.getDomParam(t.key,"moduleId");if(r)s=ModuleFactory.get(r);else{let i=this.value;if(s=ModuleFactory.get(i),!s)return!0;s.templateModuleId=this.templateModuleId,r=s.id,e.objectManager.setDomParam(t.key,"moduleId",r),Renderer.getCurrentModule().addChild(s)}t.moduleId=r,delete t.tagName;let i={};if(t.props)for(let e of Object.keys(t.props)){let s=t.props[e];"$"===e[0]?(i.$data||(i.$data={}),i.$data[e.substring(1)]=s,delete t.props[e]):i[e]=s}return s.setProps(i,t),!0}),8),Nodom.createDirective("model",(function(e,t){let s=e.get(t.model,this.value);return s&&(t.model=s),!0}),1),Nodom.createDirective("repeat",(function(e,t){let s=this.value;if(!Util.isArray(s)||0===s.length)return!1;const r=t.vdom,i=r.getProp("index"),n=t.parent;this.disabled=!0;for(let t=0;t<s.length;t++){if(!s[t])continue;i&&(s[t][i]=t);let o=Renderer.renderDom(e,r,s[t],n,s[t].__key);i&&delete o.props.index}return this.disabled=!1,!1}),2),Nodom.createDirective("recur",(function(e,t){const s=t.vdom;if(t.props.hasOwnProperty("ref")){s.children=[];const r="$recurs."+(t.props.ref||"default");let i=e.objectManager.get(r);if(!i)return!0;let n=t.model,o=n[i.getDirective("recur").value];if(!o)return!0;let a=i.clone();a.removeDirective("recur"),t.children||(t.children=[]),Array.isArray(o)?Renderer.renderDom(e,a,n,t,o.__key):Renderer.renderDom(e,a,o,t,o.__key)}else{if(!t.model[this.value])return!0;const r="$recurs."+(t.props.name||"default");e.objectManager.get(r)||e.objectManager.set(r,s)}return!0}),2),Nodom.createDirective("if",(function(e,t){if(t.parent)return e.objectManager.setDomParam(t.parent.key,"$if",this.value),this.value}),5),Nodom.createDirective("else",(function(e,t){if(t.parent)return!e.objectManager.getDomParam(t.parent.key,"$if")}),5),Nodom.createDirective("elseif",(function(e,t){if(t.parent)return!0!==e.objectManager.getDomParam(t.parent.key,"$if")&&!!this.value&&(e.objectManager.setDomParam(t.parent.key,"$if",!0),!0)}),5),Nodom.createDirective("endif",(function(e,t){if(t.parent)return e.objectManager.removeDomParam(t.parent.key,"$if"),!1}),5),Nodom.createDirective("show",(function(e,t){let s=e.objectManager.getDomParam(t.key,"$show");if(!(this.value||s&&s.rendered))return!1;s||(s={},e.objectManager.setDomParam(t.key,"$show",s));let r,i,n=t.props.style;return n&&(r=/display\s*\:[\w\-]+/.exec(n),null!==r)&&(i=r[0].split(":")[1].trim(),s.origin||"none"===i||(s.origin=i)),this.value?(s.rendered=!0,"none"===i&&n&&(n=s.origin?n.substring(0,r.index)+"display:"+s.origin+n.substring(r.index+r[0].length):n.substring(0,r.index)+n.substring(r.index+r[0].length))):n?i?"none"!==i&&(n=n.substring(0,r.index)+"display:none"+n.substring(r.index+r[0].length)):n+=";display:none":n="display:none",n&&(t.props.style=n),!0}),5),Nodom.createDirective("field",(function(e,t){t.assets||(t.assets={}),0===t.staticNum&&(t.staticNum=1);let s=e.get(t.model,this.value);switch(t.props.type){case"radio":let e=t.props.value;t.props.name=this.value,s==e?(t.props.checked="checked",t.assets.checked=!0):(delete t.props.checked,t.assets.checked=!1);break;case"checkbox":let r=t.props["yes-value"];s==r?(t.props.value=r,t.assets.checked=!0):(t.props.value=t.props["no-value"],t.assets.checked=!1);break;case"select":t.props.value=s,t.assets.value=s;default:let i=null!=s?s:"";t.props.value=i,t.assets.value=i}let r=GlobalCache.get("$fieldChangeEvent");return r||(r=new NEvent(null,"change",(function(e,t){const s=this.getElement(t.key);if(!s)return;const r=t.vdom.getDirective("field"),i=t.props.type;let n=r.value,o=s.value;"checkbox"===i?o=t.props["yes-value"]==o?t.props["no-value"]:t.props["yes-value"]:"radio"===i&&(s.checked||(o=void 0));let a=n.split(".");if(1===a.length)e[n]=o;else{let t=e;n=a.pop();for(let e=0;e<a.length&&t;e++)t=t[a[e]];t&&(t[n]=o)}})),GlobalCache.set("$fieldChangeEvent",r)),t.vdom.addEvent(r),!0}),10),Nodom.createDirective("route",(function(e,t){if(!Nodom.$Router)throw new NError("uninit",r.TipWords.route);if("a"===t.tagName&&(t.props.href="javascript:void(0)"),t.props.path=this.value,t.props.active){let s=t.props.active;delete t.props.active;const r=Nodom.$Router;r.addActiveModel(e.id,this.value,t.model,s),t.model[s]&&r.activePath(this.value)}let s=GlobalCache.get("$routeClickEvent");return s||(s=new NEvent(e,"click",(function(e,t,s,r){let i=t.props.path;Util.isEmpty(i)||Nodom.$Router.go(i)})),GlobalCache.set("$routeClickEvent",s)),t.vdom.addEvent(s),!0}),10),Nodom.createDirective("router",(function(e,t){if(!Nodom.$Router)throw new NError("uninit",r.TipWords.route);return t.children=[{key:t.key+"_r",model:t.model}],Nodom.$Router.registRouter(e.id,Renderer.getCurrentModule(),t),!0}),10),Nodom.createDirective("slot",(function(e,t){this.value=this.value||"default";let s=t.parent.moduleId;const r=t.vdom,i="$slots."+this.value;if(s){let n=ModuleFactory.get(s);if(n){let s=n.objectManager.get(i);s||(s={},n.objectManager.set(i,s)),s.dom=r,s.model=t.model,s.module=e}}else{let s=e.objectManager.get(i);if(s){if(!s.type){s.type=r.hasProp("innerrender")?1:2;for(let e of s.dom.children)if(n(e)){s.needBind=!0;break}function n(e){if(-1===e.staticNum)return!0;if(e.children)for(let t of e.children)if(n(t))return!0}}}else s={type:1};if(s.dom&&s.dom.children&&s.dom.children.length>0)if(1===s.type)for(let r of s.dom.children)Renderer.renderDom(e,r,t.model,t.parent,t.model.__key+"s");else{s.needBind&&s.module.modelManager.bindModel(s.model,e);for(let e of s.dom.children)Renderer.renderDom(s.module,e,s.model,t.parent,s.model.__key+"s")}}return!1}),5),EventManager.regist("tap",{touchstart(e,t,s,r){let i=r.touches[0];s.dependEvent.setParam(t,e,"pos",{sx:i.pageX,sy:i.pageY,t:Date.now()})},touchmove(e,t,s,r){let i=s.dependEvent.getParam(t,e,"pos");if(!i)return;let n=r.touches[0],o=n.pageX-i.sx,a=n.pageY-i.sy;(Math.abs(o)>5||Math.abs(a)>5)&&(i.move=!0)},touchend(e,t,s,r){let i=s.dependEvent.getParam(t,e,"pos");if(!i)return;s.dependEvent.removeParam(t,e,"pos");let n=Date.now()-i.t;if(!i.move&&n<200){let i=s.dependEvent.handler;"string"==typeof i?t.invokeMethod(s.dependEvent.handler,e.model,e,s.dependEvent,r):i.apply(t,[e.model,e,s.dependEvent,r])}}}),EventManager.regist("swipe",{touchstart(e,t,s,r){let i=r.touches[0],n=Date.now();s.dependEvent.setParam(t,e,"swipe",{oldTime:[n,n],speedLoc:[{x:i.pageX,y:i.pageY},{x:i.pageX,y:i.pageY}],oldLoc:{x:i.pageX,y:i.pageY}})},touchmove(e,t,s,r){let i=Date.now(),n=r.touches[0],o=s.dependEvent.getParam(t,e,"swipe");i-o.oldTime[1]>50&&(o.speedLoc[0]={x:o.speedLoc[1].x,y:o.speedLoc[1].y},o.speedLoc[1]={x:n.pageX,y:n.pageY},o.oldTime[0]=o.oldTime[1],o.oldTime[1]=i),o.oldLoc={x:n.pageX,y:n.pageY}},touchend(e,t,s,r){let i=s.dependEvent.getParam(t,e,"swipe"),n=Date.now(),o=n-i.oldTime[1]<30?0:1,a=i.oldLoc.x-i.speedLoc[o].x,l=i.oldLoc.y-i.speedLoc[o].y,d=Math.sqrt(a*a+l*l),c=n-i.oldTime[o];if(c>300||d<10)return;let h=d/c;if(h>.05){let i="";if(a<0&&Math.abs(l/a)<1&&(r.v0=h,i="swipeleft"),a>0&&Math.abs(l/a)<1&&(r.v0=h,i="swiperight"),l>0&&Math.abs(a/l)<1&&(r.v0=h,i="swipedown"),l<0&&Math.abs(a/l)<1&&(r.v0=h,i="swipeup"),s.dependEvent.name===i){let i=s.dependEvent.handler;"string"==typeof i?t.invokeMethod(i,e.model,e,s.dependEvent,r):"function"==typeof i&&i.apply(t,[e.model,e,s.dependEvent,r])}}}}),EventManager.regist("swipeleft",EventManager.get("swipe")),EventManager.regist("swiperight",EventManager.get("swipe")),EventManager.regist("swipeup",EventManager.get("swipe")),EventManager.regist("swipedown",EventManager.get("swipe")),EventManager.regist("dblclick",{click(e,t,s,r){let i=s.dependEvent.getParam(t,e,"firstClick");if(i){if(Date.now()-i<300){let i=s.dependEvent.handler;"string"==typeof i?t.invokeMethod(s.dependEvent.handler,e.model,e,s.dependEvent,r):i.apply(t,[e.model,e,s.dependEvent,r])}}else s.dependEvent.setParam(t,e,"firstClick",Date.now());setTimeout((()=>{s.dependEvent.removeParam(t,e,"firstClick")}),500)}});export{Compiler,CssManager,DefineElement,DefineElementManager,DiffTool,Directive,DirectiveManager,DirectiveType,o as EModuleState,EventFactory,EventManager,Expression,GlobalCache,Model,ModelManager,Module,ModuleFactory,NCache,NError,NEvent,Nodom,r as NodomMessage,t as NodomMessage_en,s as NodomMessage_zh,Renderer,Route,Router,Scheduler,Util,VirtualDom,i as nodom};
//# sourceMappingURL=nodom.esm.min.js.map
